{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#documentation-pedagogique","title":"Documentation P\u00e9dagogique","text":"<p>Bienvenue dans cette documentation p\u00e9dagogique g\u00e9n\u00e9r\u00e9e automatiquement \u00e0 l'aide de MkDocs et h\u00e9berg\u00e9e sur GitHub Pages. Cette documentation a \u00e9t\u00e9 cr\u00e9\u00e9e dans le but de vous fournir Les informations essentielles de votre contexte d'apprentissage.</p>"},{"location":"#comment-utiliser-cette-documentation","title":"Comment Utiliser Cette Documentation","text":"<ul> <li> <p>Navigation : Utilisez la barre de navigation sur la gauche pour acc\u00e9der aux diff\u00e9rentes sections de la documentation. Cliquez sur les liens pour explorer les sujets qui vous int\u00e9ressent.</p> </li> <li> <p>Recherche : Si vous recherchez des informations sp\u00e9cifiques, utilisez la fonction de recherche en haut de la page pour trouver rapidement ce dont vous avez besoin.</p> </li> <li> <p>Contributions et Corrections : Cette documentation est h\u00e9berg\u00e9e sur GitHub. Si vous identifiez des erreurs, des inexactitudes ou si vous souhaitez contribuer en ajoutant du contenu, vous \u00eates invit\u00e9 \u00e0 soumettre des Pull Requests.</p> </li> </ul>"},{"location":"#hebergement-sur-github-pages","title":"H\u00e9bergement sur GitHub Pages","text":"<p>Cette documentation est automatiquement mise en ligne gr\u00e2ce \u00e0 GitHub Pages, une fonctionnalit\u00e9 de GitHub qui permet de publier facilement du contenu statique. Chaque fois que des modifications sont apport\u00e9es \u00e0 la documentation et pouss\u00e9es vers la branche principale du r\u00e9f\u00e9rentiel (main), les GitHub Actions sont d\u00e9clench\u00e9es pour g\u00e9n\u00e9rer et d\u00e9ployer automatiquement les changements dans la documentation \u00e0 chaque \"Push\". Ce principe s'appelle CI/CD.</p> CI/CD <p>CI/CD est l'acronyme de Continuous Integration (Int\u00e9gration Continue) et Continuous Delivery (Livraison Continue) ou Continuous Deployment (D\u00e9ploiement Continu). Ces pratiques sont utilis\u00e9es dans le d\u00e9veloppement logiciel pour am\u00e9liorer la qualit\u00e9 du code et acc\u00e9l\u00e9rer le processus de livraison des logiciels. Voici une d\u00e9finition rapide de chaque terme : -    Continuous Integration (CI) : Pratique consistant \u00e0 int\u00e9grer r\u00e9guli\u00e8rement les modifications de code dans un d\u00e9p\u00f4t central, g\u00e9n\u00e9ralement plusieurs fois par jour. Cela permet de d\u00e9tecter les erreurs t\u00f4t gr\u00e2ce \u00e0 des tests automatis\u00e9s qui v\u00e9rifient chaque int\u00e9gration. -    Continuous Delivery (CD) : Pratique qui \u00e9tend CI en automatisant le processus de livraison du code jusqu'\u00e0 un environnement de staging ou de pr\u00e9-production. Cela permet de garantir que le code est toujours pr\u00eat \u00e0 \u00eatre d\u00e9ploy\u00e9 en production \u00e0 tout moment. -    Continuous Deployment (CD) : Variante de Continuous Delivery o\u00f9 le code est automatiquement d\u00e9ploy\u00e9 en production d\u00e8s qu'il passe les tests automatis\u00e9s. Cela permet des mises \u00e0 jour fr\u00e9quentes et rapides en production. Ces pratiques favorisent une approche agile et r\u00e9active, r\u00e9duisent les risques et am\u00e9liorent la qualit\u00e9 du produit final.</p> <p>Il existe de nombreux outils d\u00e9di\u00e9s \u00e0 la documentation:</p>"},{"location":"#outils-de-documentation","title":"Outils de documentation","text":"<p>L'ensemble du projet que vous allez pr\u00e9parer cette ann\u00e9e devra etre document\u00e9 avec l'un de ces outils et \u00eatre heberg\u00e9 via github pages afin que l'acc\u00e8s soit toujhours possible m\u00eame apr\u00e8s l'obtention de votre d\u00e9pot. Vous veuillerez \u00e0 transmetrte \u00e0 vos enseignants l'URL de la documentation afin qu'elle puisse \u00eatre lue nottament pour les \u00e9preuves de fin d'ann\u00e9e.</p> <p>L'anc\u00eatre de ces outils est le format DocBook (en XML), suivi d'Asciidoc, avant la cr\u00e9ation du langage Markdown (MD).</p> mkdocsDocusaurus SphinxAstro <pre><code>https://squidfunk.github.io/mkdocs-material/publishing-your-site/\n</code></pre> <pre><code>https://docusaurus.io/fr/docs/\n</code></pre> <pre><code>https://www.sphinx-doc.org/en/master/usage/installation.html\n</code></pre> <pre><code>https://docs.astro.build/fr/getting-started/\n</code></pre>"},{"location":"#gestion-des-secrets-mots-de-passe","title":"Gestion des secrets (mots de passe)","text":"<p>L'ensemble des mots de passe utilis\u00e9s dans votre infrastructure ne doit pas \u00eatre pr\u00e9sent dans cette documentation. Vous choisirez un gestionnaire de mots de passe s\u00e9curis\u00e9 afin de partager les mots de passe avec vos coll\u00e8gues. L\u00e0 encore, il n'y a que l'embarras du choix concernant les outils (Bitwarden, LastPass, Dashlane, PassBolt), etc.</p> <p>N'h\u00e9sitez pas \u00e0 explorer les diff\u00e9rentes sections et \u00e0 profiter de cette ressource pour enrichir votre compr\u00e9hension des sujets abord\u00e9s.</p> <p>Happy learning!</p>"},{"location":"contexte/01-pr%C3%A9sentation/","title":"Pr\u00e9sentation","text":""},{"location":"contexte/01-pr%C3%A9sentation/#bts-sio-option-sisr","title":"BTS SIO option SISR","text":""},{"location":"contexte/01-pr%C3%A9sentation/#annee-scolaire-2025-2026","title":"Ann\u00e9e scolaire 2025-2026","text":"<p>Auteur : Ludovic MERY Co-Enseignant : Kevin Huet</p> <p></p>"},{"location":"contexte/01-pr%C3%A9sentation/#presentation-generale-de-lentreprise","title":"Pr\u00e9sentation g\u00e9n\u00e9rale de l\u2019entreprise","text":""},{"location":"contexte/01-pr%C3%A9sentation/#activite","title":"Activit\u00e9","text":"<p>SportLudique SARL est une soci\u00e9t\u00e9e implant\u00e9 en r\u00e9gion centre sp\u00e9cialis\u00e9e dans la conception et la fabrication d\u2019articles de sports et de loisirs compos\u00e9e de 452 personnes r\u00e9parties autour de trois sites g\u00e9ographiques : Chartres, Tours, Orl\u00e9ans.</p> <p>Elle dispose d\u2019un quatri\u00e8me site sur Bourges suite \u00e0 la mise en place d\u2019une filiale sp\u00e9cialis\u00e9e dans la logistique.</p> <p>Le si\u00e8ge de SportLudique se situe dans l\u2019agglom\u00e9ration chartraine.</p> <p>Elle enregistre de bons r\u00e9sultats gr\u00e2ce \u00e0 une gamme de produits compl\u00e8te (pour tous les \u00e2ges) et conna\u00eet depuis peu un essor consid\u00e9rable proposant des installations cl\u00e9 en main aux collectivit\u00e9s</p>"},{"location":"contexte/01-pr%C3%A9sentation/#donnees-economiques-et-juridiques","title":"Donn\u00e9es \u00e9conomiques et juridiques","text":"D\u00e9nomination sociale SportLudique D\u00e9but d'activit\u00e9 : 16/10/1995 Siret : 347839493 00021 Statut juridique SARL Capital Social 485 000 \u20ac Chiffre d\u2019affaire 2014 8 562 000 \u20ac Benefice net 2014 1 735 200 \u20ac Nombre d\u2019employ\u00e9s 452"},{"location":"contexte/01-pr%C3%A9sentation/#organigramme","title":"Organigramme","text":"<p>La Direction des Services Informatiques est sous la direction de Monsieur Claude Postic</p> <p>Celui-ci a sous ses ordres 4 techniciens.</p> <p>Le service RH est dirig\u00e9 par Ms Helen Paisley-Le Bihan.</p>"},{"location":"contexte/01-pr%C3%A9sentation/#situation-et-repartition-geographique","title":"Situation et r\u00e9partition g\u00e9ographique","text":"<p>La soci\u00e9t\u00e9 est articul\u00e9e autour de quatre sites g\u00e9ographiques :</p> <ul> <li> <p>le site de Chartres : il regroupe la direction, le marketing, les     &gt; finances, les ressources humaines et la direction des services     &gt; informatiques (DSI) ;</p> </li> <li> <p>le site d\u2019Orl\u00e9ans : il regroupe l\u2019usine de production des     \u00e9quipements ext\u00e9rieurs bois.</p> </li> <li> <p>le site de Tours : il regroupe le laboratoire de test et la     &gt; production des \u00e9quipements plastique</p> </li> <li> <p>le site de Bourges\u00a0: situ\u00e9 id\u00e9alement au centre de la France,     &gt; les stocks et la logistique sont la sp\u00e9cialit\u00e9 de ce site.</p> </li> </ul> <p></p>"},{"location":"contexte/02-SystemeInformation/","title":"Le Syst\u00e8me d'Information","text":""},{"location":"contexte/02-SystemeInformation/#presentation-de-linfrastructure-informatique","title":"Pr\u00e9sentation de l\u2019infrastructure Informatique","text":"<p>Le syst\u00e8me d'information (SI) de SportLudique refl\u00e8te la dynamique de l'entreprise : mis en place il y a quelques ann\u00e9es, il a depuis connu une expansion consid\u00e9rable. SportLudique est divis\u00e9e en quatre domaine windows autonomes, chacun op\u00e9rant sur un site g\u00e9ographique distinct et control\u00e9 par un controleur de domaine ind\u00e9pendant.</p> <p>En r\u00e9ponse \u00e0 la croissance de l'activit\u00e9 et \u00e0 divers projets informatiques, des serveurs Windows 2019 Server et Windows Server 2022 ont \u00e9t\u00e9 int\u00e9gr\u00e9s au syst\u00e8me. Cette initiative visait \u00e0 renforcer la fiabilit\u00e9 et \u00e0 ajouter des fonctionnalit\u00e9s, le tout sans perturber l'infrastructure existante. </p> <p>L'architecture actuelle repose sur la virtualisation, mise en \u0153uvre \u00e0 travers de la solution hyperconverg\u00e9e propos\u00e9e par Nutanix et son hypervieur AHV. Un projet de mise en oeuvre d'un syst\u00e8me de tol\u00e9rance aux pannes reposant sur des hyperviseurs Proxmox sera \u00e0 mettre en oeuvre et devront accueillir \u00e0 minima un controlleur de domaine secondaire pour assurer une haute disponibilit\u00e9 de ce service critique.</p> <p>Chaque site b\u00e9n\u00e9ficie de son propre d\u00e9partement informatique, couvrant un large \u00e9ventail de responsabilit\u00e9s allant de l'administration r\u00e9seau et syst\u00e8me (Windows et Linux), la supervision de l'infrastructure \u00e0 l'assistances aux utilisateurs via une solution de helpdesk qu'il faudra mettre en oeuvre.</p> <p>Les utilisateurs font partie d'un domaine g\u00e9r\u00e9 localement par d\u00e9l\u00e9gation du nom de domaine commun sportludique.fr. Les postes de travail de l'\u00e9quipe IT sont sous Linux avec une interface utilisateur (GUI). Ils utilisent diverses applications adapt\u00e9es \u00e0 leurs activit\u00e9s, notamment des suites bureautiques telles que LibreOffice, ainsi que des outils graphiques ou des applications internes d\u00e9velopp\u00e9es au sein de l'entreprise.</p> <p>L'administration des machines windows se fera avec un client SSH int\u00e9gr\u00e9 nativement au syst\u00e8me sans bureau X11 L'administration des machines Windows se fera avec un client RDP (Remote Desktop Protocol) d\u00e9j\u00e0 int\u00e9gr\u00e9 aux postes de travail via la commande suivante:</p> <p><code>xfreerdp /u:user@domain.tld /v:fqdn-server-or-IP /sec:nla</code></p> <p>Le plus simple sera d'utiliser le logiciel Remina un logiciel de bureau \u00e0 distance et un client SSH sous linux sans oublier le plugin pour prendre en charge le protocole RDP.</p>"},{"location":"contexte/03_infrastructure-actuelle/","title":"Infrastructure actuelle","text":""},{"location":"contexte/03_infrastructure-actuelle/#extrait-de-linfrastructure-par-site","title":"Extrait de l\u2019infrastructure par site","text":""},{"location":"contexte/03_infrastructure-actuelle/#site-de-chartres-siege-social","title":"Site de chartres (si\u00e8ge social)","text":"Nombre d\u2019utilisateurs 132 Nombres de stations de travail 132 fixes 100 portables 12 Nombre de serveurs 10"},{"location":"contexte/03_infrastructure-actuelle/#site-dorleans","title":"Site d\u2019Orl\u00e9ans","text":"Nombre d\u2019utilisateurs 60 Nombres de stations de travail 83 fixes 80 portables 3 Nombre de serveurs 11"},{"location":"contexte/03_infrastructure-actuelle/#site-de-tours","title":"Site de Tours","text":"Nombre d\u2019utilisateurs 179 Nombres de stations de travail 95 fixes 90 portables 5 Nombre de serveurs 10"},{"location":"contexte/03_infrastructure-actuelle/#site-de-bourges","title":"Site de Bourges","text":"Nombre d\u2019utilisateurs 81 Nombres de stations de travail 50 fixes 40 portables 10 Nombre de serveurs 3"},{"location":"contexte/03_infrastructure-actuelle/#details-des-equipements-serveurs-par-site","title":"D\u00e9tails des \u00e9quipements serveurs par site","text":""},{"location":"contexte/03_infrastructure-actuelle/#site-de-chartres","title":"Site de Chartres","text":"Nom Fonction OS CHA_DC_01 Contr\u00f4leur principal de domaine Windows server 2012 Serveur primaire DNS Domaine : chartres.local Serveur DHCP Serveur de fichiers CHA_DC_02 Contr\u00f4leur secondaire de domaine Windows server 2012 R2 Serveur secondaire DNS Serveur de fichiers repliqu\u00e9 SL_BDD Serveur de base de donn\u00e9es Linux Debian 8 + MySQL SL_OCS Serveur d\u2019inventaire Linux Debian 8 + OCS Inventory \u2026"},{"location":"contexte/03_infrastructure-actuelle/#site-dorleans_1","title":"Site d\u2019Orl\u00e9ans","text":"Nom Fonction OS ORL_DC_01 Contr\u00f4leur principal de domaine Windows server 2008 R2 Serveur primaire DNS Domaine : orleans.local Serveur DHCP Serveur de fichiers ORL_DC_02 Contr\u00f4leur secondaire de domaine Windows server 2008 R2 Serveur secondaire DNS Serveur de fichiers repliqu\u00e9 \u2026 \u2026 \u2026"},{"location":"contexte/03_infrastructure-actuelle/#site-de-tours_1","title":"Site de Tours","text":"Nom Fonction OS TRS_DC_01 Contr\u00f4leur principal de domaine Windows server 2008 R2 Serveur primaire DNS Domaine : tours.local Serveur DHCP Serveur de fichiers TRS_DC_02 Contr\u00f4leur secondaire de domaine Windows server 2008 R2 Serveur secondaire DNS Serveur de fichiers repliqu\u00e9 \u2026 \u2026 \u2026"},{"location":"contexte/03_infrastructure-actuelle/#site-de-bourges_1","title":"Site de Bourges","text":"Nom Fonction OS BRG_DC_01 Contr\u00f4leur principal de domaine Windows server 2008 R2 Serveur primaire DNS Domaine : Bourges.local Serveur DHCP Serveur de fichiers BRG_DC_02 Contr\u00f4leur secondaire de domaine Windows server 2008 R2 Serveur secondaire DNS Serveur de fichiers repliqu\u00e9 \u2026 \u2026 \u2026"},{"location":"contexte/03_infrastructure-actuelle/#topologie-physique-sur-le-site-de-chartres","title":"Topologie physique sur le site de chartres","text":""},{"location":"contexte/03_infrastructure-actuelle/#topologie-logique-actuelle","title":"Topologie Logique actuelle","text":""},{"location":"contexte/03_infrastructure-actuelle/#dysfonctionnement-du-si","title":"Dysfonctionnement du SI","text":"<p>La DSI de l\u2019entreprise a demand\u00e9 en 2022 \u00e0 une soci\u00e9t\u00e9 ext\u00e9rieure d\u2019auditer son syst\u00e8me d\u2019information. Le rapport d\u2019audit, dat\u00e9 de mars 2023, a permis de mettre en lumi\u00e8re les dysfonctionnements suivants:</p>"},{"location":"contexte/03_infrastructure-actuelle/#1-des-processus-et-des-choix-heterogenes","title":"1-Des processus et des choix h\u00e9t\u00e9rog\u00e8nes","text":"<p>Aujourd\u2019hui, chaque site poss\u00e8de sa propre m\u00e9thode de travail, ses choix de syst\u00e8mes d\u2019exploitation et de logiciels. A titre d\u2019exemple, chaque site poss\u00e8de aujourd\u2019hui son propre antivirus. Il reste donc tr\u00e8s difficile, voire souvent impossible, de mettre en place des solutions globales au niveau de l\u2019organisation.</p>"},{"location":"contexte/03_infrastructure-actuelle/#2-des-couts-de-gestion-important","title":"2-Des couts de gestion important","text":"<p>L\u2019organisation regroupe, sur l\u2019ensemble de ses quatre sites, une tr\u00e8s grande diversit\u00e9 de serveurs et de stations de travail :</p> <p>La gamme des stations de travail est \u00e0 l\u2019\u00e9gale de la gamme des serveurs puisque l\u2019on y retrouve des clients install\u00e9s au fil des livraisons mat\u00e9rielles.</p> <p>Les techniciens du centre d\u2019appels de la DSI (site de Chartres) sont ainsi oblig\u00e9s de conna\u00eetre plusieurs syst\u00e8mes d\u2019exploitation clients tels que Windows 2008 R2, Windows 7, Windows 10 sans oublier les diff\u00e9rentes versions serveurs de Windows ainsi que les diff\u00e9rentes distributions Linux utilis\u00e9es (Debian, CentOS pour ne citer qu\u2019elles) et les diverses applications, souvent dupliqu\u00e9es quand elles ne sont pas tripl\u00e9es.</p> <p>Cette situation induit une charge de travail et des co\u00fbts importants pour le centre d\u2019appels.</p>"},{"location":"contexte/03_infrastructure-actuelle/#3-une-reactivite-lente","title":"3-Une r\u00e9activit\u00e9 lente","text":"<p>Vu la diversit\u00e9 des versions des syst\u00e8mes d\u2019exploitation des stations de travail et des serveurs, la qualification des logiciels se voit multipli\u00e9e par trois.</p> <p>Ainsi, par exemple, la suite bureautique LibreOffice est pr\u00e9sente sous diff\u00e9rentes versions sur les diff\u00e9rents sites. Il faut donc tester le bon fonctionnement de chaque version LibreOffice aussi bien sous Windows  ce qui ne se passe pas toujours bien.</p> <p>En outre, lorsqu\u2019un probl\u00e8me est d\u00e9tect\u00e9 sur une plateforme ou qu\u2019un nouveau Service Pack sort afin d\u2019am\u00e9liorer la s\u00e9curit\u00e9 ou apporter des fonctionnalit\u00e9s suppl\u00e9mentaires, il faut le temps de le tester et de le d\u00e9ployer sans impact sur les autres plateformes.</p> <p>L\u2019entreprise souffre donc de probl\u00e8mes de r\u00e9activit\u00e9 au niveau de la gestion de son parc.</p>"},{"location":"contexte/03_infrastructure-actuelle/#une-gestion-du-parc-informatique-trop-complexe","title":"Une gestion du parc informatique trop complexe","text":"<p>L\u2019entreprise ne poss\u00e8de pas de m\u00e9thode d\u2019installation industrialis\u00e9e pour les syst\u00e8mes d\u2019exploitation clients et serveurs.</p> <p>La mise en service de stations de travail ou de serveurs se fait donc manuellement. Cela n\u00e9cessite la mobilisation de techniciens sp\u00e9cialis\u00e9s et form\u00e9s \u00e0 ces proc\u00e9dures complexes (Boot sur cl\u00e9 USB et r\u00e9ponse aux questions manuelle, ceci r\u00e9p\u00e9t\u00e9 sur autant de postes que compte le parc)</p> <p>L\u2019impact sur le d\u00e9lai de la mise en production et le co\u00fbt des machines est \u00e9videmment tr\u00e8s cons\u00e9quent.</p>"},{"location":"contexte/03_infrastructure-actuelle/#un-si-peu-securise","title":"Un SI peu s\u00e9curis\u00e9","text":"<p>Le syst\u00e8me d\u2019informatique tel que d\u00e9fini actuellement est tr\u00e8s peu s\u00e9curis\u00e9.</p> <p>Les principales d\u00e9faillances rep\u00e9r\u00e9es au niveau de la s\u00e9curit\u00e9 tiennent aux faits suivants :</p> <ul> <li> <p>pr\u00e9sence d\u2019anciennes versions de syst\u00e8mes d\u2019exploitation, qui     imposent par exemple de maintenir des protocoles de communication     non s\u00e9curis\u00e9s, octroi par d\u00e9faut, \u00e0 tous les utilisateurs, du statut     d\u2019administrateurs de leur station de travail, ce qui ouvre la voie,     entre autre, \u00e0 :</p> <ul> <li> <p>l\u2019installation d\u2019applications non conformes,</p> </li> <li> <p>l\u2019utilisation de p\u00e9riph\u00e9riques externes (sans compter l\u2019impact     sur la gestion par le centre d\u2019appels).</p> </li> </ul> </li> <li> <p>absence de syst\u00e8me centralis\u00e9 de mise \u00e0 jour de correctifs.</p> </li> </ul>"},{"location":"contexte/Objectifs/00-Objectifs/","title":"Objectifs \u00e0 atteindre","text":""},{"location":"contexte/Objectifs/00-Objectifs/#objectifs-strategiques-de-la-dsi","title":"Objectifs strat\u00e9giques de la DSI","text":"<p>Suite au rapport d\u2019audit, la Direction a d\u00e9cid\u00e9 de r\u00e9agir pour corriger les dysfonctionnements constat\u00e9s et ainsi optimiser les performances globales de l\u2019entreprise.</p> <p>Apr\u00e8s concertation des diff\u00e9rents acteurs du SI de l\u2019entreprise, et de multiples r\u00e9unions de travail, le comit\u00e9 de direction a dress\u00e9 pour l\u2019ann\u00e9e 2024-2025, quatre grands axes de travail:</p> <ul> <li>R\u00e9duire les co\u00fbts</li> <li>Prendre en compte la dimension cartographique</li> <li>S\u00e9curiser le SI</li> <li>Placer l'entreprise dans une logique de developement durable (Politique RSE)</li> </ul> Politique RSE <p>Une politique RSE (Responsabilit\u00e9 Soci\u00e9tale des Entreprises) est un ensemble d'engagements et de pratiques adopt\u00e9s par une entreprise pour int\u00e9grer des pr\u00e9occupations sociales, environnementales, \u00e9thiques, et \u00e9conomiques dans ses activit\u00e9s et ses interactions avec ses parties prenantes (salari\u00e9s, clients, fournisseurs, etc.). Elle vise \u00e0 contribuer au d\u00e9veloppement durable en prenant en compte l'impact de l'entreprise sur la soci\u00e9t\u00e9 et l'environnement, tout en assurant sa performance \u00e9conomique. Cela peut inclure des initiatives en mati\u00e8re de r\u00e9duction des \u00e9missions de carbone, d'am\u00e9lioration des conditions de travail, de respect des droits de l'homme, et de transparence dans la gouvernance.</p> <p>Ces axes, qui d\u00e9finissent en fait quatre objectifs strat\u00e9giques, concernent tous les services de l\u2019entreprise, mais s\u2019adressent tout particuli\u00e8rement \u00e0 la DSI.</p> <p>Celle-ci les a convertis en strategies op\u00e9rationnelles qui lui permettront de faire \u00e9voluer le SI actuellement en place en ad\u00e9quation avec les demandes de la Direction.</p>"},{"location":"contexte/Objectifs/00-Objectifs/#strategies-operationnelles-de-la-dsi","title":"Strat\u00e9gies op\u00e9rationnelles de la DSI","text":"<p>L\u2019\u00e9quipe informatique de la DSI a pris connaissance de l\u2019ensemble des demandes de la direction et en a d\u00e9gag\u00e9, \u00e0 son niveau, trois objectifs op\u00e9rationnels de travail correspondant aux objectifs strat\u00e9giques. Il n'y a pas de strat\u00e9gie organisationnelle pour le quatri\u00e8me objectifs strat\u00e9gique  :</p> <ul> <li>La premi\u00e8re strategie consistera \u00e0 concevoir une nouvelle infrastructure     informatique qui proposera une plateforme mat\u00e9rielle et logicielle     commune \u00e0 tous les sites. Elle sera la base d\u2019un travail de fond sur la     r\u00e9duction des co\u00fbts, la s\u00e9curisation et la r\u00e9activit\u00e9 du SI.</li> </ul> <p>Exemples :</p> R\u00e9duction des co\u00fbts all\u00e8gement de la charge de travail du centre d\u2019appels, par un contr\u00f4le total de l\u2019environnement de travail de l\u2019utilisateur, et donc recentrage des comp\u00e9tences et des champs d\u2019interventions des techniciens. S\u00e9curisation contr\u00f4le total de l\u2019environnement de travail : les utilisateurs ne pourront \u00eatre vecteurs d\u2019intrusion de virus par des t\u00e9l\u00e9chargements malveillants, des cl\u00e9s USB... R\u00e9activit\u00e9 du SI r\u00e9duction du temps de mise \u00e0 jour des nouvelles versions des logiciels applicatifs D\u00e9veloppement durable limitation des \u00e9ditions papier, de la consommation d'\u00e9nergie\u2026 <ul> <li> <p>La seconde strat\u00e9gie vis\u00e9e est d\u2019offrir une plus grande disponibilit\u00e9     de l\u2019infrastructure, des serveurs et des stations de travail : cela     participera \u00e9galement \u00e0 la r\u00e9duction des co\u00fbts. Tout doit \u00eatre mis     en \u0153uvre pour simplifier l\u2019acc\u00e8s aux donn\u00e9es et accro\u00eetre la     productivit\u00e9 de l\u2019utilisateur en lui assurant une haute disponibilit\u00e9 au SI.</p> </li> <li> <p>La troisi\u00e8me strat\u00e9gie portera sur l\u2019industrialisation des     installations des stations de travail et des serveurs, l\u2019uniformit\u00e9     des choix logiciels et l\u2019all\u00e9gement de la charge de travail du     centre d\u2019appels.</p> </li> </ul>"},{"location":"contexte/Objectifs/01-Objectif-1/","title":"Objectif strat\u00e9gique 1\u00a0: R\u00e9duire les co\u00fbts","text":"<p>L\u2019entreprise bien qu\u2019encore en pleine croissance per\u00e7oit un tassement du march\u00e9 sur lequel elle travaille : la concurrence se fait plus rude, les clients sont de plus en plus regardant sur les prix. Pour maintenir sa position sur son march\u00e9, elle doit absolument maintenir ses prix de vente. Cela passe par une ma\u00eetrise totale de ses co\u00fbts de production, mais \u00e9galement de ses co\u00fbts structurels. L\u2019audit ayant montr\u00e9 que les co\u00fbts induits par les dysfonctionnements de son SI \u00e9taient nombreux, la direction demande \u00e0 la DSI de travailler dans le sens d\u2019une r\u00e9duction des co\u00fbts d\u2019infrastructure et de fonctionnement du SI.</p>"},{"location":"contexte/Objectifs/01-Objectif-1/#strategie-operationnelle-reorganisation-au-sein-dune-architecture-unique","title":"Strat\u00e9gie Operationnelle\u00a0: R\u00e9organisation au sein d\u2019une architecture unique","text":"<p>Informatiquement parlant, il est possible de consid\u00e9rer la filiale de Bourges de deux fa\u00e7ons :</p> <p>- Soit comme un partenaire communiquant avec SportLudique,</p> <p>- Soit comme faisant partie int\u00e9grante de l\u2019infrastructure de SportLudique.</p> <p>La direction souhaitant absorber juridiquement cette filliale, il para\u00eet \u00e9vident de l\u2019absorber dans la l\u2019infrastructure de SportLudique tout en conservant ses sp\u00e9cificit\u00e9s:</p> <p>Il en d\u00e9coule que l\u2019entreprise sera r\u00e9organis\u00e9e de la fa\u00e7on suivante :</p> <ul> <li> <p>Les trois sites de Chartres, Orl\u00e9ans et Tours poss\u00e9deront chacun un     serveur d\u2019infrastructure li\u00e9 au domaine auquel il appartient,</p> </li> <li> <p>La succursale de Bourges, qui ne concerne que dix utilisateurs,     n\u2019aura ni serveur d\u2019infrastructure, ni domaine. Le SI sera     accessible par un moyen s\u00e9curis\u00e9 en utilisant une connexion     distante.</p> </li> <li> <p>Toutefois, pour des raisons p\u00e9dagogique la succursale de Bourges disposera de son infrastructure autonome.</p> </li> </ul>"},{"location":"contexte/Objectifs/01-Objectif-1/#choix-de-la-solution-dinfrastructure-organisationnelle","title":"Choix de la solution d\u2019infrastructure organisationnelle","text":"<p>Les serveurs d\u2019infrastructure auront les r\u00f4les de services r\u00e9seaux de base, tels que serveurs DNS, serveurs DHCP, Annuaure Active Directory.</p> <p>La DSI a retenu la mise en \u0153uvre d\u2019un annuaire Active Directory bas\u00e9 sur un mod\u00e8le de for\u00eat unique reposant sur des serveurs Windows 2019 minimum.</p> <p>Cette solution permet d\u2019exploiter les avantages de l\u2019annuaire Active Directory autour du nom de domaine sportludique.fr. Le fait de rassembler l\u2019organisation de l\u2019entreprise sous une forme de for\u00eat unique ne ferme pas les portes sur les possibilit\u00e9s d\u2019isoler une partie de l\u2019entreprise ayant des besoins sp\u00e9cifiques, en mati\u00e8re de s\u00e9curit\u00e9 par exemple.</p> <p>L\u2019annuaire Active Directory permet d\u2019exploiter de nouvelles fonctionnalit\u00e9s telles que la prise en compte des notions de site, d\u2019unit\u00e9 organisationnelle, de groupe universel.</p> <p>On pourra appliquer des strat\u00e9gies de groupe aux utilisateurs et aux ordinateurs en fonction de crit\u00e8res multiples.</p> <p>Par cette r\u00e9organisation, l\u2019entreprise va r\u00e9duire consid\u00e9rablement le trafic r\u00e9seau et les relations d\u2019approbation au travers du r\u00e9seau. Elle conservera une certaine ind\u00e9pendance au niveau de l\u2019administration, tout en int\u00e9grant sa nouvelle filiale au sein d\u2019une organisation unique.</p>"},{"location":"contexte/Objectifs/01-Objectif-1/#refonte-du-plan-dadressage-ip","title":"Refonte du plan d\u2019adressage IP","text":"<p>Cette r\u00e9organisation est l\u2019occasion r\u00eav\u00e9e de remettre \u00e0 plat le plan d\u2019adressage IP et le plan de nommage afin d\u2019harmoniser et de simplifier l\u2019utilisation du r\u00e9seau au travers des diff\u00e9rents sites, de clarifier les r\u00f4les des serveurs et d\u2019anticiper le futur (rachat de nouvelles soci\u00e9t\u00e9s par exemple).</p>"},{"location":"contexte/Objectifs/02-Objectif-2/","title":"Objectif Strat\u00e9gique 2\u00a0: Prendre en compte la dimension cartographique","text":"<p>La cartographie va sous peu \u00e9voluer du fait la la redistribution des r\u00f4les entre les deux sites de production de Tours et Orl\u00e9ans :</p> <p>Les 2 sites de production et d\u2019acheminement de Tours et Orl\u00e9ans vont \u00eatre regroup\u00e9s en un seul (sur Tours), le site d\u2019Orl\u00e9ans gardant sa sp\u00e9cificit\u00e9 de R&amp;D.</p> <p>La Direction demande particuli\u00e8rement \u00e0 la DSI de r\u00e9fl\u00e9chir d\u00e8s maintenant \u00e0 la mani\u00e8re d\u2019int\u00e9grer ces nouveaux param\u00e8tres dans l\u2019infrastructure existante.</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#strategie-operationnelle-optimiser-la-gestion-et-la-disponibilite-de-linfrastructure","title":"Strat\u00e9gie Operationnelle\u00a0: Optimiser la gestion et la disponibilit\u00e9 de l\u2019infrastructure","text":"<p>Tout doit \u00eatre mis en \u0153uvre plus rendre l\u2019infrastructure globalement plus disponible, tant au niveau des serveurs que de des postes utilisateurs, ce qui revient \u00e0 assurer une plus grande disponibilit\u00e9 et donc productivit\u00e9 des utilisateurs et des techniciens du centre d\u2019appels.</p> <p>Cela passera par diff\u00e9rents moyens d\u2019action :</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#mise-en-place-doutils-de-gestion-de-par-cet-de-supervision-reseau","title":"Mise en place d\u2019outils de gestion de par cet de supervision r\u00e9seau","text":"<p>Pour pouvoir r\u00e9duire le co\u00fbt des serveurs et des stations de travail, il sera important de limiter le nombre d\u2019interventions et le temps pass\u00e9 sur chaque machine.</p> <p>Pour cela, deux actions de base devront \u00eatre mises en place :</p> <ul> <li> <p>Les serveurs seront install\u00e9s \u00e0 partir de techniques dites silencieuses, avec des fichiers de r\u00e9ponses.</p> </li> <li> <p>Les stations de travail seront industrialis\u00e9es avec l\u2019installation des Service Packs et autres. Les postes utilisateurs seront pr\u00e9configur\u00e9s avec les logiciels n\u00e9cessaires au fonctionnement de la station de travail de base.</p> </li> </ul> <p>Les outils de gestion de parc et de supervision de r\u00e9seau devront donc \u00eatre \u00e9tudi\u00e9s et mis en place, afin de rationaliser les interventions du centre d\u2019appels.</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#mise-en-place-doutils-de-deploiement","title":"Mise en place d\u2019outils de d\u00e9ploiement","text":"<p>On d\u00e9ploiera les logiciels par l\u2019interm\u00e9diaire de la technologie Intelligente propos\u00e9 par les syst\u00e8mes d\u2019exploitation (Strat\u00e9gies de groupes par exemple) ou des solutions applicative sp\u00e9cialis\u00e9es (d\u00e9ploiement via GLPI par exemple).</p> <p>Pour r\u00e9duire les co\u00fbts li\u00e9s aux interventions des techniciens sur les sites, on mettra en place un mod\u00e8le de poste standard (Master)</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#homogeneite-logiciels-des-stations-de-travail","title":"Homog\u00e9n\u00e9it\u00e9 logiciels des stations de travail","text":"<p>Pour garantir la bonne utilisation des postes, la DSI publiera les logiciels de base, ce qui pr\u00e9sentera l\u2019int\u00e9r\u00eat de permettre une remise en \u00e9tat automatique en cas de suppression volontaire ou involontaire de la part de l\u2019utilisateur.</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#limitation-des-droits-des-utilisateurs","title":"Limitation des droits des utilisateurs","text":"<p>Pour ne plus avoir de probl\u00e8mes de stabilit\u00e9 sur les stations de travail, les utilisateurs ne seront plus administrateurs de leur station. Il faudra donc utiliser la politique du moindre privil\u00e8ge.</p> <p>On utilisera des mod\u00e8les de s\u00e9curit\u00e9 pour appliquer des param\u00e8tres de s\u00e9curit\u00e9 coh\u00e9rents sur l\u2019ensemble des stations de travail de l\u2019organisation. On cr\u00e9era des strat\u00e9gies de groupe en fonction des besoins des services (ressources humaines, finances\u2026) et des contraintes de domaine et de site, pour assurer la meilleure utilisation des postes selon les besoins sp\u00e9cifiques, et uniquement les besoins.</p> <p>La mise en place de clich\u00e9s instantan\u00e9s permettra aux utilisateurs de g\u00e9rer eux-m\u00eames les sauvegardes des diff\u00e9rentes versions de leurs fichiers. Par une interface tr\u00e8s simple, ils pourront restaurer des versions ant\u00e9rieures et ainsi diminuer le nombre de coups de t\u00e9l\u00e9phone au centre d\u2019appels.</p> <p>La mise en place d'un serveur de fichier et d'une politique de sauvegarde ad\u00e9quate devra \u00eatre mis en place.</p> <p>L\u2019\u00e9tude des strat\u00e9gies de compte en fonction des besoins de chaque domaine contribuera \u00e9galement \u00e0 l\u2019effort de r\u00e9duction de la charge d\u2019appels.</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#application-de-quotas-despace-de-stockage-aux-utilisateurs","title":"Application de quotas d\u2019espace de stockage aux utilisateurs","text":"<p>Pour limiter l\u2019utilisation des serveurs de fichiers et ma\u00eetriser les d\u00e9penses dues \u00e0 l\u2019achat d\u2019espace disque, on appliquera des quotas.</p> <p>L\u2019action d\u2019un utilisateur sur un poste se limitera uniquement aux besoins de son p\u00e9rim\u00e8tre. Il sera important de limiter, voire d\u2019emp\u00eacher l\u2019installation de logiciels exotiques (non n\u00e9cessaires \u00e0 l\u2019entreprise), qui sont facteurs de r\u00e9installation des postes et de surplus de coups de t\u00e9l\u00e9phone au centre d\u2019appels (helpdesk).</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#mettre-en-place-des-services-reseaux","title":"Mettre en place des services r\u00e9seaux","text":"<p>Messagerie, t\u00e9l\u00e9phonie sur IP, services d\u2019impression, acc\u00e8s nomades, acc\u00e8s WIFI</p>"},{"location":"contexte/Objectifs/02-Objectif-2/#mettre-en-place-doutils-de-gestion","title":"Mettre en place d\u2019outils de gestion","text":"<p>PGI, SGBD, outils collaboratifs..., certains outils seront d'ailleurs accessible via le Cloud (comme MS Team)</p>"},{"location":"contexte/Objectifs/03-Objectif-3/","title":"Objectif Strat\u00e9gique 3 - S\u00e9curiser le SI","text":"<p>La s\u00e9curit\u00e9 doit devenir primordiale, notamment en ce qui concerne son syst\u00e8me d\u2019informations. Les r\u00e9seaux \u00e9tant constamment menac\u00e9s par des attaques provenant de sources diff\u00e9rentes, la direction souhaite renforcer la s\u00e9curisation de son syst\u00e8me d'informations.</p> <p>En ce sens, la Direction a demand\u00e9 la mise en place d\u2019un plan de s\u00e9curit\u00e9 \u00e0 tous les niveaux de l\u2019entreprise, et notamment au niveau de la DSI. Ce plan devra en permanence tenir compte du co\u00fbt initial et continu de la s\u00e9curit\u00e9.</p> <p>Pour r\u00e9pondre au mieux \u00e0 cette demande, une phase de conception devra \u00eatre d\u00e9finie en introduction du plan de s\u00e9curit\u00e9. Elle permettra d\u2019analyser tous les facteurs qui, s\u2019ils ne sont pas identifi\u00e9s, risquent d\u2019augmenter le co\u00fbt de la s\u00e9curit\u00e9, et de rechercher les technologies de s\u00e9curit\u00e9 qui, si elles ne sont pas employ\u00e9es, feront \u00e9chouer le projet.</p> <p>Cette phase de conception s\u2019articulera autour des points suivants :</p> <ul> <li> <p>la conception de la s\u00e9curit\u00e9 pour la gestion du r\u00e9seau ;</p> </li> <li> <p>la conception d\u2019une infrastructure de mise \u00e0 jour des dispositifs de     s\u00e9curit\u00e9 ;</p> </li> <li> <p>la conception d\u2019un syst\u00e8me de clients s\u00e9curis\u00e9.</p> </li> </ul> <p>Le plan de s\u00e9curit\u00e9 devra imp\u00e9rativement r\u00e9pondre aux exigences suivantes :</p> <ol> <li> <p>Consid\u00e9rer les exigences l\u00e9gales qui affectent la mise en \u0153uvre de la s\u00e9curit\u00e9 Pour int\u00e9grer les dispositions l\u00e9gales au sein de l\u2019entreprise, il est important de demander au service juridique de l\u2019entreprise de v\u00e9rifier le plan de s\u00e9curit\u00e9. Il s\u2019agit entre autres de r\u00e9aliser un certain nombre de d\u00e9marches aupr\u00e8s des organismes gouvernementaux et des associations qui peuvent \u00eatre des sources de conseils en mati\u00e8re de s\u00e9curit\u00e9.</p> </li> <li> <p>Mesurer l\u2019impact des d\u00e9cisions de s\u00e9curit\u00e9 sur les utilisateurs finaux Il faudra mesurer l\u2019impact des d\u00e9cisions de s\u00e9curit\u00e9 sur l\u2019utilisateur final. Par exemple, dans le cas du choix d\u2019une strat\u00e9gie de s\u00e9curisation des comptes utilisateurs, une strat\u00e9gie de mot de passe trop lourde (15 caract\u00e8res) alli\u00e9e \u00e0 une strat\u00e9gie de complexit\u00e9 de mot de passe (lettres et chiffres), forcerait l\u2019utilisateur \u00e0 conserver son mot de passe sur un papier, pr\u00e8s de son ordinateur. De m\u00eame, une strat\u00e9gie de verrouillage de comptes mal adapt\u00e9e apportera un surplus important de coups de t\u00e9l\u00e9phone au centre d\u2019appels.</p> </li> <li> <p>Mesurer les risques en se fondant sur la probabilit\u00e9 et la criticit\u00e9 de la menace Il est important de pouvoir mesurer les probabilit\u00e9s d\u2019attaques, les moyens mis en \u0153uvre face \u00e0 une menace ainsi que les r\u00e9ponses \u00e0 ces menaces, afin d\u2019en estimer les co\u00fbts. Cette analyse de menace sera \u00e9tudi\u00e9 via la m\u00e9thode EBIOS. Prenons le cas de la probabilit\u00e9 d\u2019une menace. Si on d\u00e9finit une \u00e9chelle des probabilit\u00e9s allant de 1 \u00e0 4 \u2013 4 \u00e9tant la probabilit\u00e9 la plus importante qu\u2019une menace se produise \u2013 et si on d\u00e9finit une \u00e9chelle du niveau de criticit\u00e9 allant de 1 \u00e0 4 \u2013 4 \u00e9tant la criticit\u00e9 la plus \u00e9lev\u00e9e \u2013 une menace avec une probabilit\u00e9 de 2 et une criticit\u00e9 de 4 sur cette \u00e9chelle devra \u00eatre prise en compte selon certaines consid\u00e9rations.</p> </li> <li> <p>Maintenir la disponibilit\u00e9 et l\u2019interop\u00e9rabilit\u00e9 des services Appliquer une s\u00e9curit\u00e9 importante dans l\u2019entreprise ne signifie pas que l\u2019activit\u00e9 doit s\u2019arr\u00eater. Que l\u2019on ne puisse plus communiquer, \u00e9changer des donn\u00e9es ou encore piloter des applications n\u2019est pas forc\u00e9ment le signe d\u2019un r\u00e9seau s\u00e9curis\u00e9. Au contraire, il faut pouvoir garantir les \u00e9changes de donn\u00e9es en cryptant les informations, en s\u2019assurant de la compatibilit\u00e9 de certains protocoles avec les autres syst\u00e8mes, en veillant \u00e0 l\u2019aspect fonctionnel de l\u2019infrastructure. Les performances des machines doivent \u00eatre prises en compte \u00e9galement : en effet, l\u2019utilisation excessive d\u2019un protocole de chiffrement peut emp\u00eacher un ordinateur de communiquer dans un temps imparti.</p> </li> <li> <p>R\u00e9pondre aux besoins d\u2019\u00e9volutivit\u00e9. Il ne faut pas que l\u2019infrastructure notamment informatique devienne une voie de garage dans laquelle il ne sera plus possible d\u2019\u00e9voluer.</p> </li> <li> <p>S\u00e9curiser le service de R&amp;D et les services mis en ligne.Ce service \u00e9tant celui qui g\u00e9n\u00e8re la valeur ajout\u00e9e de la soci\u00e9t\u00e9, il faudra particuli\u00e8rement le s\u00e9curiser, tant au niveau des mat\u00e9riels, qu\u2019au niveau de l\u2019infrastructure (d\u00e9finition d\u2019un domaine d\u00e9di\u00e9) et de la transmission des donn\u00e9es.</p> </li> </ol>"},{"location":"contexte/Objectifs/03-Objectif-3/#strategie-operationnelle-securiser-linfrastructure","title":"Strat\u00e9gie Operationnelle\u00a0: S\u00e9curiser l\u2019Infrastructure","text":"<p>Pour r\u00e9pondre aux objectifs de s\u00e9curit\u00e9 impos\u00e9s par la Direction, la s\u00e9curit\u00e9 devra \u00eatre impl\u00e9ment\u00e9e \u00e0 plusieurs niveaux fonctionnels : infrastructure, syst\u00e8mes, processus, flux.</p> <p>Il sera n\u00e9cessaire d\u2019\u00e9tudier les solutions les moins on\u00e9reuses et de regarder les technologies de s\u00e9curit\u00e9 apport\u00e9es par Windows pouvant r\u00e9pondre au mieux au plan de s\u00e9curit\u00e9.</p> <p>Windows 11 venant tout juste d\u2019\u00eatre mis \u00e0 disposition la DSI souhaite attendre un retour d\u2019exp\u00e9rience utilisateur sur ce nouvel OS.</p> <p>Les solutions bas\u00e9es sur les syst\u00e8mes libres seront  envisag\u00e9es pour la plupart des serveurs. Les postes de travail resteront dans un envioronnement Microsoft.</p>"},{"location":"contexte/Objectifs/03-Objectif-3/#securisation-du-materiel-de-linfrastructure","title":"S\u00e9curisation du mat\u00e9riel de l\u2019infrastructure","text":"<p>Les serveurs qui joueront un r\u00f4le important dans l\u2019infrastructure devront \u00eatre s\u00e9curis\u00e9s dans une salle pr\u00e9vue \u00e0 cet effet. L\u2019ensemble des serveurs pourra \u00eatre accessible via une solution bas\u00e9e sur un cluster d\u2019hyperviseur pour faciliter leur gestion et r\u00e9duire l\u2019encombrement. La solution d\u2019infrastructure ainsi virtualis\u00e9e, devra \u00eatre constamment document\u00e9 par les techniciens. Les utilisateurs devront \u00eatre tenus responsables de l\u2019usage du mat\u00e9riel informatique mis \u00e0 leur disposition par l\u2019entreprise (PC, portables, t\u00e9l\u00e9phones...). Les contrats de travail et la charte informatique de l\u2019entreprise devront \u00eatre revus en ce sens.</p> <p>La solution d'hyperviseur et d'hyperconvergence reposera sur l'\u00e9diteur Nutanix </p> Nutanix <p>Nutanix AHV (Acropolis Hypervisor) est une plateforme de virtualisation con\u00e7ue par Nutanix pour permettre la consolidation des ressources informatiques et la gestion des charges de travail sur des clusters de serveurs. C'est une solution de virtualisation int\u00e9gr\u00e9e au sein de l'\u00e9cosyst\u00e8me Nutanix, visant \u00e0 simplifier et \u00e0 optimiser l'infrastructure des centres de donn\u00e9es (datacenter).</p>"},{"location":"contexte/Objectifs/03-Objectif-3/#securisation-des-flux","title":"S\u00e9curisation des flux","text":"<p>L'ensemble des communications de l\u2019entreprise doivent \u00eatre prot\u00e9g\u00e9es.</p> <p>Il s\u2019agit entre autre, d\u2019isoler l\u2019activit\u00e9 de recherche et de d\u00e9veloppement du site d\u2019Orl\u00e9ans et de chiffrer les donn\u00e9es sensibles. Les techniques de VLAN, de DMZ, de VPN et de chiffrement des donn\u00e9es seront privil\u00e9gi\u00e9es.</p> Rappel Cybers\u00e9curit\u00e9 <p>Disponibilit\u00e9 : Il s'agit d'assurer que les syst\u00e8mes, les donn\u00e9es et les services sont accessibles et op\u00e9rationnels lorsque n\u00e9cessaire. La disponibilit\u00e9 est essentielle pour garantir la continuit\u00e9 des op\u00e9rations et \u00e9viter les interruptions nuisibles.</p> <p>Int\u00e9grit\u00e9 : L'int\u00e9grit\u00e9 concerne la protection des donn\u00e9es et des syst\u00e8mes contre toute alt\u00e9ration non autoris\u00e9e. Les informations doivent rester exactes et non alt\u00e9r\u00e9es tout au long de leur cycle de vie.</p> <p>Confidentialit\u00e9 : La confidentialit\u00e9 consiste \u00e0 emp\u00eacher l'acc\u00e8s ou la divulgation non autoris\u00e9s des informations sensibles. Elle vise \u00e0 garantir que seules les personnes autoris\u00e9es peuvent acc\u00e9der aux donn\u00e9es confidentielles.</p> <p>Preuve (ou Preuve d'Audit) : Il s'agit de la capacit\u00e9 \u00e0 d\u00e9montrer que des \u00e9v\u00e9nements ou des actions sp\u00e9cifiques se sont produits dans un syst\u00e8me. Cela implique de conserver des journaux d'activit\u00e9 et des enregistrements pour \u00e9tablir une piste d'audit et v\u00e9rifier les actions pass\u00e9es.</p>"},{"location":"contexte/Objectifs/04-Objectif-4/","title":"Objectif Strat\u00e9gique 4\u00a0: Placer l\u2019entreprise dans une logique de d\u00e9veloppement durable.","text":"<p>La direction souhaite inscrire toutes ses actions dans une logique de d\u00e9veloppement durable :</p> <ul> <li> <p>R\u00e9duction des consommations de papiers (d\u00e9mat\u00e9rialisation de     l'information)</p> </li> <li> <p>R\u00e9duction des d\u00e9placements (recours aux visio-conf\u00e9rences)</p> </li> <li> <p>R\u00e9duction des consommations d'\u00e9nergie (\u00e9lectricit\u00e9\u2026)</p> </li> <li> <p>Etc.</p> </li> </ul> <p>Cette strategie a d\u00e9j\u00e0 \u00e9t\u00e9 mise en oeuvre par l'entreprise lorsqu'elle a d\u00e9cid\u00e9 d'investir dans une ferme de serveurs pour virtualiser l'ensemble de ses serveurs de productions.</p>"},{"location":"cours/01-documentations/git-mkdocs/","title":"Utilisation de git et de mkdocs","text":""},{"location":"cours/01-documentations/git-mkdocs/#prerequis","title":"Pr\u00e9requis","text":"<p>Avant de commencer, assurez-vous d'avoir les \u00e9l\u00e9ments suivants install\u00e9s sur votre machine : - Git (<code>sudo apt-get install git</code>) - Python et pip (<code>sudo apt-get install python3-pip</code>) - MkDocs (<code>pip install mkdocs</code>)</p>"},{"location":"cours/01-documentations/git-mkdocs/#1-configurer-python-environnement-virtuel-pour-des-tests-locaux","title":"1. Configurer Python (environnement virtuel) pour des tests locaux","text":""},{"location":"cours/01-documentations/git-mkdocs/#environnement-virtuel","title":"Environnement virtuel","text":"<p>Creation de l'environnement virtuel et activation</p> <pre><code>python3 -m venv venv\nsource venv/bin/activate\n</code></pre> <p>le prompt doit afficher <code>(venv))</code></p> <p>Installez les d\u00e9pendances avec pip. Ces d\u00e9pendances seront install\u00e9es uniquement dans l'environnement virtuel et pas globalement dans le syst\u00e8me.</p> <p>Pensez \u00e0 r\u00e9activer l'environnement virtuel pour pouvoir l'utiliser \u00e0 nouveau.</p>"},{"location":"cours/01-documentations/git-mkdocs/#installation-gloable-sur-le-systeme","title":"Installation gloable sur le syst\u00e8me","text":"<p>Pour installer de mani\u00e8re globale:</p> <pre><code>sudo python3 -m pip install --upgrade pip\nsudo python3 -m pip install mkdocs mkdocs-material\n</code></pre> <p>Verifier le chemin de l'executable:</p> <pre><code>which mkdocs\n</code></pre> <p>Si tout est correct, <code>which mkdocs</code> devrait renvoyer <code>/usr/local/bin/mkdocs</code>.</p> <p>Vous pourrez tester localement mkdocs.</p>"},{"location":"cours/01-documentations/git-mkdocs/#2-creation-dun-depot-github-public","title":"2. Cr\u00e9ation d'un d\u00e9p\u00f4t GitHub public","text":"<ol> <li>Rendez-vous sur GitHub et connectez-vous \u00e0 votre compte.</li> <li>Cliquez sur le bouton New repository.</li> <li>Entrez un nom pour votre d\u00e9p\u00f4t (ex: <code>mon-projet-mkdocs</code>).</li> <li>S\u00e9lectionnez l'option Public pour rendre le d\u00e9p\u00f4t accessible \u00e0 tous.</li> <li>Cochez l'option Add a README file pour initier votre d\u00e9p\u00f4t avec un fichier README.</li> <li>Cliquez sur Create repository.</li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#2-cloner-le-depot-sur-linux-mint","title":"2. Cloner le d\u00e9p\u00f4t sur Linux Mint","text":"<ol> <li>Ouvrez un terminal.</li> <li>Naviguez vers le r\u00e9pertoire o\u00f9 vous souhaitez cloner votre d\u00e9p\u00f4t (ex: <code>cd ~/MesDocumentations</code>).</li> <li>Copiez l'URL de votre d\u00e9p\u00f4t depuis GitHub (bouton vert \"Code\" &gt; SSH).</li> <li> <p>Tapez la commande suivante pour cloner le d\u00e9p\u00f4t sur votre machine :</p> <pre><code>git clone git@github.com:votre-nom-utilisateur/mon-projet-mkdocs.git\n</code></pre> </li> <li> <p>Naviguez dans le r\u00e9pertoire clon\u00e9 :</p> <pre><code>cd mon-projet-mkdocs\n</code></pre> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#3-configuration-du-compte-github-pour-le-depot-local","title":"3. Configuration du compte GitHub pour le d\u00e9p\u00f4t local","text":"<p>Avant de commencer \u00e0 travailler avec Git et GitHub sur votre d\u00e9p\u00f4t local, vous devez configurer votre compte GitHub pour que vos commits soient associ\u00e9s \u00e0 votre profil.</p>"},{"location":"cours/01-documentations/git-mkdocs/#1-configurer-votre-nom-dutilisateur-et-votre-adresse-e-mail","title":"1. Configurer votre nom d'utilisateur et votre adresse e-mail","text":"<ol> <li>Ouvrez un terminal sur votre machine.</li> <li> <p>D\u00e9finissez votre nom d'utilisateur :</p> <pre><code>git config --global user.name \"Votre Nom d'utilisateur GitHub\"\n</code></pre> </li> <li> <p>D\u00e9finissez votre adresse e-mail (cette adresse doit \u00eatre la m\u00eame que celle utilis\u00e9e sur GitHub) :</p> <pre><code>git config --global user.email \"votre-email@example.com\"\n</code></pre> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#2-verifier-la-configuration","title":"2. V\u00e9rifier la configuration","text":"<ol> <li> <p>Pour v\u00e9rifier que votre configuration a bien \u00e9t\u00e9 prise en compte, utilisez la commande suivante :</p> <pre><code>git config --global --list\n</code></pre> <p>Vous devriez voir votre nom d'utilisateur et votre adresse e-mail list\u00e9s.</p> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#3-configurer-lauthentification-par-cle-ssh","title":"3. Configurer l'authentification par cl\u00e9 SSH","text":"<p>Sous windows (Client graphique TortoiseGit), il est possible de s'authentifier avec un login/password. github n'accepte plus les push avec la methode http de puis ?, sous linux et avec le terminal il faut forcement s'authentifier avec une cl\u00e9 SSH Pour faciliter l'authentification et \u00e9viter de saisir vos identifiants \u00e0 chaque push, vous pouvez configurer une cl\u00e9 SSH :</p> <ol> <li>G\u00e9n\u00e9rer une cl\u00e9 SSH :</li> </ol> RSACourbe Eliptique <pre><code>ssh-keygen -t rsa -b 4096 -C \"votre-email@example.com\"\n</code></pre> <pre><code>ssh-keygen -t ed25519 -C \"votre-email@example.com\"\n</code></pre> Information <p>ED25519 est une cl\u00e9 bas\u00e9e sur les courbes elliptiques (ECC).  Elle utilise la courbe elliptique Curve25519, optimis\u00e9e pour la s\u00e9curit\u00e9 et la rapidit\u00e9. C\u2019est une alternative moderne \u00e0 RSA ou DSA, offrant la m\u00eame s\u00e9curit\u00e9 avec des cl\u00e9s beaucoup plus courtes. Avantages\u202f: Plus rapide pour la g\u00e9n\u00e9ration de cl\u00e9s, la signature et la v\u00e9rification. Taille des cl\u00e9s et des signatures plus petites (32 bytes pour la cl\u00e9 publique). Tr\u00e8s r\u00e9sistante aux attaques connues contre RSA/DSA avec cl\u00e9s plus courtes.</p> <p>Appuyez sur <code>Entr\u00e9e</code> pour accepter l'emplacement par d\u00e9faut du fichier. Vous pouvez aussi d\u00e9finir une phrase de passe pour s\u00e9curiser votre cl\u00e9.</p> Attention <p>Attention ne perdez pas le mot de passe associ\u00e9 \u00e0 votr\u00e9 cl\u00e9 priv\u00e9e.</p> <ol> <li>Ajouter la cl\u00e9 SSH \u00e0 votre compte GitHub :</li> <li> <p>Copiez la cl\u00e9 publique g\u00e9n\u00e9r\u00e9e :</p> <pre><code>cat ~/.ssh/id_ed25519.pub\n</code></pre> </li> <li> <p>Connectez-vous \u00e0 GitHub, allez dans Settings &gt; SSH and GPG keys, puis cliquez sur New SSH key. Collez la cl\u00e9 dans le champ pr\u00e9vu \u00e0 cet effet et donnez-lui un nom.</p> </li> <li> <p>Tester la connexion :</p> <pre><code>ssh -T git@github.com\n</code></pre> <p>Si tout est bien configur\u00e9, vous recevrez un message de confirmation de la connexion.</p> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#4-initialisation-de-mkdocs","title":"4. Initialisation de MkDocs","text":"<ol> <li> <p>Dans votre terminal, assurez-vous d'\u00eatre dans le r\u00e9pertoire de votre projet :</p> <pre><code>cd ~/MesDocumentations/mon-projet-mkdocs\n</code></pre> </li> <li> <p>Cr\u00e9ez une structure de base pour MkDocs :</p> <pre><code>mkdocs new .\n</code></pre> </li> <li> <p>Cette commande cr\u00e9e un r\u00e9pertoire <code>docs/</code> et un fichier <code>mkdocs.yml</code>.</p> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#5-arborescence-de-fichiers-attendue-pour-un-projet-mkdocs","title":"5. Arborescence de fichiers attendue pour un projet MkDocs","text":"<p>Une structure de fichiers de base pour un projet MkDocs devrait ressembler \u00e0 ceci :</p> <pre><code>```plaintext\n    mon-projet-mkdocs/\n    \u251c\u2500\u2500 .git/\n    \u251c\u2500\u2500 .vscode/\n    \u2502   \u2514\u2500\u2500 settings.json\n    \u251c\u2500\u2500 docs/\n    \u2502   \u251c\u2500\u2500 index.md\n    \u2502   \u2514\u2500\u2500 autres_pages.md\n    \u251c\u2500\u2500 mkdocs.yml\n    \u2514\u2500\u2500 README.md\n```\n</code></pre>"},{"location":"cours/01-documentations/git-mkdocs/#details-des-repertoires","title":"Details des repertoires","text":"<ul> <li>.git/ : R\u00e9pertoire cach\u00e9 contenant les fichiers de configuration et l'historique des versions Git.</li> <li>.vscode/ : R\u00e9pertoire cach\u00e9 pour les configurations sp\u00e9cifiques de l'\u00e9diteur (comme Codium), avec des fichiers comme settings.json.</li> <li>docs/ : Contient les fichiers Markdown pour la documentation.</li> <li>mkdocs.yml : Fichier de configuration pour MkDocs.</li> <li>README.md : Fichier de pr\u00e9sentation du projet.</li> </ul>"},{"location":"cours/01-documentations/git-mkdocs/#6-faire-un-commit-local","title":"6. Faire un commit local","text":"<ol> <li> <p>Apr\u00e8s avoir modifi\u00e9 ou ajout\u00e9 des fichiers, v\u00e9rifiez l'\u00e9tat de votre d\u00e9p\u00f4t :</p> <pre><code>git status\n</code></pre> </li> <li> <p>Ajoutez les fichiers modifi\u00e9s ou ajout\u00e9s pour le commit :</p> <pre><code>git add .\n</code></pre> </li> <li> <p>Cr\u00e9ez un commit avec un message explicatif :</p> <pre><code>git commit -m \"Initialisation du projet avec MkDocs\"\n</code></pre> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#7-envoyer-les-modifications-sur-github-push","title":"7. Envoyer les modifications sur GitHub (Push)","text":"<ol> <li> <p>Pour envoyer vos modifications locales vers GitHub, utilisez la commande :</p> <pre><code>git push origin main\n</code></pre> <p>Note : Si votre branche principale s'appelle <code>master</code> au lieu de <code>main</code>, adaptez la commande.</p> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#8-recuperer-les-modifications-de-github-pull","title":"8. R\u00e9cup\u00e9rer les modifications de GitHub (Pull)","text":"<ol> <li> <p>Avant de commencer \u00e0 travailler sur votre projet, r\u00e9cup\u00e9rez les derni\u00e8res modifications depuis GitHub pour \u00e9viter les conflits :</p> <pre><code>git pull origin main\n</code></pre> </li> <li> <p>Si vous et d'autres collaborateurs avez fait des modifications en m\u00eame temps, vous devrez peut-\u00eatre r\u00e9soudre des conflits. Git vous indiquera les fichiers en conflit et vous guidera pour les r\u00e9soudre.</p> </li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#9-bonnes-pratiques-pour-eviter-les-conflits","title":"9. Bonnes pratiques pour \u00e9viter les conflits","text":"<ul> <li>Tirez (avec la commande pull) toujours les derni\u00e8res modifications avant de commencer \u00e0 travailler.</li> <li>Commitez et poussez (commande push) vos changements r\u00e9guli\u00e8rement.</li> <li>Si vous travaillez sur une fonctionnalit\u00e9 ou une grosse modification, envisagez de cr\u00e9er une branche s\u00e9par\u00e9e (si vous voulez tester un autre th\u00e8me par exemple)</li> </ul>"},{"location":"cours/01-documentations/git-mkdocs/#10-workflow-de-travail-collaboratif","title":"10. Workflow de travail collaboratif","text":"<p>Afin d\u2019assurer un d\u00e9veloppement propre et collaboratif, nous suivons un workflow bas\u00e9 sur les branches et les Pull Requests.</p>"},{"location":"cours/01-documentations/git-mkdocs/#regles-principales","title":"\ud83d\udd39 R\u00e8gles principales","text":"<ul> <li>Chaque collaborateur travaille sur sa propre branche.</li> <li>Toute modification doit \u00eatre propos\u00e9e via une Pull Request (PR).</li> <li>Le propri\u00e9taire du projet (ou un responsable) effectue une code review avant toute int\u00e9gration dans la branche principale (<code>main</code>).</li> </ul>"},{"location":"cours/01-documentations/git-mkdocs/#bonnes-pratiques","title":"\ud83d\udd39 Bonnes pratiques","text":"<ol> <li>Cr\u00e9er une nouvelle branche \u00e0 partir de <code>main</code> : <pre><code>git checkout main\ngit pull origin main\ngit checkout -b ma-branche\n</code></pre></li> <li>Travailler et committer r\u00e9guli\u00e8rement :    <pre><code> git add .\n git commit -m \"Ajout de la section sur le workflow collaboratif\"\n</code></pre></li> <li>Pousser la branche sur le d\u00e9p\u00f4t distant :    <pre><code> git push origin ma-branche\n</code></pre></li> <li>Ouvrir une Pull Request sur GitHub pour proposer les changements.</li> </ol>"},{"location":"cours/01-documentations/git-mkdocs/#processus-de-revue","title":"\ud83d\udd39 Processus de revue","text":"<p>\u2705 Validation : si la proposition est correcte, la PR est valid\u00e9e et fusionn\u00e9e dans main.</p> <p>\u274c Refus : si des corrections sont n\u00e9cessaires (orthographe, clart\u00e9, coh\u00e9rence\u2026), la PR est rejet\u00e9e avec des commentaires explicatifs.</p> <p>\ud83d\udd04 Am\u00e9lioration : l\u2019auteur peut alors mettre \u00e0 jour sa branche, corriger ses modifications puis soumettre une nouvelle PR.</p>"},{"location":"cours/01-documentations/git-mkdocs/#11-configuration-du-cicd-avec-github-actions-via-linterface-github","title":"11. Configuration du CI/CD avec GitHub Actions via l'interface GitHub","text":"<ul> <li>Ouvrez votre d\u00e9p\u00f4t sur GitHub.</li> <li>Cliquez sur l'onglet Actions en haut de la page de votre d\u00e9p\u00f4t.</li> <li>GitHub vous proposera des templates pour diff\u00e9rents workflows. Vous pouvez choisir un template existant, comme \"Deploy static content to GitHub Pages\", ou commencer \u00e0 partir de z\u00e9ro en cliquant sur Set up a workflow yourself.</li> <li>Une fois dans l'\u00e9diteur, un fichier YAML nomm\u00e9 <code>main.yml</code> (ou un autre nom de votre choix) sera cr\u00e9\u00e9 dans le r\u00e9pertoire <code>.github/workflows/</code>.</li> <li>\u00c9ditez le fichier directement dans l'\u00e9diteur GitHub pour sp\u00e9cifier les \u00e9tapes de votre pipeline (installation de MkDocs, g\u00e9n\u00e9ration de la documentation, d\u00e9ploiement).</li> <li>Apr\u00e8s avoir configur\u00e9 le workflow, ajoutez un message de commit dans le champ pr\u00e9vu \u00e0 cet effet sous l'\u00e9diteur.</li> <li>Assurez-vous que l'option \"Commit directly to the <code>main</code> branch\" est s\u00e9lectionn\u00e9e, puis cliquez sur Commit new file.</li> <li>Une fois le commit effectu\u00e9, GitHub ex\u00e9cutera automatiquement le workflow si vous avez configur\u00e9 un d\u00e9clencheur comme <code>push</code> ou <code>pull_request</code>.</li> <li>Vous pouvez suivre l'ex\u00e9cution de votre workflow dans l'onglet Actions pour v\u00e9rifier qu'il se d\u00e9roule correctement.</li> <li>Apr\u00e8s avoir modifi\u00e9 le workflow directement sur GitHub, il est important de synchroniser votre d\u00e9p\u00f4t local avec le d\u00e9p\u00f4t distant pour que toutes les modifications soient align\u00e9es.</li> <li> <p>Ouvrez votre terminal et naviguez dans votre r\u00e9pertoire de projet local, puis ex\u00e9cutez :</p> <p><pre><code>git pull origin main\n</code></pre>    - Cette commande t\u00e9l\u00e9chargera les derni\u00e8res modifications du d\u00e9p\u00f4t distant vers votre d\u00e9p\u00f4t local.</p> </li> </ul>"},{"location":"cours/01-documentations/git-mkdocs/#12-activer-github-pages-avec-la-branche-de-deploiement","title":"12. Activer GitHub Pages avec la branche de d\u00e9ploiement","text":"<p>Une fois votre workflow CI/CD configur\u00e9 pour d\u00e9ployer la documentation, vous pouvez activer GitHub Pages pour h\u00e9berger votre site de documentation.</p> <ul> <li>Dans votre d\u00e9p\u00f4t GitHub, cliquez sur l'onglet Settings (Param\u00e8tres) en haut \u00e0 droite.</li> <li>Dans le menu lat\u00e9ral gauche, faites d\u00e9filer vers le bas jusqu'\u00e0 la section Pages.</li> <li>Sous la section Build and deployment, trouvez l'option Source.</li> <li>Dans le menu d\u00e9roulant, s\u00e9lectionnez la branche utilis\u00e9e pour le d\u00e9ploiement. Il s'agit g\u00e9n\u00e9ralement d'une branche nomm\u00e9e <code>gh-deploy</code> ou d'une autre branche sp\u00e9cifi\u00e9e dans votre workflow YAML.</li> <li>Cliquez sur Save (Enregistrer) pour valider les param\u00e8tres.</li> <li>GitHub Pages sera maintenant activ\u00e9 pour cette branche sp\u00e9cifique. Si le d\u00e9ploiement a \u00e9t\u00e9 correctement configur\u00e9 et ex\u00e9cut\u00e9, votre documentation sera disponible \u00e0 l'adresse URL fournie par GitHub.</li> <li>GitHub affichera l'URL o\u00f9 votre site est h\u00e9berg\u00e9. Vous pouvez y acc\u00e9der pour v\u00e9rifier que votre documentation est correctement d\u00e9ploy\u00e9e.</li> </ul> <p>Avec cette configuration, votre documentation sera automatiquement mise \u00e0 jour et d\u00e9ploy\u00e9e sur GitHub Pages chaque fois que le workflow CI/CD est ex\u00e9cut\u00e9, en utilisant la branche de d\u00e9ploiement d\u00e9finie.</p>"},{"location":"cours/02-adressage/vlsm/","title":"VLSM (Variable Length Subnet Mask)","text":""},{"location":"cours/02-adressage/vlsm/#introduction","title":"Introduction","text":"<p>Le VLSM (Variable Length Subnet Mask) est une technique d'adressage IP qui permet de subdiviser un r\u00e9seau en sous-r\u00e9seaux de tailles diff\u00e9rentes, en fonction des besoins. Contrairement \u00e0 la technique classique des sous r\u00e9seaux - FLSM (Fixed Length Subnet Mask), o\u00f9 tous les sous-r\u00e9seaux ont la m\u00eame taille, le VLSM permet une utilisation plus efficace de l'espace d'adressage.</p>"},{"location":"cours/02-adressage/vlsm/#avantages-du-vlsm","title":"Avantages du VLSM","text":"<ul> <li>Efficacit\u00e9 de l'utilisation des adresses IP : Permet de minimiser le gaspillage des adresses IP en allouant des sous-r\u00e9seaux de tailles adapt\u00e9es aux besoins.</li> <li>Flexibilit\u00e9 : Permet de cr\u00e9er des sous-r\u00e9seaux de diff\u00e9rentes tailles \u00e0 partir du m\u00eame espace d'adressage.</li> <li>Scalabilit\u00e9 : Facilite l'extension du r\u00e9seau en cr\u00e9ant de nouveaux sous-r\u00e9seaux selon les besoins.</li> </ul> <p>Attention</p> <p>VLSM est une technique d'optimisation pour l'adressage utile dans des plages d'adresse publiques. Dans un contexte d'adresse priv\u00e9es (RFC1918), cela a nettement moins d'interet.</p> RFC 1918 <p>Les plages d'adresses priv\u00e9es d\u00e9finies dans cette RFC interdisent leur routage sur Internet. On a : -    10.0.0.0 /8   -    172.16.0.0 /12  -    192.168.0.0 /16 </p>"},{"location":"cours/02-adressage/vlsm/#principe-de-fonctionnement","title":"Principe de fonctionnement","text":"<ul> <li> <p>D\u00e9termination des besoins en sous-r\u00e9seaux : Identifiez le nombre de sous-r\u00e9seaux et le nombre d'h\u00f4tes requis pour chaque sous-r\u00e9seau.</p> </li> <li> <p>Allouer des sous-r\u00e9seaux \u00e0 l'aide de masques de sous-r\u00e9seau de longueurs variables :</p> </li> <li>Commencez par le plus grand sous-r\u00e9seau (Il est tr\u00e8s important de trier avant de commencer a travailler).</li> <li>Choisissez un masque de sous-r\u00e9seau qui satisfait le nombre d'h\u00f4tes requis.</li> <li>Continuez \u00e0 subdiviser les sous-r\u00e9seaux restants pour r\u00e9pondre aux autres besoins en utilisant des masques de sous-r\u00e9seau appropri\u00e9s.</li> </ul>"},{"location":"cours/02-adressage/vlsm/#algorithme-pour-reussir-un-adressage-vlsm","title":"Algorithme pour r\u00e9ussir un adressage VLSM","text":"Attention <p>Il est important de trier les r\u00e9seaux du plus grand au plus petit !</p> <ol> <li> <p>Lister les sous-r\u00e9seaux    Identifier tous les sous-r\u00e9seaux n\u00e9cessaires avec le nombre d\u2019h\u00f4tes requis pour chacun.</p> </li> <li> <p>Trier les sous-r\u00e9seaux par nombre d\u2019h\u00f4tes d\u00e9croissant </p> </li> <li>Traiter d\u2019abord le plus grand sous-r\u00e9seau (celui avec le plus d\u2019h\u00f4tes).  </li> <li> <p>Cela permet d\u2019allouer correctement les plages d\u2019adresses sans conflit.</p> </li> <li> <p>Attribuer un masque \u00e0 chaque sous-r\u00e9seau </p> </li> <li>Pour chaque sous-r\u00e9seau, calculer le nombre de bits n\u00e9cessaires pour les h\u00f4tes : <pre><code>bits_hotes = plus petit entier n tel que 2^n - 2 &gt;= nombre d\u2019h\u00f4tes requis\n\nle -2 = @ r\u00e9seau et @ Diffusion\n</code></pre></li> <li> <p>Le masque de sous-r\u00e9seau correspond \u00e0 : <pre><code>/ (32 - bits_hotes)\n</code></pre></p> </li> <li> <p>Allouer les adresses </p> </li> <li>Commencer \u00e0 partir de l\u2019adresse r\u00e9seau initiale.  </li> <li> <p>Pour chaque sous-r\u00e9seau, d\u00e9finir :  </p> <ul> <li>l\u2019adresse r\u00e9seau,  </li> <li>la plage d\u2019adresses utilisables,  </li> <li>l\u2019adresse de broadcast.  </li> </ul> </li> <li> <p>Recommancer</p> </li> <li>Passer \u00e0 l\u2019adresse imm\u00e9diatement apr\u00e8s la plage allou\u00e9e pour le sous-r\u00e9seau suivant.  </li> <li>Continuer jusqu\u2019\u00e0 ce que tous les sous-r\u00e9seaux soient allou\u00e9s.</li> </ol>"},{"location":"cours/02-adressage/vlsm/#exemple-de-mise-en-oeuvre","title":"Exemple de mise en oeuvre","text":"<p>Supposons que vous avez une adresse r\u00e9seau 192.168.1.0/24 et que vous devez cr\u00e9er les sous-r\u00e9seaux suivants en utilisant la technique VLSM :</p> <ul> <li>Sous-r\u00e9seau A : 50 h\u00f4tes</li> <li>Sous-r\u00e9seau B : 25 h\u00f4tes</li> <li>Sous-r\u00e9seau C : 10 h\u00f4tes</li> </ul>"},{"location":"cours/02-adressage/vlsm/#etapes","title":"\u00c9tapes","text":"<ul> <li>Sous-r\u00e9seau A : 50 h\u00f4tes \u2192 N\u00e9cessite 6 bits pour les h\u00f4tes (2^6 - 2 = 62 h\u00f4tes).</li> <li>Masque de sous-r\u00e9seau : /26 (255.255.255.192)</li> <li>Sous-r\u00e9seau : 192.168.1.0/26</li> <li>Plage d'adresses : 192.168.1.1 \u00e0 192.168.1.62</li> </ul> <ul> <li>Sous-r\u00e9seau B : 25 h\u00f4tes \u2192 N\u00e9cessite 5 bits pour les h\u00f4tes (2^5 - 2 = 30 h\u00f4tes).</li> <li>Masque de sous-r\u00e9seau : /27 (255.255.255.224)</li> <li>Sous-r\u00e9seau : 192.168.1.64/27</li> <li>Plage d'adresses : 192.168.1.65 \u00e0 192.168.1.94</li> </ul> <ul> <li>Sous-r\u00e9seau C : 10 h\u00f4tes \u2192 N\u00e9cessite 4 bits pour les h\u00f4tes (2^4 - 2 = 14 h\u00f4tes).</li> <li>Masque de sous-r\u00e9seau : /28 (255.255.255.240)</li> <li>Sous-r\u00e9seau : 192.168.1.96/28</li> <li>Plage d'adresses : 192.168.1.97 \u00e0 192.168.1.110</li> </ul>"},{"location":"cours/02-adressage/vlsm/#remettre-son-travail-dans-un-tableau","title":"Remettre son travail dans un tableau","text":"Sous-r\u00e9seau Nombre d\u2019h\u00f4tes Bits h\u00f4tes Masque Adresse r\u00e9seau Plage d\u2019adresses Adresse broadcast A 50 6 /26 192.168.1.0 192.168.1.1 - 192.168.1.62 192.168.1.63 B 25 5 /27 192.168.1.64 192.168.1.65 - 192.168.1.94 192.168.1.95 C 10 4 /28 192.168.1.96 192.168.1.97 - 192.168.1.110 192.168.1.111"},{"location":"cours/02-adressage/vlsm/#conclusion","title":"Conclusion","text":"<p>La moindre erreur de calcul entrainera une erreur compl\u00e8te de l'espace d'adressage ! Soyez vigilent !</p>"},{"location":"cours/03-hyperviseurs/proxmox-reseaux/","title":"Gestion des r\u00e9seaux sous Promox","text":""},{"location":"cours/03-hyperviseurs/proxmox-reseaux/#reseaux-et-virtualisation","title":"R\u00e9seaux et virtualisation","text":"<p>Dans un hyperviseur, tous les \u00e9l\u00e9ments r\u00e9seau se trouvant \"derri\u00e8re\" la carte r\u00e9seau sont virtuels. Selon les hyperviseurs, il est possible de virtualiser ou non certains concept r\u00e9seaux. Proxmox \u00e9tant bas\u00e9 sur GNU/Linux, il est possible de virtualiser un vaste panel de ces concepts de mani\u00e8re flexible.</p> <p>Il existe 3 principaux types d'\u00e9l\u00e9ments r\u00e9seau tr\u00e8s utiles dans Proxmox :</p> <ul> <li>Linux Brige : un switch virtuel pouvant acheminer des VLAN (en mode trunk).</li> <li>Linux VLAN : une interface virtuelle mettant \u00e0 disposition un VLAN en mode access pour le serveur Proxmox.</li> <li>Linux Bond : une aggr\u00e9gation d'interfaces physiques g\u00e9rant plusieurs protocoles (notamment LACP).</li> </ul> <p>Pour g\u00e9rer les diff\u00e9rents \u00e9l\u00e9ments r\u00e9seaux de Proxmox, il suffit de cliquer sur le noeud en question dans l'interface web, puis d'aller dans l'item \"Syst\u00e8me\" =&gt; \"R\u00e9seau\".</p> <p>Il existe \u00e9galement la possibilit\u00e9 de d\u00e9ployer des r\u00e9seaux distribu\u00e9s virtuels (SDN ou Software Defined Networking) connecter des VMs en access \u00e0 diff\u00e9rents VLANs. Pour cela, il est n\u00e9cessaire de cr\u00e9er une zone de type VLAN, et d'y attacher des VNets (r\u00e9seaux virtuels) correspondant chacun \u00e0 un VLAN. Il ne restera plus qu'\u00e0 connecter les interfaces des VM directements aux bons VNets.</p> <p>La gestion des r\u00e9seaux virtuels distribu\u00e9s est r\u00e9alis\u00e9e en cliquant sur le centre de donn\u00e9es puis en allant dans l'item \"SDN\" =&gt; \"Zones\" pour les zones, ou \"SDN\" =&gt; VNets pour les r\u00e9seaux virtuels.</p>"},{"location":"cours/03-hyperviseurs/proxmox-reseaux/#combinaisons-delements","title":"Combinaisons d'\u00e9l\u00e9ments","text":"<p>Dans proxmox, il est possible de combiner ces diff\u00e9rents \u00e9l\u00e9ments en les cascadant pour parvenir la solution recherch\u00e9e. Vous trouverez quelques exemples ci-dessous.</p> <p>Exemple de connexion directe de VMs au r\u00e9seau de l'hyperviseur : </p> <p>Exemple de connexion de VMs un VLAN avec interconnexion de l'hyperviseur en mode trunk : </p> <p>Exemple de connexion directe de VMs avec interconnexion de l'hyperviseur en LACP  </p> <p>Lors de la combinaison des diff\u00e9rents \u00e9l\u00e9ments, n'oubliez pas de renseigner les ports esclaves pour les bonds, les ports du pont pour les bridges, et les p\u00e9riph\u00e9riques support pour les vlans!</p>"},{"location":"cours/03-hyperviseurs/proxmox-vmha/","title":"VMs et HA sous Promox","text":""},{"location":"cours/03-hyperviseurs/proxmox-vmha/#ha-dans-un-cluster","title":"HA dans un cluster","text":"<p>Dans un cluster Promox avec plusieurs noeuds, la haute disponibilit\u00e9 des VMs permet :</p> <ul> <li>la migration automatique des VMs sur un autre noeud en cas de d\u00e9faillance.</li> <li>de g\u00e9rer la priorisation du noeud d'h\u00e9bergement</li> <li>de g\u00e9rer des affinit\u00e9s entre VMs tel que le regroupement ou la s\u00e9paration de groupes</li> <li>le d\u00e9marrage automatique de VMs en cas de red\u00e9marrage du cluster</li> </ul> <p>Il est donc important de configurer correctement la haute disponibilit\u00e9 sur les services critiques.</p>"},{"location":"cours/03-hyperviseurs/proxmox-vmha/#ha-sur-un-noeud-unique-cas-sport-ludique","title":"HA sur un noeud unique (cas Sport Ludique)","text":"<p>Sur un hyperviseur d'h\u00e9bergement autnome, la haute disponibilit\u00e9 peut \u00e0 minima permettre un d\"marrage automatique de VMs en cas de red\u00e9marrage de Promox.</p> <p>Dans l'interface Web, la partie \"Ressources\" du menu \"HA\" de l'objet \"Centre de donn\u00e9es\" permet de configurer la liste des machines virtuelles concern\u00e9es par de la haute dispobilit\u00e9. Pour cela il suffit de cliquer sur \"Ajouter\" pour ajouter toute chaque VM concern\u00e9e par de la haute disponibilit\u00e9 :</p> <p></p> <p>S\u00e9lectionnez simplement la VM concern\u00e9e ainsi qu'\u00e9tat d\u00e9sir\u00e9 :</p> <ul> <li>Started : La VM sera toujours d\u00e9marr\u00e9e si possible et pourra \u00eatre chang\u00e9e de noeud</li> <li>Stopped : La VM doit \u00eatre \u00e9teinte, mais pourra \u00eatre chang\u00e9e de noeud</li> <li>Disabled : La VM doit \u00eatre \u00e9teinte, et ne sera jamais chang\u00e9e de noeud.</li> <li>Ignored : La VM sera ignor\u00e9e par d\u00e9faut, les actions devront \u00eatres manuelles</li> </ul> <p>Sur un hyperviseur autonome, l'\u00e9tat \"stopped\" \u00e9quivaut \u00e0 l'\u00e9tat \"Disabled\". La partie \"Retour en arri\u00e8re\" et \"Nombre max de d\u00e9m\u00e9nagements\" ne seront \u00e9galement pas prises en compte.</p>"},{"location":"cours/03-hyperviseurs/stockage/","title":"Stockage mat\u00e9riel","text":""},{"location":"cours/03-hyperviseurs/stockage/#introduction","title":"Introduction","text":"<p>Le choix du stockage sur un serveur est tr\u00e8s important. Les supports de stockage doivent \u00eatre \u00e0 la fois fiable pour fonctionner 24/24 7J/7, et suffisamment performant pour r\u00e9pondre rapidement \u00e0 une demande. Le co\u00fbt sera \u00e9galement un facteur d\u00e9terminant dans le dimensionnement et le choix de la technologie utilis\u00e9e.</p>"},{"location":"cours/03-hyperviseurs/stockage/#les-criteres-techniques-importants-a-prendre-en-compte","title":"Les crit\u00e8res techniques importants \u00e0 prendre en compte","text":"<ul> <li>Le d\u00e9bit en Mo/s</li> <li>La latence, repr\u00e9sentant le temps de r\u00e9ponse exprim\u00e9 en millisecondes ou microsecondes</li> <li>Le nombre d'op\u00e9ration par secondes exprim\u00e9es en IOPS (Input/Output operations per second)</li> </ul>"},{"location":"cours/03-hyperviseurs/stockage/#les-differentes-normes-de-communication","title":"Les diff\u00e9rentes normes de communication","text":""},{"location":"cours/03-hyperviseurs/stockage/#sata","title":"SATA","text":"<p>D'abord con\u00e7u pour les PC grand publique, SATA a \u00e9t\u00e9 int\u00e9gr\u00e9 dans les serveurs gr\u00e2ce \u00e0 son faible co\u00fbt. Sont d\u00e9bit maximum est 6 Gb/s th\u00e9orique (environ 600Mo/s en pratique).</p> <p> </p>"},{"location":"cours/03-hyperviseurs/stockage/#sas","title":"SAS","text":"<p>Le SAS est d\u00e9di\u00e9 aux serveur, il a une vitesse maximum th\u00e9orique de 12 Gb/s (1.2Go /s en pratique). La fiabilit\u00e9 des support utilisant le SAS est tr\u00e8s \u00e9lev\u00e9e, expliquant le co\u00fbt du SAS g\u00e9n\u00e9ralement plus \u00e9lev\u00e9 que le SATA.</p> <p></p>"},{"location":"cours/03-hyperviseurs/stockage/#nvme-pcie","title":"NVMe (PCIe)","text":"<p>La norme NVMe a \u00e9t\u00e9 con\u00e7ue pour acc\u00e9der au stockage directement \u00e0 travers le bus PCI Express. Cela permet un temps d'acc\u00e8s beaucoup plus faible et des d\u00e9bits beaucoup plus \u00e9lev\u00e9s : le d\u00e9bit maximum peut monter jusqu'\u00e0 14 Go/s sur 4 lignes PCIe 5.0 . En contrepartie, ces disque sont les plus on\u00e9reux. Seuls des support de stockages types SSD sont capable d'exploiter cette connectique.</p> <p></p>"},{"location":"cours/03-hyperviseurs/stockage/#les-differents-supports","title":"Les diff\u00e9rents supports","text":""},{"location":"cours/03-hyperviseurs/stockage/#hdd","title":"HDD","text":"<p>Les HDD (Hard Disk Drive) sont des supports magn\u00e9tiques et m\u00e9caniques utilisant des plateaux m\u00e9talliques pour stocker les donn\u00e9es. A cause du mouvement des pi\u00e8ces m\u00e9caniques le temps d'acc\u00e8s de ces supports est mauvais. Le d\u00e9bit d'un HDD est \u00e9galement relativement faible par rapport \u00e0 un SSD. La dur\u00e9e de vie d'un HDD d\u00e9pend essentiellement de la qualit\u00e9 de ses pi\u00e8ces m\u00e9caniques, elle tout m\u00eame consid\u00e9r\u00e9e comme longue. Ces disques sont aujourd'hui tr\u00e8s bon march\u00e9.</p> <p></p>"},{"location":"cours/03-hyperviseurs/stockage/#ssd","title":"SSD","text":"<p>Les SSD sont des supports utilisant des puces m\u00e9moires pour stocker les informations. Cela permet un temps d'acc\u00e8s tr\u00e8s faible compar\u00e9 \u00e0 un disque m\u00e9canique. Le nombre d'IOPS peut donc \u00eatre tr\u00e8s \u00e9lev\u00e9. Bien que la dur\u00e9e de vie d'un SSD est th\u00e9oriquement limit\u00e9e dans le temps, on peut consid\u00e9rer aujourd'hui qu'un support sera consid\u00e9r\u00e9 comme obsol\u00e8te avant de l'avoir us\u00e9 compl\u00e8tement. Leur densit\u00e9 continuant aujourd'hui d'augmenter gr\u00e2ce aux avanc\u00e9s de l'industrie des semi-conducteurs, leur capacit\u00e9 de stockage maximum devrait tr\u00e8s vite rejoindre voire d\u00e9passer celle des HDD.</p> <p></p>"},{"location":"cours/03-hyperviseurs/stockage/#specificite-des-controlleurs-de-stockage-des-serveurs","title":"Sp\u00e9cificit\u00e9 des controlleurs de stockage des serveurs","text":"<p>Les serveurs d'aujourd'hui sont presque tous \u00e9quip\u00e9s de controlleurs RAID mat\u00e9riel. Ces controleurs g\u00e8rent directement les disques de stockage, qu'ils soient m\u00e9caniques ou SSD. Ils permettent de r\u00e9aliser des \"grappes\" RAID aussi appel\u00e9s disques virtuels. Ces disques virtuels sont pr\u00e9sent\u00e9s directement au syst\u00e8me install\u00e9 sur le serveur comme un disque. Le syst\u00e8me d'exploitation n'a donc pas \u00e0 se pr\u00e9ocuper de la gestion mat\u00e9rielle des disques. </p> <p> </p> <p>Les disques connect\u00e9s \u00e0 un controlleur de stockage de serveur sont \u00e9changeables \u00e0 chaud (\"hot swappable\"), permettant de les remplacer pendant que le serveur est en fonctionnement. Ces disques sont accessibles directement sur la fa\u00e7ade du serveur pour \u00eatre retir\u00e9s rapidement en cas de besoin :</p> <p></p> <p>D'autre part, un cache de bonne capacit\u00e9 (parfois plusieurs Go) ainsi qu'une batterie sont g\u00e9n\u00e9ralement pr\u00e9sents sur ces controlleurs afin d'assurer la fin correcte des op\u00e9rations d'\u00e9criture sur les disques en cas de rupture d'alimentation, limitant ainsi grandement la corruption des donn\u00e9es.</p>"},{"location":"cours/03-hyperviseurs/stockage/#pour-resumer","title":"Pour r\u00e9sumer","text":"<ul> <li>Le SATA est la solution la moins cher, mais peu performant.</li> <li>Le SAS permet un bonne fiabilit\u00e9 et de bonnes performances.</li> <li>Le NVMe est le plus on\u00e9reux, mais poss\u00e8de d'excellentes perfomances</li> </ul>"},{"location":"cours/03-hyperviseurs/virtualisation/","title":"Virtualisation","text":""},{"location":"cours/03-hyperviseurs/virtualisation/#type-dhyperviseurs","title":"Type d'hyperviseurs","text":"<p>Les hyperviseurs sont des logiciels qui permettent de cr\u00e9er et de g\u00e9rer des machines virtuelles (VMs) sur un mat\u00e9riel physique. Il existe deux types principaux d'hyperviseurs : le type 1 (bare-metal) et le type 2 (hosted). Voici un aper\u00e7u des diff\u00e9rences entre ces deux types d'hyperviseurs :</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#hyperviseur-de-type-1-bare-metal","title":"Hyperviseur de Type 1 (Bare-Metal) :","text":"<ol> <li> <p>Ex\u00e9cution directe : Les hyperviseurs de type 1 s'ex\u00e9cutent directement sur le mat\u00e9riel physique du serveur, sans n\u00e9cessiter un syst\u00e8me d'exploitation h\u00f4te interm\u00e9diaire. Cela signifie qu'ils ont un acc\u00e8s plus direct aux ressources mat\u00e9rielles.</p> </li> <li> <p>Performances : En raison de leur acc\u00e8s direct au mat\u00e9riel, les hyperviseurs de type 1 ont tendance \u00e0 offrir de meilleures performances que les hyperviseurs de type 2. Ils sont g\u00e9n\u00e9ralement utilis\u00e9s dans des environnements o\u00f9 les performances sont essentielles, tels que les datacenters d'entreprise.</p> </li> <li> <p>Exemples : VMware vSphere/ESXi, Microsoft Hyper-V (dans sa version pour serveurs), et KVM sont des exemples d'hyperviseurs de type 1.</p> </li> <li> <p>Utilisation : Les hyperviseurs de type 1 sont g\u00e9n\u00e9ralement utilis\u00e9s dans des environnements de production, o\u00f9 la virtualisation est une composante essentielle de l'infrastructure.</p> </li> </ol> <p></p>"},{"location":"cours/03-hyperviseurs/virtualisation/#hyperviseur-de-type-2-hosted","title":"Hyperviseur de Type 2 (Hosted) :","text":"<ol> <li> <p>Ex\u00e9cution au-dessus d'un syst\u00e8me d'exploitation : Les hyperviseurs de type 2 s'ex\u00e9cutent au-dessus d'un syst\u00e8me d'exploitation h\u00f4te existant, ce qui signifie qu'il y a une couche logicielle suppl\u00e9mentaire entre l'hyperviseur et le mat\u00e9riel physique.</p> </li> <li> <p>Facilit\u00e9 d'utilisation : Les hyperviseurs de type 2 sont g\u00e9n\u00e9ralement plus faciles \u00e0 installer et \u00e0 utiliser, car ils s'appuient sur un syst\u00e8me d'exploitation existant. Ils sont souvent utilis\u00e9s pour le d\u00e9veloppement, le test et l'apprentissage.</p> </li> <li> <p>Performances moindres : En raison de la couche logicielle suppl\u00e9mentaire, les hyperviseurs de type 2 ont tendance \u00e0 avoir des performances l\u00e9g\u00e8rement inf\u00e9rieures par rapport aux hyperviseurs de type 1. Cependant, pour de nombreuses charges de travail, cette diff\u00e9rence de performance peut ne pas \u00eatre significative.</p> </li> <li> <p>Exemples : VirtualBox, VMware Workstation, Parallels Desktop (pour macOS) sont des exemples d'hyperviseurs de type 2.</p> </li> <li> <p>Utilisation : Les hyperviseurs de type 2 sont souvent utilis\u00e9s dans des environnements de d\u00e9veloppement, de test, d'\u00e9mulation, et par des utilisateurs individuels qui souhaitent ex\u00e9cuter des syst\u00e8mes d'exploitation invit\u00e9s sur leur propre machine.</p> </li> </ol> <p>En r\u00e9sum\u00e9, la principale diff\u00e9rence entre les hyperviseurs de type 1 et de type 2 r\u00e9side dans leur relation avec le mat\u00e9riel. Les hyperviseurs de type 1 s'ex\u00e9cutent directement sur le mat\u00e9riel, tandis que les hyperviseurs de type 2 s'ex\u00e9cutent au-dessus d'un syst\u00e8me d'exploitation h\u00f4te. Le choix entre les deux d\u00e9pend des besoins sp\u00e9cifiques de virtualisation et des performances de votre environnement.</p> <p></p>"},{"location":"cours/03-hyperviseurs/virtualisation/#definition-de-lhyperconvergence","title":"D\u00e9finition de l\u2019hyperconvergence","text":"<p>L\u2019hyperconvergence est une approche d\u2019architecture informatique qui consiste \u00e0 int\u00e9grer dans une seule plateforme logicielle les trois piliers traditionnels d\u2019un datacenter :</p> <ul> <li>le calcul (CPU et m\u00e9moire pour ex\u00e9cuter les machines virtuelles),</li> <li>le stockage (disques locaux mutualis\u00e9s et g\u00e9r\u00e9s comme une seule ressource partag\u00e9e),</li> <li>et le r\u00e9seau (communications internes entre les n\u0153uds du cluster).</li> </ul> <p>Contrairement \u00e0 une infrastructure traditionnelle o\u00f9 ces \u00e9l\u00e9ments sont g\u00e9r\u00e9s s\u00e9par\u00e9ment (serveurs, SAN/NAS, commutateurs sp\u00e9cialis\u00e9s fiber channel), l\u2019hyperconvergence repose sur un hyperviseur et du stockage d\u00e9fini par logiciel (SDS) pour combiner toutes ces ressources au sein d\u2019un m\u00eame cluster.</p> Notion <p>Chez Proxmox la solution repose sur le syst\u00e8me CEPH</p> <p>Important</p> <p>Ceph est une solution de stockage distribu\u00e9 open source con\u00e7ue pour offrir une grande scalabilit\u00e9, une tol\u00e9rance aux pannes et des performances \u00e9lev\u00e9es. Il repose sur l\u2019agr\u00e9gation de disques pr\u00e9sents dans plusieurs serveurs (appel\u00e9s n\u0153uds) pour cr\u00e9er un espace de stockage unique, vu comme un seul syst\u00e8me. Utilisation : souvent employ\u00e9 dans des environnements de cloud (OpenStack, Proxmox, Kubernetes) pour fournir un stockage r\u00e9silient et distribu\u00e9 aux machines virtuelles et conteneurs.</p> <p>Avantages :</p> <ul> <li>Simplification de la gestion (administration unifi\u00e9e via une console unique).</li> <li>Scalabilit\u00e9 lin\u00e9aire : on ajoute simplement des n\u0153uds pour augmenter la capacit\u00e9.</li> <li>R\u00e9duction des co\u00fbts et de la complexit\u00e9 (moins de mat\u00e9riel sp\u00e9cialis\u00e9 comme les SAN).</li> <li>Haute disponibilit\u00e9 et r\u00e9silience int\u00e9gr\u00e9es.</li> </ul>"},{"location":"cours/03-hyperviseurs/virtualisation/#solutions-techniques","title":"Solutions techniques","text":"<p>Les hyperviseurs sont des logiciels qui permettent de cr\u00e9er et de g\u00e9rer des machines virtuelles (VMs) sur un serveur physique. Ils sont essentiels pour la virtualisation, qui permet d'ex\u00e9cuter plusieurs syst\u00e8mes d'exploitation et applications sur un seul mat\u00e9riel physique. Voici un petit cours sur les hyperviseurs, en mettant en avant VMware, Hyper-V, VirtualBox et Nutanix, tout en discutant des sp\u00e9cificit\u00e9s de l'hyperconvergence.</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#virtualbox","title":"VirtualBox :","text":"<p>Type d'hyperviseur : VirtualBox que vous avez utilis\u00e9 l'an dernier est un hyperviseur de type 2, ce qui signifie qu'il s'ex\u00e9cute sur un syst\u00e8me d'exploitation h\u00f4te existant (Windows, macOS, Linux).</p> <p>Caract\u00e9ristiques : VirtualBox est adapt\u00e9 pour les environnements de d\u00e9veloppement, de test et d'apprentissage. Il est open source et offre une interface utilisateur conviviale.</p> <p>Concurents : </p> <ul> <li> <p>VMware Workstation (et VMware Fusion pour macOS) : hyperviseurs de type 2 commerciaux offrant plus de fonctionnalit\u00e9s avanc\u00e9es et une meilleure int\u00e9gration professionnelle.</p> </li> <li> <p>Hyper-V (int\u00e9gr\u00e9 aux \u00e9ditions professionnelles et serveurs de Windows) : m\u00eame si c\u2019est un hyperviseur de type 1, il peut \u00eatre vu comme un concurrent car il est directement disponible sur Windows et souvent utilis\u00e9 pour la virtualisation locale.</p> </li> </ul>"},{"location":"cours/03-hyperviseurs/virtualisation/#vmware","title":"VMware :","text":"<p>Type d'hyperviseur : VMware propose deux types d'hyperviseurs - VMware vSphere/ESXi pour les environnements d'entreprise et VMware Workstation/Fusion pour les environnements de d\u00e9veloppement et de test.</p> <p>Caract\u00e9ristiques : VMware est l'un des leaders du march\u00e9 de la virtualisation. Il offre des fonctionnalit\u00e9s avanc\u00e9es telles que la migration \u00e0 chaud, la gestion automatis\u00e9e des ressources, la haute disponibilit\u00e9, la r\u00e9plication et la gestion centralis\u00e9e avec vCenter Server.</p> <p>Hyperconvergence : VMware propose une solution hyperconverg\u00e9e appel\u00e9e VMware vSAN. Il combine stockage et calcul sur un m\u00eame cluster de serveurs pour simplifier la gestion et am\u00e9liorer les performances.</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#hyper-v","title":"Hyper-V :","text":"<p>Type d'hyperviseur : Hyper-V est l'hyperviseur de Microsoft, int\u00e9gr\u00e9 \u00e0 Windows Server. Il existe \u00e9galement une version gratuite appel\u00e9e Hyper-V Server.</p> <p>Caract\u00e9ristiques : Hyper-V offre une virtualisation robuste avec des fonctionnalit\u00e9s telles que la migration en direct, la mise en cluster, la gestion \u00e0 distance via Hyper-V Manager ou PowerShell, et la prise en charge des machines virtuelles Linux et Windows.</p> <p>Hyperconvergence : Microsoft propose Azure Stack HCI, une solution hyperconverg\u00e9e bas\u00e9e sur Hyper-V. Elle offre une plateforme de calcul et de stockage hautement int\u00e9gr\u00e9e.</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#nutanix","title":"Nutanix :","text":"<p>Type d'hyperviseur : Nutanix est une plateforme hyperconverg\u00e9e qui int\u00e8gre son propre hyperviseur, appel\u00e9 Acropolis Hypervisor (AHV). Cependant, il prend \u00e9galement en charge d'autres hyperviseurs comme VMware ESXi et Hyper-V.</p> <p>Caract\u00e9ristiques : Nutanix offre une solution hyperconverg\u00e9e tout-en-un, combinant stockage, calcul et gestion dans un cluster \u00e9volutif. Il simplifie la gestion, offre une haute disponibilit\u00e9 et une scalabilit\u00e9 lin\u00e9aire.</p> <p>Hyperconvergence : Nutanix est une solution hyperconverg\u00e9e par excellence, car elle combine tous les \u00e9l\u00e9ments n\u00e9cessaires pour ex\u00e9cuter des charges de travail virtualis\u00e9es de mani\u00e8re efficace.</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#proxmox","title":"Proxmox :","text":"<p>Type d'hyperviseur : Proxmox VE est un hyperviseur de type 1 (bare-metal) bas\u00e9 sur KVM (Kernel-based Virtual Machine)pour la virtualisation mat\u00e9rielle et LXC (Linux Containers) pour la virtualisation bas\u00e9e sur conteneurs.</p> <p>Caract\u00e9ristiques : - Gestion centralis\u00e9e des machines virtuelles et des conteneurs via une interface web conviviale. - Prise en charge de la haute disponibilit\u00e9 avec la possibilit\u00e9 de migration en direct des machines virtuelles. - Int\u00e9gration du stockage d\u00e9fini par logiciel (Software-Defined Storage) pour la gestion des donn\u00e9es. - Prise en charge des conteneurs Linux via LXC pour une efficacit\u00e9 accrue des ressources. - Int\u00e9gration de la sauvegarde et de la restauration des machines virtuelles et des conteneurs.</p> <p>Important</p> <p>KVM (Kernel-based Virtual Machine) est un hyperviseur de type 1 int\u00e9gr\u00e9 au noyau Linux, qui transforme un syst\u00e8me Linux en plateforme de virtualisation compl\u00e8te. Il utilise les extensions mat\u00e9rielles (Intel VT-x, AMD-V) pour ex\u00e9cuter des machines virtuelles avec des performances proches du natif. Utilisation : KVM est largement employ\u00e9 dans les datacenters et solutions de cloud open source, comme Proxmox VE, OpenStack ou oVirt, pour g\u00e9rer des machines virtuelles Linux et Windows de mani\u00e8re fiable et performante.</p>"},{"location":"cours/03-hyperviseurs/virtualisation/#xen","title":"Xen :","text":"<p>Type d'hyperviseur : Xen est un hyperviseur de type 1 (bare-metal) open source, initialement d\u00e9velopp\u00e9 \u00e0 l\u2019Universit\u00e9 de Cambridge. Il a ensuite \u00e9t\u00e9 commercialis\u00e9 par XenSource, rachet\u00e9 en 2007 par Citrix, qui l\u2019a int\u00e9gr\u00e9 dans son produit XenServer (aujourd\u2019hui appel\u00e9 Citrix Hypervisor). Depuis 2013, le projet open source est g\u00e9r\u00e9 par la Linux Foundation sous le nom de Xen Project, avec Citrix comme contributeur majeur aux c\u00f4t\u00e9s d\u2019autres acteurs.</p> <p>Il ne sera pas mis en oeuvre mais sachez qu'il existe. On priviligiera les solutions bas\u00e9es sur KVM.</p> <p>Caract\u00e9ristiques :</p> <p>Xen utilise une architecture particuli\u00e8re avec un domaine privil\u00e9gi\u00e9 appel\u00e9 Dom0, qui g\u00e8re les interactions avec le mat\u00e9riel et les pilotes, et des domaines invit\u00e9s appel\u00e9s DomU pour ex\u00e9cuter les machines virtuelles.</p> <p>Il prend en charge deux modes de virtualisation : la paravirtualisation (PV), qui n\u00e9cessite un OS modifi\u00e9 pour fonctionner efficacement, et la virtualisation compl\u00e8te (HVM), qui repose sur les extensions mat\u00e9rielles de virtualisation (Intel VT-x, AMD-V).</p> <p>Xen est reconnu pour sa s\u00e9curit\u00e9 renforc\u00e9e et sa modularit\u00e9, ce qui en fait un choix fr\u00e9quent pour des environnements sensibles.</p> <p>Utilisation : Xen est largement utilis\u00e9 dans les infrastructures de cloud computing, notamment par Amazon Web Services (AWS) pour son service EC2, ainsi que dans certains syst\u00e8mes embarqu\u00e9s et environnements n\u00e9cessitant une isolation forte.</p>"},{"location":"cours/04-Routage%20vers%20Internet/hsrp/","title":"FailOver avec le Protocole HSRP","text":"<p>Le protocole HSRP (Hot Standby Router Protocol) est un protocole de Cisco con\u00e7u pour fournir une haute disponibilit\u00e9 (HA) aux r\u00e9seaux en permettant \u00e0 un routeur de prendre automatiquement le relais en cas de panne du routeur principal. HSRP est souvent utilis\u00e9 pour cr\u00e9er une passerelle par d\u00e9faut redondante vers l'Internet ou d'autres r\u00e9seaux.</p> <p>Important</p> <p>Son \u00e9quivalent normalis\u00e9 est VRRP (Virtual Router Redundancy Protocol, RFC 5798), qui fonctionne de mani\u00e8re similaire mais est interop\u00e9rable entre constructeurs. On trouve \u00e9galement CARP (Common Address Redundancy Protocol), utilis\u00e9 dans l\u2019univers BSD, notamment sur les pare-feux pfSense et OPNsense. C\u00f4t\u00e9 Linux, un \u00e9quivalent tr\u00e8s r\u00e9pandu est Keepalived, qui s\u2019appuie sur VRRP pour assurer la redondance d\u2019IP virtuelles et qui est souvent utilis\u00e9 pour la haute disponibilit\u00e9 de serveurs applicatifs ou de load balancers (par exemple avec HAProxy ou Nginx).</p> Remarque <p>Dans le monde des serveurs, on retrouve une logique proche avec Heartbeat, Pacemaker ou Corosync issu du projet Linux-HA : ils ne s\u2019appliquent pas seulement aux passerelles IP, mais plus g\u00e9n\u00e9ralement \u00e0 la haute disponibilit\u00e9 applicative et syst\u00e8me, en permettant \u00e0 un n\u0153ud secondaire de prendre le relais du n\u0153ud primaire en cas de panne, par exemple pour un service web ou une base de donn\u00e9es.</p> <p>Voici une pr\u00e9sentation rapide du protocole HSRP avec des exemples de configuration utilisant des adresses IP de la plage 172.28.x.0/24, avec une adresse VIP (Virtual IP) de 172.28.x.254 :</p> <p>Supposons que vous ayez deux routeurs Cisco, R1 et R2, et que vous souhaitiez configurer HSRP entre eux pour la haute disponibilit\u00e9.</p> <p>Configuration de R1 :</p> <pre><code>interface GigabitEthernet0/0\n ip address 172.28.x.251 255.255.255.0\n standby 1 ip 172.28.x.254\n standby 1 priority 110\n standby 1 preempt\n</code></pre> <p>Dans cette configuration :</p> <ul> <li>L'interface GigabitEthernet0/0 de R1 est configur\u00e9e avec l'adresse IP 172.28.x.251.</li> <li>\"standby 1 ip 172.28.x.254\" d\u00e9finit l'adresse VIP (Virtual IP) HSRP \u00e0 172.28.x.254.</li> <li>\"standby 1 priority 110\" d\u00e9finit la priorit\u00e9 de ce routeur \u00e0 110 (par d\u00e9faut est 100).</li> <li>\"standby 1 preempt\" permet \u00e0 R1 de reprendre automatiquement le r\u00f4le de routeur actif s'il redevient disponible apr\u00e8s une panne.</li> </ul> <p>Configuration de R2 :</p> <pre><code>interface GigabitEthernet0/0\n ip address 172.28.x.252 255.255.255.0\n standby 1 ip 172.28.x.254\n standby 1 priority 100\n standby 1 preempt\n</code></pre> <p>Dans cette configuration :</p> <ul> <li>L'interface GigabitEthernet0/0 de R2 est configur\u00e9e avec l'adresse IP 172.28.x.3.</li> <li>\"standby 1 ip 172.28.x.254\" d\u00e9finit \u00e9galement l'adresse VIP HSRP \u00e0 172.28.x.254, qui est la m\u00eame que celle configur\u00e9e sur R1.</li> <li>\"standby 1 priority 100\" d\u00e9finit la priorit\u00e9 de ce routeur \u00e0 100.</li> <li>\"standby 1 preempt\" permet \u00e0 R2 de prendre le relais en tant que routeur actif si R1 devient indisponible.</li> </ul> <p>Ainsi, avec cette configuration, R1 sera le routeur actif tant qu'il est disponible. En cas de panne de R1 ou de sa connexion, R2 prendra automatiquement le relais en tant que routeur actif, assurant ainsi une haute disponibilit\u00e9 pour la VIP 172.28.x.254.</p>"},{"location":"cours/04-Routage%20vers%20Internet/nat/","title":"04-NAT Dynamique (Masquerade) version Cisco","text":"<p>Le NAT dynamique est une technique utilis\u00e9e pour permettre \u00e0 plusieurs dispositifs d'une r\u00e9seau local (IP inside) de partager une seule adresse IP publique (IP outside) pour acc\u00e9der \u00e0 Internet ou d'autres r\u00e9seaux externes.</p> <p>\u00c9l\u00e9ments du NAT dynamique :</p> <ol> <li> <p>IP Inside (Adresse priv\u00e9e) : L'adresse IP inside est l'adresse IP attribu\u00e9e aux dispositifs du r\u00e9seau local. Dans votre exemple, l'adresse IP inside est en 172.28.x.254/24. Ces adresses IP sont g\u00e9n\u00e9ralement priv\u00e9es et ne sont pas routables sur Internet.</p> </li> <li> <p>IP Outside (Adresse publique) : L'adresse IP outside est l'adresse IP attribu\u00e9e au routeur ou au pare-feu qui relie le r\u00e9seau local au r\u00e9seau externe, g\u00e9n\u00e9ralement Internet. Dans votre exemple, l'adresse IP outside est en 183.44.x.1/30. Cette adresse IP est publique et utilis\u00e9e pour communiquer avec des ressources sur Internet.</p> </li> <li> <p>Table de traduction (Translation Table) : La table de traduction est une table g\u00e9r\u00e9e par le routeur ou le pare-feu NAT qui associe les adresses IP inside aux adresses IP outside. Chaque fois qu'un dispositif du r\u00e9seau local initie une connexion vers l'ext\u00e9rieur, une entr\u00e9e est cr\u00e9\u00e9e dans la table de traduction pour suivre la correspondance entre l'adresse IP inside et l'adresse IP outside.</p> </li> <li> <p>Port Mapping (Port Mapping) : Dans le cas du NAT dynamique, les num\u00e9ros de port sont \u00e9galement modifi\u00e9s. Cela permet \u00e0 plusieurs dispositifs \u00e0 l'int\u00e9rieur du r\u00e9seau local d'utiliser la m\u00eame adresse IP publique en attribuant un num\u00e9ro de port unique \u00e0 chaque connexion. Ainsi, le routeur peut rediriger le trafic vers le dispositif appropri\u00e9 en fonction du num\u00e9ro de port.</p> </li> </ol> <p>Configuration du NAT dynamique avec Cisco :</p> <p>Voici un exemple de configuration du NAT dynamique avec Cisco :</p> <pre><code>interface GigabitEthernet0/0\n ip address 183.44.x.1 255.255.255.252\n ip nat outside\n\ninterface GigabitEthernet0/1\n ip address 172.28.x.254 255.255.255.0\n ip nat inside\n\nip nat inside source list 1 interface GigabitEthernet0/0 overload\n\naccess-list 1 permit 172.28.x.0 0.0.0.255\n</code></pre> <p>Explications :</p> <ul> <li> <p>La commande <code>ip nat outside</code> est appliqu\u00e9e \u00e0 l'interface connect\u00e9e \u00e0 l'ext\u00e9rieur (GigabitEthernet0/0), tandis que <code>ip nat inside</code> est appliqu\u00e9 \u00e0 l'interface connect\u00e9e au r\u00e9seau local (GigabitEthernet0/1).</p> </li> <li> <p>La commande <code>ip nat inside source list 1 interface GigabitEthernet0/0 overload</code> d\u00e9finit la r\u00e8gle de translation NAT dynamique. Elle indique que toutes les adresses IP du r\u00e9seau local (d\u00e9finies dans l'access-list 1) seront traduites en utilisant l'adresse IP publique de l'interface GigabitEthernet0/0, avec la surcharge (overload) pour g\u00e9rer plusieurs connexions simultan\u00e9es en utilisant le mappage de ports.</p> </li> <li> <p>L'access-list 1 sp\u00e9cifie les adresses IP \u00e0 l'int\u00e9rieur du r\u00e9seau local qui sont autoris\u00e9es \u00e0 \u00eatre traduites.</p> </li> </ul> <p>Ainsi, avec cette configuration, les dispositifs du r\u00e9seau local avec des adresses IP en 172.28.x.x pourront acc\u00e9der \u00e0 Internet en partageant l'adresse IP publique 183.44.x.1 gr\u00e2ce au NAT dynamique. Chaque connexion sortante se verra attribuer un num\u00e9ro de port unique pour permettre la correspondance correcte entre les dispositifs internes et l'adresse IP publique.</p>"},{"location":"cours/04-Routage%20vers%20Internet/nat/#verification-du-contenu-de-la-table-de-nat","title":"Verification du contenu de la table de NAT","text":"<p>Pour v\u00e9rifier la table de translation NAT et la vider sur un routeur Cisco, vous pouvez utiliser les commandes suivantes :</p> <p>Pour v\u00e9rifier la table de translation NAT, utilisez la commande suivante : <pre><code>show ip nat translations\n</code></pre></p> <p>Cette commande affichera une liste des entr\u00e9es dans la table de translation NAT, montrant les adresses IP inside, les ports source, les adresses IP outside, les ports de destination, ainsi que le protocole utilis\u00e9.</p> <p>Pour vider la table de translation NAT, utilisez la commande suivante : <pre><code>clear ip nat translation *\n</code></pre></p> <p>Cette commande supprimera toutes les entr\u00e9es de la table de translation NAT, r\u00e9initialisant ainsi les associations entre les adresses IP inside et outside. Assurez-vous d'utiliser cette commande avec pr\u00e9caution, car elle peut interrompre les connexions en cours.</p>"},{"location":"cours/04-Routage%20vers%20Internet/nat/#gestion-avec-une-interface-de-management","title":"Gestion avec une interface de management","text":"<p>Vous pouvez configurer le NAT avec une sous-interface d\u00e9di\u00e9e au management qui n'est pas rout\u00e9e. Voici un exemple de configuration NAT avec une sous-interface sur un routeur Cisco, en supposant que vous avez d\u00e9j\u00e0 configur\u00e9 une interface principale :</p> <p>Configuration de la sous-interface pour le NAT :</p> <pre><code>interface GigabitEthernet0/0.10\n encapsulation dot1Q 10\n ip address 172.28.x.254 255.255.255.0\n ip nat inside\n\ninterface GigabitEthernet0/0.20\n encapsulation dot1Q 20\n ip address 192.168.1.1 255.255.255.0\n no ip route-cache\n</code></pre> <p>Dans cet exemple :</p> <ul> <li>Nous avons cr\u00e9\u00e9 deux sous-interfaces, \"GigabitEthernet0/0.10\" et \"GigabitEthernet0/0.20\", chacune avec son propre VLAN (10 et 20).</li> <li>\"GigabitEthernet0/0.10\" est configur\u00e9 comme une interface NAT inside, avec une adresse IP de 172.28.x.254/24. Cette sous-interface sera utilis\u00e9e pour le trafic NAT.</li> <li>\"GigabitEthernet0/0.20\" est configur\u00e9 avec une adresse IP de gestion de 192.168.1.1/24, mais nous avons ajout\u00e9 \"no ip route-cache\" pour emp\u00eacher cette interface d'\u00eatre rout\u00e9e. Ainsi, cette sous-interface est d\u00e9di\u00e9e au management et ne participera pas au processus de routage.</li> </ul> <p>Ensuite, vous pouvez configurer le NAT de la m\u00eame mani\u00e8re que dans l'exemple pr\u00e9c\u00e9dent, en utilisant \"GigabitEthernet0/0.10\" comme interface NAT inside. Cette configuration permettra aux dispositifs du r\u00e9seau VLAN 10 (sous-interface 10) d'utiliser NAT pour acc\u00e9der \u00e0 Internet, tandis que la sous-interface 20 est r\u00e9serv\u00e9e au management et n'est pas rout\u00e9e.</p>"},{"location":"cours/04-Routage%20vers%20Internet/nat/#configuration-du-switch-pour-assurer-la-liaison","title":"Configuration du switch pour assurer la liaison.","text":"<p>Pour connecter le routeur \u00e0 un commutateur (switch), vous pouvez configurer une connexion trunk(802.1q) entre le routeur et le commutateur si vous avez plusieurs VLANs sur le routeur (comme dans l'exemple pr\u00e9c\u00e9dent). Voici comment configurer un port du commutateur pour une connexion trunk vers le routeur Cisco.</p> <p>Supposons que vous ayez deux VLANs sp\u00e9cifiques, VLAN 10 et VLAN 20, que vous souhaitez autoriser \u00e0 communiquer avec le routeur. Vous avez d\u00e9j\u00e0 configur\u00e9 les sous-interfaces correspondantes sur le routeur (comme dans l'exemple pr\u00e9c\u00e9dent).</p> <p>Configuration du port du commutateur en mode trunk avec les VLANs autoris\u00e9s :</p> <pre><code>interface GigabitEthernet0/1\n    switchport mode trunk\n    switchport trunk allowed vlan 10,20\n</code></pre> <p>Important</p> <p>Pensez \u00e0 bien cr\u00e9er les vlans en mettant une description par exemple. Un simple allowed ne cr\u00e9 par le vlan ! Ne pas hesitez \u00e0 faire un <code>show vlan brief</code></p> <p>Dans cette configuration :</p> <ul> <li><code>switchport mode trunk</code> configure le port du commutateur en mode trunk.</li> <li><code>switchport trunk allowed vlan 10,20</code> sp\u00e9cifie que seuls les VLANs 10 et 20 sont autoris\u00e9s \u00e0 traverser le port trunk. Vous pouvez ajouter d'autres num\u00e9ros de VLAN s\u00e9par\u00e9s par des virgules si n\u00e9cessaire.</li> </ul> <p>Assurez-vous que la configuration de l'interface du commutateur est compatible avec la configuration des sous-interfaces sur le routeur. Cela garantira que le trafic VLAN entre le commutateur et le routeur est correctement \u00e9tiquet\u00e9 et rout\u00e9.</p>"},{"location":"cours/05-Services/01-config-base-securise/","title":"Configuration de base - Serveurs","text":""},{"location":"cours/05-Services/01-config-base-securise/#serveurs-linux","title":"Serveurs Linux","text":""},{"location":"cours/05-Services/01-config-base-securise/#configuration-ip","title":"Configuration IP","text":"<ul> <li>Configurer la ou les IP statique dans<code>/etc/network/interfaces</code></li> <li>V\u00e9rifier la passerelle et les routes.</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-du-resolver-dns","title":"Configuration du Resolver DNS","text":"<ul> <li>Configurer le resolver DNS dans <code>/etc/resolv.conf</code></li> <li>Bien v\u00e9rifier si le resolver n'est pas g\u00e9r\u00e9 par <code>Network Manager</code></li> <li>Indiquer un Resolver principal et un de secours.</li> <li>Verification avec <code>nslookup</code> ou <code>dig</code> (paquet <code>dns-utils</code>)</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-de-lhorloge-synchronisation-avec-ntp","title":"Configuration de l'horloge (Synchronisation avec NTP)","text":"<ul> <li>Utiliser chrony (recommand\u00e9 depuis Debian 10 / Ubuntu 18) </li> </ul> <pre><code>apt install chrony\n</code></pre> <p>Dans <code>etc/chrony/chrony.conf</code> :</p> <ul> <li>Ajouter plusieurs serveurs NTP (internes si dispo)</li> <li> <p>Autoriser la d\u00e9rive raisonnable</p> </li> <li> <p>Verification de la synchronisation des horloges <pre><code>chronyc tracking\nchronyc sources\n</code></pre></p> </li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-du-nom-de-la-machine-hostname","title":"Configuration du nom de la machine (hostname)","text":"<ul> <li>Coh\u00e9rent, court, ayant du sens par rapport au service rendu, sans caract\u00e8re sp\u00e9cial.</li> <li>D\u00e9finir dans <code>/etc/hostname</code> et <code>/etc/hosts</code>.</li> </ul> <pre><code>echo \"srv-http01\" &gt; /etc/hostname\nhostnamectl set-hostname srv-http01\n</code></pre>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-ssh-securisee","title":"Configuration SSH (s\u00e9curis\u00e9e)","text":"<p>Fichier : <code>/etc/ssh/sshd_config</code></p> <ul> <li>D\u00e9sactiver l\u2019acc\u00e8s root</li> <li>Privilegier l'authentification par cl\u00e9 SSH si possible</li> <li>Limiter les utilisateurs autoris\u00e9s (les admins syst\u00e8me)</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-de-la-journalisation-logs","title":"Configuration de la journalisation (Logs)","text":"<ul> <li>Activer et configurer rsyslog (d\u00e9faut).</li> <li> <p>Conserver les logs suffisants :</p> </li> <li> <p>/var/log/auth.log</p> </li> <li>/var/log/syslog</li> <li>/var/log/kern.log</li> <li> <p>Logs applicatifs dans <code>/var/log/&lt;service&gt;</code></p> </li> <li> <p>Rotation via <code>logrotate</code></p> </li> </ul> <p>Pour plus de logs</p> <ul> <li>Installer <code>auditd</code></li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-dun-agent-siem-serveur-de-logs","title":"Configuration d'un agent SIEM (Serveur de Logs)","text":"<p>Un <code>SIEM (Security Information and Event Management)</code> est une plateforme centralis\u00e9e qui collecte, corr\u00e8le et analyse les journaux (logs) provenant de serveurs, postes, firewalls, applications ou services cloud. Son objectif principal est de d\u00e9tecter rapidement les incidents de s\u00e9curit\u00e9.</p> <p>Il permet:   - Centraliser tous les logs au m\u00eame endroit   - D\u00e9tecter des comportements suspects (ex : brute force, exfiltration)   - G\u00e9n\u00e9rer des alertes en temps r\u00e9el   - Conserver les journaux pour l\u2019analyse forensique   - Faciliter les obligations l\u00e9gales (RGPD, conformit\u00e9)</p> <p>Exemple:   - Wazuh   - Splunk   - ELK / OpenSearch SIEM   - Microsoft Sentinel   - Graylog avec extensions de s\u00e9curit\u00e9</p> <p>Sans SIEM, chaque machine a ses logs isol\u00e9s, ce qui rend quasi impossible la d\u00e9tection d\u2019une attaque coordonn\u00e9e. Un SIEM permet de voir l\u2019activit\u00e9 globale du syst\u00e8me d\u2019information.</p> <ul> <li>Installer l'agent SIEM pour communiquer avec le Serveur</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-dune-politique-de-sauvegarde","title":"Configuration d'une politique de sauvegarde","text":"<ul> <li>Conserver au moins l'ancienne versions d'une config (revenir \u00e0 l'\u00e9tat anterieur fonctionnel).</li> <li>Dans l'ideal versionner avec git (<code>etckeeper</code>) <code>/etc/</code> et pousser sur un serveur de confiance (un gitlab interne par exemple)</li> <li>Faire des backup<ul> <li>VEAM pour des VM</li> <li>rsync + cron pour seulement des fichiers.</li> </ul> </li> </ul> <p>S\u00e9curiser l\u2019acc\u00e8s \u00e0 la sauvegarde :</p> <ul> <li>Authentification</li> <li>R\u00e9seau isol\u00e9 (Management deconnect\u00e9 d'internet)</li> <li>Horodatage et immuabilit\u00e9 si possible</li> </ul> <p>R\u00e8gle classique \u201c7 daily backups\u201d utilis\u00e9e par de nombreux syst\u00e8mes</p> <p>Beaucoup de solutions appliquent par d\u00e9faut :</p> <ul> <li>7 backups journaliers  (1 / jour)</li> <li>4 backups hebdomadaires (1 / semaine)</li> <li>12 backups mensuels (1 / mois)</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#configuration-pour-un-serveur-de-supervision","title":"Configuration pour un serveur de Supervision","text":"<ul> <li>Activer SNMP si n\u00e9cessaire (serveur devant rester hautement disponible)</li> <li>Utiliser SNMPv3 avec mot de passe fort et chiffrement (pas de communaut\u00e9 public si pas d'utilisation de la version 3)</li> <li>Limiter l\u2019acc\u00e8s \u00e0 un serveur de supervision ou VLAN d\u00e9di\u00e9 (management ou monitoring)</li> <li>Configurer des traps ou alertes pour les \u00e9v\u00e9nements critiques</li> <li>Journaliser toutes les requ\u00eates SNMP pour audit si possible</li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#serveurs-windows","title":"Serveurs Windows","text":"<p>La configuration d\u2019un serveur Windows demande une attention particuli\u00e8re, notamment lorsqu\u2019il est destin\u00e9 \u00e0 rejoindre un domaine Active Directory ou \u00e0 h\u00e9berger des r\u00f4les critiques. Voici les bonnes pratiques essentielles.</p>"},{"location":"cours/05-Services/01-config-base-securise/#bonnes-pratiques","title":"Bonnes pratiques","text":"<p>Il est imp\u00e9ratif de choisir le nom d\u00e9finitif du serveur avant son ajout au domaine Active Directory.</p> <p>Attention</p> <p>Renommer une machine d\u00e9j\u00e0 membre du domaine peut provoquer : - des erreurs Kerberos  - des objets dupliqu\u00e9s dans l\u2019AD - des probl\u00e8mes DNS et SPN - un dysfonctionnement des r\u00f4les ADDS li\u00e9s - Cela oblige souvent \u00e0 retirer et r\u00e9int\u00e9grer le serveur au domaine.</p> <p>RDP uniquement pour les administrateurs - Jamais expos\u00e9 \u00e0 Internet - accessible seulement depuis un r\u00e9seau d\u2019administration isol\u00e9 ou une machine d\u2019administration d\u00e9di\u00e9e</p> <p>Les \u00e9ditions Windows Server Core sont all\u00e9g\u00e9es :</p> <ul> <li>pas d\u2019interface graphique</li> <li>moins de services actifs</li> <li>moins de failles potentielles</li> <li>moins de mises \u00e0 jour</li> <li>moins de ressources utilis\u00e9es</li> <li>Administration \u00e0 distance facilit\u00e9e (PowerShell, WinRM)</li> </ul> <p>N'installer le bureau que si necessaire, privilegier les version Core et management avec une machine d\u00e9di\u00e9 \u00e0 l'administration se connectant aux diff\u00e9rents serveurs windows (outil RSAT ).</p> <p>Differents outils d'administration:</p> <ul> <li>PowerShell Remoting (WinRM)</li> <li>Windows Admin Center</li> </ul> <p></p> <p>Attention</p> <p>Attention WindowsAdmin Center est pens\u00e9 pour travailler dans un domaine: L'ajout d'une machine se fait pas son nom complet (pas par son IP), cela peut \u00eatre d\u00e9routant La machine servant de Passerelle Windows Admin Center doit \u00eatre attach\u00e9 au domaine, en Worgroup il faut autoriser explicitement les h\u00f4tes cibles?   Par ailleurs Windows Admin Center ne fonctionne qu'avec un navigateur bas\u00e9 sur Chromium (le mieux est d'utiliser Edge de Microsoft) </p> <p>Exemple de commande en worgroup (pour des test)</p> <pre><code>Set-Item WSMan:\\localhost\\Client\\TrustedHosts -Value \"srv-test.local\" -Force\nGet-Item WSMan:\\localhost\\Client\\TrustedHosts\n\nou un\n\nSet-Item WSMan:\\localhost\\Client\\TrustedHosts -Value \"*\" -Force\n</code></pre> <p>Le derni\u00e8re ligne autoriser n'importe quelle machine (pratique risqu\u00e9e)</p> <p>Dans l'id\u00e9al on passera par un Bastion d'administration qui servira de Passerelle applicative. Les postes des administrateurs (sous windows) peuvent disposer de l'application Windows Admin Center pour g\u00e9rer les serveurs.</p> <p></p> <p>Attention</p> <p>Il faut penser \u00e0 installer les extensions pour certaines fonctionnalit\u00e9s (d\u00e9routant)</p> <p></p> <p></p> <p></p> <p></p>"},{"location":"cours/05-Services/01-config-base-securise/#principe-fondamental-1-serveur-1-role","title":"Principe fondamental : 1 serveur = 1 r\u00f4le","text":"<ul> <li>Serveur ADDS \u2192 uniquement contr\u00f4leur de domaine + Service DNS (Exception pour ADDC + DNS car Un contr\u00f4leur de domaine Windows doit h\u00e9berger DNS pour que le domaine fonctionne correctement.)</li> <li>Serveur de fichiers \u2192 uniquement file server</li> <li>Serveur WSUS \u2192 uniquement WSUS</li> <li>Serveur RDS \u2192 uniquement Remote Desktop Services (Attention aux licences !!!!!!! ) </li> </ul>"},{"location":"cours/05-Services/01-config-base-securise/#securiser-les-roles-sensibles-pki-autorites-de-certification","title":"S\u00e9curiser les r\u00f4les sensibles : PKI / Autorit\u00e9s de Certification","text":"<p>Une PKI interne (Autorit\u00e9 de Certification Windows) doit \u00eatre prot\u00e9g\u00e9e comme un r\u00f4le hautement critique. La moindre compromission peut mettre en p\u00e9ril toute la confiance interne. Journalisation de tous les evennement obligatoire.</p> <p>Si possible, utiliser une CA racine (root) hors ligne : cl\u00e9 priv\u00e9e totalement d\u00e9connect\u00e9e du r\u00e9seau. Toute la chaine de confiance reposera sur cette Autorit\u00e9.</p> <p>Les CA delegu\u00e9es peuvent \u00eatre en ligne pour d\u00e9livrer les certificats aux serveurs et utilisateurs.</p> <p>Limiter l\u2019acc\u00e8s r\u00e9seau aux seules machines d\u2019administration autoris\u00e9es.</p> <p>RDP / GUI uniquement depuis le r\u00e9seau d\u2019administration d\u00e9di\u00e9.</p> <p>Tous les \u00e9v\u00e9nements li\u00e9s \u00e0 la PKI doivent \u00eatre journalis\u00e9s et centralis\u00e9s.</p> <ul> <li> <p>Activer la journalisation d\u00e9taill\u00e9e via Event Viewer / Security / ADCS :</p> </li> <li> <p>Demandes de certificat</p> </li> <li>D\u00e9livrances</li> <li>R\u00e9vocations</li> <li>Modifications de templates</li> <li> <p>Acc\u00e8s aux cl\u00e9s priv\u00e9es</p> </li> <li> <p>Envoyer ces logs vers un SIEM pour corr\u00e9lation et alerting.</p> </li> <li>Faire des backups et test de restauration regulierement</li> </ul> <p>Conserver au moins 3 versions historiques des bases de certificats et cl\u00e9s priv\u00e9es.</p> <p>Suivre la politique 3-2-1 de l'ANSSI :</p> <ul> <li>3 copies</li> <li>2 supports diff\u00e9rents</li> <li>1 copie hors site</li> </ul>"},{"location":"cours/05-Services/DNS/01-dns/","title":"01 - DNS (Domain Name System)","text":""},{"location":"cours/05-Services/DNS/01-dns/#introduction-aux-dns","title":"Introduction aux DNS","text":"<p>Les DNS, ou Domain Name System, sont un syst\u00e8me fondamental d'Internet qui permet de traduire les noms de domaine en adresses IP et vice-versa. Ils jouent un r\u00f4le essentiel dans la navigation sur le Web et la communication entre les appareils connect\u00e9s \u00e0 Internet.</p>"},{"location":"cours/05-Services/DNS/01-dns/#resolveurs-dns","title":"R\u00e9solveurs DNS","text":"<p>voir page d\u00e9di\u00e9e</p>"},{"location":"cours/05-Services/DNS/01-dns/#serveurs-dautorite","title":"Serveurs d'autorit\u00e9","text":"<p>Les serveurs d'autorit\u00e9 sont des serveurs DNS responsables d'une zone DNS particuli\u00e8re. Ils ont la capacit\u00e9 d'autoriser des requ\u00eates pour les noms de domaine dans leur zone respective. Les zones DNS sont g\u00e9n\u00e9ralement d\u00e9finies pour repr\u00e9senter une partie de l'arborescence des noms de domaine, et chaque zone a un serveur d'autorit\u00e9 qui la g\u00e8re.</p>"},{"location":"cours/05-Services/DNS/01-dns/#separation-des-roles","title":"S\u00e9paration des r\u00f4les","text":"<p>La s\u00e9paration des r\u00f4les dans le syst\u00e8me DNS est une pratique courante pour garantir la s\u00e9curit\u00e9 et la fiabilit\u00e9. Cette s\u00e9paration peut \u00eatre r\u00e9alis\u00e9e en utilisant diff\u00e9rents serveurs pour les r\u00f4les sp\u00e9cifiques, tels que les serveurs de r\u00e9solution, les serveurs d'autorit\u00e9 et les serveurs de redirection.</p> <p>Attention</p> <p>Il y a souvent confusion entre les r\u00f4le de Resolveur et Autorit\u00e9.</p>"},{"location":"cours/05-Services/DNS/01-dns/#redirecteurs-dns","title":"Redirecteurs DNS","text":"<p>Les redirecteurs DNS sont des serveurs DNS qui redirigent les requ\u00eates DNS vers d'autres serveurs DNS, g\u00e9n\u00e9ralement les serveurs d'autorit\u00e9 appropri\u00e9s. Ils sont utiles pour am\u00e9liorer l'efficacit\u00e9 du syst\u00e8me DNS en \u00e9vitant des requ\u00eates inutiles aux serveurs racine.</p>"},{"location":"cours/05-Services/DNS/01-dns/#serveurs-racine","title":"Serveurs Racine","text":"<p>Les serveurs racine sont le niveau le plus \u00e9lev\u00e9 de la hi\u00e9rarchie DNS. Ils stockent les informations de base pour l'ensemble du syst\u00e8me DNS et sont responsables de renvoyer les requ\u00eates vers les serveurs d'autorit\u00e9 appropri\u00e9s pour les domaines de premier niveau (TLD) tels que .com, .org, .net, etc.</p>"},{"location":"cours/05-Services/DNS/01-dns/#delegation-des-zones","title":"D\u00e9l\u00e9gation des Zones","text":"<p>La d\u00e9l\u00e9gation des zones est le processus par lequel une autorit\u00e9 parente confie la gestion d'une zone DNS \u00e0 une autorit\u00e9 enfant. Cela permet de distribuer la responsabilit\u00e9 de la gestion des noms de domaine dans la hi\u00e9rarchie DNS. Par exemple, le registraire d'un domaine peut d\u00e9l\u00e9guer la gestion de la zone DNS \u00e0 l'h\u00e9bergeur Web du propri\u00e9taire du domaine.</p>"},{"location":"cours/05-Services/DNS/01-dns/#schema-de-linfrastructure-dns-pour-sportludique","title":"Schema de l'infrastructure DNS pour SportLudique","text":""},{"location":"cours/05-Services/DNS/02-resolver/","title":"02.1- Resolveur DNS","text":"<p>Un r\u00e9solveur DNS est un logiciel ou un service responsable de la r\u00e9solution des noms de domaine en adresses IP. Les r\u00e9solveurs sont g\u00e9n\u00e9ralement utilis\u00e9s par les appareils clients pour interroger le syst\u00e8me DNS et obtenir les adresses IP associ\u00e9es aux noms de domaine.</p>"},{"location":"cours/05-Services/DNS/02-resolver/#avec-bind","title":"Avec Bind","text":"<p>Dans le fichier <code>/etc/bind/named.conf.options</code></p> <pre><code>    options {\n            directory \"/var/cache/bind\";\n\n            //Autorise les requetes recursives\n            recursion yes;  \n\n            //Liste des r\u00e9seaux autoris\u00e9s \u00e0 interoger le resolver\n            //Par defaut seul les \u00e9quipements du meme r\u00e9seau IP que le serveur peuvent l\\'interroger.\n            allow-query { \n                172.16.x.0/24;       //LAN\n                127.0.0.1;          //LOCALHOST\n                192.168.x.0/24;    //DMZ\n            };\n\n            //Desactivation de DNSSec\n            dnssec-validation no;\n\n            //Ecoute sur l\\'ensemble des interfaces IPv4\n            listen-on { any; };\n    };\n</code></pre>"},{"location":"cours/05-Services/DNS/02-resolver/#configuration-des-redirecteurs","title":"Configuration des redirecteurs","text":"<p>Dans le fichier <code>/etc/bind/named.conf.local</code></p> <p>Les requetes \u00e0 destination de la zone locale doivent \u00eatre redirig\u00e9es vers le serveur DNS de la DMZ en interogeant la vue interne.</p> <pre><code>zone \"ville.sportludique.fr\" {\n    type forward;\n    forwarders { 192.168.x.y };  // Remplace par l'IP du serveur DNS ayant autorit\u00e9 sur la zone (dans la DMZ)\n};\n</code></pre> <p>Les requetes \u00e0 destination de la zone de l'entreprise (sportludique.fr) doivent partir vers le serveur resolver de l'enseignant g\u00e9rant cette zone.</p> <pre><code>zone \"sportludique.fr\" {\n    type forward;\n    forwarders { 121.183.90.205; };  // IP du serveur de l'enseignant ayant autorit\u00e9 sur la zone sportludique.fr\n};\n</code></pre> <p>Toutes les autres requetes sont recursives et interrogent donc les serveurs racines (connu de Bind). Cela permet d'\u00e9viter une potentielle censure en utilisant le serveur DNS d'un Op\u00e9rateur (celui du prof :-) )</p>"},{"location":"cours/05-Services/DNS/02-unbound/","title":"02.2 - Resolver Unbound","text":"<p>Unbound est un r\u00e9solveur DNS r\u00e9cursif rapide et s\u00e9curis\u00e9 d\u00e9velopp\u00e9 par l'organisation NLnet Labs. Il est principalement utilis\u00e9 pour r\u00e9pondre aux requ\u00eates DNS de mani\u00e8re r\u00e9cursive tout en assurant la confidentialit\u00e9, l'int\u00e9grit\u00e9, et la validation des r\u00e9ponses \u00e0 l'aide de DNSSEC (Domain Name System Security Extensions).</p>"},{"location":"cours/05-Services/DNS/02-unbound/#fonctionnement-dunbound","title":"Fonctionnement d'Unbound","text":"<p>Unbound peut fonctionner comme :</p> <ul> <li>Un r\u00e9solveur r\u00e9cursif : Il effectue la r\u00e9solution DNS compl\u00e8te en interrogeant directement les serveurs DNS depuis les racines jusqu'aux serveurs faisant autorit\u00e9.</li> <li>Un validateur DNSSEC : Il assure que les r\u00e9ponses DNS n'ont pas \u00e9t\u00e9 modifi\u00e9es en chemin en v\u00e9rifiant les signatures cryptographiques des enregistrements DNS.</li> </ul> <p>Attention</p> <p>Les fonctionnalit\u00e9 DNSSEC ne peuvent \u00eatre mise en place au sein du projet sportludique qui est un projet simul\u00e9. Le nom de domaine n'existe pas reelement et est g\u00e9r\u00e9 par un serveur DNS sp\u00e9cifiquement mis en place par votre enseignant.</p>"},{"location":"cours/05-Services/DNS/02-unbound/#principales-fonctionnalites-dunbound","title":"Principales fonctionnalit\u00e9s d'Unbound","text":"<ul> <li>R\u00e9solution r\u00e9cursive : Il effectue les requ\u00eates DNS en partant du serveur racine jusqu'\u00e0 la source autoritaire.</li> <li>Validation DNSSEC : Garantit que les donn\u00e9es DNS n'ont pas \u00e9t\u00e9 alt\u00e9r\u00e9es ou falsifi\u00e9es.</li> <li>Cache DNS : Il stocke les r\u00e9ponses des requ\u00eates pour am\u00e9liorer les performances en \u00e9vitant des r\u00e9solutions r\u00e9p\u00e9t\u00e9es pour les m\u00eames requ\u00eates.</li> <li>Vie priv\u00e9e : Unbound permet de minimiser les informations envoy\u00e9es dans les requ\u00eates DNS (via QNAME minimisation), ce qui am\u00e9liore la confidentialit\u00e9 de l'utilisateur.</li> <li>Support pour IPv6 : Il supporte les requ\u00eates et r\u00e9solutions d'adresses IPv6. (On ne travaillera qu'avec IPv4)</li> </ul>"},{"location":"cours/05-Services/DNS/02-unbound/#resolution-de-probleme-courants","title":"Resolution de probl\u00e8me courants","text":"<p>Toujours v\u00e9rifier votre configuration avec :</p> <pre><code>sudo unbound-checkconf\n</code></pre> <p>Si on obtient ceci:</p> <pre><code>[1728294345] unbound-checkconf[7516:0] error: failed to read /var/lib/unbound/root.key\n[1728294345] unbound-checkconf[7516:0] error: error reading auto-trust-anchor-file: /var/lib/unbound/root.key\n[1728294345] unbound-checkconf[7516:0] error: validator: error in trustanchors config\n[1728294345] unbound-checkconf[7516:0] error: validator: could not apply configuration settings.\n[1728294345] unbound-checkconf[7516:0] fatal error: bad config for validator module\n</code></pre> <p>Le probl\u00e8me est li\u00e9e \u00e0 la configuration des trust anchors DNSSEC (ancrages de confiance) dans Unbound. </p> <p>Si besoin on peut r\u00e9initialiser ce fichier</p> <pre><code>sudo unbound-anchor -a /var/lib/unbound/root.key\n</code></pre> <p>Verification:</p> <pre><code>sudo unbound-checkconf\n</code></pre> <p>Redemarrage du service:</p> <pre><code>sudo systemctl restart unbound\n</code></pre>"},{"location":"cours/05-Services/DNS/03-autority/","title":"03 - Serveur DNS D'autorit\u00e9","text":""},{"location":"cours/05-Services/DNS/03-autority/#exemple-de-configuration-dun-serveur-bind-9","title":"Exemple de configuration d'un Serveur (BIND 9)","text":"<p>Supposons que vous utilisez BIND comme serveur DNS principal pour le domaine <code>exemple.com</code> et que vous souhaitez d\u00e9l\u00e9guer la gestion du sous-domaine <code>sousdomaine.exemple.com</code> \u00e0 un autre serveur DNS dont l'adresse IP est <code>203.0.113.100</code>.</p>"},{"location":"cours/05-Services/DNS/03-autority/#configuration-bind-zone-principale-pour-exemplecom","title":"Configuration BIND (zone principale pour exemple.com) :","text":"<ol> <li>Dans le fichier de zone pour <code>exemple.com</code>, ajoutez les enregistrements NS pour le sous-domaine d\u00e9l\u00e9gu\u00e9 comme ceci :</li> </ol> <pre><code>; Fichier de zone pour exemple.com (zone publique)\n$TTL 3600\n\n@      IN      SOA    ns1.exemple.com. admin.exemple.com. (\n                  2023091301 ; Num\u00e9ro de s\u00e9rie\n                  3600       ; Intervalle de rafra\u00eechissement\n                  1800       ; Intervalle de r\u00e9essai\n                  604800     ; Intervalle d'expiration\n                  86400 )    ; Dur\u00e9e minimale de cache\n\n;choisir une des 2 syntaxes avec le @ ou en recopiant le domaine (avec le point \u00e0 la fin)\n;@      IN      NS     ns1.exemple.com.\nexemple.com.        IN      NS      ns1.exemple.com.\n\n; Serveur DNS primaire\nns1     IN      A       203.0.113.40\n\n; Enregistrements IPv4 des serveurs web\n@      IN      A      203.0.113.10\n; le @ remplace la zone DNS, tres utile pour acceder au site web sans le www, on en reparlera avec le Subject Alternative Name des certificats pour TLS\nwww    IN      A      203.0.113.10\n\n; Enregistrements IPv4 du serveur de messagerie\nmail   IN      A      203.0.113.30\n\n; D\u00e9l\u00e9gation du sous-domaine \u00e0 un autre serveur DNS\nsousdomaine.exemple.com.  IN  NS  ns.sousdomaine.exemple.com.\n</code></pre> <p>Information</p> <p>Notez que dans cet exemple, nous utilisons l'enregistrement NS <code>ns.serveurdns.externe.com</code> pour d\u00e9l\u00e9guer la gestion du sous-domaine <code>sousdomaine.exemple.com</code> \u00e0 un serveur DNS externe. Vous devez remplacer <code>ns.serveurdns.externe.com</code> par le nom de domaine complet du serveur DNS externe qui g\u00e9rera le sous-domaine.</p>"},{"location":"cours/05-Services/DNS/03-autority/#configuration-sur-le-serveur-dns-externe-nssousdomaineexemplecom","title":"Configuration sur le serveur DNS externe (ns.sousdomaine.exemple.com) :","text":"<ol> <li> <p>Configurez le serveur DNS externe pour r\u00e9pondre aux requ\u00eates pour le sous-domaine <code>sousdomaine.exemple.com</code>.</p> </li> <li> <p>Cr\u00e9ez les enregistrements DNS appropri\u00e9s pour le sous-domaine <code>sousdomaine.exemple.com</code> sur le serveur DNS externe, par exemple :</p> </li> </ol> <pre><code>; Configuration sur le serveur DNS externe\n$TTL 3600\n\n@      IN      SOA    ns.sousdomaine.exemple.com. admin.sousdomaine.exemple.com. (\n                  2023091301 ; Num\u00e9ro de s\u00e9rie\n                  3600       ; Intervalle de rafra\u00eechissement\n                  1800       ; Intervalle de r\u00e9essai\n                  604800     ; Intervalle d'expiration\n                  86400 )    ; Dur\u00e9e minimale de cache\n\n@      IN      NS     ns.sousdomaine.exemple.com.\nsousdomaine IN      A      203.0.113.100  ; Adresse IP du serveur pour sousdomaine.exemple.com\n</code></pre> <ol> <li>Assurez-vous que le serveur DNS externe est configur\u00e9 pour r\u00e9pondre aux requ\u00eates DNS pour le sous-domaine <code>sousdomaine.exemple.com</code> et qu'il pointe correctement vers l'adresse IP <code>203.0.113.100</code>.</li> </ol> <p>De cette mani\u00e8re, la gestion du sous-domaine <code>sousdomaine.exemple.com</code> est d\u00e9l\u00e9gu\u00e9e au serveur DNS externe <code>ns.sousdomaine.exemple.com.</code>, et ce dernier est responsable de la r\u00e9solution DNS pour ce sous-domaine. Le serveur BIND g\u00e8re toujours la zone principale pour <code>exemple.com</code>.</p>"},{"location":"cours/05-Services/DNS/03-autority/#division-des-zones-privees-et-publiques","title":"Division des Zones (Priv\u00e9es et Publiques)","text":"<p>Les zones DNS peuvent \u00eatre divis\u00e9es en zones priv\u00e9es et publiques. Les zones publiques contiennent des informations accessibles au public, telles que les enregistrements DNS pour un site web. Les zones priv\u00e9es, en revanche, contiennent des informations sp\u00e9cifiques \u00e0 un r\u00e9seau priv\u00e9, comme les enregistrements pour les serveurs internes. La division permet de contr\u00f4ler l'acc\u00e8s aux informations DNS en fonction des besoins de s\u00e9curit\u00e9.</p> <p>En conclusion, le DNS est un syst\u00e8me fondamental pour le fonctionnement d'Internet. Il repose sur une hi\u00e9rarchie de serveurs, des r\u00e9solveurs pour la r\u00e9solution des requ\u00eates DNS, et la d\u00e9l\u00e9gation des zones pour g\u00e9rer la r\u00e9partition des responsabilit\u00e9s. La compr\u00e9hension de ces concepts est essentielle pour la gestion efficace des noms de domaine et la gestion des ressources Internet.</p>"},{"location":"cours/05-Services/DNS/03-autority/#dns-partage-split-horizon-dns","title":"DNS Partag\u00e9 (Split-Horizon DNS) :","text":"<p>Le DNS partag\u00e9, \u00e9galement appel\u00e9 DNS split-horizon, implique d'avoir des vues diff\u00e9rentes de l'espace de noms DNS pour les utilisateurs internes et externes. Cela est souvent utilis\u00e9 pour fournir des r\u00e9ponses DNS diff\u00e9rentes en fonction de la provenance de la requ\u00eate DNS, c'est-\u00e0-dire si la requ\u00eate provient de l'int\u00e9rieur ou de l'ext\u00e9rieur du r\u00e9seau local. Pour mettre en \u0153uvre le DNS partag\u00e9 avec BIND9, vous configurez g\u00e9n\u00e9ralement des vues distinctes dans le fichier de configuration BIND.</p> <p>Voici un exemple simplifi\u00e9 :</p> <pre><code>view \"interne\" {\n    match-clients { localhost; 172.16.x.0/24; };\n    zone \"exemple.com\" {\n        type master;\n        file \"/etc/bind/db.interne\";\n    };\n};\n\nview \"externe\" {\n    match-clients { any; };\n    zone \"exemple.com\" {\n        type master;\n        file \"/etc/bind/db.externe\";\n    };\n};\n</code></pre> <p>Dans cet exemple, les utilisateurs provenant du r\u00e9seau local (172.16.x.0/24) verront une vue DNS d\u00e9finie par le fichier <code>/etc/bind/db.interne</code>, tandis que les utilisateurs externes verront une vue d\u00e9finie par le fichier <code>/etc/bind/db.externe</code>.</p>"},{"location":"cours/05-Services/DNS/03-autority/#fichier-etcbindnamedconflocal","title":"Fichier /etc/bind/named.conf.local","text":"<p>Il faut choisir la bonne zone en fonction des IP sources via des ACL</p> <pre><code>    //zone externe\n    view \"outside\" {\n        match-clients { \n            !172.x.x.0/24;    //requ\u00e8te de provenant pas du LAN\n            !192.168.x.0/24;    //requ\u00e8te de provenant pas de la DMZ\n            any;                //Toutes les autres adresses\n        };\n\n        zone \"ville.sportludique.fr.\" {\n            type master;\n            file \"/etc/bind/db.ville.sp.fr.externe\";\n        };\n    };\n\n    view \"inside\" {\n\n        match-clients { \n            172.x.0.0/24;    //requ\u00e8te provenant du LAN\n            192.168.x.0/24;    //requ\u00e8te provenant de la DMZ\n        };\n\n        zone \"ville.sportludique.fr.\" {\n            type master;\n            file \"/etc/bind/db.ville.sp.fr.interne\";\n        };\n\n    };\n</code></pre> Attention <p>Toutes les lignes du fichier <code>named.conf.default-zones</code> doivent \u00eatre mises <code>en commentaire</code> car ne elles ne sont associ\u00e9es \u00e0 aucune vue.</p>"},{"location":"cours/05-Services/DNS/04-Resilience/","title":"04 - Resilience du Service critique DNS","text":""},{"location":"cours/05-Services/DNS/04-Resilience/#tolerance-aux-pannes","title":"Tolerance aux pannes","text":"<p>Dans une architecture r\u00e9seau professionnelle, garantir la disponibilit\u00e9 des services critiques est un enjeu essentiel. Pour \u00e9viter qu\u2019une panne n\u2019entra\u00eene une interruption compl\u00e8te, on s\u2019appuie souvent sur le principe de redondance, en d\u00e9ployant des serveurs secondaires capables de prendre le relais en cas de d\u00e9faillance du serveur principal. Le syst\u00e8me DNS illustre parfaitement ce m\u00e9canisme.</p>"},{"location":"cours/05-Services/DNS/04-Resilience/#pourquoi-un-serveur-secondaire","title":"Pourquoi un serveur secondaire","text":"<p>Un serveur DNS primaire (ou master) est celui qui d\u00e9tient la zone DNS en \u00e9criture : il h\u00e9berge le fichier de zone original et permet les modifications. Si ce serveur tombe en panne, sans solution de secours, plus aucune r\u00e9solution de nom ne serait possible pour les domaines qu\u2019il g\u00e8re.</p> <p>Pour assurer la tol\u00e9rance aux pannes, on met en place un serveur secondaire (ou slave). Celui-ci :</p> <ul> <li>h\u00e9berge une copie en lecture seule de la zone ;</li> <li>peut r\u00e9pondre aux requ\u00eates des clients \u00e0 la place du primaire ;</li> <li>augmente la disponibilit\u00e9 globale du service ;</li> <li>permet une eventuelle r\u00e9partition de la charge (load balancing simple).</li> </ul>"},{"location":"cours/05-Services/DNS/04-Resilience/#syncronisation-avec-le-transfert-de-zone","title":"Syncronisation avec le Transfert de Zone","text":"<p>Pour que le secondaire dispose d\u2019une copie fid\u00e8le du fichier de zone, le DNS utilise un m\u00e9canisme automatique : le transfert de zone (zone transfer).</p> <p>Il existe deux types principaux :</p> <p>\u2705 AXFR (Full Zone Transfer)</p> <p>Transfert complet de la zone : Le secondaire r\u00e9cup\u00e8re tout le contenu du fichier de zone depuis le primaire. Cela arrive : - lors de la premi\u00e8re synchronisation ; - ou si le fichier de zone change radicalement.</p> <p>\u2705 IXFR (Incremental Zone Transfer)</p> <p>Transfert incr\u00e9mentiel : Le secondaire t\u00e9l\u00e9charge uniquement les changements (deltas) depuis la derni\u00e8re version. Ce m\u00e9canisme r\u00e9duit : - la charge r\u00e9seau, - les temps de synchronisation.</p>"},{"location":"cours/05-Services/DNS/04-Resilience/#role-du-serial-number","title":"R\u00f4le du Serial Number","text":"<p>Chaque fichier de zone contient un champ Serial dans l\u2019enregistrement SOA. Il indique la version de la zone. Le secondaire compare : - son Serial local - le Serial du primaire</p> <p>Si celui du primaire est sup\u00e9rieur, le secondaire d\u00e9clenche un transfert IXFR (incrementiel) si possible, sinon AXFR (complet).</p>"},{"location":"cours/05-Services/DNS/04-Resilience/#securisation-du-transfert-de-zone","title":"Securisation du transfert de zone","text":"<p>Un point essentiel : ne jamais laisser le transfert de zone ouvert \u00e0 tout le monde. Sinon, n\u2019importe qui pourrait t\u00e9l\u00e9charger l\u2019int\u00e9gralit\u00e9 de la zone (ce qui serait un risque de s\u00e9curit\u00e9).</p> <p>On s\u00e9curise en :</p> <ul> <li>limitant les adresses IP autoris\u00e9es (ACLS c\u00f4t\u00e9 primaire) ;</li> <li>utilisant des cl\u00e9s TSIG pour authentifier le transfert ;</li> <li>filtrant les ports c\u00f4t\u00e9 firewall (TCP/53).</li> </ul> cl\u00e9 TSIG <p>Une <code>cl\u00e9 TSIG</code> est un m\u00e9canisme d\u00e9fini par la <code>RFC 2845</code> permettant d\u2019authentifier de fa\u00e7on s\u00e9curis\u00e9e certaines op\u00e9rations DNS sensibles. Contrairement au transfert de zone, qui consiste \u00e0 copier une zone du serveur ma\u00eetre vers un serveur esclave, mon utilisation n\u2019avait rien \u00e0 voir avec cela : dans mon cas, j\u2019ai utilis\u00e9 TSIG pour autoriser des mises \u00e0 jour DNS dynamiques, telles que d\u00e9finies dans la <code>RFC 2136</code>. Ce m\u00e9canisme permet \u00e0 un client ( Certbot ) d\u2019ajouter automatiquement un enregistrement TXT dans la zone DNS lors du challenge DNS-01 d\u00e9crit par la <code>RFC 8555 (protocole ACME)</code>. Cela prouve \u00e0 Let\u2019s Encrypt que je suis bien propri\u00e9taire du domaine, et permet d\u2019automatiser le renouvellement de notre certificat <code>wildcard</code>. Cela depasse un peu le cadre du BTS SIO.</p>"},{"location":"cours/05-Services/DNS/04-Resilience/#resilience-globale","title":"R\u00e9silience globale","text":"<p>Gr\u00e2ce \u00e0 ce m\u00e9canisme, m\u00eame si le primaire devient :</p> <ul> <li>indisponible (panne mat\u00e9rielle, r\u00e9seau, maintenance),ou surcharg\u00e9,</li> <li>le secondaire continue de r\u00e9pondre. La zone reste accessible, m\u00eame si elle n\u2019est plus modifiable temporairement.</li> </ul> <p>Une bonne pratique consiste \u00e0 avoir au moins un secondaire, parfois plus (y compris g\u00e9ographiquement r\u00e9partis). C\u2019est indispensable pour atteindre une haute disponibilit\u00e9 du DNS.</p> <p>L\u2019ANSSI recommande de disposer d\u2019au moins deux serveurs DNS sur des infrastructures s\u00e9par\u00e9es afin d\u2019assurer la haute disponibilit\u00e9 et la r\u00e9silience du service. Concr\u00e8tement, cela implique :</p> <ul> <li> <p>Deux adresses IP publiques distinctes, id\u00e9alement fournies par des fournisseurs diff\u00e9rents (ce qui correspond \u00e0 notre configuration avec deux routeurs de deux fournisseurs).</p> </li> <li> <p>Deux infrastructures de virtualisation ind\u00e9pendantes, reposant sur des serveurs physiques distincts (dans notre cas : Nutanix et Proxmox), afin qu\u2019une panne mat\u00e9rielle ou logicielle sur l\u2019une n\u2019affecte pas l\u2019autre.</p> </li> </ul> <p>Cette architecture garantit que le service DNS reste accessible m\u00eame en cas de d\u00e9faillance d\u2019un fournisseur, d\u2019un routeur ou d\u2019une infrastructure de virtualisation, r\u00e9pondant ainsi aux bonnes pratiques de s\u00e9curit\u00e9 et de disponibilit\u00e9 recommand\u00e9es par l\u2019ANSSI.</p>"},{"location":"cours/05-Services/DNS/04-Resilience/#schema-de-linfra-dns-redondante","title":"Schema de l'infra DNS redondante","text":""},{"location":"cours/05-Services/DNS/04-Resilience/#contenu-du-fichier-de-zone-en-prenant-en-compte-cette-resilience","title":"Contenu du fichier de zone en prenant en compte cette resilience","text":"<pre><code>; La dur\u00e9e de vie des enregistrements est de 12 heures. Les serveurs DNS r\u00e9cursifs\n; stockeront les informations sur cette zone dans leur cache pendant ce laps de temps\n$TTL 43200 ; 12 heures\n\n; l\u2019adresse du contact technique est postmaster@&lt;ville&gt;.sportludique.fr\n&lt;ville&gt;.sportludique.fr. IN SOA ns1.&lt;ville&gt;.sportludique.fr. postmaster.&lt;ville&gt;.sportludique.fr. (\n2025110701 ; Serial\n1D ; Refresh\n1H ; Retry\n1W ; Expire\n3H ) ; Negative Cache TTL\n\n; D\u00e9claration des serveurs DNS\n&lt;ville&gt;.sportludique.fr. IN NS ns1.&lt;ville&gt;.sportludique.fr.\n&lt;ville&gt;.sportludique.fr. IN NS ns2.&lt;ville&gt;.sportludique.fr.\n\n; Serveurs DNS primaire et secondaire (infrastructures s\u00e9par\u00e9es)\nns1.&lt;ville&gt;.sportludique.fr. IN A 183.44.x.y  ;IPPubFAI1\nns2.&lt;ville&gt;.sportludique.fr. IN A 221.87.x.y   ;IPPubFAI2\n</code></pre>"},{"location":"cours/05-Services/DNS/04-Resilience/#activer-le-transfert-de-zone-vers-un-serveur-identifie","title":"Activer le transfert de zone vers un serveur identifi\u00e9","text":""},{"location":"cours/05-Services/DNS/04-Resilience/#sur-le-serveur-primaire-master","title":"Sur le serveur primaire (Master)","text":"<pre><code>zone \"&lt;ville&gt;.sportludique.fr\" {\n    type master;\n    file \"/etc/bind/db.&lt;ville&gt;.sportludique.fr\";\n    allow-transfer { a.b.c.d; };   // IP du serveur secondaire\n    allow-query { any; };\n};\n</code></pre>"},{"location":"cours/05-Services/DNS/04-Resilience/#sur-le-serveur-secondaire-slave","title":"Sur le serveur secondaire (Slave)","text":"<p>C\u2019est ici qu'on actives r\u00e9ellement le transfert de zone : Il doit aller chercher la zone aupr\u00e8s du ma\u00eetre.</p> <pre><code>zone \"&lt;ville&gt;.sportludique.fr\" {\n    type slave;\n    masters { a.b.c.d; };           // IP du master\n    file \"/var/cache/bind/slave.&lt;ville&gt;.sportludique.fr\";\n};\n</code></pre>"},{"location":"cours/05-Services/DNS/05-dnssec/","title":"05 - DNSSEC (Domain Name System Security Extensions)","text":""},{"location":"cours/05-Services/DNS/05-dnssec/#introduction","title":"Introduction","text":"<p>Le DNS (Domain Name System) est le syst\u00e8me qui traduit les noms de domaine lisibles par l\u2019homme (ex. www.example.com) en adresses IP compr\u00e9hensibles par les machines. Le probl\u00e8me : le DNS classique n\u2019est pas s\u00e9curis\u00e9. N\u2019importe qui peut falsifier une r\u00e9ponse DNS, ce qui peut entra\u00eener des attaques comme :</p> <ul> <li><code>DNS Spoofing</code> : r\u00e9pondre avec une fausse IP pour un site l\u00e9gitime.</li> <li><code>Man-in-the-middle</code> : intercepter et modifier les requ\u00eates DNS.</li> </ul> <p><code>DNSSEC</code> a \u00e9t\u00e9 cr\u00e9\u00e9 pour r\u00e9soudre ce probl\u00e8me : il apporte l\u2019<code>authenticit\u00e9</code> et l\u2019<code>int\u00e9grit\u00e9</code> des r\u00e9ponses DNS, mais pas la confidentialit\u00e9. Vous remarquez donc que ce sont les m\u00eame apports que la <code>signature \u00e9l\u00e9ctronique</code></p>"},{"location":"cours/05-Services/DNS/05-dnssec/#principe-de-dnssec","title":"Principe de DNSSEC","text":"<ol> <li> <p>Chaque zone DNS a une cl\u00e9 priv\u00e9e unique</p> </li> <li> <p>Chaque enregistrement DNS (A, MX\u2026) est sign\u00e9 avec cette cl\u00e9 priv\u00e9e.</p> </li> <li> <p>La zone stocke la cl\u00e9 publique qui correspond \u00e0 cette cl\u00e9 priv\u00e9e (enregistremnt DNSKEY)</p> </li> <li> <p>Le r\u00e9solveur DNS utilise cette cl\u00e9 publique pour v\u00e9rifier que la r\u00e9ponse est authentique.</p> </li> </ol> <p>la zone signe les r\u00e9ponses et le client v\u00e9rifie la signature.</p>"},{"location":"cours/05-Services/DNS/05-dnssec/#porincipe-du-hash-integrite-et-de-lauthentification-verifie-avec-cle-publique-de-lemetteur","title":"POrincipe du hash (int\u00e9grit\u00e9) et de l'authentification (verifi\u00e9 avec cl\u00e9 publique de l'emetteur)","text":""},{"location":"cours/05-Services/DNS/05-dnssec/#verification-de-lintegrite","title":"Verification de <code>l'int\u00e9grit\u00e9</code> :","text":"<ol> <li> <p>La zone DNS prend chaque enregistrement et calcule un r\u00e9sum\u00e9 unique appel\u00e9 hash.</p> </li> <li> <p>Ce hash est une empreinte num\u00e9rique : m\u00eame si un seul bit change, le hash change compl\u00e8tement.</p> </li> </ol>"},{"location":"cours/05-Services/DNS/05-dnssec/#verification-de-lauthentification-de-lemmetteur","title":"Verification de <code>l'authentification de l'emmetteur</code> :","text":"<ol> <li> <p>La zone utilise sa cl\u00e9 priv\u00e9e pour signer ce hash.</p> </li> <li> <p>Le r\u00e9sultat est la signature (RRSIG) attach\u00e9e \u00e0 l\u2019enregistrement.</p> </li> </ol>"},{"location":"cours/05-Services/DNS/05-dnssec/#verification-cote-client-des-signatures","title":"V\u00e9rification c\u00f4t\u00e9 client des signatures :","text":"<ol> <li> <p>Le client r\u00e9cup\u00e8re l\u2019enregistrement et sa signature.</p> </li> <li> <p>Il calcule lui-m\u00eame le hash de l\u2019enregistrement.</p> </li> <li> <p>Il utilise la cl\u00e9 publique (contenu dans la zone interrog\u00e9e via l'enregistrement DNSSEC) pour v\u00e9rifier la signature et obtenir le hash original.</p> </li> </ol> <p>Si les deux hash correspondent --&gt; la r\u00e9ponse est authentique.</p> <p>Sinon --&gt; la r\u00e9ponse a \u00e9t\u00e9 modifi\u00e9e ou falsifi\u00e9e.</p> <p>Pour en savoir plus : Comment fonctionne le protocole DNSSEC ? \u2013 AmenSchool</p>"},{"location":"cours/05-Services/containers/11-docker/","title":"11 Docker","text":""},{"location":"cours/05-Services/containers/11-docker/#introduction","title":"Introduction","text":""},{"location":"cours/05-Services/containers/11-docker/#virtualisation-vs-containerisation","title":"Virtualisation vs Containerisation","text":"<p>La virtualisation et la containerisation sont deux approches diff\u00e9rentes pour la gestion des ressources et l'isolation des applications sur un syst\u00e8me h\u00f4te.</p> <ul> <li> <p>Virtualisation : La virtualisation utilise des hyperviseurs pour cr\u00e9er des machines virtuelles (VMs), chaque VM ex\u00e9cutant un syst\u00e8me d'exploitation complet. Cela n\u00e9cessite plus de ressources car chaque VM contient son propre noyau d'OS.</p> </li> <li> <p>Containerisation : La containerisation utilise des conteneurs l\u00e9gers pour isoler les applications. Chaque conteneur partage le m\u00eame noyau d'OS que l'h\u00f4te, ce qui les rend plus l\u00e9gers et plus rapides \u00e0 d\u00e9marrer.</p> </li> </ul> <p></p>"},{"location":"cours/05-Services/containers/11-docker/#installation-de-docker","title":"Installation de Docker","text":"<p>Pour installer Docker, suivez les instructions de la documentation officielle selon votre syst\u00e8me d'exploitation :</p> <ul> <li>Installation de Docker sur Linux</li> <li>Installation de Docker sur macOS</li> <li>Installation de Docker sur Windows</li> </ul> <p>Compatibilit\u00e9 Hyper-V</p> <p>Docker Desktop for Windows utilise Hyper-V, qui peut \u00eatre incompatible avec d'autres hyperviseurs tels que VirtualBox. Si vous avez d\u00e9j\u00e0 VirtualBox install\u00e9, assurez-vous de v\u00e9rifier la compatibilit\u00e9 avant d'installer Docker Desktop. Pour plus d'informations, consultez la documentation officielle de Docker.</p>"},{"location":"cours/05-Services/containers/11-docker/#dockerfile","title":"Dockerfile","text":"<p>Un Dockerfile est un script qui contient les instructions n\u00e9cessaires pour cr\u00e9er une image Docker. Voici un exemple simple de Dockerfile pour une application web Node.js :</p>"},{"location":"cours/05-Services/containers/11-docker/#exemple-de-deploiement-dapplication-nodejs-simple-via-un-container","title":"Exemple de deploiement d'Application Node.js Simple via un container","text":"<p>Cr\u00e9ez un dossier pour votre application Node.js et cr\u00e9ez un fichier <code>app.js</code> avec le contenu suivant :</p> <pre><code>// app.js\nconst http = require('http');\n\nconst server = http.createServer((req, res) =&gt; {\n  res.statusCode = 200;\n  res.setHeader('Content-Type', 'text/plain');\n  res.end('Hello, Docker!\\n');\n});\n\nconst port = process.env.PORT || 3000;\n\nserver.listen(port, () =&gt; {\n  console.log(`Server running on http://localhost:${port}`);\n});\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#dockerfile_1","title":"Dockerfile","text":"<p>Cr\u00e9ez un fichier appel\u00e9 <code>Dockerfile</code> dans le m\u00eame r\u00e9pertoire que votre application avec le contenu suivant :</p> <pre><code># Use the official Node.js image\nFROM node:14\n\n# Set the working directory\nWORKDIR /usr/src/app\n\n# Install app dependencies\nRUN npm install\n\n# Bundle app source\nCOPY . .\n\n# Expose the port\nEXPOSE 3000\n\n# Command to run the application\nCMD [\"node\", \"app.js\"]\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#docker-compose","title":"Docker Compose","text":"<p>Docker Compose est un outil pour d\u00e9finir et g\u00e9rer des applications Docker multi-conteneurs. Vous pouvez utiliser un fichier <code>docker-compose.yml</code> pour sp\u00e9cifier les services, les r\u00e9seaux et les volumes n\u00e9cessaires \u00e0 votre application.</p>"},{"location":"cours/05-Services/containers/11-docker/#commande-utiles","title":"Commande utiles","text":"<p>La commande <code>docker-compose up -d</code> est utilis\u00e9e pour d\u00e9marrer les services d\u00e9finis dans votre fichier <code>docker-compose.yml</code> en mode d\u00e9tach\u00e9 (arri\u00e8re-plan). Cela signifie que les conteneurs Docker seront lanc\u00e9s en arri\u00e8re-plan, et vous pourrez continuer \u00e0 utiliser votre terminal pour d'autres t\u00e2ches sans bloquer sur les journaux des conteneurs.</p> <p>Voici comment utiliser cette commande :</p> <pre><code>docker-compose up -d\n</code></pre> <p>Assurez-vous d'ex\u00e9cuter cette commande dans le r\u00e9pertoire o\u00f9 se trouve votre fichier <code>docker-compose.yml</code>. Docker Compose utilisera ce fichier pour cr\u00e9er et configurer les conteneurs.</p> <p>Apr\u00e8s avoir ex\u00e9cut\u00e9 cette commande, Docker Compose lancera tous les services d\u00e9finis dans le fichier <code>docker-compose.yml</code>. Vous pouvez v\u00e9rifier l'\u00e9tat des services avec la commande suivante :</p> <pre><code>docker-compose ps\n</code></pre> <p>Cette commande affiche l'\u00e9tat de tous les services d\u00e9finis dans le fichier <code>docker-compose.yml</code>. Si les services sont en cours d'ex\u00e9cution, vous devriez les voir r\u00e9pertori\u00e9s avec l'\u00e9tat \"Up\".</p> <p>Pour arr\u00eater les services et supprimer les conteneurs, vous pouvez utiliser la commande suivante :</p> <pre><code>docker-compose down\n</code></pre> <p>Si vous souhaitez voir les journaux des services en cours d'ex\u00e9cution, vous pouvez utiliser la commande <code>docker-compose logs</code>. Par exemple, pour afficher les journaux du service \"app\" :</p> <pre><code>docker-compose logs app\n</code></pre> <p>N'oubliez pas de remplacer \"app\" par le nom r\u00e9el de votre service.</p>"},{"location":"cours/05-Services/containers/11-docker/#deploiement-avec-docker-compose","title":"Deploiement avec Docker Compose","text":"<p>Cr\u00e9ez un fichier <code>docker-compose.yml</code> dans le m\u00eame r\u00e9pertoire avec le contenu suivant :</p> <pre><code>version: '3'\nservices:\n  app:\n    build:\n      context: .\n    ports:\n      - \"3000:3000\"\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#mappage-de-port-entre-hote-et-container","title":"Mappage de Port entre Hote et container","text":"<p>Le mappage de port dans Docker Compose permet de lier les ports d'un conteneur \u00e0 des ports sp\u00e9cifiques de l'h\u00f4te, permettant ainsi aux services ex\u00e9cut\u00e9s dans les conteneurs d'\u00eatre accessibles depuis l'ext\u00e9rieur du conteneur.</p> <p>Dans le fichier <code>docker-compose.yml</code>, la section <code>ports</code> sous un service sp\u00e9cifie le mappage de port. Voici comment cela fonctionne :</p> <pre><code>version: '3'\nservices:\n  app:\n    image: my-node-app\n    ports:\n      - \"3000:3000\"\n</code></pre> <p>Dans cet exemple :</p> <ul> <li><code>\"3000:3000\"</code> indique le mappage du port. Le premier num\u00e9ro (3000 \u00e0 gauche du <code>:</code>) repr\u00e9sente le port sur l'h\u00f4te, tandis que le second num\u00e9ro (3000 \u00e0 droite du <code>:</code>) repr\u00e9sente le port dans le conteneur.</li> </ul> <p>Ainsi, avec cette configuration, le port 3000 du conteneur sera accessible \u00e0 partir du port 3000 de l'h\u00f4te. Si vous avez plusieurs services, chaque service peut avoir son propre mappage de port.</p> <p>Dans ce cas, Docker attribuera un port disponible sur l'h\u00f4te, et vous pouvez d\u00e9couvrir ce port avec la commande <code>docker-compose ps</code>.</p> <p>Le mappage de port est essentiel pour exposer les services d'un conteneur \u00e0 l'ext\u00e9rieur et permettre aux utilisateurs d'acc\u00e9der \u00e0 ces services depuis l'h\u00f4te ou d'autres machines dans le r\u00e9seau, selon la configuration du r\u00e9seau Docker.</p>"},{"location":"cours/05-Services/containers/11-docker/#mappage-des-volumes","title":"Mappage des volumes","text":"<p>Le mappage des volumes est une pratique essentielle dans Docker qui permet de persister les donn\u00e9es g\u00e9n\u00e9r\u00e9es par les conteneurs au-del\u00e0 de leur cycle de vie. Lorsque vous ex\u00e9cutez un conteneur, ses donn\u00e9es peuvent \u00eatre stock\u00e9es dans son syst\u00e8me de fichiers interne. Cependant, une fois le conteneur arr\u00eat\u00e9 ou supprim\u00e9, ces donn\u00e9es peuvent \u00eatre perdues. Le mappage de volumes r\u00e9sout ce probl\u00e8me en cr\u00e9ant un lien entre un dossier sur l'h\u00f4te et un dossier \u00e0 l'int\u00e9rieur du conteneur.</p> <p>Par exemple, pour cr\u00e9er un volume nomm\u00e9 \"mydata\" et le monter dans le r\u00e9pertoire \"/app\" d'un conteneur, vous pouvez utiliser l'option <code>-v</code> lors de la cr\u00e9ation du conteneur :</p> <pre><code>docker run -v mydata:/app my-image\n</code></pre> <p>Cela assure la persistance des donn\u00e9es du conteneur dans le volume \"mydata\" sur l'h\u00f4te, permettant ainsi de partager des donn\u00e9es entre plusieurs conteneurs ou de sauvegarder ces donn\u00e9es m\u00eame si le conteneur est supprim\u00e9.</p> <p>Le mappage des volumes est particuli\u00e8rement utile pour les applications n\u00e9cessitant le stockage de donn\u00e9es, comme les bases de donn\u00e9es, les serveurs de fichiers, et autres. Il offre une flexibilit\u00e9 et une gestion facile des donn\u00e9es dans le contexte des conteneurs Docker.</p> <p>Voici un exemple simple d'utilisation du mappage de volumes avec Docker Compose. Supposons que vous avez une application Node.js qui stocke des donn\u00e9es dans un dossier <code>/app/data</code> et que vous souhaitez persister ces donn\u00e9es en utilisant un volume.</p> <p>Cr\u00e9ez un fichier <code>docker-compose.yml</code> avec le contenu suivant :</p> <pre><code>version: '3'\nservices:\n  webapp:\n    image: my-node-app\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - mydata:/app/data\n\nvolumes:\n  mydata:\n</code></pre> <p>Dans cet exemple :</p> <ul> <li>Le service <code>webapp</code> utilise l'image <code>my-node-app</code> (remplacez cela par l'image r\u00e9elle de votre application Node.js).</li> <li>Le mappage de port expose le port 3000 du conteneur vers le port 3000 de l'h\u00f4te.</li> <li>La section <code>volumes</code> cr\u00e9e un volume nomm\u00e9 \"mydata\" et le monte dans le r\u00e9pertoire <code>/app/data</code> du conteneur.</li> </ul> <p>Lorsque vous lancez votre application avec <code>docker-compose up -d</code>, le volume \"mydata\" est cr\u00e9\u00e9, et les donn\u00e9es g\u00e9n\u00e9r\u00e9es par l'application dans le dossier <code>/app/data</code> du conteneur sont persist\u00e9es sur l'h\u00f4te, dans le volume \"mydata\".</p> <p>Cette approche garantit que les donn\u00e9es de votre application restent disponibles m\u00eame si le conteneur est arr\u00eat\u00e9 ou supprim\u00e9. Vous pouvez \u00e9galement partager ce volume entre plusieurs services dans le m\u00eame <code>docker-compose.yml</code> ou m\u00eame entre plusieurs applications s'ex\u00e9cutant sur la m\u00eame machine.</p>"},{"location":"cours/05-Services/containers/11-docker/#lancement-des-containners","title":"Lancement des containners","text":"<p>Ouvrez un terminal dans le r\u00e9pertoire de votre application et ex\u00e9cutez la commande suivante pour construire et d\u00e9marrer votre conteneur :</p> <pre><code>docker-compose up\n</code></pre> <p>Votre application Node.js sera accessible \u00e0 l'adresse http://localhost:3000. Vous pouvez modifier le port dans le fichier <code>docker-compose.yml</code> si n\u00e9cessaire.</p> <p>N'oubliez pas d'arr\u00eater les conteneurs avec la commande suivante lorsque vous avez termin\u00e9 :</p> <pre><code>docker-compose down\n</code></pre> <p>Ceci est un exemple simple pour d\u00e9marrer. Vous pouvez \u00e9tendre et personnaliser votre Dockerfile en fonction des besoins de votre application.</p>"},{"location":"cours/05-Services/containers/11-docker/#commande-de-base-quand-on-travaille-avec-docker","title":"Commande de base quand on travaille avec docker","text":"<p>Voici quelques commandes de base indispensables \u00e0 conna\u00eetre pour travailler avec Docker :</p> <ol> <li> <p><code>docker --version</code> : Affiche la version de Docker install\u00e9e.</p> </li> <li> <p><code>docker pull &lt;image&gt;</code> : T\u00e9l\u00e9charge une image Docker depuis Docker Hub ou un autre registre. Par exemple, <code>docker pull nginx</code> t\u00e9l\u00e9charge l'image NGINX.</p> </li> <li> <p><code>docker images</code> : Affiche la liste des images Docker t\u00e9l\u00e9charg\u00e9es sur votre machine.</p> </li> <li> <p><code>docker ps</code> : Affiche la liste des conteneurs Docker en cours d'ex\u00e9cution.</p> </li> <li> <p><code>docker ps -a</code> : Affiche tous les conteneurs, qu'ils soient en cours d'ex\u00e9cution ou arr\u00eat\u00e9s.</p> </li> <li> <p><code>docker run &lt;options&gt; &lt;image&gt;</code> : Cr\u00e9e et d\u00e9marre un conteneur \u00e0 partir d'une image. Par exemple, <code>docker run -d -p 8080:80 nginx</code> d\u00e9marre un conteneur NGINX en arri\u00e8re-plan, exposant le port 8080 de l'h\u00f4te vers le port 80 du conteneur.</p> </li> <li> <p><code>docker exec -it &lt;container&gt; &lt;command&gt;</code> : Ex\u00e9cute une commande \u00e0 l'int\u00e9rieur d'un conteneur en cours d'ex\u00e9cution en mode interactif. Par exemple, <code>docker exec -it my-container /bin/bash</code> ouvre un shell Bash interactif \u00e0 l'int\u00e9rieur du conteneur.</p> </li> <li> <p><code>docker stop &lt;container&gt;</code> : Arr\u00eate un conteneur en cours d'ex\u00e9cution. Vous pouvez \u00e9galement utiliser <code>docker kill</code> pour arr\u00eater imm\u00e9diatement le conteneur.</p> </li> <li> <p><code>docker rm &lt;container&gt;</code> : Supprime un conteneur arr\u00eat\u00e9.</p> </li> <li> <p><code>docker rmi &lt;image&gt;</code> : Supprime une image Docker de votre syst\u00e8me.</p> </li> <li> <p><code>docker-compose up -d</code> : D\u00e9marre les services d\u00e9finis dans le fichier <code>docker-compose.yml</code> en mode d\u00e9tach\u00e9.</p> </li> <li> <p><code>docker-compose down</code> : Arr\u00eate les services d\u00e9finis dans le fichier <code>docker-compose.yml</code> et supprime les conteneurs associ\u00e9s.</p> </li> <li> <p><code>docker logs &lt;container&gt;</code> : Affiche les journaux d'un conteneur sp\u00e9cifique.</p> </li> <li> <p><code>docker network ls</code> : Affiche la liste des r\u00e9seaux Docker.</p> </li> <li> <p><code>docker volume ls</code> : Affiche la liste des volumes Docker.</p> </li> </ol> <p>Ces commandes constituent une base solide pour travailler avec Docker. N'oubliez pas de consulter la documentation officielle de Docker pour des informations plus d\u00e9taill\u00e9es sur chaque commande : Documentation Docker.</p> <p></p>"},{"location":"cours/05-Services/containers/11-docker/#outil-dadministration","title":"Outil d'administration","text":"<p>Portainer est une interface graphique open source pour la gestion des conteneurs Docker. Il fournit une interface utilisateur web intuitive pour visualiser, g\u00e9rer et d\u00e9ployer des applications dans des conteneurs Docker. Voici quelques caract\u00e9ristiques cl\u00e9s de Portainer :</p> <p>Pour utiliser Portainer, vous pouvez le d\u00e9ployer en tant que conteneur Docker unique \u00e0 l'aide de la commande suivante :</p> <pre><code>docker run -d -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer-ce\n</code></pre> <p>Cela lancera Portainer en mode d\u00e9tach\u00e9 et le rendra accessible sur le port 9000 de votre machine. Vous pouvez ensuite acc\u00e9der \u00e0 l'interface web et commencer \u00e0 g\u00e9rer vos conteneurs.</p> <p>En ce qui concerne d'autres outils similaires, voici quelques alternatives \u00e0 Portainer :</p> <ol> <li> <p>Kitematic : Une interface graphique pour Docker compatible avec Windows, macOS et Linux.</p> </li> <li> <p>Rancher : Une plateforme de gestion de conteneurs open source qui prend en charge Kubernetes et Docker.</p> </li> <li> <p>Swarm UI : Une interface web native pour la gestion des clusters Docker Swarm.</p> </li> <li> <p>Cockpit : Une interface web pour la gestion des serveurs Linux qui prend en charge Docker.</p> </li> <li> <p>Shipyard : Une interface web open source pour la gestion de Docker.</p> </li> </ol> <p>Ces outils offrent des fonctionnalit\u00e9s similaires, mais la meilleure option d\u00e9pend souvent des besoins sp\u00e9cifiques de votre environnement et de votre pr\u00e9f\u00e9rence en mati\u00e8re d'interface utilisateur.</p>"},{"location":"cours/05-Services/containers/11-docker/#clusterisation-des-noeuds-docker","title":"Clusterisation des noeuds Docker","text":"<p>Docker Swarm est un outil de gestion de cluster Docker int\u00e9gr\u00e9 qui permet de cr\u00e9er et de g\u00e9rer un ensemble de n\u0153uds Docker, transformant ainsi plusieurs machines en un seul pool de ressources. Outre Docker Swarm, d'autres solutions de gestion de clusters Docker incluent Kubernetes, Apache Mesos, et Amazon ECS. Chacune de ces solutions a ses propres caract\u00e9ristiques et avantages, et le choix d\u00e9pend souvent des besoins sp\u00e9cifiques de votre environnement. Par exemple, Kubernetes est largement utilis\u00e9 pour les d\u00e9ploiements \u00e0 grande \u00e9chelle, tandis que Docker Swarm offre une configuration plus simple pour les cas d'utilisation plus modestes.</p>"},{"location":"cours/05-Services/containers/11-docker/#securite-des-conteneurs-docker","title":"S\u00e9curit\u00e9 des Conteneurs Docker","text":"<p>La s\u00e9curit\u00e9 des conteneurs Docker est une pr\u00e9occupation essentielle pour garantir la protection des applications et des donn\u00e9es qu'ils contiennent. Voici un aper\u00e7u des bonnes pratiques de s\u00e9curit\u00e9 associ\u00e9es aux conteneurs Docker :</p>"},{"location":"cours/05-Services/containers/11-docker/#1-utiliser-des-images-officielles-et-verifiees","title":"1. Utiliser des Images Officielles et V\u00e9rifi\u00e9es","text":"<p>Privil\u00e9giez l'utilisation d'images officielles provenant de d\u00e9p\u00f4ts de confiance tels que Docker Hub. Assurez-vous que les images utilis\u00e9es sont r\u00e9guli\u00e8rement mises \u00e0 jour et b\u00e9n\u00e9ficient du support de la communaut\u00e9.</p>"},{"location":"cours/05-Services/containers/11-docker/#2-mise-a-jour-reguliere-des-images-et-des-conteneurs","title":"2. Mise \u00e0 Jour R\u00e9guli\u00e8re des Images et des Conteneurs","text":"<p>Les mises \u00e0 jour fr\u00e9quentes des images et des conteneurs sont cruciales pour corriger les vuln\u00e9rabilit\u00e9s de s\u00e9curit\u00e9. Automatisez ce processus autant que possible pour maintenir votre environnement \u00e0 jour.</p> <pre><code>docker pull &lt;image&gt;:&lt;tag&gt;\ndocker-compose pull\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#3-utilisation-de-non-root-users","title":"3. Utilisation de Non-root Users","text":"<p>\u00c9vitez d'utiliser l'utilisateur root dans les conteneurs. D\u00e9finissez un utilisateur non-root pour minimiser les risques potentiels.</p> <pre><code>FROM base-image\nUSER nonrootuser\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#4-configuration-fine-des-ressources","title":"4. Configuration Fine des Ressources","text":"<p>Limitez les ressources disponibles aux conteneurs avec <code>--memory</code>, <code>--cpu</code>, et d'autres options pour pr\u00e9venir les attaques par d\u00e9ni de service.</p> <pre><code>docker run --memory=512m --cpu=0.5 my-image\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#5-isolation-des-reseaux","title":"5. Isolation des R\u00e9seaux","text":"<p>Utilisez des r\u00e9seaux Docker isol\u00e9s pour emp\u00eacher les communications non autoris\u00e9es entre conteneurs.</p> <pre><code>docker network create --driver bridge my-network\ndocker run --network=my-network my-container\n</code></pre> <p>En suivant ces meilleures pratiques de s\u00e9curit\u00e9, vous pouvez renforcer la r\u00e9silience de vos conteneurs Docker et att\u00e9nuer les risques potentiels. Il est important de rester inform\u00e9 sur les mises \u00e0 jour de s\u00e9curit\u00e9 et d'appliquer r\u00e9guli\u00e8rement les correctifs n\u00e9cessaires pour garantir un environnement Docker s\u00fbr et fiable.</p>"},{"location":"cours/05-Services/containers/11-docker/#exemple-de-stack-lamp-avec-plusieurs-containers-un-peu-obsolete-aujourdhui-car-repose-sur-une-debian-8","title":"Exemple de stack LAMP avec plusieurs containers (un peu obsolete aujourd'hui car repose sur une Debian 8)","text":"<pre><code>version: '3'\nservices:\n    m_apache:\n        build: docker/apache\n        container_name: m_apache\n        ports:\n          - 80:80\n        volumes:\n          - ./docker/config/vhosts:/etc/apache2/sites-enabled\n          - ./www:/var/www/html\n        depends_on:\n          - m_php\n\n    m_mysql:\n        image: mysql\n        command: \"--default-authentication-plugin=mysql_native_password\"\n        container_name: m_mysql\n        volumes:\n            - ./db:/var/lib/mysql\n        environment:\n            MYSQL_ROOT_PASSWORD: root\n            MYSQL_DATABASE: mery\n            MYSQL_USER: mery\n            MYSQL_PASSWORD: mery\n\n    m_php:\n        build: docker/php\n        container_name: m_php\n        volumes:\n          - ./www:/var/www/html\n        depends_on:\n          - m_mysql\n\n    m_phpmyadmin:\n        image: phpmyadmin/phpmyadmin\n        container_name: m_phpmyadmin\n        environment:\n          PMA_HOST: m_mysql\n          PMA_PORT: 3306\n        ports:\n            - 8080:80\n        links:\n            - m_mysql\n</code></pre>"},{"location":"cours/05-Services/containers/11-docker/#fichier-dockerphpdockerfile","title":"fichier docker/php/Dockerfile","text":"<pre><code>FROM php:7.2.10-fpm\n\nRUN apt-get update \\\n    &amp;&amp; apt-get install -y --no-install-recommends vim curl debconf subversion git apt-transport-https apt-utils \\\n    build-essential locales acl mailutils wget nodejs zip unzip \\\n    gnupg gnupg1 gnupg2 \\\n    zlib1g-dev \\\n    sudo\n\nRUN docker-php-ext-install pdo pdo_mysql zip\n\nCOPY php.ini /usr/local/etc/php/php.ini\nCOPY php-fpm-pool.conf  /usr/local/etc/php/pool.d/www.conf\n\nRUN curl -sSk https://getcomposer.org/installer | php -- --disable-tls &amp;&amp; \\\n    mv composer.phar /usr/local/bin/composer\n\nRUN wget --no-check-certificate https://phar.phpunit.de/phpunit-6.5.3.phar &amp;&amp; \\\n    mv phpunit*.phar phpunit.phar &amp;&amp; \\\n    chmod +x phpunit.phar &amp;&amp; \\\n    mv phpunit.phar /usr/local/bin/phpunit\n\nRUN echo \"deb https://deb.nodesource.com/node_6.x jessie main\" &gt;&gt; /etc/apt/sources.list.d/nodejs.list &amp;&amp; \\\n    wget -nv -O -  https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - &amp;&amp; \\\n    echo \"deb-src https://deb.nodesource.com/node_6.x jessie main\" &gt;&gt; /etc/apt/sources.list.d/nodejs.list &amp;&amp; \\\n    apt-get update &amp;&amp; \\\n    apt-get install -y --force-yes nodejs &amp;&amp; \\\n    rm -f /etc/apt/sources.list.d/nodejs.list\n\nRUN groupadd dev -g 999\nRUN useradd dev -g dev -d /home/dev -m\nRUN passwd -d dev\n\nRUN rm -rf /var/lib/apt/lists/*\nRUN echo \"en_US.UTF-8 UTF-8\" &gt; /etc/locale.gen &amp;&amp; \\\n    echo \"fr_FR.UTF-8 UTF-8\" &gt;&gt; /etc/locale.gen &amp;&amp; \\\n    locale-gen\n\nRUN echo \"dev ALL=(ALL) ALL\" &gt; /etc/sudoers\n\nWORKDIR /var/www/\n##&lt;/romaricp&gt;##\n\nEXPOSE 9000\nCMD [\"php-fpm\"]\n</code></pre>"},{"location":"cours/05-Services/management/logs-server/","title":"Serveur de Log","text":""},{"location":"cours/05-Services/management/logs-server/#objectifs","title":"Objectifs","text":"<p>Apprendre \u00e0 centraliser, analyser et exploiter les logs avec des outils modernes et ergonomiques, en \u00e9vitant les solutions obsol\u00e8tes comme <code>syslog-ng</code>.</p>"},{"location":"cours/05-Services/management/logs-server/#introductiuon","title":"Introductiuon","text":"<p>Dans un environnement informatique, les logs sont la m\u00e9moire technique de votre infrastructure. Ils enregistrent chaque \u00e9v\u00e9nement, chaque erreur, chaque tentative d\u2019acc\u00e8s \u2013 et constituent donc une source d\u2019information critique pour la s\u00e9curit\u00e9, le d\u00e9pannage et la conformit\u00e9.</p> <p>Un serveur de logs bien con\u00e7u r\u00e9pond aux quatre piliers de la s\u00e9curit\u00e9 de l\u2019information :</p> <ul> <li> <p>Disponibilit\u00e9 :   Les logs doivent \u00eatre accessibles en temps r\u00e9el pour permettre une r\u00e9action rapide en cas d\u2019incident (ex : panne, attaque).   Exemple : Un serveur de logs centralis\u00e9 \u00e9vite de perdre des informations critiques si un \u00e9quipement tombe en panne.</p> </li> <li> <p>Int\u00e9grit\u00e9 :   Les logs doivent \u00eatre prot\u00e9g\u00e9s contre toute alt\u00e9ration (volontaire ou accidentelle).   Exemple : Un attaquant pourrait tenter de supprimer ses traces ; un serveur de logs s\u00e9curis\u00e9 emp\u00eache cette manipulation.</p> </li> <li> <p>Confidentialit\u00e9 :   Les logs contiennent souvent des donn\u00e9es sensibles (adresses IP, noms d\u2019utilisateurs, actions syst\u00e8me).   Exemple : Un acc\u00e8s non contr\u00f4l\u00e9 aux logs peut exposer des informations personnelles (RGPD).</p> </li> <li> <p>Preuve (Tra\u00e7abilit\u00e9) :   Les logs servent de preuve l\u00e9gale en cas d\u2019audit, d\u2019intrusion ou de litige.   Exemple : En cas de violation de donn\u00e9es, les logs permettent de retracer l\u2019origine de l\u2019incident et de prouver la conformit\u00e9 aux r\u00e9glementations.</p> </li> </ul>"},{"location":"cours/05-Services/management/logs-server/#solution-traditionnelles-et-limites","title":"Solution traditionnelles et limites","text":"<p>Historiquement, des outils comme <code>syslog-ng</code> ou <code>rsyslog</code> ont \u00e9t\u00e9 utilis\u00e9s pour centraliser les logs. Cependant, ils pr\u00e9sentent plusieurs inconv\u00e9nients majeurs :</p> <ul> <li> <p>Interface utilisateur absente ou obsol\u00e8te :   La gestion des logs se fait souvent en ligne de commande, ce qui rend l\u2019analyse lente et complexe pour les \u00e9quipes op\u00e9rationnelles.</p> </li> <li> <p>Parsing et recherche limit\u00e9s :   Les logs sont stock\u00e9s sous forme de texte brut, ce qui rend leur exploitation peu efficace pour des analyses avanc\u00e9es.</p> </li> <li> <p>Scalabilit\u00e9 insuffisante :   Ces outils ne sont pas con\u00e7us pour g\u00e9rer des volumes massifs de logs (ex : milliers de messages par seconde).</p> </li> <li> <p>Manque de fonctionnalit\u00e9s modernes :   Pas d\u2019alerting natif, pas de dashboards, pas d\u2019int\u00e9gration facile avec d\u2019autres outils de monitoring ou de s\u00e9curit\u00e9.</p> </li> </ul> <p>Ces limites justifient le recours \u00e0 des solutions modernes comme <code>Graylog</code>, <code>ELK</code> ou <code>Loki</code>.</p>"},{"location":"cours/05-Services/management/logs-server/#presentation-de-graylog","title":"Pr\u00e9sentation de Graylog","text":"<p>Graylog est une plateforme open source con\u00e7ue pour simplifier la collecte, le stockage, l\u2019analyse et la visualisation des logs, tout en offrant une interface utilisateur moderne et intuitive. Contrairement aux solutions traditionnelles comme syslog-ng, Graylog propose une exp\u00e9rience utilisateur compl\u00e8te, accessible m\u00eame aux \u00e9quipes non techniques, sans sacrifier la puissance ni la flexibilit\u00e9.</p> <p></p> <p>MongoDB:</p> <p>MongoDB est utilis\u00e9 par Graylog pour stocker les informations de configuration, les utilisateurs, les r\u00f4les, les dashboards, les alertes, les r\u00e8gles de traitement des logs, etc. Pas les logs eux-m\u00eames (ce r\u00f4le revient \u00e0 Elasticsearch).  MongoDB est une base de donn\u00e9es NoSQL, id\u00e9ale pour des donn\u00e9es semi-structur\u00e9es comme les m\u00e9tadonn\u00e9es. Rapide pour les lectures/\u00e9critures de petites quantit\u00e9s de donn\u00e9es (parfait pour la configuration).</p> <p>ElasticSearch: Elasticsearch est le moteur de recherche et d\u2019analyse qui stocke tous les logs collect\u00e9s par Graylog. Il permet :</p> <ul> <li>L\u2019indexation des logs pour une recherche ultra-rapide.</li> <li>La recherche full-text (recherche dans le contenu des logs).</li> <li>L\u2019analyse (agr\u00e9gations, visualisations, alertes bas\u00e9es sur des motifs).</li> <li>La r\u00e9tention des logs (selon les politiques de conservation).</li> </ul> <p>Con\u00e7u pour g\u00e9rer des volumes massifs de donn\u00e9es (des milliards de logs). Le Moteur est optimis\u00e9 pour les requ\u00eates complexes et les analyses en temps r\u00e9el contrairement \u00e0 un moteur de base de donn\u00e9es SQL classique.</p>"},{"location":"cours/05-Services/management/logs-server/#fonctionnalites-cles","title":"Fonctionnalit\u00e9s cl\u00e9s","text":"<ul> <li> <p>Interface web ergonomique : Graylog offre un tableau de bord personnalisable, des outils de recherche avanc\u00e9e et des visualisations claires. Plus besoin de fouiller dans des fichiers texte ou de ma\u00eetriser des commandes complexes : tout est accessible via une interface graphique. Exemple : Un administrateur peut filtrer les logs par niveau de s\u00e9v\u00e9rit\u00e9, par source ou par p\u00e9riode, en quelques clics.</p> </li> <li> <p>Parsing et structuration des logs : Gr\u00e2ce \u00e0 des outils int\u00e9gr\u00e9 Graylog permet de transformer des logs bruts en donn\u00e9es structur\u00e9es et exploitables.</p> </li> </ul> <p>Exemple : Un log Apache brut  <pre><code>(192.168.1.1 - - [10/Oct/2023:13:55:36 +0200] \"GET /index.html HTTP/1.1\" 200 2326)\n</code></pre> peut \u00eatre d\u00e9coup\u00e9 en champs distincts : </p> <pre><code>- client_ip, \n- timestamp, \n- http_method, \n- status_code, \n- etc.\n</code></pre> <ul> <li>Alerting et notifications : Graylog permet de configurer des alertes en temps r\u00e9el bas\u00e9es sur des conditions personnalis\u00e9es (ex : plus de 10 erreurs 500 en 5 minutes). Les notifications peuvent \u00eatre envoy\u00e9es par email, Slack, ou via des webhooks. Cas d\u2019usage : D\u00e9tecter une attaque par force brute en surveillant les tentatives de connexion \u00e9chou\u00e9es.</li> </ul> <p>Bien que Graylog offre des fonctionnalit\u00e9s d\u2019alerting avanc\u00e9es, il ne remplace pas un vrai SIEM (comme Wazuh, Splunk, ou QRadar) pour la d\u00e9tection d\u2019intrusions sophistiqu\u00e9es</p> <ul> <li> <p>Scalabilit\u00e9 et performance : Graylog s\u2019appuie sur Elasticsearch pour le stockage et la recherche, ce qui lui permet de g\u00e9rer des volumes massifs de logs (millions de messages par jour). Il supporte \u00e9galement les d\u00e9ploiements en cluster pour une haute disponibilit\u00e9.</p> </li> <li> <p>Int\u00e9grations multiples: Graylog est compatible avec de nombreux protocoles (Syslog, GELF, Beats, Kafka) et s\u2019int\u00e8gre facilement avec des outils de monitoring (Prometheus, Grafana) ou de s\u00e9curit\u00e9 (SIEM).</p> </li> </ul>"},{"location":"cours/05-Services/management/logs-server/#stack-de-graylog","title":"Stack de Graylog","text":"<p>Graylog repose sur une architecture modulaire, s\u00e9parant clairement les fonctions de pr\u00e9sentation, de traitement et de stockage des logs.</p> <p>Graylog repose sur \u00e0 minima 2 serveurs:</p> <ul> <li><code>graylog-server</code> : le front et l'appli g\u00e9rant le dashboard</li> <li><code>graylog-datanodes</code> : le back g\u00e9rant le stockage avec le moteur opensearch (fork de Elastic)</li> </ul>"},{"location":"cours/05-Services/management/logs-server/#graylog-server","title":"Graylog-server","text":"<p>Le Graylog Server constitue le point d\u2019entr\u00e9e de la plateforme. Il fournit l\u2019interface d\u2019administration accessible aux utilisateurs habilit\u00e9s et assure le traitement des journaux avant leur stockage.</p> <p>Il est responsable de :</p> <ul> <li>Interface web (dashboards, recherches, alertes) </li> <li>R\u00e9ception des logs (GELF, Syslog, Beats, etc.)</li> <li>Parsing, normalisation et enrichissement des logs</li> <li>Gestion des utilisateurs, r\u00f4les et permissions</li> </ul> <p>Le Graylog Server ne stocke pas les logs de mani\u00e8re persistante. Sur ce noeud on y installe generallement le service MongoDB.</p>"},{"location":"cours/05-Services/management/logs-server/#service-mongodb","title":"Service Mongodb","text":"<p>MongoDB est utilis\u00e9 comme base de donn\u00e9es de configuration.</p> <p>Il stocke notamment :</p> <ul> <li>les utilisateurs et leurs r\u00f4les,</li> <li>les tableaux de bord,</li> <li>les streams, alertes et param\u00e8tres de la plateforme.</li> </ul> <p>Les logs eux-m\u00eames ne sont jamais stock\u00e9s dans MongoDB.</p>"},{"location":"cours/05-Services/management/logs-server/#graylog-datanode","title":"Graylog-datanode","text":"<p>Le Graylog Data Node est d\u00e9di\u00e9 au stockage et \u00e0 l\u2019indexation des journaux.</p> <p>Il embarque le moteur <code>OpenSearch</code>, qui assure :</p> <ul> <li>l\u2019indexation des logs,</li> <li>le stockage des donn\u00e9es,</li> <li>les recherches rapides (full-text, filtres, agr\u00e9gations),</li> <li>la gestion de la r\u00e9tention (suppression automatique des anciens logs).</li> </ul> OpenSearch <p>OpenSearch est un fork d\u2019Elasticsearch, n\u00e9 suite au changement de licence de ce dernier.</p> <p>La documentation Graylog recommande l\u2019utilisation d\u2019un espace de stockage d\u00e9di\u00e9, format\u00e9 avec le syst\u00e8me de fichiers <code>XFS</code>, particuli\u00e8rement adapt\u00e9 aux charges d\u2019\u00e9criture intensives g\u00e9n\u00e9r\u00e9es par les logs.</p> syst\u00e8me de fichier XFS <p>Tr\u00e8s performant avec de gros volumes de donn\u00e9es Excellente gestion des fichiers volumineux (logs, bases, VM) Allocation dynamique \u2192 moins de fragmentation Scalabilit\u00e9 \u00e9lev\u00e9e (pens\u00e9 pour serveurs et stockage pro) Croissance \u00e0 chaud du syst\u00e8me de fichiers (resize sans arr\u00eat) Tr\u00e8s adapt\u00e9 aux usages logs / OpenSearch / Graylog</p> <p></p> <p></p> <pre><code>admin@graylog:~$ ss -ltn\nState         Recv-Q        Send-Q                         Local Address:Port                  Peer Address:Port\nLISTEN        0             128                                  w.x.y.z:22                         0.0.0.0:*\nLISTEN        0             4096                         192.168.10.100:27017                      0.0.0.0:*\nLISTEN        0             4096                [::ffff:192.168.10.100]:9000                             *:*\n</code></pre> <p><code>::ffff:192.168.10.100</code> signifie qu\u2019un client IPv4 (192.168.10.100) est vu via un socket IPv6 : c\u2019est du dual-stack, l\u2019IPv4 \u00e9tant encapsul\u00e9e dans une adresse IPv6.</p> <pre><code>admin@graylog:~$ ss -lun\nState        Recv-Q       Send-Q                                Local Address:Port              Peer Address:Port\nUNCONN       0            0                                                 *:514                          *:*\nUNCONN       0            0                                                 *:514                          *:*\nUNCONN       0            0                                                 *:514                          *:*\nUNCONN       0            0                                                 *:514                          *:*\nUNCONN       0            0                                                 *:12201                        *:*\nUNCONN       0            0                                                 *:12201                        *:*\nUNCONN       0            0                                                 *:12201                        *:*\nUNCONN       0            0                                                 *:12201                        *:*\n</code></pre> <p>Graylog ouvre plusieurs listeners (\u00e9coute 4 fois sur le m\u00eame port UDP) pour :</p> <ul> <li>g\u00e9rer plus de d\u00e9bit</li> <li>\u00e9viter les blocages</li> <li>parall\u00e9liser la r\u00e9ception des logs</li> </ul> <pre><code>admin@datanode-01:~$ ss -ltn\nState           Recv-Q          Send-Q                   Local Address:Port                   Peer Address:Port\nLISTEN          0               128                            w.x.y.z:22                          0.0.0.0:*\nLISTEN          0               4096                                 *:9300                              *:*\nLISTEN          0               4096                                 *:8999                              *:*\nLISTEN          0               4096                                 *:9200                              *:*\n</code></pre> <ul> <li>9200 permet de parler \u00e0 <code>OpenSearch</code> (requ\u00eates, index, stats).</li> <li>9300 sert aux serveurs <code>OpenSearch</code> (cluster datanodes) pour se parler entre eux.</li> <li>8999 est le port de contr\u00f4le entre Graylog et ses Data Nodes.</li> </ul>"},{"location":"cours/05-Services/management/logs-server/#proposition-dimplementation","title":"Proposition d'impl\u00e9mentation","text":"<p>L'ensemble des logs seront envoy\u00e9 via: - rsyslog (par d\u00e9faut) ou syslog-ng (\u00e0 installer) sur les machines linux. - NXLogs ou Syslog Windows Agent pour les machines windows.</p> <p>Il faudra en plus installer l'agent du SIEM et autoriser les communication bidirectionnelles vers le r\u00e9seau g\u00e9rant le SOC.</p> <p>Je vous conseille l'installation du SIEM via un container Docker d\u00e9di\u00e9 pour faciliter les mont\u00e9es de version (\u00e9volution tr\u00e8s rapide)</p>"},{"location":"cours/05-Services/management/siem/","title":"SIEM","text":""},{"location":"cours/05-Services/management/siem/#introduction","title":"Introduction","text":"<p>Dans un paysage num\u00e9rique o\u00f9 les cybermenaces \u00e9voluent en permanence, les organisations doivent \u00eatre capables de d\u00e9tecter, analyser et r\u00e9pondre rapidement aux incidents de s\u00e9curit\u00e9. C\u2019est l\u00e0 qu\u2019intervient le <code>SIEM (Security Information and Event Management)</code>, une solution indispensable pour toute infrastructure soucieuse de sa s\u00e9curit\u00e9.</p>"},{"location":"cours/05-Services/management/siem/#role-dun-siem","title":"role d'un SIEM","text":"<p>Un SIEM est une plateforme qui agr\u00e8ge, corr\u00e8le et analyse les \u00e9v\u00e9nements de s\u00e9curit\u00e9 provenants de diverses sources (serveurs, r\u00e9seaux, applications, \u00e9quipements de s\u00e9curit\u00e9) pour :</p> <p>D\u00e9tecter les menaces en temps r\u00e9el (ex : attaques par force brute, mouvements lat\u00e9raux, exfiltration de donn\u00e9es). Centraliser les logs de s\u00e9curit\u00e9 et les rendre exploitables via des tableaux de bord et des alertes. Automatiser les r\u00e9ponses aux incidents (ex : blocage d\u2019une IP, isolation d\u2019un endpoint compromis). Faciliter la conformit\u00e9 en g\u00e9n\u00e9rant des rapports pour les normes (RGPD, ISO 27001, PCI DSS, etc.).</p>"},{"location":"cours/05-Services/management/siem/#presentation-de-wazuh","title":"Pr\u00e9sentation de Wazuh","text":"<p>Wazuh est une solution open source de d\u00e9tection d\u2019intrusions (IDS), de monitoring de s\u00e9curit\u00e9 et de r\u00e9ponse aux incidents (SIEM), con\u00e7ue pour offrir une protection proactive contre les cybermenaces. Contrairement \u00e0 des outils de log management comme <code>Graylog</code>, Wazuh se concentre sur la d\u00e9tection d\u2019activit\u00e9s malveillantes, la corr\u00e9lation d\u2019\u00e9v\u00e9nements de s\u00e9curit\u00e9, et l\u2019application automatique de contre-mesures (ex : blocage d\u2019IP, isolation de machines compromises). Wazuh combine plusieurs fonctionnalit\u00e9s cl\u00e9s :</p> <ul> <li> <p>D\u00e9tection d\u2019intrusions : Gr\u00e2ce \u00e0 des r\u00e8gles de corr\u00e9lation avanc\u00e9es (bas\u00e9es sur des signatures d\u2019attaques connues et des comportements anormaux), Wazuh identifie les tentatives d\u2019intrusion, les mouvements lat\u00e9raux, ou les exfiltrations de donn\u00e9es.</p> </li> <li> <p>Monitoring d\u2019int\u00e9grit\u00e9 des fichiers (FIM) : Surveillance en temps r\u00e9el des modifications critiques sur les syst\u00e8mes (ex : alt\u00e9ration de fichiers syst\u00e8me, cr\u00e9ation de backdoors). Conformit\u00e9 et audit : G\u00e9n\u00e9ration de rapports pour les normes PCI DSS, RGPD, ISO 27001, etc., avec des templates pr\u00e9d\u00e9finis.</p> </li> <li> <p>R\u00e9ponse automatique : Int\u00e9gration avec des outils comme OSSEC (moteur de d\u00e9tection) pour bloquer des IP, arr\u00eater des processus suspects, ou d\u00e9clencher des scripts de rem\u00e9diation.</p> </li> </ul>"},{"location":"cours/05-Services/management/siem/#emplacement-dans-un-soc","title":"Emplacement dans un SOC","text":"<p>Un SIEM comme Wazuh est le c\u0153ur analytique d\u2019un SOC (<code>Security Operation Center</code>). Il permet de :</p> <ul> <li> <p>D\u00e9tecter les menaces en temps r\u00e9el : Identifier des attaques comme les brute-force, les mouvements lat\u00e9raux, ou les exfiltrations de donn\u00e9es gr\u00e2ce \u00e0 des r\u00e8gles de corr\u00e9lation avanc\u00e9es.</p> </li> <li> <p>Centraliser et normaliser les logs de s\u00e9curit\u00e9 : Agr\u00e9gation des logs provenants des firewalls, IDS/IPS, serveurs, endpoints, et applications, puis les rendre exploitables via des tableaux de bord et des alertes prioris\u00e9es.</p> </li> <li> <p>Automatiser les r\u00e9ponses aux incidents : D\u00e9clencher des actions comme le blocage d\u2019une IP, l\u2019isolation d\u2019un endpoint compromis, ou l\u2019envoi d\u2019une alerte aux analystes du SOC.</p> </li> <li> <p>Faciliter la conformit\u00e9 : G\u00e9n\u00e9rer des rapports automatis\u00e9s pour r\u00e9pondre aux exigences r\u00e9glementaires (RGPD, ISO 27001, PCI DSS, etc.).</p> </li> </ul> <p>Le SIEM doit \u00eatre int\u00e9gr\u00e9 au SOC, car c\u2019est l\u00e0 que les analystes surveillent, analysent et r\u00e9pondent aux incidents de s\u00e9curit\u00e9. Cependant, son emplacement r\u00e9seau est crucial pour garantir s\u00e9curit\u00e9, disponibilit\u00e9 et performance.</p> <p>Placer le SIEM dans un VLAN de management d\u00e9di\u00e9, strictement contr\u00f4l\u00e9 (ACL, chiffrement, acc\u00e8s restreint), dans l'id\u00e9al un vlan d\u00e9di\u00e9 au SOC serait pertinent. Isoler physiquement ou logiquement le SIEM des r\u00e9seaux de production et publics. Utiliser des liens s\u00e9curis\u00e9s (TLS, VPN) pour la collecte des logs depuis les autres VLANs.</p>"},{"location":"cours/05-Services/management/siem/#exemple-de-deploiement","title":"Exemple de deploiement","text":"<p>Exemple de d\u00e9ploiement avec Wazuh et Graylog</p> <ul> <li>Graylog (VLAN de management) : Centralise tous les logs (applicatifs, r\u00e9seau, syst\u00e8mes) et les rend exploitables via des dashboards.</li> <li>Wazuh (SIEM, VLAN de management) : Consomme les logs de Graylog, applique des r\u00e8gles de corr\u00e9lation, et d\u00e9clenche des alertes/r\u00e9ponses automatiques.</li> <li>SOC : Les analystes utilisent Graylog pour l\u2019analyse des logs et Wazuh pour la d\u00e9tection des menaces et la r\u00e9ponse aux incidents.</li> </ul> \u00c9l\u00e9ment Recommandation Emplacement VLAN de management isol\u00e9 et s\u00e9curis\u00e9, accessible uniquement depuis le SOC. Acc\u00e8s Restreint aux analystes SOC, avec MFA. Chiffrement TLS pour tous les flux, chiffrement des logs sensibles. Int\u00e9gration SIEM connect\u00e9 \u00e0 Graylog (logs) et aux outils de r\u00e9ponse (firewalls, EDR). Redondance Cluster SIEM + sauvegardes des logs dans un VLAN d\u00e9di\u00e9. Segmentation ACL strictes pour limiter les flux entrants/sortants du VLAN de management. Sauvegardes Logs sauvegard\u00e9s dans un emplacement isol\u00e9 et chiffr\u00e9. Haute disponibilit\u00e9 D\u00e9ploiement en cluster pour \u00e9viter les points de d\u00e9faillance uniques."},{"location":"cours/05-Services/management/siem/#rappel-architecture-souhaitee","title":"Rappel architecture souhait\u00e9e","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/","title":"06 - Messagerie","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/#enregistrement-mx-et-serveurs-dns","title":"Enregistrement MX et Serveurs DNS","text":"<p>L'enregistrement MX (Mail Exchange) dans le syst\u00e8me de noms de domaine (DNS) est essentiel pour diriger le courrier \u00e9lectronique vers le serveur de messagerie appropri\u00e9. Cela s'effectue en sp\u00e9cifiant une priorit\u00e9 (le chiffre avant le nom du serveur MX) et le nom du serveur de messagerie. Voici un exemple plus d\u00e9taill\u00e9 :</p> <p><pre><code>MX 10 mail.example.com\nmail.example.com   IN   A   203.0.113.1\n</code></pre> Cet enregistrement indique que le serveur de messagerie pour le domaine example.com est mail.example.com avec une priorit\u00e9 de 10. La priorit\u00e9 est utilis\u00e9e pour d\u00e9terminer l'ordre de pr\u00e9f\u00e9rence des serveurs MX lorsque plusieurs sont disponibles.</p> <p>Cet enregistrement associe l'adresse IP 203.0.113.1 au nom de domaine mail.example.com. Ainsi, lorsque quelqu'un envoie un courrier \u00e0 user@example.com, le syst\u00e8me de messagerie consulte l'enregistrement MX pour d\u00e9terminer le serveur de messagerie de destination (mail.example.com), puis utilise l'enregistrement A pour obtenir son adresse IP (203.0.113.1).</p> <p>Ces enregistrements, pr\u00e9sents dans la zone DNS du domaine, permettent au courrier \u00e9lectronique d'\u00eatre correctement dirig\u00e9 vers le serveur de messagerie associ\u00e9 au domaine cible.</p> <p></p> <ul> <li>Le MTA (Mail Transfert Agent) est un serveur de messagerie (Postfix)</li> <li>Le MDA (Mail Delivery Agent) est le processus par lequel le mail est stock\u00e9e dans la boite aux lettre de l'utilisateur. (</li> <li>Le MUA (Mail User Agent) est le logiciel de messagerie install\u00e9 sur les postes clients permettant de r\u00e9cuperer les mails (Thunderbird, outlook)</li> </ul>"},{"location":"cours/05-Services/messagerie/06-messagerie/#protocoles-de-messagerie","title":"Protocoles de Messagerie","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/#smtp-simple-mail-transfer-protocol","title":"SMTP (Simple Mail Transfer Protocol)","text":"<p>Le protocole SMTP (Simple Mail Transfer Protocol) est utilis\u00e9 pour l'envoi de courriers \u00e9lectroniques. Il op\u00e8re sur le port TCP 25 par d\u00e9faut. Cependant, il est important de noter que le port 25 n'est pas s\u00e9curis\u00e9.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-25-non-securise","title":"Port TCP 25 (Non s\u00e9curis\u00e9) :","text":"<p>Le port 25 est traditionnellement utilis\u00e9 pour la transmission non s\u00e9curis\u00e9e des courriers \u00e9lectroniques. Cependant, en raison de probl\u00e8mes de s\u00e9curit\u00e9 potentiels, de nombreux fournisseurs de services de messagerie et ISP (Fournisseurs d'Acc\u00e8s Internet) bloquent parfois le trafic sortant sur ce port pour pr\u00e9venir le spam.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-587-starttls","title":"Port TCP 587 (STARTTLS) :","text":"<p>Pour surmonter les limitations de s\u00e9curit\u00e9 li\u00e9es au port 25, le port 587 est souvent utilis\u00e9 comme alternative. Ce port est d\u00e9di\u00e9 \u00e0 la transmission s\u00e9curis\u00e9e des courriers \u00e9lectroniques en utilisant le m\u00e9canisme STARTTLS. Lorsqu'un client se connecte au serveur SMTP sur le port 587 et indique qu'il souhaite utiliser STARTTLS, une connexion s\u00e9curis\u00e9e est \u00e9tablie avant le transfert du courrier \u00e9lectronique.</p> <p>Le m\u00e9canisme STARTTLS permet d'ajouter une couche de s\u00e9curit\u00e9 (chiffrement) \u00e0 la communication SMTP, rendant difficile l'interception des informations sensibles, telles que le contenu du courrier \u00e9lectronique et les informations d'identification.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#pop-post-office-protocol","title":"POP (Post Office Protocol)","text":"<p>Le protocole POP (Post Office Protocol) est utilis\u00e9 pour r\u00e9cup\u00e9rer les courriers \u00e9lectroniques d'un serveur et les t\u00e9l\u00e9charger sur l'appareil local de l'utilisateur. Deux versions couramment utilis\u00e9es sont POP3 (non s\u00e9curis\u00e9) et POP3S (s\u00e9curis\u00e9).</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-110-non-securise-pop3","title":"Port TCP 110 (Non s\u00e9curis\u00e9 - POP3) :","text":"<p>Le port 110 est traditionnellement associ\u00e9 \u00e0 la communication POP3 non s\u00e9curis\u00e9e. Lorsqu'un client de messagerie se connecte au serveur POP3 sur ce port, les courriers \u00e9lectroniques sont t\u00e9l\u00e9charg\u00e9s du serveur vers l'appareil local. Cependant, le transfert d'informations sur le port 110 est effectu\u00e9 en texte brut, sans chiffrement, ce qui expose les donn\u00e9es \u00e0 des risques potentiels d'interception.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-995-securise-pop3s","title":"Port TCP 995 (S\u00e9curis\u00e9 - POP3S) :","text":"<p>Pour rem\u00e9dier aux vuln\u00e9rabilit\u00e9s de s\u00e9curit\u00e9 li\u00e9es \u00e0 la transmission non s\u00e9curis\u00e9e sur le port 110, le port 995 est r\u00e9serv\u00e9 au protocole POP3 avec une couche de s\u00e9curit\u00e9 (SSL/TLS) ajout\u00e9e. Cette version s\u00e9curis\u00e9e est appel\u00e9e POP3S. Lorsqu'un client se connecte au serveur POP3 sur le port 995, la communication est chiffr\u00e9e, garantissant une transmission s\u00e9curis\u00e9e des courriers \u00e9lectroniques entre le serveur et l'appareil local.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#imap-internet-message-access-protocol","title":"IMAP (Internet Message Access Protocol)","text":"<p>Le protocole IMAP (Internet Message Access Protocol) est con\u00e7u pour permettre une gestion plus avanc\u00e9e des courriers \u00e9lectroniques en synchronisant les messages entre le client de messagerie et le serveur. Deux versions couramment utilis\u00e9es sont IMAP (non s\u00e9curis\u00e9) et IMAPS (s\u00e9curis\u00e9).</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-143-non-securise-imap","title":"Port TCP 143 (Non s\u00e9curis\u00e9 - IMAP) :","text":"<p>Le port 143 est associ\u00e9 \u00e0 la communication IMAP non s\u00e9curis\u00e9e. Lorsqu'un client de messagerie se connecte au serveur IMAP sur ce port, il peut afficher les en-t\u00eates des courriers \u00e9lectroniques et choisir les messages \u00e0 t\u00e9l\u00e9charger. Cependant, le transfert d'informations sur le port 143 est effectu\u00e9 en texte brut, sans chiffrement, exposant potentiellement les donn\u00e9es \u00e0 des risques d'interception.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#port-tcp-993-securise-imaps","title":"Port TCP 993 (S\u00e9curis\u00e9 - IMAPS) :","text":"<p>Pour renforcer la s\u00e9curit\u00e9 des communications IMAP, le port 993 est r\u00e9serv\u00e9 au protocole IMAP avec une couche de s\u00e9curit\u00e9 (SSL/TLS) ajout\u00e9e. L'utilisation de ce port s\u00e9curis\u00e9, appel\u00e9 IMAPS, garantit que la transmission des donn\u00e9es entre le client et le serveur est chiffr\u00e9e, pr\u00e9servant ainsi la confidentialit\u00e9 des informations.</p> <p>La caract\u00e9ristique principale d'IMAP par rapport \u00e0 POP est la conservation des messages sur le serveur. Les actions effectu\u00e9es sur le client (marquer comme lu/non lu, d\u00e9placer vers un dossier, etc.) sont refl\u00e9t\u00e9es sur le serveur, assurant une synchronisation entre les diff\u00e9rents appareils connect\u00e9s au m\u00eame compte de messagerie. IMAP permet de g\u00e9rer les courriels sur plusieurs appareils. POP t\u00e9l\u00e9charge les courriels, les retirant du serveur, ce qui est moins pratique dans un monde multi-appareils.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#positionnement-du-serveur-de-messagerie","title":"Positionnement du Serveur de Messagerie","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/#zone-reseau-protegee","title":"Zone R\u00e9seau Prot\u00e9g\u00e9e :","text":"<p>Le positionnement du serveur de messagerie au sein d'une zone r\u00e9seau prot\u00e9g\u00e9e est crucial pour garantir la s\u00e9curit\u00e9 des donn\u00e9es et la disponibilit\u00e9 des services. Cette zone, souvent appel\u00e9e le \"r\u00e9seau de p\u00e9rim\u00e8tre\", est configur\u00e9e avec des pare-feu, des syst\u00e8mes de d\u00e9tection d'intrusion et d'autres m\u00e9canismes de s\u00e9curit\u00e9 pour contr\u00f4ler et filtrer le trafic r\u00e9seau.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#pare-feu","title":"Pare-feu :","text":"<p>Un pare-feu est d\u00e9ploy\u00e9 pour surveiller et filtrer le trafic entrant et sortant du serveur de messagerie. Cela aide \u00e0 pr\u00e9venir les attaques malveillantes, telles que les tentatives d'intrusion ou les attaques par d\u00e9ni de service.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#detection-dintrusion","title":"D\u00e9tection d'Intrusion :","text":"<p>Les syst\u00e8mes de d\u00e9tection d'intrusion sont mis en place pour d\u00e9tecter les activit\u00e9s suspectes ou malveillantes. Cela inclut la surveillance des journaux d'\u00e9v\u00e9nements, l'analyse du trafic r\u00e9seau, et l'identification des tentatives d'acc\u00e8s non autoris\u00e9es.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#stockage-des-boites-aux-lettres-sur-un-serveur-de-base-de-donnees-securise","title":"Stockage des Bo\u00eetes aux Lettres sur un Serveur de Base de Donn\u00e9es S\u00e9curis\u00e9 :","text":"<p>Le stockage des bo\u00eetes aux lettres sur un serveur de base de donn\u00e9es s\u00e9curis\u00e9 offre plusieurs avantages en termes de s\u00e9curit\u00e9 et de gestion des donn\u00e9es.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#chiffrement-des-donnees","title":"Chiffrement des Donn\u00e9es :","text":"<p>Les donn\u00e9es des bo\u00eetes aux lettres peuvent \u00eatre chiffr\u00e9es pour garantir que m\u00eame en cas d'acc\u00e8s non autoris\u00e9, les informations restent illisibles sans la cl\u00e9 de chiffrement appropri\u00e9e.</p> <p>Gestion Centralis\u00e9e :</p> <p>La centralisation des donn\u00e9es sur un serveur de base de donn\u00e9es facilite la gestion des bo\u00eetes aux lettres, les sauvegardes r\u00e9guli\u00e8res, et la mise en \u0153uvre de politiques de s\u00e9curit\u00e9 coh\u00e9rentes.</p> <p>Contr\u00f4le d'Acc\u00e8s :</p> <p>Des m\u00e9canismes de contr\u00f4le d'acc\u00e8s stricts peuvent \u00eatre appliqu\u00e9s pour garantir que seules les personnes autoris\u00e9es ont acc\u00e8s aux donn\u00e9es sensibles des bo\u00eetes aux lettres.</p> <p>En int\u00e9grant ces pratiques dans l'infrastructure, le serveur de messagerie peut op\u00e9rer de mani\u00e8re s\u00e9curis\u00e9e, r\u00e9duisant les risques potentiels li\u00e9s \u00e0 la confidentialit\u00e9 et \u00e0 l'int\u00e9grit\u00e9 des donn\u00e9es.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#obligations-legales-et-confidentialite-dans-le-contexte-francais","title":"Obligations L\u00e9gales et Confidentialit\u00e9 dans le Contexte Fran\u00e7ais","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/#acces-aux-boites-aux-lettres","title":"Acc\u00e8s aux Bo\u00eetes aux Lettres :","text":"<p>En France, l'acc\u00e8s aux bo\u00eetes aux lettres des utilisateurs est soumis \u00e0 des obligations l\u00e9gales strictes visant \u00e0 prot\u00e9ger la vie priv\u00e9e des individus et \u00e0 garantir la confidentialit\u00e9 des communications \u00e9lectroniques. Voici quelques points importants \u00e0 consid\u00e9rer :</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#rgpd-reglement-general-sur-la-protection-des-donnees","title":"RGPD (R\u00e8glement G\u00e9n\u00e9ral sur la Protection des Donn\u00e9es) :","text":"<p>Depuis mai 2018, le RGPD est \u00e9galement applicable en France. Il \u00e9tablit des r\u00e8gles strictes concernant la protection des donn\u00e9es personnelles des citoyens de l'Union europ\u00e9enne, y compris les donn\u00e9es contenues dans les bo\u00eetes aux lettres \u00e9lectroniques. Les entreprises et les administrateurs sont tenus de se conformer aux exigences du RGPD, notamment en mati\u00e8re de consentement, de notification des violations de donn\u00e9es, et de respect des droits individuels.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#secret-des-correspondances","title":"Secret des Correspondances :","text":"<p>En vertu de l'article 226-15 du Code p\u00e9nal fran\u00e7ais, le secret des correspondances est prot\u00e9g\u00e9. Tout acc\u00e8s non autoris\u00e9 aux communications \u00e9lectroniques, y compris les bo\u00eetes aux lettres, peut \u00eatre passible de sanctions p\u00e9nales.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#autorisation-prealable","title":"Autorisation Pr\u00e9alable :","text":"<p>Dans de nombreux cas, l'administrateur syst\u00e8me doit obtenir une autorisation pr\u00e9alable avant d'acc\u00e9der aux bo\u00eetes aux lettres des utilisateurs. Cette autorisation peut \u00eatre d\u00e9termin\u00e9e par les politiques internes de l'entreprise et doit \u00eatre conforme aux lois en vigueur.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#conservation-des-donnees","title":"Conservation des Donn\u00e9es :","text":"<p>Les administrateurs doivent \u00eatre conscients des obligations de conservation des donn\u00e9es, d\u00e9finies par la loi, et s'assurer que les politiques de conservation sont respect\u00e9es.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#droit-a-loubli","title":"Droit \u00e0 l'Oubli :","text":"<p>Le RGPD accorde \u00e9galement aux individus le droit \u00e0 l'oubli, permettant aux utilisateurs de demander la suppression de leurs donn\u00e9es personnelles. Les administrateurs doivent \u00eatre pr\u00eats \u00e0 r\u00e9pondre \u00e0 de telles demandes de mani\u00e8re conforme \u00e0 la loi.</p> <p>En r\u00e9sum\u00e9, l'acc\u00e8s aux bo\u00eetes aux lettres en France est soumis \u00e0 un cadre juridique rigoureux visant \u00e0 prot\u00e9ger les droits fondamentaux \u00e0 la vie priv\u00e9e et \u00e0 la protection des donn\u00e9es personnelles. Les administrateurs doivent op\u00e9rer dans le respect de ces lois et mettre en place des m\u00e9canismes appropri\u00e9s pour garantir la confidentialit\u00e9 des communications \u00e9lectroniques. Violations de ces lois peuvent entra\u00eener des sanctions s\u00e9v\u00e8res.</p>"},{"location":"cours/05-Services/messagerie/06-messagerie/#serveurs-de-messageries-connus","title":"Serveurs de messageries connus","text":""},{"location":"cours/05-Services/messagerie/06-messagerie/#sous-windows","title":"Sous Windows","text":"<ul> <li>Microsoft Exchange</li> <li>hmailserver</li> </ul>"},{"location":"cours/05-Services/messagerie/06-messagerie/#sous-linux","title":"Sous Linux","text":"<ul> <li>Postfix (smtp)</li> <li>Dovecot (imap)</li> </ul>"},{"location":"cours/05-Services/messagerie/06-messagerie/#solution-completes-agenda-contacts-etc","title":"Solution compl\u00e8tes (agenda, contacts etc..)","text":"<ul> <li>Microsoft Exchange</li> <li>Zimbra</li> <li>IBM Notes (Lotus Notes)</li> </ul>"},{"location":"cours/05-Services/messagerie/06-messagerie/#clients-de-messagerie","title":"Clients de messagerie","text":"<ul> <li>Microsoft Outlook</li> <li>Mozilla Thunderbird</li> <li>Apple Mail</li> <li>Evolution (Linux)</li> </ul>"},{"location":"cours/05-Services/messagerie/07-hmailapi/","title":"07-API Hmail","text":""},{"location":"cours/05-Services/messagerie/07-hmailapi/#automatiser-la-creation-de-boite-aux-lettres-avec-lpai-hmailserver","title":"Automatiser la cr\u00e9ation de boite aux lettres avec l\u2019PAI HmailServer","text":"<p>L\u2019objectif est simple, \u00eatre capable de cr\u00e9er autant de boite aux lettre que n\u00e9cessaire tr\u00e8s rapidement \u00e0 partir d\u2019une liste d\u2019utilisateurs fournie dans un fichier texte. Le script devra evidement \u00eatre utilis\u00e9 sur la machine windows qui h\u00e9berge le serveur hmail.</p> <p>Cet exemple de code en PowerShell cr\u00e9 une boitte aux lettre. Il faut \u00e9videment l\u2019adapter pour en g\u00e9n\u00e9rer plusieurs d\u2019un coup.</p> <pre><code>#**************************************************\n#\n#     creation d'un compte de messagerie dans hmailserver   \n#\n#                               Auteur: MERY Ludovic\n#\n#************************************************** \n\n    Write-Host \" Creation d'un compte dans hMailServer ...\"\n\n    # This creates a COM object against the hMailServer API\n    $hm = New-Object -ComObject hMailServer.Application\n\n    #On precise le compte administrateur capable de grer le serveur\n    $hm.Authenticate(\"Administrator\", \"Azerty1234\") | Out-Null\n\n    ##On precise le suffixe DNS utilis\u00e9\n    $dnsroot = \"test.sportludique.fr\"; \n    #Le serveur de messagerie peut heberger plusieurs domaine, on cherche celui renseign\u00e9 plus haut.\n    $hmdom = $hm.Domains.ItemByName($dnsroot)\n    #On cr\u00e9 un compte.\n    $hmact = $hmdom.Accounts.Add()\n\n    #On renseigne les attributs du compte.\n    $hmact.Address = \"toto@test.sportludique.fr\"\n    $hmact.Active = $true\n    $hmact.IsAD = $false\n    $hmact.MaxSize = 100\n    $hmact.ADUsername = \"toto.tata\"\n    $hmact.PersonFirstName = \"toto\"\n    $hmact.PersonLastName = \"tata\"\n\n    #Et on oublie pas de sauvegarder\n    $hmact.save()\n\n    Write-Host \"Compte cree...Bravo !\"\n</code></pre>"},{"location":"cours/05-Services/web/apache/","title":"01- Apache (Serveur web)","text":""},{"location":"cours/05-Services/web/apache/#les-virtual-hosts-vhosts-sous-apache","title":"Les Virtual Hosts (vhosts) sous Apache","text":""},{"location":"cours/05-Services/web/apache/#cest-quoi-un-virtual-host","title":"C\u2019est quoi un Virtual Host ?","text":"<p>Un Virtual Host (ou vhost) permet \u00e0 un m\u00eame serveur Apache de g\u00e9rer plusieurs sites web diff\u00e9rents. Chaque vhost peut avoir :</p> <ul> <li>son propre nom de domaine (ex. www.site1.local),</li> <li>son dossier racine (o\u00f9 sont les fichiers du site),</li> <li>ses logs s\u00e9par\u00e9s, etc.</li> </ul> <p>C\u2019est gr\u00e2ce aux vhosts qu\u2019un seul serveur peut h\u00e9berger plusieurs sites.</p>"},{"location":"cours/05-Services/web/apache/#ou-ca-se-trouve","title":"O\u00f9 \u00e7a se trouve ?","text":"<p>Sous Linux la configuration des Vhosts se fait :</p> <pre><code>/etc/apache2/sites-available/   \u2192 contient tous les fichiers de configuration des sites\n/etc/apache2/sites-enabled/     \u2192 contient les sites actuellement activ\u00e9s (liens symboliques pointant vers sites-available )\n</code></pre> <p>Attention</p> <p>NE TOUCHEZ PAS AUX SITES PAR D\u00c9FAUT (000-default.conf, default-ssl.conf) Ces fichiers servent de base et assurent que ton Apache d\u00e9marre correctement. Cr\u00e9e tes propres fichiers .conf \u00e0 c\u00f4t\u00e9, c\u2019est plus propre.</p>"},{"location":"cours/05-Services/web/apache/#exemple-de-configuration","title":"Exemple de configuration","text":"<p>Fichier : <code>/etc/apache2/sites-available/mon_site.conf</code></p> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerName monsite.domaine.tld        # Nom FQDN correspondant \u00e0 l'url\n    ServerAlias autrenom.domaine.tld        # Nom alternatif (nom obligatoire) \n    DocumentRoot /var/www/monsite       #Dossier ou sont situ\u00e9 les fichiers html\n\n    &lt;Directory /var/www/monsite&gt;        #Autorisation d'acc\u00e8s\n        Options Indexes FollowSymLinks\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n                                        #Gestion des logs (indispensable)\n    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log\n    CustomLog ${APACHE_LOG_DIR}/monsite_access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <p>Explications :</p> <ul> <li>ServerName \u2192 le nom de domaine principal du site.</li> <li>ServerAlias \u2192 d\u2019autres noms qui pointent vers le m\u00eame site.</li> <li>DocumentRoot \u2192 dossier contenant ton site.</li> <li>ErrorLog / CustomLog \u2192 fichiers de log sp\u00e9cifiques \u00e0 ce site.</li> </ul> <p>Activer un vhost (et la magie du a2ensite)</p> <p>Une fois le fichier cr\u00e9\u00e9 :</p> <pre><code>sudo a2ensite mon_site.conf\nsudo systemctl reload apache2\n</code></pre> Information <p>a2ensite veut dire \u201cApache2 Enable Site\u201d Mais en r\u00e9alit\u00e9, c\u2019est juste un raccourci pour cr\u00e9er un lien symbolique : <pre><code>sudo ln -s /etc/apache2/sites-available/mon_site.conf /etc/apache2/sites-enabled/mon_site.conf\n</code></pre></p> <p>Donc <code>a2ensite = ln -s</code> (avec un peu d\u2019intelligence en plus pour v\u00e9rifier la conf). L\u2019inverse,  Donc <code>a2dissite</code>, fait un <code>rm</code> du lien symbolique</p> <p>Important</p> <p>V\u00e9rifier le status du service:  <code>sudo systemctl status apache2</code>, Pour les logs: <code>${APACHE_LOG_DIR} --&gt; /var/log/apache2/   (sous debian)</code>,</p>"},{"location":"cours/05-Services/web/apache/#les-erreurs-classiques","title":"Les erreurs classiques","text":"<ul> <li>Modifier <code>000-default.conf</code> au lieu de cr\u00e9er un vrai fichier : NON.</li> <li>Oublier le <code>ServerName</code> : Apache ne sait pas quel site servir.</li> <li>Ne pas recharger Apache : les modifs ne sont pas prises en compte.</li> <li>Oublier d\u2019ajouter l'enregistrement DNS correspondant sur le serveur d'autorit\u00e9 (ou \u00e0 minima configurer le fichier host pour faire pointer le FQDN vers la bonne adresse IP).</li> </ul>"},{"location":"cours/05-Services/web/https_via_openssl/","title":"02- Protocole TLS avec OpenSSL","text":""},{"location":"cours/05-Services/web/https_via_openssl/#mise-en-place-dun-serveur-web-securise-https-avec-le-protocole-ssl-tls-avec-openssl","title":"Mise en place d'un serveur web s\u00e9curis\u00e9 (https) avec le Protocole SSL / TLS avec OpenSSL","text":""},{"location":"cours/05-Services/web/https_via_openssl/#introduction","title":"Introduction","text":"<p>Dans ce TP, vous allez configurer notre serveur Apache sur et activer l'extension mod_SSL permettant de s\u00e9curiser les communications avec le protocole Secure Socket Layer dont l'\u00e9volution a donn\u00e9 naissance au protocole TLS (Transport Layer Security).</p> <p>SSL signifie \u00ab\u00a0Secure Socket Layer\u00a0\u00bb et TLS \u00ab\u00a0Transport Layer Security\u00a0\u00bb. Les deux sont des protocoles de chiffrement pour permettre aux requ\u00eates et r\u00e9ponses de circuler de mani\u00e8re confidentielle sur la couche de transport d'Internet. Ils agissent donc au niveau au-dessus de la couche 4 du mod\u00e8le OSI. Leur t\u00e2che est de proc\u00e9der au chiffrement (aussi appel\u00e9 cryptage) des flux de donn\u00e9es entre un client et un serveur.</p> <p>Dans le mod\u00e8le th\u00e9orique OSI on peut les imaginer fonctionnant sur la couche 6\u00a0: Pr\u00e9sentation. A charge pour les d\u00e9veloppeurs des protocoles applicatifs classiques de g\u00e9rer l'impl\u00e9mentation de la couche de s\u00e9curit\u00e9 associ\u00e9e en respectant le protocole TLS.</p> <p></p> <p>Lorsque la communication est effectu\u00e9e via cette couche de transport chiffr\u00e9e, un \u00ab\u00a0s\u00a0\u00bb est ajout\u00e9 au nom du protocole\u00a0: http devient https, imap devient imaps, etc. On rencontre \u00e9galement l'abr\u00e9viation SSL lorsqu'on parle de certificat SSL. Ce certificat est n\u00e9cessaire pour transf\u00e9rer la cl\u00e9 publique du serveur ainsi que son identit\u00e9 afin d'initier une communication via TLS. Ces certificats sont indispensables \u00e0 la s\u00e9curit\u00e9 sur internet. Ils permettent l'authentification des machines qui contrairement aux humains ne peuvent s'authentifier avec des logins/password.</p> <p>Les certificats sont \u00e9mis et sign\u00e9s num\u00e9riquement par des tiers de confiance\u00a0: L'autorit\u00e9 de certification que l'on peut assimiler \u00e0 un notaire lors d'une transaction immobili\u00e8re. Il est garant de la v\u00e9rification de l'identit\u00e9 des vendeurs (mais aussi des acheteurs).</p> <p></p> <p>Un protocole s\u00e9curis\u00e9 fonctionne sur un port diff\u00e9rent de son homologue non s\u00e9curis\u00e9.</p> Nom Port Nom Port http 80 https 443 ftp 21 ftps 990 imap 143 imaps 993 smtp 25 smtps 465 (obsol\u00e8te), 587 pop 110 pops 995"},{"location":"cours/05-Services/web/https_via_openssl/#difference-entre-ssl-et-tls","title":"Diff\u00e9rence entre SSL et TLS","text":"<p>Le SSL a \u00e9t\u00e9 introduit en 1995. Apr\u00e8s la d\u00e9couverte d'une s\u00e9rie de lourdes failles de s\u00e9curit\u00e9, la version\u00a02.0 am\u00e9lior\u00e9e a ensuite vu le jour puis la version 3.0 l'ann\u00e9e suivante. Plus tard, l'IETF (l'Internet Engineering Task Force, charg\u00e9e du d\u00e9veloppement d'Internet) a rejet\u00e9 SSL 3.0 apr\u00e8s la d\u00e9couverte de nouvelles failles de s\u00e9curit\u00e9.</p> <p>TLS est le protocole succ\u00e9dant \u00e0 SSL. Il a \u00e9t\u00e9 introduit en 1999 en tant que version am\u00e9lior\u00e9e de SSL\u00a03.0 et fut tout d'abord baptis\u00e9 SSL 3.1. La version actuelle est TLS 1.3 (depuis 2018).</p> <p>Dans un premier temps, l'\u00e9cart entre SSL 3.0 et TLS 1.0 \u00e9tait mince. \u00ab\u00a0Les diff\u00e9rences entre ce protocole (TLS) et SSL 3.0 ne sont pas fondamentales, mais sont suffisamment importantes pour que TLS 1.0 et SSL 3.0 ne puissent pas fonctionner ensemble\u00a0\u00bb (traduit librement de la requ\u00eate RFC 2246). Par rapport \u00e0 SSL\u00a03.0, TLS 1.0 a am\u00e9lior\u00e9 la s\u00e9curit\u00e9 cryptographique et l'interop\u00e9rabilit\u00e9 des applications. La version TLS 1.2 utilis\u00e9e actuellement apporte une s\u00e9curit\u00e9 accrue contre les attaques des hackers et permet aux applications une flexibilit\u00e9 nettement plus grande en ce qui concerne la gestion des algorithmes de chiffrement utilis\u00e9s (cipher suites ou suite cryptographiques).</p> <p>Par cons\u00e9quent, le TLS actuel est plus s\u00fbr, plus flexible et plus efficace que l'ancien SSL. Toutefois, comme l'abr\u00e9viation \u00ab\u00a0SSL\u00a0\u00bb est aujourd'hui nettement plus connue que \u00ab\u00a0TLS\u00a0\u00bb, de nombreux fournisseurs de logiciels utilisent le terme SSL ou le double terme SSL/TLS alors qu'ils entendent g\u00e9n\u00e9ralement la version actuelle de TLS, \u00e0 savoir TLS 1.3.</p>"},{"location":"cours/05-Services/web/https_via_openssl/#recommandations-officielles-de-la-cnil","title":"Recommandations officielles de la CNIL","text":"<p>Tout site web doit garantir son identit\u00e9 et la confidentialit\u00e9 des informations transmises.</p>"},{"location":"cours/05-Services/web/https_via_openssl/#les-precautions-elementaires","title":"Les pr\u00e9cautions \u00e9l\u00e9mentaires","text":"<ul> <li> <p>Mettre en \u0153uvre le protocole TLS (en remplacement de SSL) sur     tous les sites web, en utilisant uniquement les versions les plus     r\u00e9centes et en v\u00e9rifiant sa bonne mise en \u0153uvre.</p> </li> <li> <p>Rendre l'utilisation de TLS obligatoire pour toutes les pages     d'authentification, de formulaire ou sur lesquelles sont affich\u00e9es     ou transmises des donn\u00e9es \u00e0 caract\u00e8re personnel non publiques.</p> </li> <li> <p>Limiter les ports de communication strictement n\u00e9cessaires au     bon fonctionnement des applications install\u00e9es. Si l'acc\u00e8s \u00e0 un     serveur web passe uniquement par HTTPS, il faut autoriser uniquement     les flux r\u00e9seau IP entrants sur cette machine sur le port 443 et     bloquer tous les autres ports. (R\u00e8gle de filtrage dans le pare feu)</p> </li> <li> <p>Limiter l'acc\u00e8s aux outils et interfaces d'administration aux     seules personnes habilit\u00e9es. En particulier, limiter l'utilisation     des comptes administrateurs aux \u00e9quipes en charge de l'informatique     et ce, uniquement pour les actions d'administration qui le     n\u00e9cessitent.</p> </li> <li> <p>Si des cookies non n\u00e9cessaires au service sont utilis\u00e9s,     recueillir le consentement de l'internaute apr\u00e8s information de     celui-ci et avant le d\u00e9p\u00f4t du cookie.</p> </li> <li> <p>Limiter le nombre de composants mis en \u0153uvre, en effectuer une     veille et les mettre \u00e0 jour.</p> </li> </ul>"},{"location":"cours/05-Services/web/https_via_openssl/#ce-quil-ne-faut-pas-faire","title":"Ce qu'il ne faut pas faire","text":"<ul> <li> <p>Faire transiter des donn\u00e9es \u00e0 caract\u00e8re personnel dans une URL     telles que identifiants ou mots de passe.</p> </li> <li> <p>Utiliser des services non s\u00e9curis\u00e9s (authentification en clair, flux     en clair, etc.).</p> </li> <li> <p>Utiliser les serveurs comme des postes de travail, notamment pour     naviguer sur des sites web, acc\u00e9der \u00e0 la messagerie \u00e9lectronique,     etc.</p> </li> <li> <p>Placer les bases de donn\u00e9es sur un serveur directement accessible     depuis Internet.</p> </li> <li> <p>Utiliser des comptes utilisateurs g\u00e9n\u00e9riques (c'est-\u00e0-dire partag\u00e9s     entre plusieurs utilisateurs).</p> </li> </ul> <p>https://www.cnil.fr/fr/securite-securiser-les-sites-web</p> <p>Voil\u00e0 un bon r\u00e9sum\u00e9 de l'int\u00e9r\u00eat du cours Cybers\u00e9curit\u00e9 du BTS SIO</p>"},{"location":"cours/05-Services/web/https_via_openssl/#openssl-ou-lets-encrypt","title":"OpenSSL ou Let's Encrypt","text":"<p>Let\\'s Encrypt (abr\u00e9g\u00e9 LE) est une autorit\u00e9 de certification lanc\u00e9e le 3 d\u00e9cembre 2015 (B\u00eata Version Publique). Cette autorit\u00e9 fournit des certificats gratuits X.509 pour le protocole cryptographique TLS au moyen d\\'un processus automatis\u00e9 destin\u00e9 \u00e0 se passer du processus complexe actuel impliquant la cr\u00e9ation manuelle, la validation, la signature, l\\'installation et le renouvellement des certificats pour la s\u00e9curisation des sites internet. En d\u00e9cembre 2019, Let\\'s encrypt fournit 54,67\u00a0% des certificats TLS.</p> <p>Le projet vise \u00e0 g\u00e9n\u00e9raliser l\\'usage de connexions s\u00e9curis\u00e9es sur l'internet. En supprimant la n\u00e9cessit\u00e9 de paiement, de la configuration du serveur web, des courriels de validation et de gestion de l\\'expiration des certificats, le projet est fait pour r\u00e9duire de mani\u00e8re significative la complexit\u00e9 de la mise en place et de la maintenance du chiffrement TLS. Sur un serveur GNU/Linux, l'ex\u00e9cution de seulement deux commandes est cens\u00e9e \u00eatre suffisante pour param\u00e9trer le chiffrement HTTPS, l'acquisition et l'installation de certificats, et ceci en quelques dizaines de secondes. C'est ce que propose OVH m\u00eame sur son offre LowCoast.</p> <p>Let's Encrypt est LA solution \u00e0 moindre co\u00fbt, toutefois, comme tous les certificats, son utilisation repose sur l'achat d'un nom de domaine (que nous n'avons pas). De plus Let's Encrypt automatise le processus (workflow) entre le client (propri\u00e9taire d'un nom de domaine) et le prestataire (autorit\u00e9 de certification) tier de confiance. Il est indispensable de bien comprendre les r\u00f4les et diff\u00e9rentes \u00e9tapes de ce processus pour comprendre le fonctionnement de la s\u00e9curisation d'un site web. C'est pourquoi nous utiliserons le logiciel Openssl pour r\u00e9aliser nos propres certificats et nous faire passer pour une autorit\u00e9 de certification.</p> <p>Par ailleurs, la gratuit\u00e9 de Let's encrypt a permis aux cybercriminels de monter des serveurs s\u00e9curis\u00e9s ce qui emp\u00eache la d\u00e9tection des logiciels malveillants (ils sont chiffr\u00e9s). Ils ont aussi profit\u00e9 de l'aubaine pour monter des campagnes de typo-squatting (achat de noms de domaine dont le nom est tr\u00e8s proche de la victime cibl\u00e9e) leur permettant de monter des copies de sites l\u00e9gitimes avec de v\u00e9ritables certificats reconnus comme de confiance par les navigateurs. Cela rend les attaques de phishing plus performantes.</p> <p></p> <p>Le fameux cadenas vert du navigateur a d'ailleurs disparu pour cette raison, le cadenas n'est pas le signe que l'on peut faire confiance au serveur, il indique juste que la communication est chiffr\u00e9e et qu'un certificat a bien \u00e9t\u00e9 \u00e9mis pour le nom de domaine utilis\u00e9. Cela ne signifie pas que le propri\u00e9taire de ce nom de domaine est un acteur de confiance. Il faut donc toujours rester vigilant par rapport aux URL quel que soit la mani\u00e8re d'y acc\u00e9der.</p>"},{"location":"cours/05-Services/web/https_via_openssl/#installation-dopenssl","title":"Installation d'OpenSSL","text":"<p>OpenSSL est un ensemble de biblioth\u00e8ques et d'outils comprenant tout ce qui est n\u00e9cessaire \u00e0 l'utilisation de la cryptographie forte et des protocoles SSL (Secure Sockets Layer), TLS (Transport Layer Security)</p> <p>Il se d\u00e9coupe donc en trois parties :</p> <ul> <li> <p>la biblioth\u00e8que cryptographique</p> </li> <li> <p>la biblioth\u00e8que impl\u00e9mentant SSL/TLS</p> </li> <li> <p>le programme en ligne de commande permettant, entre autres, de     manipuler les certificats et de mettre en place un serveur     d'authentification ou une autorit\u00e9 de certification (CA)</p> </li> </ul> <p>Nous allons supposer que nous sommes notre propre autorit\u00e9 de certification. Cependant en pratique pour le commerce \u00e9lectronique il est pr\u00e9f\u00e9rable de demander un certificat \u00e0 une autorit\u00e9 reconnue (VeriSign, etc). De fait, en \u00e9tant nous-m\u00eame autorit\u00e9 de certification nous risquons de ne pas avoir beaucoup de client, puisque nous ne sommes pas reconnus comme autorit\u00e9 de certification racine dans les navigateurs. Pour le devenir (installation de notre certificat racine) il faut que le client nous fasse confiance (en g\u00e9n\u00e9ral juste pour une session).</p> <p>A noter\u00a0: openssl est aussi utilisable sous windows sans aucun probl\u00e8me puisque le projet a \u00e9t\u00e9 d\u00e9velopp\u00e9 en C. Il suffit juste de t\u00e9l\u00e9charger une version compil\u00e9e pour windows 64 bits ou de le compiler soit m\u00eame comme un grand.</p> <p>Pour installer openssl, rien de plus simple avec les gestionnaires de paquet, mais il est probable qu'il soit d\u00e9j\u00e0 install\u00e9. <code>apt-get install openssl</code></p> <p>PS\u00a0: \u00e0 vous de savoir quand il faut pr\u00e9fixer une commande par sudo d\u00e9sormais.</p> <ol> <li>Taper openssl version pour v\u00e9rifier</li> </ol> <p></p> <p>A noter\u00a0: Nous ne disposons pas de la toute derni\u00e8re version (1.1.1i de d\u00e9cembre 2020) mais cela suffira pour notre TP.</p> <p>Information tr\u00e8s importante </p> <p>V\u00e9rification du nom de l\u2019objet</p> <p>La RFC 2818, publi\u00e9e en mai 2000, d\u00e9conseille l\u2019utilisation du champ Common Name (CN) dans les certificats TLS pour la v\u00e9rification du nom de l\u2019objet. Les certificats TLS sans la section SAN (Subject Alternative Name) ne peuvent plus \u00eatre utilis\u00e9s \u00e0 des fins de v\u00e9rification. Les clients qui utilisent d\u00e9j\u00e0 TLS, mais qui n\u2019utilisent pas de SAN, doivent mettre \u00e0 jour leurs certificats pour se conformer aux nouvelles exigences. Plus important encore, les clients doivent ajouter les DNS et/ou les adresses IP externes au champ SAN (Subject Alternative Names) du certificat. </p> <p>Les navigateurs r\u00e9cents impl\u00e9mentent cette RFC et les certificats sans champ SAN ne sont plus valid\u00e9s.</p> <p>OpenSSL ne gere malheuresement pas par d\u00e9faut ce champ. Voici la solution:</p>"},{"location":"cours/05-Services/web/https_via_openssl/#configuration-openssl-gestion-rfc-2818","title":"Configuration openSSL (gestion RFC 2818)","text":"<p>Editer le fichier <code>/etc/ssl/openssl.cnf</code> . Ce fichier d\u00e9crit le comportemant que g\u00e8re openSSL. C'est dans ce fichier que nous imposerons les champs SAN (Subject Alternative Names). </p> <p>Information tr\u00e8s importante </p> <p>Malheuresement, ces champs ne peuvent \u00eatre renseign\u00e9es par l'utilisateur de mani\u00e8re interactive. Il faudra donc penser \u00e0 faire cette manipulation pour chaque site que pour lesquel vous souhaitez g\u00e9n\u00e9rer un certificat.</p> <pre><code>[ req ]\ndistinguished_name = req_distinguished_name\nreq_extensions = v3_req    #Decommenter cette ligne et trouver la section\n\n...\n\n[ v3_req ]\n# Extensions to add to a certificate request\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\n\n#########    Ajouter la ligne suivante:\nsubjectAltName = @alt_names    # le @alt_names est un pointeur vers la section ci dessous\n\n[ alt_names ]\nDNS.1 = example.com             #Saisir le nom du domaine concern\u00e9 (vous remarquez qu'il n'y a pas l'h\u00f4te associ\u00e9)\nDNS.2 = www.example.com         #saisir le nom FQDN de votre site\n</code></pre> <p>N'oubliez pas d'enregistrer votre fichier</p> <ol> <li>Cr\u00e9er un dossier de travail ( tpssl par exemple) dans la VM avec     l'arborescence suivante afin de s'organiser un minimum. V\u00e9rifiez     avec la commande tree \u00e0 installer si vous ne l'avez pas d\u00e9j\u00e0 fait\u00a0:</li> </ol> <pre><code>\u251c\u2500\u2500 autorite\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 certificats\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 keys\n\u2514\u2500\u2500 siteweb\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 certificats\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 keys\n\u2514\u2500\u2500 requests_certificats\n</code></pre>"},{"location":"cours/05-Services/web/https_via_openssl/#creation-de-la-demande-de-certificat-par-le-proprietaire-du-site","title":"Cr\u00e9ation de la demande de certificat par le propri\u00e9taire du site","text":"<p>Pour l'algorithme RSA (factorisation de deux grands nombre premiers), L'ANSSI recommande d'utiliser des cl\u00e9s RSA de 2048 bits jusqu'en 2030. Au-del\u00e0 il faudra passer \u00e0 des cl\u00e9s d'une taille de 3072 bits ou changer d'algorithme en choisissant les courbes elliptiques par exemple. Ne me demandez pas de d\u00e9tail, c'est de l'expertise math\u00e9matique tr\u00e8s avanc\u00e9e.</p> <p>Source\u00a0: https://www.keylength.com/fr/5/</p> <p></p>"},{"location":"cours/05-Services/web/https_via_openssl/#generation-de-la-cle-privee-du-serveur-web","title":"G\u00e9n\u00e9ration de la cl\u00e9 priv\u00e9e du serveur web","text":"RSAcourbe eliptique <pre><code>openssl genrsa 2048 &gt; siteweb/keys/privatekey.key\n</code></pre> <pre><code>openssl ecparam -genkey -name prime256v1 -out privatekey.key\n</code></pre> <ol> <li>V\u00e9rifier le contenu du fichier g\u00e9n\u00e9r\u00e9 avec la commande <code>cat</code> pour les cl\u00e9s RSA ou pour les courbes eliptique</li> </ol> <pre><code>openssl ec -in privatekey.key -text -noout\n</code></pre>"},{"location":"cours/05-Services/web/https_via_openssl/#generation-dune-demande-de-certificat-pour-le-serveur-web","title":"G\u00e9n\u00e9ration d'une demande de certificat pour le serveur web.","text":"<p>La demande de certificat est g\u00e9n\u00e9r\u00e9 avec openssl via la commande suivante :</p> <p>Information tr\u00e8s importante </p> <p>Normallement les modifications dans le fichier de conf d'open SSL sont prise en compte mais on peut forcer leur utilisation</p> classiqueForcer l'usage du fichier de conf  <pre><code>openssl req -new -key siteweb/keys/privatekey.key &gt; siteweb/requests_certificats/demande.csr \n</code></pre> <pre><code>openssl req -new -key siteweb/keys/privatekey.key &gt; siteweb/requests_certificats/demande.csr -config /etc/ssl/openssl.cnf\n</code></pre> <p>Le syst\u00e8me va vous demander de saisir des champs ; remplissez-les en adaptant sauf le champ Common Name qui doit correspondre exactement au nom de domaine utilis\u00e9 correspondant \u00e0 la directive Server Name d\u00e9fini dans le VHost d'apache. (ex\u00a0: www.lyceefulbert.fr Attention\u00a0: ce domaine existe r\u00e9ellement, en choisir un autre obligatoirement)</p> <p>Ce n'est pas la peine de saisir d'autres \"extra attributes\"...</p> <p>Ce qui permet de g\u00e9n\u00e9rer votre CSR certificat. Celle-ci est cr\u00e9\u00e9e dans le format PEM encod\u00e9 en base64, PEM (Privacy Enhanced Mail) \u00e9tant le format par d\u00e9faut pour OpenSSL (il s'agit d'un fichier DER encod\u00e9 en ASCII et entour\u00e9 de balises de marquage).</p> <p>Deux choix s'offrent d\u00e9sormais \u00e0 nous\u00a0:</p> <ul> <li> <p>envoyer le fichier demande.csr \u00e0 un organisme (le tiers de confiance     ou l\\'autorit\u00e9 de certification (CA)) et ainsi obtenir le     certificat d\u00fbment sign\u00e9 par la cl\u00e9 priv\u00e9e de l'organisme (apr\u00e8s     avoir pay\u00e9),</p> </li> <li> <p>ou bien signer nous-m\u00eame notre certificat avec une autorit\u00e9 que     nous allons cr\u00e9er pour l'occasion. Elle ne sera \u00e9videment pas     reconnu comme \u00e9tant de confiance. Cela ne peut donc pas \u00eatre mis en     production dans le monde r\u00e9el.</p> </li> </ul> <p>C'est ce dernier choix que nous allons voir.</p> <ol> <li>V\u00e9rifions tout de m\u00eame notre demande avant de la traiter\u00a0:</li> </ol> <pre><code>openssl req -in siteweb/requests_certificats/demande.csr -noout -text\n</code></pre> <p>Important</p> <p>Verifier la pr\u00e9sence des champs Subject Alternatives Names</p> <p></p>"},{"location":"cours/05-Services/web/https_via_openssl/#creation-du-certificat-de-lautorite-de-certification","title":"Cr\u00e9ation du certificat de l'autorit\u00e9 de certification","text":"<p>Pour signer un certificat, vous devez devenir votre propre autorit\u00e9 de certification, cela implique donc de poss\u00e9der une cl\u00e9 priv\u00e9e et un certificat auto-sign\u00e9.</p> <ol> <li>La cr\u00e9ation de la cl\u00e9 priv\u00e9e de l\\'autorit\u00e9 de certification se fait comme pr\u00e9c\u00e9demment :</li> </ol> <pre><code>openssl genrsa -des3 2048 &gt; [a vous de pr\u00e9ciser le chemin, soyez coh\u00e9rent SVP] private_ca.key\n</code></pre> <p>Attention ne pas m\u00e9langer le fichier correspondant \u00e0 notre serveur et ceux correspondant \u00e0 l\\'autorit\u00e9 de certification.</p> <p>l\\'option -des3 introduit l\\'usage d\\'une \\\"passphrase\\\" qui sera demand\u00e9e \u00e0 chaque utilisation de la cl\u00e9 priv\u00e9e. Ne l'oubliez surtout pas. Noter le ici\u00a0: _______________________</p> <ol> <li>Ensuite, \u00e0 partir de la cl\u00e9\u00a0priv\u00e9e, on cr\u00e9e un certificat x509 pour une dur\u00e9e de validit\u00e9 d\\'un an auto-sign\u00e9 :</li> </ol> <pre><code>openssl req -new -x509 -days 365 -key private_ca.key &gt; autorite/certificats/ca.crt\n</code></pre> Attention <p>Attention il faut mettre les bons chemins des diff\u00e9rents fichiers\u00a0!!!! Utilisez la tabulation pour \u00e9viter les erreurs de saisie.</p> <p>Soyez imaginatif dans la saisie des informations concernant l'autorit\u00e9. Elles doivent \u00eatre diff\u00e9rentes des informations saisies pr\u00e9c\u00e9demment pour le site web. Ici vous g\u00e9n\u00e9rez votre propre autorit\u00e9 de certification qui est fictive.</p> <ol> <li>Quel passphrase est attendu\u00a0? Pourquoi\u00a0?</li> </ol>"},{"location":"cours/05-Services/web/https_via_openssl/#traitement-de-la-demande-de-certificat-de-notre-serveur-par-lautorite-de-certification-fictive","title":"Traitement de la demande de certificat de notre serveur par l'autorit\u00e9 de certification fictive","text":"<ol> <li>Taper openssl x509 -help pour obtenir l'aide\u00a0:</li> </ol> <p>La demande de certificat \u00e0 signer est le fichier ________________________________</p> <ol> <li>La commande qui signe la demande de certificat est la suivante :</li> </ol> classiqueForcer l'usage des champs Subject Alternatives Names (SAN)  <pre><code>openssl x509 -req -in [te_plante_pas].csr -out [a_adapter].crt -CA [certif_autorite].crt -CAkey [privatekey_ca].key -CAcreateserial -CAserial ca.srl\n</code></pre> <pre><code>openssl x509 -req -in [te_plante_pas].csr -out [a_adapter].crt -CA [certif_autorite].crt -CAkey [privatekey_ca].key -CAcreateserial -CAserial ca.srl -extfile /etc/ssl/openssl.cnf -extensions v3_req\n</code></pre> <p>Important</p> <p>Noter bien -extfile openssl.cnf -extensions v3_req a la fin de la demande de signature qui impose donc l'usage des options g\u00e9rant les champs SAN. Il faut evidement le bon chemin. On peut imaginer un fichier de conf d'openssl par siteweb souhait\u00e9. A vous de vous adapter.</p> <p>Le certificat sign\u00e9 par l'autorit\u00e9 de certification est le fichier ___________________________.</p> <ol> <li>V\u00e9rifier sa pr\u00e9sence dans le syst\u00e8me de fichier.</li> </ol> <pre><code> \u251c\u2500\u2500 autorite\n \u2502\u00a0\u00a0 \u251c\u2500\u2500 certificats\n \u2502\u00a0\u00a0 \u2514\u2500\u2500 keys\n \u2514\u2500\u2500 siteweb\n \u251c\u2500\u2500 certificats\n \u251c\u2500\u2500 keys\n \u2514\u2500\u2500 requests_certificats\n</code></pre> <ol> <li>V\u00e9rifier son contenu avec la commande appropri\u00e9e:</li> </ol> <pre><code>    openssl x509 -in siteweb/certificats/siteweb.crt -noout -text\n</code></pre> <p></p> <p>Atttention</p> <p>La copie d'\u00e9cran ci dessus ne montre pas les champs SAN pourtant n\u00e9cessaire avec la RFC 2018</p>"},{"location":"cours/05-Services/web/https_via_openssl/#format-pem","title":"Format PEM","text":"<p>PEM (initialement \\\"Privalit\u00e9 Enhanced Mail \u00bb) est le format le plus courant pour X.509 certificats, CSRs et les cl\u00e9s cryptographiques. Un fichier PEM est un fichier texte contenant un ou plusieurs \u00e9l\u00e9ments en codage ASCII Base64, chacun avec des en-t\u00eates et pieds de page en texte brut (par exemple <code>-----BEGIN CERTIFICATE-----</code> et <code>-----END CERTIFICATE-----</code>). </p> <p>Un seul fichier PEM peut contenir un certificat d'entit\u00e9 finale, une cl\u00e9 priv\u00e9e ou plusieurs certificats formant une cha\u00eene de confiance compl\u00e8te</p> <p>Remarque</p> <p>Avec Nginx, on utilise souvent des fichiers PEM qui sont des conteneurs avec le certificat et la cl\u00e9 priv\u00e9e. Ca permet de manipuler un seul fichier au lieu de deux.</p> <p>Le fichier n'est donc pas lisible par l'\u0153il humain sans une conversion dans un format texte ce qui nous oblige \u00e0 utiliser l'option -text pour afficher un contenu lisible.</p> <p>Pour g\u00e9n\u00e9rer un seul fichier PEM avec le certificat et la cl\u00e9 priv\u00e9e du serveur, il suffit de concatener les 2 fichier dans un troisi\u00e8me en utilisant cat (surtout pas nano) et l'op\u00e9rateur de redirection de flux &gt; qui cr\u00e9\u00e9ra un fichier.</p> <pre><code>cat file1.crt file2.key &gt; file3.pem\n</code></pre>"},{"location":"cours/05-Services/web/https_via_openssl/#configuration-du-serveur-web","title":"Configuration du serveur WEB","text":"<ol> <li> <p>Copier le fichier <code>/etc/apache2/sites-available/default-ssl.conf</code> dans     son dossier d'origine mais avec le nom de votre site web (celui     d\u00e9fini dans le champ Common Name). Pensez \u00e0 bien conserver     l'extension .conf indispensable pour la commande <code>a2ensite</code>.</p> </li> <li> <p>Modifier le contenu du fichier correspondant \u00e0 la configuration de     votre site web en adaptant les directives <code>DocumentRoot</code> et     <code>ServerName</code>.</p> </li> <li> <p>Modifier le chemin de <code>SSLCertificateFile</code> et     <code>SSLCertificatekeyfile</code> en fonction de ce que vous avez fait avec     le logiciel openssl.</p> </li> <li> <p>Activer le module SSL avec la commande <code>a2enmod ssl</code>, activer le     site, et red\u00e9marrer le service comme demand\u00e9.</p> </li> <li> <p>Penser \u00e0 rediriger le port 443 sur votre VM via votre     vagrantfile.</p> </li> <li> <p>Tentez d'acc\u00e9der \u00e0 votre site web en utilisant son nom (pensez \u00e0     ajuster le fichier host si n\u00e9cessaire).</p> </li> <li> <p>Accepter le certificat et afficher ses informations</p> </li> </ol>"},{"location":"cours/05-Services/web/https_via_openssl/#diagramme-de-sequence-dune-connexion-https","title":"Diagramme de sequence d'une connexion HTTPS","text":""},{"location":"cours/05-Services/web/https_via_openssl/#consultation-du-site-web-avec-chrome","title":"Consultation du site web avec chrome","text":"<p>L'avertissement des navigateurs est normal puisque l'autorit\u00e9 de certification qui a d\u00e9livr\u00e9 le certificat au propri\u00e9taire du site n'est pas une autorit\u00e9 digne de confiance.</p> <p>Pour r\u00e9gler le probl\u00e8me il suffit de r\u00e9cup\u00e9rer le certificat de l'autorit\u00e9 (ca.crt) et l'ins\u00e9rer dans le magasin des autorit\u00e9s digne de confiance.</p> <p>Dans le monde r\u00e9el ce probl\u00e8me n'existe pas puisqu'on utilise une autorit\u00e9 de confiance.</p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"cours/05-Services/web/https_via_openssl/#exemple-de-faux-certificats-forge","title":"Exemple de faux certificats forg\u00e9","text":"<p>Remarque</p> <p>Prenez bien en compte la pr\u00e9sence du champ Subject Alernative Names nomm\u00e9 en fran\u00e7ais Noms alternatifs du sujet dans Firefox.</p>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/","title":"03 - LoadBalacing avec HA Proxy","text":""},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#introduction","title":"Introduction","text":"<p>L\u2019objectif est de mettre en place de la r\u00e9partition de charge sur une ou plusieurs application web.</p> <p>Je ferai le test avec 2 serveurs web apache, en montrant les configurations n\u00e9cessaires pour:</p> <ul> <li>Du load Balancing d\u2019une appli en http</li> <li>Du Load Balancing d\u2019une appli en https</li> <li>Du Load Balabncing de plusieurs appli en http et https</li> </ul>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-globale","title":"Configuration globale","text":""},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-des-serveurs-dns","title":"Configuration des serveurs DNS","text":"<ul> <li>Les deux serveurs sont enregistr\u00e9s avec leurs IP respectives.</li> <li>Le Load Balancer a aussi sont IP.</li> <li>Les applications pointent vers le haproxy en utilisant des alias (enregistrements CNAME)</li> </ul>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-du-load-balancing-dune-appli-en-http","title":"Configuration du load Balancing d\u2019une appli en http","text":"<p>Cr\u00e9ation d\u2019un site web r\u00e9pondant au nom app.mery.test.</p>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#sur-srv-http1","title":"Sur srv-http1","text":"<pre><code>&lt;html&gt;\n &lt;h1&gt;Mon App Hautement disponible sur un cluster&lt;/h1&gt;\n&lt;?php\necho \"&lt;h2&gt;IP serveur WEB: \".$_SERVER['SERVER_ADDR'].\"&lt;/h2&gt;\";\necho \"&lt;h3&gt;IP Repartiteur de charge: \".$_SERVER['REMOTE_ADDR'].\"&lt;/h3&gt;\";\necho \"&lt;h3&gt;Client d orgigine: \".$_SERVER['HTTP_X_FORWARDED_FOR'].\"&lt;/h3&gt;\";\n?&gt;\n&lt;/html&gt;\n</code></pre> <p>N\u2019oubliez pas d\u2019activer le site web avec la commande a2ensite  \u00e0 partir du fichier <code>/etc/apache2/sites-avaibles/app.conf</code></p>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#sur-srv-http2","title":"Sur srv-http2","text":"<p>La m\u00eame chose sur srv-http2 en modifiant un peu le script (on va ajouter un fond en couleur)</p> <pre><code>&lt;html&gt;\n&lt;body style=\"background-color:yellow;\"&gt;\n &lt;h1&gt;Mon App Hautement disponible sur un cluster&lt;/h1&gt;\n&lt;?php\necho \"&lt;h2&gt;IP serveur WEB: \".$_SERVER['SERVER_ADDR'].\"&lt;/h2&gt;\";\necho \"&lt;h3&gt;IP Repartiteur de charge: \".$_SERVER['REMOTE_ADDR'].\"&lt;/h3&gt;\";\necho \"&lt;h3&gt;Client d orgigine: \".$_SERVER['HTTP_X_FORWARDED_FOR'].\"&lt;/h3&gt;\";\n?&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-de-haproxy","title":"Configuration de haproxy","text":"<pre><code>listen cluster 0.0.0.0:80\n    mode http      #mode http\n\n    stats enable   #on active la gestion des stats ou pas\n\n    stats uri /stats        #url d'acc\u00e8s a la consultation des stats\n    stats realm Strictly\\ Private   #acc\u00e9s restreint, authentification requise\n    stats auth admin:admin          #utilisateur autoris\u00e9\n\n    balance roundrobin      #Algorithme du tourniquet 50/50 pour 2 serveurs\n\n    option httpclose        \n    option forwardfor       #transmet au serveur le demandeur r\u00e9\u00e9l (le client)\n\n    #on d\u00e9fini le cluster ici avec chaque adresse\n    server srv-http1 10.251.0.201:80 check\n    server srv-http2 10.251.0.202:80 check\n</code></pre> <p>On oublie pas de red\u00e9marrer le service</p> <p></p> <p></p>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-du-load-balancing-dune-appli-en-https","title":"Configuration du load Balancing d\u2019une appli en https","text":"<p>Idem pour les serveurs web, rien \u00e0 modifier</p> <p>Il faut cr\u00e9er un tunnel entre le Client et le r\u00e9partiteur de charge (haproxy), les serveurs web n\u2019ont donc pas \u00e0 \u00eatre configur\u00e9s avec TLS.</p> <p></p> <p>Il faut \u00e9videment un certificat valide pour le nom de domaine concern\u00e9, j\u2019ai rapidement cr\u00e9\u00e9 un certificat auto-sign\u00e9.</p> <p>Important</p> <p>haproxy requiert l\u2019usage du format pem qui regroupe dans un conteneur le certificat et la cl\u00e9 priv\u00e9e du serveur. Cela se fait en concat\u00e9nant les deux fichiers dans un autre. Si vous le faites en ligne de commande utilisez la commande cat (listing du contenu du fichier par d\u00e9faut sur l\u2019\u00e9cran) et surtout pas nano qui est un \u00e9diteur de texte.</p> <pre><code>cat lecertificat.crt lacleprive.key &gt; app.mery.test.pem\n</code></pre>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-de-ha-proxy","title":"Configuration de HA Proxy","text":"<pre><code>...\n# on defini le point d'entr\u00e9 qui \u00e9coute en http et https\nfrontend appmerytest\n        #on ecoute les 2 app sur les 2 ports\n    bind app.mery.test:80\n        # pour https (port 443) on pr\u00e9cise le chemin\n    bind app.mery.test:443 ssl crt /etc/ssl/app.mery.test/app.mery.test.pem\n\n        #Pour forcer a utiliser https\n        #redirect scheme https code 301 if !{ ssl_fc }\n\n    mode http\n    reqadd X-Forwarded-Proto:\\ http\n    reqadd X-Forwarded-Proto:\\ https\n\n        #on precise l'etiquette on sont d\u00e9finit les serveurs de backend (cach\u00e9s)\n    default_backend appmerytest_http_backend\n\n#D\u00e9finition du cluster backend (cach\u00e9s des clients en opposition au frontend)\nbackend appmerytest_http_backend\n    mode http\n\n    balance roundrobin\n\n        option forwardfor\n\n        # redirection sur les serveurs en http\n    server srv-http1 10.251.0.201:80 check\n    server srv-http2 10.251.0.202:80 check\n</code></pre>"},{"location":"cours/05-Services/web/loadbalancing_via_HAProxy/#configuration-du-load-balabncing-de-plusieurs-applis-en-http-et-https","title":"Configuration du Load Balabncing de plusieurs applis en http et https","text":"<p>On cr\u00e9e une deuxi\u00e8me web-application sur chaque serveur web (app2) et on les active. (gestion des vhosts )</p> <p>La deuxi\u00e8me version de l\u2019application aura un fond vert plut\u00f4t que jaune sur le serveur http2 (ben oui c\u2019est la m\u00eame application que j\u2019ai copi\u00e9)</p> <pre><code>frontend appmerytest\n    bind app.mery.test:80\n    bind app.mery.test:443 ssl crt /etc/ssl/app.mery.test/app.mery.test.pem\n\n    #redirect scheme https code 301 if !{ ssl_fc }\n    mode http\n    reqadd X-Forwarded-Proto:\\ http\n    reqadd X-Forwarded-Proto:\\ https\n\n    default_backend appmerytest_http_backend\n\nfrontend app2merytest\n    bind app2.mery.test:80\n    bind app2.mery.test:443 ssl crt /etc/ssl/app2.mery.test/app2.mery.test.pem\n\n    #redirect scheme https code 301 if !{ ssl_fc }\n    mode http\n    reqadd X-Forwarded-Proto:\\ http\n    reqadd X-Forwarded-Proto:\\ https\n\n    default_backend appmerytest_http_backend\n\nbackend appmerytest_http_backend\n    mode http\n    balance roundrobin\n    server srv-http1 10.251.0.201:80 check\n    server srv-http2 10.251.0.202:80 check\n</code></pre> <p>Il y a ici deux expositions en FrontEnd avec chacune leurs certificats. La redirection se fait sur le m\u00eame cluster de serveurs web (backend)</p> <p></p> <p></p>"},{"location":"cours/05-Services/web/reverse-proxy/","title":"04 - Reverse Proxy","text":"<p>Un reverse proxy est un serveur qui agit comme un interm\u00e9diaire entre les clients (navigateurs) et les serveurs web internes. Il re\u00e7oit les requ\u00eates, les redirige vers le bon serveur en fonction du nom de domaine ou du chemin demand\u00e9, puis renvoie la r\u00e9ponse au client.</p> <p>Dans votre infrastructure, vous avez actuellement :</p> <ul> <li>un serveur web Apache h\u00e9bergeant un site HTML statique, et vous allez progressivement y ajouter d\u2019autres applications, </li> <li>comme un WordPress (en PHP)</li> <li>ou une application d\u00e9velopp\u00e9e par les \u00e9tudiants SLAM.</li> </ul> <p>La bonne pratique consiste \u00e0 s\u00e9parer chaque application sur un serveur distinct pour \u00e9viter les conflits entre environnements.  Par exemple, un WordPress peut n\u00e9cessiter PHP 8.1, alors qu\u2019une autre application peut d\u00e9pendre encore de PHP 7.4. Si toutes ces versions cohabitent sur le m\u00eame serveur, les d\u00e9pendances peuvent entrer en conflit.</p> <p>Pour ex\u00e9cuter du PHP, deux approches existent :</p> <ul> <li>Apache avec le module <code>libapache2-mod-php</code>, qui int\u00e8gre directement PHP dans Apache (simple, mais monolithique),</li> <li><code>PHP-FPM (FastCGI Process Manager)</code>, un service s\u00e9par\u00e9 qui ex\u00e9cute le code PHP de mani\u00e8re ind\u00e9pendante. Cette seconde solution est plus performante et plus souple, car elle permet de g\u00e9rer plusieurs versions de PHP sur le m\u00eame syst\u00e8me, chaque application ayant son propre moteur PHP.</li> </ul> <p>Comme il n\u2019y a qu\u2019une seule adresse publique (et donc un seul port 80/443) disponible, il est impossible d\u2019exposer directement plusieurs serveurs web sur Internet. Le <code>reverse proxy</code> r\u00e8gle ce probl\u00e8me : il agit comme un point d\u2019entr\u00e9e unique, recevant toutes les requ\u00eates et les distribuant vers les bons serveurs internes selon le nom de domaine :</p> <ul> <li>www.monsite.fr \u2192 vers le serveur Apache du site HTML,</li> <li>blog.monsite.fr \u2192 vers le serveur WordPress,</li> <li>app.monsite.fr \u2192 vers l\u2019application SLAM.</li> </ul> <p>Nous allons utiliser Nginx comme reverse proxy principal, car il est plus performant et plus l\u00e9ger qu\u2019Apache pour ce r\u00f4le : - il g\u00e8re mieux les connexions simultan\u00e9es, consomme moins de ressources et sert les fichiers statiques plus rapidement. - Apache peut \u00e9galement \u00eatre configur\u00e9 en reverse proxy, mais cela demande une adaptation diff\u00e9rente (modules mod_proxy, mod_proxy_http, etc.) et n\u2019est pas aussi optimis\u00e9 pour les forts volumes de requ\u00eates.</p> <p>Plus tard, cette architecture \u00e9voluera naturellement vers l\u2019utilisation de container <code>Docker</code>, qui permettra d\u2019isoler chaque application (et sa version de PHP) dans un conteneur d\u00e9di\u00e9, tout en restant accessible via le m\u00eame reverse proxy Nginx.</p> <p></p>"},{"location":"cours/05-Services/web/reverse-proxy/#installation-de-nginx-si-ce-nest-pas-deja-fait","title":"Installation de Nginx (si ce n'est pas d\u00e9j\u00e0 fait) :","text":"<pre><code>sudo apt-get update\nsudo apt-get install nginx\n</code></pre>"},{"location":"cours/05-Services/web/reverse-proxy/#configuration-de-nginx","title":"Configuration de Nginx :","text":"<ol> <li>Cr\u00e9er un fichier pour chaque site dans /etc/nginx/sites-available :</li> </ol> <pre><code>sudo nano /etc/nginx/sites-available/site1\n</code></pre> <ol> <li>Ajoutez une section pour chaque site, en rempla\u00e7ant les valeurs par les v\u00f4tres :</li> </ol> <p><pre><code>    server {\n        listen 80;\n        server_name site1.domaine.org;\n\n        location / {\n            proxy_pass http://site1.domaine.org;   //avec une resolution donnant l'IP interne par le resolver\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n    }\n</code></pre> <pre><code>sudo nano /etc/nginx/sites-available/site2\n</code></pre> <pre><code>    server {\n        listen 80;\n        server_name site2.domaine.org;\n\n        location / {\n            proxy_pass http://192.168.1.20:88; // avec un port d'\u00e9coute sp\u00e9cifique \u00e0 un vhost\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n    }\n</code></pre> etc... <pre><code>    server {\n        listen 80;\n        server_name site3.domaine.org;\n\n        location / {\n            proxy_pass http://uneip:unport; \n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n    }\n</code></pre></p> <p>Cr\u00e9er un lien symbolique pour chaque site r\u00e9f\u00e9renc\u00e9 dans sites-available pour les activer dans sites-enabled </p> <pre><code># Create symbolic links for all sites in sites-available\nsudo ln -s /etc/nginx/sites-available/site1 /etc/nginx/sites-enabled/\nsudo ln -s /etc/nginx/sites-available/site2 /etc/nginx/sites-enabled/\n# Repeat the above command for each site configuration file\n\n# Test Nginx configuration\nsudo nginx -t\n\n# If the configuration test is successful, reload Nginx\nsudo systemctl reload nginx\n</code></pre> <p>Les directives <code>proxy_set_header</code> dans la configuration Nginx sont utilis\u00e9es pour d\u00e9finir les en-t\u00eates HTTP qui seront envoy\u00e9s au serveur backend lorsqu'une requ\u00eate est transmise par le reverse proxy.</p> <p>Ces en-t\u00eates sont g\u00e9n\u00e9ralement utilis\u00e9s pour transf\u00e9rer des informations sur la requ\u00eate ou le client d'origine au serveur backend. Voici une explication des directives que vous trouverez dans l'exemple fourni :</p> <ol> <li><code>proxy_set_header Host $host;</code>:</li> <li> <p>Cette directive d\u00e9finit l'en-t\u00eate <code>Host</code> qui est envoy\u00e9 au serveur backend. Elle prend la valeur de <code>$host</code>, qui est la valeur de l'en-t\u00eate <code>Host</code> de la requ\u00eate initiale du client. Cela est important pour que le serveur backend puisse distinguer entre diff\u00e9rents domaines virtuels (vhosts) s'il en g\u00e8re plusieurs.</p> </li> <li> <p><code>proxy_set_header X-Real-IP $remote_addr;</code>:</p> </li> <li> <p>Cette directive d\u00e9finit l'en-t\u00eate <code>X-Real-IP</code>, qui est souvent utilis\u00e9 pour transmettre l'adresse IP r\u00e9elle du client au serveur backend. Cela peut \u00eatre utile lorsque Nginx est plac\u00e9 derri\u00e8re un autre proxy.</p> </li> <li> <p><code>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</code>:</p> </li> <li> <p>Cette directive d\u00e9finit l'en-t\u00eate <code>X-Forwarded-For</code>. Il s'agit d'un en-t\u00eate standard utilis\u00e9 pour transmettre l'adresse IP du client d'origine au serveur backend. La valeur <code>$proxy_add_x_forwarded_for</code> ajoute l'adresse IP du client \u00e0 la liste existante de adresses IP d\u00e9j\u00e0 pr\u00e9sentes dans l'en-t\u00eate.</p> </li> <li> <p><code>proxy_set_header X-Forwarded-Proto $scheme;</code>:</p> </li> <li>Cette directive d\u00e9finit l'en-t\u00eate <code>X-Forwarded-Proto</code>. Cet en-t\u00eate indique au serveur backend le protocole utilis\u00e9 par le client pour acc\u00e9der \u00e0 Nginx (HTTP ou HTTPS). La valeur <code>$scheme</code> prend la valeur du sch\u00e9ma de la requ\u00eate (http ou https).</li> </ol> <p>L'utilisation de ces en-t\u00eates est importante lorsqu'un reverse proxy est utilis\u00e9, car elle permet de fournir au serveur backend des informations cruciales sur la requ\u00eate initiale du client. Cela est particuli\u00e8rement important dans les architectures o\u00f9 plusieurs serveurs interagissent les uns avec les autres, et o\u00f9 certaines informations de la requ\u00eate d'origine peuvent \u00eatre perdues lors du passage par le proxy.</p> <ol> <li> <p>Sauvegardez et fermez le fichier.</p> </li> <li> <p>Testez la configuration Nginx :</p> </li> </ol> <pre><code>sudo nginx -t\n</code></pre> <ol> <li>Red\u00e9marrez Nginx pour appliquer les modifications :</li> </ol> <pre><code>sudo systemctl restart nginx\n</code></pre> <p>Maintenant, Nginx agira en tant que reverse proxy et dirigera les requ\u00eates en fonction des noms de domaine vers les serveurs appropri\u00e9s.</p> <p>Assurez-vous de remplacer les valeurs comme <code>192.168.1.20</code>, <code>192.168.1.30</code>, <code>unport</code> par les valeurs sp\u00e9cifiques \u00e0 votre configuration. Vous pouvez \u00e9galement personnaliser les options de proxy en fonction de vos besoins.</p>"},{"location":"cours/05-Services/web/reverse-proxy/#gestion-de-tls","title":"Gestion de TLS","text":"<p>La gestion du HTTPS avec Nginx implique la configuration d'un certificat SSL/TLS pour s\u00e9curiser les connexions entre les clients et le serveur Nginx. Voici comment vous pouvez ajouter la prise en charge du HTTPS \u00e0 votre configuration existante :</p> <ol> <li>Modifiez la configuration Nginx :</li> <li> <p>Ajoutez les directives SSL dans chaque bloc <code>server</code> pour activer le support HTTPS.</p> <pre><code>server {\n    listen 80;\n    server_name site1.domaine.org;\n    return 301 https://$host$request_uri; // forcer la redirection en https\n}\n\nserver {\n    listen 443 ssl;\n    server_name site1.domaine.org;\n\n    ssl_certificate /etc/ssl/certificat.pem;\n    ssl_certificate_key /etc/ssl/privkey.pem;\n\n    # ... autres directives SSL (comme ssl_protocols, ssl_ciphers, etc.)\n\n    location / {\n        proxy_pass http://192.168.1.20;\n        include /etc/nginx/proxy_params;\n    }\n}\n</code></pre> <ul> <li>R\u00e9p\u00e9tez le m\u00eame processus pour les autres serveurs virtuels (<code>site2.domaine.org</code> et <code>site3.domaine.org</code>).</li> </ul> </li> <li> <p>Red\u00e9marrez Nginx :</p> </li> <li> <p>Une fois que vous avez configur\u00e9 les certificats et ajust\u00e9 la configuration Nginx, red\u00e9marrez Nginx pour appliquer les changements.</p> <pre><code>sudo systemctl restart nginx\n</code></pre> </li> </ol> <p>Maintenant, votre serveur Nginx devrait \u00eatre configur\u00e9 pour g\u00e9rer les connexions HTTPS. Assurez-vous de remplacer les chemins des certificats (<code>ssl_certificate</code> et <code>ssl_certificate_key</code>) avec les chemins r\u00e9els de vos certificats.</p> <p>N'oubliez pas de maintenir vos certificats SSL \u00e0 jour. Vous pouvez configurer un renouvellement automatique avec Certbot ou en ajoutant une t\u00e2che planifi\u00e9e (cron tab) .</p> <p>Dans le sc\u00e9nario de configuration qci dessus, les certificats SSL/TLS sont g\u00e9n\u00e9ralement n\u00e9cessaires uniquement sur le serveur Nginx, qui agit en tant que reverse proxy. Les serveurs d'origine (Apache, serveurs Docker, etc.) ne n\u00e9cessitent pas de certificats SSL/TLS propres, car la communication entre le serveur Nginx et les serveurs d'origine peut souvent se faire en interne via des connexions non chiffr\u00e9es.</p> <p>Le trafic chiffr\u00e9 SSL/TLS entre les clients et Nginx s'arr\u00eate au niveau du serveur Nginx, et la communication entre Nginx et les serveurs d'origine peut \u00eatre non chiffr\u00e9e (HTTP) ou chiffr\u00e9e s\u00e9par\u00e9ment (par exemple, si les serveurs d'origine prennent en charge HTTPS et ont leurs propres certificats).</p> <p>Assurez-vous que le trafic entre Nginx et les serveurs d'origine est s\u00e9curis\u00e9 en fonction de vos exigences de s\u00e9curit\u00e9. Si n\u00e9cessaire, vous pouvez activer HTTPS entre Nginx et les serveurs d'origine, mais cela impliquera la configuration de certificats sur ces serveurs d'origine \u00e9galement. Dans de nombreux cas, cette couche de chiffrement suppl\u00e9mentaire n'est pas n\u00e9cessaire si le r\u00e9seau interne est consid\u00e9r\u00e9 comme s\u00e9curis\u00e9.</p>"},{"location":"cours/05-Services/web/reverse-proxy/#gestion-des-headers-administration-avancee","title":"Gestion des Headers (administration avanc\u00e9e)","text":"<p>Les headers HTTP permettent au serveur de donner des instructions au navigateur pour am\u00e9liorer la s\u00e9curit\u00e9 ou le comportement du site. Ils ne remplacent pas un code s\u00e9curis\u00e9, mais limitent l\u2019impact des failles existantes.</p>"},{"location":"cours/05-Services/web/reverse-proxy/#principaux-headers","title":"Principaux Headers","text":"Header Objectif Strict-Transport-Security (HSTS) Force le navigateur \u00e0 utiliser HTTPS, prot\u00e8ge contre les attaques MITM Content-Security-Policy (CSP) Limite l\u2019ex\u00e9cution de JS/CSS/images provenant de sources non autoris\u00e9es X-Content-Type-Options: nosniff Emp\u00eache le navigateur de deviner le type MIME d\u2019un fichier X-Frame-Options Prot\u00e8ge contre le clickjacking (inclusion du site dans un iframe) Referrer-Policy Contr\u00f4le quelles informations sont envoy\u00e9es dans l\u2019en-t\u00eate Referer Permissions-Policy Limite l\u2019acc\u00e8s \u00e0 la cam\u00e9ra, micro, g\u00e9olocalisation. Correspond aux autorisations d'une app sous Android <p>Ces headers permettent de passer proprement les scans de s\u00e9curit\u00e9 (SecurityHeaders.com, Mozilla Observatory).</p>"},{"location":"cours/05-Services/web/reverse-proxy/#headers-complementaires-app-modernes","title":"Headers compl\u00e9mentaires (app modernes)","text":"Header R\u00f4le Cross-Origin-Embedder-Policy (COEP) Bloque le chargement de ressources non s\u00e9curis\u00e9es cross-origin Cross-Origin-Resource-Policy (CORP) D\u00e9finit qui peut acc\u00e9der aux ressources Cross-Origin-Opener-Policy (COOP) S\u00e9pare les fen\u00eatres / onglets pour \u00e9viter certaines attaques"},{"location":"cours/05-Services/web/reverse-proxy/#configurations-des-headers","title":"Configurations des Headers","text":"<ul> <li>Cr\u00e9er un fichier global pour tous les vhosts : <code>/etc/nginx/security-headers.conf</code></li> <li>Exemple minimaliste et s\u00fbr :</li> </ul> <pre><code>add_header Strict-Transport-Security \"max-age=63072000; includeSubDomains\" always;\nadd_header X-Content-Type-Options \"nosniff\" always;\nadd_header X-Frame-Options \"SAMEORIGIN\" always;\nadd_header Content-Security-Policy \"default-src 'self' https:;\" always;\n</code></pre> <ul> <li>Inclure ce fichier dans chaque vhost HTTPS :</li> </ul> <pre><code>include /etc/nginx/security-headers.conf;\n</code></pre> <ul> <li>CSP permissive : permet aux CDN et API externes de continuer \u00e0 fonctionner</li> </ul> <p>Les headers HTTP ne corrigent pas les failles du code, mais r\u00e9duisent leur impact et permettent aux scanners et audits de passer proprement.</p>"},{"location":"cours/06-Cybersecurite/cybersecu/","title":"Cybers\u00e9curit\u00e9","text":"<p>Ce chapitre pr\u00e9sente les principales attaques informatiques, class\u00e9es selon les couches du mod\u00e8le OSI, de la plus basse (physique) \u00e0 la plus haute (applicative).</p> <p>Cette liste est non exhaustive : - Les techniques d\u2019attaque \u00e9voluent constamment - De nouvelles vuln\u00e9rabilit\u00e9s apparaissent r\u00e9guli\u00e8rement  </p> <p>L\u2019objectif est de : - Comprendre les m\u00e9canismes g\u00e9n\u00e9raux des attaques - Associer chaque attaque \u00e0 des contre-mesures adapt\u00e9es - Donner une culture cybers\u00e9curit\u00e9 commune aux \u00e9tudiants</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#1-couche-1-physique","title":"1. Couche 1 \u2013 Physique","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#physical-access-attack","title":"Physical Access Attack","text":"<p>Traduction : Attaque par acc\u00e8s physique</p> <p>Principe : Acc\u00e8s non autoris\u00e9 \u00e0 un \u00e9quipement (serveur, switch, poste client).</p> <p>Exemples : - Vol de disque dur - Branchement d\u2019un p\u00e9riph\u00e9rique USB malveillant</p> <p>Contre-mesures : - Contr\u00f4le d\u2019acc\u00e8s physique - Baies ferm\u00e9es - D\u00e9sactivation du boot USB</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#2-couche-2-liaison-de-donnees","title":"2. Couche 2 \u2013 Liaison de donn\u00e9es","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#arp-spoofing-arp-poisoning","title":"ARP Spoofing / ARP Poisoning","text":"<p>Traduction : Usurpation / empoisonnement ARP</p> <p>Principe : L\u2019attaquant se fait passer pour la passerelle afin d\u2019intercepter le trafic r\u00e9seau local.</p> <p>Cons\u00e9quences : - Man\u2011In\u2011The\u2011Middle local - Interception d\u2019identifiants (confidentialit\u00e9) - Modification du trafic (int\u00e9grit\u00e9) - D\u00e9ni de service local (Disponibilit\u00e9)</p> <p>Contre-mesures : - Switchs manag\u00e9s   - Dynamic ARP Inspection (DAI)   - DHCP Snooping - VLAN : Segmentation du r\u00e9seau - VLAN isol\u00e9s / Private VLAN     - Emp\u00eache la communication directe entre postes d\u2019un m\u00eame VLAN  - Port Security    - Limitation du nombre d\u2019adresses MAC par port - Filtrage ARP statique (r\u00e9seaux tr\u00e8s restreints)</p> <p>L\u2019ARP spoofing est une attaque locale : la meilleure d\u00e9fense est la segmentation et l\u2019isolation r\u00e9seau, pas uniquement le chiffrement.</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#mac-flooding","title":"MAC Flooding","text":"<p>Traduction : Saturation de table MAC</p> <p>Principe : Inondation du switch avec de fausses adresses MAC pour le forcer \u00e0 diffuser les trames.</p> <p>Contre-mesures : - Port Security - Limitation du nombre de MAC par port</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#attaques-dhcp","title":"Attaques DHCP","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#dhcp-starvation","title":"DHCP Starvation","text":"<p>Traduction : \u00c9puisement du serveur DHCP  </p> <p>Couche OSI : 2 / 3  </p>"},{"location":"cours/06-Cybersecurite/cybersecu/#principe","title":"Principe","text":"<p>L\u2019attaquant envoie un grand nombre de requ\u00eates DHCP avec des adresses MAC falsifi\u00e9es afin d\u2019\u00e9puiser le pool d\u2019adresses IP du serveur DHCP.</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#consequences","title":"Cons\u00e9quences","text":"<ul> <li>Plus aucune adresse IP disponible</li> <li>D\u00e9ni de service r\u00e9seau (DoS)</li> <li>Nouveaux postes incapables de se connecter</li> </ul>"},{"location":"cours/06-Cybersecurite/cybersecu/#dhcp-spoofing-dhcp-rogue","title":"DHCP Spoofing (DHCP Rogue)","text":"<p>Traduction : Usurpation de serveur DHCP  </p> <p>Principe Apr\u00e8s une attaque de starvation, l\u2019attaquant met en place un faux serveur DHCP qui fournit : - une fausse passerelle - un faux DNS</p> <p>Permet ensuite des attaques MITM ou DNS spoofing.</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#contremesures","title":"Contre\u2011mesures","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#mesures-reseau-essentielles","title":"Mesures r\u00e9seau (essentielles)","text":"<ul> <li>Switchs manag\u00e9s</li> <li>DHCP Snooping<ul> <li>Ports trusted (serveur DHCP)</li> <li>Ports untrusted (clients)</li> </ul> </li> <li>Rate limiting DHCP</li> <li>Port Security</li> <li>Limitation du nombre de MAC par port</li> <li>VLAN / VLAN isol\u00e9s</li> <li>Limiter la propagation de l\u2019attaque</li> </ul>"},{"location":"cours/06-Cybersecurite/cybersecu/#mesures-serveur","title":"Mesures serveur","text":"<ul> <li>Pool DHCP dimensionn\u00e9 correctement</li> <li>Dur\u00e9e de bail adapt\u00e9e</li> <li>Supervision du serveur DHCP</li> </ul>"},{"location":"cours/06-Cybersecurite/cybersecu/#mesures-complementaires","title":"Mesures compl\u00e9mentaires","text":"<ul> <li>IP statiques pour \u00e9quipements critiques</li> <li>IDS/IPS r\u00e9seau</li> <li>Segmentation Wi\u2011Fi (invit\u00e9s / internes)</li> </ul>"},{"location":"cours/06-Cybersecurite/cybersecu/#risque-de-confusion","title":"Risque de confusion","text":"Attaque Principe Port\u00e9e Dangerosit\u00e9 DHCP Spoofing Falsification de r\u00e9ponses DHCP Cibl\u00e9e Moyenne DHCP Rogue Faux serveur DHCP complet R\u00e9seau entier \u00c9lev\u00e9e <p>Le DHCP est un service critique mais non s\u00e9curis\u00e9 par d\u00e9faut. Sans contr\u00f4le au niveau des switchs, il est vuln\u00e9rable aux attaques locales. L'isolation est donc indispensable pour limiter la surface d'attaque.</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#3-couche-3-reseau","title":"3. Couche 3 \u2013 R\u00e9seau","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#ip-spoofing","title":"IP Spoofing","text":"<p>Traduction : Usurpation d\u2019adresse IP</p> <p>Principe : L\u2019attaquant falsifie l\u2019adresse IP source des paquets.</p> <p>Contre-mesures : - Filtrage anti-spoofing - Firewall - Segmentation r\u00e9seau</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#icmp-flood","title":"ICMP Flood","text":"<p>Traduction : Attaque par saturation ICMP</p> <p>Principe : Envoi massif de requ\u00eates ICMP (ping) pour saturer la cible.</p> <p>Contre-mesures : - Rate limiting - Filtrage ICMP</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#4-couche-4-transport","title":"4. Couche 4 \u2013 Transport","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#syn-flood","title":"SYN Flood","text":"<p>Traduction : Attaque par saturation SYN</p> <p>Principe : L\u2019attaquant envoie de nombreuses requ\u00eates TCP SYN sans terminer la connexion (n'envoi pas le ACK en r\u00e9ponse au SYN du serveur).</p> <p>Cons\u00e9quences : - D\u00e9ni de service (DoS)</p> <p>Contre-mesures : - SYN cookies - Firewall - Load balancer</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#udp-flood","title":"UDP Flood","text":"<p>Traduction : Attaque par saturation UDP</p> <p>Principe : Envoi massif de paquets UDP vers la cible.</p> <p>Contre-mesures : - Filtrage - Rate limiting</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#5-couche-5-session","title":"5. Couche 5 \u2013 Session","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#session-hijacking","title":"Session Hijacking","text":"<p>Traduction : D\u00e9tournement de session</p> <p>Principe : Vol ou r\u00e9utilisation d\u2019un identifiant de session valide.</p> <p>Contre-mesures : - HTTPS - Cookies s\u00e9curis\u00e9s (<code>HttpOnly</code>, <code>Secure</code>) - Timeout de session</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#ssl-stripping","title":"SSL Stripping","text":"<p>Traduction : Suppression du chiffrement SSL</p> <p>Principe : Forcer l\u2019utilisateur \u00e0 rester en HTTP au lieu de HTTPS.</p> <p>Contre-mesures : - HTTPS - HSTS</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#7-couche-7-application","title":"7. Couche 7 \u2013 Application","text":""},{"location":"cours/06-Cybersecurite/cybersecu/#sql-injection-sqli","title":"SQL Injection (SQLi)","text":"<p>Traduction : Injection SQL</p> <p>Principe : Injection de requ\u00eates SQL malveillantes via les entr\u00e9es utilisateur.</p> <p>Contre-mesures : - Requ\u00eates pr\u00e9par\u00e9es - Validation des entr\u00e9es</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#cross-site-scripting-xss","title":"Cross-Site Scripting (XSS)","text":"<p>Traduction : Injection de script c\u00f4t\u00e9 client</p> <p>Principe : Injection de code JavaScript malveillant dans une page web.</p> <p>Contre-mesures : - Encodage des sorties - Content-Security-Policy (CSP)</p>"},{"location":"cours/06-Cybersecurite/cybersecu/#cross-site-request-forgery-csrf","title":"Cross-Site Request Forgery (CSRF)","text":"<p>Traduction : Falsification de requ\u00eates inter-sites</p> <p>Principe : Forcer un utilisateur authentifi\u00e9 \u00e0 ex\u00e9cuter une action \u00e0 son insu.</p> <p>Contre-mesures : - Token CSRF - V\u00e9rification de l\u2019origine</p>"},{"location":"infrastructure/01-introduction/","title":"Introduction sur l'infrastructure","text":""},{"location":"infrastructure/01-introduction/#dossier-technique-de-linfrastructure-du-reseau-sportludique","title":"Dossier technique de l\u2019infrastructure du r\u00e9seau SportLudique","text":""},{"location":"infrastructure/01-introduction/#lycee-fulbert-chartres-2025-2026","title":"Lyc\u00e9e Fulbert Chartres 2025-2026","text":"<p>Auteur : Ludovic MERY</p>"},{"location":"infrastructure/01-introduction/#introduction","title":"Introduction\u00a0:","text":"<p>Les Actions Professionnelles (AP) seront d\u00e9velopp\u00e9es autour du contexte SportLudique. Cet environnement permettra \u00e0 l\u2019\u00e9tudiant de r\u00e9aliser un ensemble de projets autour de diff\u00e9rentes situations professionnelles (les missions) et acqu\u00e9rir ainsi les comp\u00e9tences en conformit\u00e9 avec le r\u00e9f\u00e9rentiel.</p>"},{"location":"infrastructure/01-introduction/#rappel-du-contexte","title":"Rappel du contexte\u00a0:","text":"<p>SportLudique est une soci\u00e9t\u00e9 bas\u00e9e sur 4 sites distants Chartres, Tours, Orl\u00e9ans et Bourges. Elle est sp\u00e9cialis\u00e9e dans la conception et la production d\u2019articles de sports non conventionnels.</p> <p>L\u2019infrastructure informatique et r\u00e9seau est prise en charge par le d\u00e9partement \"Solutions d\u2019Infrastructure Syst\u00e8me et R\u00e9seau\" (SISR) qui se charge de l\u2019exploitation de l\u2019ensemble des \u00e9quipements du parc ainsi que de la r\u00e9alisation des projets informatiques.</p> <p>La DSI d\u00e9l\u00e8gue les taches techniques de r\u00e9alisation, d\u00e9ploiement, maintenance et support \u00e0 son prestataire ma\u00eetre d\u2019\u0153uvre autour d\u2019un contrat de service dans lequel il assure la ma\u00eetrise d\u2019ouvrage.</p>"},{"location":"infrastructure/01-introduction/#presentation-generale-de-linfrastructure","title":"Pr\u00e9sentation G\u00e9n\u00e9rale de l\u2019infrastructure :","text":"<p>L\u2019infrastructure est d\u00e9coup\u00e9e en 3 parties comprenant le si\u00e8ge ainsi que les diff\u00e9rents sites distants et le r\u00e9seau d\u2019acc\u00e8s \u00e0 Internet. La DSI est responsable de l\u2019administration de l\u2019infrastructure, de la fourniture de services et de la s\u00e9curisation des donn\u00e9es en d\u00e9l\u00e9guant ces t\u00e2ches \u00e0 son prestataire homologu\u00e9 qui est le ma\u00eetre d\u2019\u0153uvre pour la r\u00e9alisation des op\u00e9rations d\u2019administration du syst\u00e8me d\u2019information de SportLudique.</p> <p>Le service Informatique de SportLudique est charg\u00e9 de la mise en \u0153uvre et de la gestion de l\u2019ensemble des projets relatifs au parc informatique de l\u2019entreprise. Il agit en tant que prestataire \u00e0 travers des contrats de service pour les diff\u00e9rents sites distants. Chaque site dispose de sa propre infrastructure et utilise un domaine de type :</p> <pre><code>   &lt;nomville&gt;.sportludique.fr.\n</code></pre> <p>Un Controlleur de domaine disposant d'un service d\u2019annuaire Active Directory assure la gestion et l\u2019administration du r\u00e9seau.</p> <ul> <li>Les serveurs publics situ\u00e9s en DMZ doivent \u00eatre accessibles sous la forme :</li> </ul> <pre><code>&lt;codeservice&gt;.&lt;ville&gt;.sportludique.fr\n</code></pre> Remarque <p>codeservice correspond au protocole ou \u00e0 la convention associ\u00e9. Exemple:  www   --&gt;  pour un serveur http/https  ns --&gt; pour un serveur DNS  smtp --&gt; Pour un serveur d'envoi de mail (messagerie) </p> <p>Pour la partie LAN, il est n\u00e9cessaire de d\u00e9finir une d\u00e9l\u00e9gation DNS interne sp\u00e9cifique \u00e0 chaque site.</p> <p>Exemple d\u2019approche d\u00e9j\u00e0 utilis\u00e9e au sein de la section SIO du lyc\u00e9e Fulbert:  </p> <pre><code>lan.sio.lyceefulbert.fr\n</code></pre>"},{"location":"infrastructure/01-introduction/#bonnes-pratiques-dns-et-recommandations","title":"Bonnes pratiques DNS et recommandations","text":"<p>Pour les domaines internes Active Directory, l\u2019ancienne pratique courante consistait \u00e0 utiliser un TLD (Top Level Domain) invent\u00e9 (ex. : ville.local ou entreprise.local). --&gt; TLD invent\u00e9: local</p> <p>Attention</p> <p>Ce n\u2019est plus recommand\u00e9 car .local est r\u00e9serv\u00e9 par RFC 6762 pour mDNS (Multicast DNS), ce qui entra\u00eene des conflits avec macOS, Linux et certains services modernes.</p> <p>Aujourd\u2019hui, les bonnes pratiques Microsoft et celles de l\u2019IETF recommandent :</p> <ul> <li>Utiliser un pr\u00e9fixe r\u00e9serv\u00e9 \u00e0 l\u2019interne (ex. : intranet.ville.sportludique.fr, lan.ville.sportludique.fr etc...) : ce sous-domaine n\u2019existe que dans le DNS interne et est inaccessible depuis Internet. Pensez au domaine public comme \u00e0 une vitrine visible par tout le monde, et au domaine interne comme \u00e0 une pi\u00e8ce ferm\u00e9e derri\u00e8re cette vitrine. Tout ce qui se trouve dans la pi\u00e8ce interne reste priv\u00e9 et s\u00e9curis\u00e9, m\u00eame si le nom est similaire \u00e0 celui de la vitrine.</li> </ul> <p>Microsoft pr\u00e9cise bien que le FQDN interne doit \u00eatre routable et enregistr\u00e9 dans un domaine poss\u00e9d\u00e9 par l\u2019entreprise afin d\u2019\u00e9viter les probl\u00e8mes de certificats, d\u2019authentification Kerberos et d\u2019int\u00e9gration avec Azure/Office365.</p>"},{"location":"infrastructure/01-introduction/#problematique-de-nommage-ad-et-netbios-et-delegation-dns","title":"Probl\u00e9matique de nommage AD et NetBIOS et d\u00e9l\u00e9gation DNS","text":"<p>L\u2019infrastructure DNS de SportLudique est organis\u00e9e de mani\u00e8re hi\u00e9rarchique : - La zone principale <code>sportludique.fr</code> est g\u00e9r\u00e9e par votre enseignant. - Chaque ville dispose d\u2019une sous-zone d\u00e9l\u00e9gu\u00e9e : <pre><code>  - bourges.sportludique.fr  \n  - chartres.sportludique.fr  \n  - orleans.sportludique.fr  \n  - tours.sportludique.fr  \n</code></pre></p> <p>\u00c0 l\u2019int\u00e9rieur de chaque sous-zone, les \u00e9tudiants doivent cr\u00e9er leur domaine Active Directory.  </p> <p>Attention</p> <p>Probl\u00e8me : le nom du domaine AD d\u00e9termine automatiquement un nom NetBIOS (15 caract\u00e8res maximum, d\u00e9riv\u00e9 du label le plus \u00e0 gauche). Si tout le monde cr\u00e9e un domaine du type <code>lan.&lt;ville&gt;.sportludique.fr</code>, le NetBIOS sera toujours <code>LAN</code>, entra\u00eenant des confusions lors des ouvertures de session (<code>LAN\\user</code>).</p> <p>Pour \u00e9viter cela, nous imposons un sch\u00e9ma de nommage qui int\u00e8gre un pr\u00e9fixe unique par ville directement dans le nom DNS du domaine. Ainsi, le nom NetBIOS refl\u00e8te aussi la ville concern\u00e9e, ce qui permet une identification rapide et sans ambigu\u00eft\u00e9.</p>"},{"location":"infrastructure/01-introduction/#noms-de-zones-dns-a-utiliser-pour-la-promotion-des-controleurs-de-domaine","title":"Noms de zones DNS \u00e0 utiliser pour la promotion des contr\u00f4leurs de domaine","text":"Ville Nom de zone DNS interne NetBIOS Chartres cha.chartres.sportludique.fr CHA Orl\u00e9ans orl.orleans.sportludique.fr ORL Tours trs.tours.sportludique.fr TRS Bourges brg.bourges.sportludique.fr BRG <pre><code>sportludique.fr  (zone principale publique, g\u00e9r\u00e9e par vos profs)\n\u2502\n\u251c\u2500\u2500 chartres.sportludique.fr  (sous-zone d\u00e9l\u00e9gu\u00e9e)\n\u2502   \u2514\u2500\u2500 cha.chartres.sportludique.fr  (domaine AD interne)\n\u2502       \u2514\u2500 NetBIOS = CHA\n\u2502\n\u251c\u2500\u2500 orleans.sportludique.fr  (sous-zone d\u00e9l\u00e9gu\u00e9e)\n\u2502   \u2514\u2500\u2500 orl.orleans.sportludique.fr  (domaine AD interne)\n\u2502       \u2514\u2500 NetBIOS = ORL\n\u2502\n\u2514\u2500\u2500 tours.sportludique.fr  (sous-zone d\u00e9l\u00e9gu\u00e9e)\n\u2502    \u2514\u2500\u2500 trs.tours.sportludique.fr  (domaine AD interne)\n\u2502        \u2514\u2500 NetBIOS = TRS\n\u2502\n\u251c\u2500\u2500 bourges.sportludique.fr  (sous-zone d\u00e9l\u00e9gu\u00e9e)\n\u2502   \u2514\u2500\u2500 brg.bourges.sportludique.fr  (domaine AD interne)\n\u2502       \u2514\u2500 NetBIOS = BRG\n</code></pre>"},{"location":"infrastructure/01-introduction/#gestion-du-dns","title":"Gestion du DNS","text":"<p>Le nom de domaine sportludique.fr a \u00e9t\u00e9 r\u00e9serv\u00e9 aupr\u00e8s de l\u2019AFNIC et le bureau d\u2019enregistrement (registar) g\u00e9rant ce nom de domaine est nordnet (en r\u00e9alit\u00e9 il est g\u00e9r\u00e9 par l\u2019enseignant M MERY et n'est donc pas accessible sur le web de chez vous, il le sera via l'utilisation d'un VPN mis \u00e0 disposition par votre enseignant).</p>"},{"location":"infrastructure/01-introduction/#whois","title":"WHOIS","text":"<p>Le nom de domaine \"sportludique.fr\" est d\u00e9j\u00e0 d\u00e9pos\u00e9.</p> <p>R\u00e9sultat de votre recherche</p> <ul> <li> <p>Nom de domaine :\u00a0sportludique.fr</p> </li> <li> <p>\u00c9tat :\u00a0Actif</p> </li> <li> <p>DNSSEC :\u00a0inactif</p> </li> <li> <p>**Bureau d'enregistrement     &gt; :\u00a0NORDNET</p> </li> <li> <p>Date de cr\u00e9ation :\u00a029 mai 2020 17:37</p> </li> <li> <p>Date d'expiration :\u00a029 mai 2030 17:37</p> </li> <li> <p>Serveurs de noms (DNS)</p> <ul> <li> <p>Serveur n\u00b0 1:\u00a0ns2.lerelaisinternet.com</p> </li> <li> <p>Serveur n\u00b0 2:\u00a0ns1.lerelaisinternet.com</p> </li> </ul> </li> </ul>"},{"location":"infrastructure/02-serveurs/","title":"Liste des serveurs et services","text":""},{"location":"infrastructure/02-serveurs/#liste-des-serveurs-obligatoires-pour-lexamen","title":"Liste des serveurs obligatoires pour l'examen:","text":"<p>Les machines virtuelles \u00e0 cr\u00e9er et \u00e0 h\u00e9berger sur la ferme de serveur sur chaque site (donc dans chaque VLAN d\u2019\u00eelot) :</p>"},{"location":"infrastructure/02-serveurs/#controleurs-de-domaine","title":"Contr\u00f4leurs de domaine","text":"<ul> <li>Contr\u00f4leur de domaine AD-DC</li> <li>Service DNS</li> <li>Service DHCP</li> </ul> <p>Dans le cadre de la gestion de l'infrastructure informatique, la mise en place de contr\u00f4leurs de domaine est cruciale pour assurer l'administration centralis\u00e9e et s\u00e9curis\u00e9e des ressources du r\u00e9seau. Il existe deux types principaux de contr\u00f4leurs de domaine : le contr\u00f4leur de domaine principal et le contr\u00f4leur de domaine secondaire.</p>"},{"location":"infrastructure/02-serveurs/#controleur-de-domaine-principal","title":"Contr\u00f4leur de domaine principal","text":"<p>Le contr\u00f4leur de domaine principal, \u00e9galement appel\u00e9 PDC (Primary Domain Controller), occupe une place centrale dans l'architecture du domaine. Il est responsable de la gestion des op\u00e9rations de base li\u00e9es \u00e0 l'authentification des utilisateurs, \u00e0 l'autorisation d'acc\u00e8s aux ressources et \u00e0 la gestion des politiques de s\u00e9curit\u00e9. En cas de modification des informations du domaine, le contr\u00f4leur de domaine principal est le point de r\u00e9f\u00e9rence.</p>"},{"location":"infrastructure/02-serveurs/#controleur-de-domaine-secondaire","title":"Contr\u00f4leur de domaine secondaire","text":"<p>Les contr\u00f4leurs de domaine secondaires, ou BDC (Backup Domain Controllers), jouent un r\u00f4le de sauvegarde et de r\u00e9partition de la charge par rapport au contr\u00f4leur de domaine principal. Ils reproduisent les informations du contr\u00f4leur de domaine principal pour garantir une redondance et une disponibilit\u00e9 \u00e9lev\u00e9es. En cas de panne du contr\u00f4leur de domaine principal, les contr\u00f4leurs de domaine secondaires peuvent prendre en charge les op\u00e9rations critiques, \u00e9vitant ainsi une interruption majeure des services.</p> <p>Il est important de noter que la mise en place d'un contr\u00f4leur de domaine principal et de contr\u00f4leurs de domaine secondaires permet une gestion fiable et s\u00e9curis\u00e9e de l'annuaire, des comptes d'utilisateurs et des strat\u00e9gies de groupe. Cette architecture renforce la disponibilit\u00e9 des services et facilite la gestion du r\u00e9seau, tout en minimisant les risques de perte de donn\u00e9es et de temps d'arr\u00eat.</p> <p>La combinaison d'un contr\u00f4leur de domaine principal et de contr\u00f4leurs de domaine secondaires constitue un \u00e9l\u00e9ment cl\u00e9 de la gestion de l'infrastructure d'un r\u00e9seau, qu'il soit de petite ou de grande taille.</p>"},{"location":"infrastructure/02-serveurs/#un-serveur-de-deploiement-dimage-de-stations-de-travail","title":"Un serveur de d\u00e9ploiement d\u2019image de stations de travail","text":"<p>- Au choix parmi les solutions suivantes\u00a0\u00e0 documenter (gestion du multicast):</p> <ul> <li>ServeurMicrosoft WDS</li> <li>Serveur FOG</li> <li>Serveur CloneZilla</li> </ul> D\u00e9finition <p>Le multicast en informatique est une m\u00e9thode de communication r\u00e9seau o\u00f9 un exp\u00e9diteur envoie des donn\u00e9es \u00e0 un groupe sp\u00e9cifique de destinataires plut\u00f4t qu'\u00e0 tous les n\u0153uds du r\u00e9seau (broadcast). Cela permet d'\u00e9conomiser la bande passante en envoyant une seule copie des donn\u00e9es aux membres du groupe int\u00e9ress\u00e9s, au lieu de multiplier les envois comme dans les envois en unicast. Le multicast est couramment utilis\u00e9 pour la diffusion de contenu en streaming, les mises \u00e0 jour de logiciels et d'autres applications n\u00e9cessitant la transmission d'informations \u00e0 un groupe cibl\u00e9. C'est la solution utilis\u00e9 pour d\u00e9ployer vos poste de travail en d\u00e9but d'ann\u00e9e (via le boot PXE au demarrage de la machine physique).</p>"},{"location":"infrastructure/02-serveurs/#un-logiciel-de-bonne-pratiques-itil","title":"Un logiciel de bonne pratiques ITIL","text":""},{"location":"infrastructure/02-serveurs/#utilisation-de-logiciels-conformes-aux-bonnes-pratiques-itil","title":"Utilisation de logiciels conformes aux bonnes pratiques ITIL","text":"<p>Dans le cadre de l'alignement sur les meilleures pratiques de gestion des services informatiques ITIL (Information Technology Infrastructure Library), l'utilisation de certains logiciels sp\u00e9cifiques peut grandement faciliter la gestion et l'organisation des processus IT.</p>"},{"location":"infrastructure/02-serveurs/#gestion-de-parc-informatique-et-incidents","title":"Gestion de parc informatique et incidents","text":"<p>Pour la gestion efficace du parc informatique et le suivi des incidents, l'outil GLPI associ\u00e9 \u00e0 Fusion Inventory s'av\u00e8re tr\u00e8s utile. Ces solutions permettent de cr\u00e9er un inventaire pr\u00e9cis des \u00e9quipements, de g\u00e9rer les tickets d'incidents et de fournir une vue globale des ressources informatiques.</p>"},{"location":"infrastructure/02-serveurs/#gestion-des-configurations-et-des-outils-associes","title":"Gestion des configurations et des outils associ\u00e9s","text":"<p>La gestion des configurations est un \u00e9l\u00e9ment fondamental pour maintenir une infrastructure informatique coh\u00e9rente et conforme aux bonnes pratiques ITIL. Les outils suivants jouent un r\u00f4le cl\u00e9 dans ce processus :</p>"},{"location":"infrastructure/02-serveurs/#outils-de-gestion-des-configurations","title":"Outils de gestion des configurations","text":"<p>Deux outils largement adopt\u00e9s et conformes aux bonnes pratiques ITIL sont Ansible et Puppet. Ils automatisent le d\u00e9ploiement, la configuration et la gestion des syst\u00e8mes et des applications. Ces outils vous permettent de garantir la coh\u00e9rence et la conformit\u00e9 des configurations tout en simplifiant l'administration.</p> <p>Dans les environnements Windows, l'utilisation de GPO (Group Policy Objects) est courante pour d\u00e9finir et g\u00e9rer les politiques de s\u00e9curit\u00e9 et de configuration. Par ailleurs, GLPI peut \u00eatre utilis\u00e9 comme service de d\u00e9ploiement de logiciels. Pour les environnements Microsoft, l'outil chocolatey simplifie le processus de gestion et de d\u00e9ploiement des logiciels.</p>"},{"location":"infrastructure/02-serveurs/#un-service-de-proxy-filtrant-implementation-au-choix-apres-etudes-des-possibilites","title":"Un service de Proxy filtrant (impl\u00e9mentation au choix apr\u00e8s \u00e9tudes des possibilit\u00e9s)","text":"<ul> <li>Proxy filtrant\u00a0: (Exemple SquidGuard)</li> <li>Authentification transparente et tra\u00e7abilit\u00e9 des acc\u00e8s dans un serveur de logs</li> <li>Possibilit\u00e9 d'utiliser le service correspondant d'un parefeux UTM</li> </ul> D\u00e9finition <p>Un pare-feu UTM (Unified Threat Management) est une solution de s\u00e9curit\u00e9 r\u00e9seau int\u00e9gr\u00e9e qui combine plusieurs fonctionnalit\u00e9s de s\u00e9curit\u00e9 au sein d'un seul appareil. Contrairement aux pare-feux traditionnels qui se concentrent principalement sur le filtrage de paquets \u00e0 la couche 3 et 4, les pare-feux UTM offrent une protection plus compl\u00e8te en int\u00e9grant diverses capacit\u00e9s de s\u00e9curit\u00e9 au sein d'une seule plateforme. Voici les principales caract\u00e9ristiques et fonctionnalit\u00e9s d'un pare-feu UTM :</p> <ul> <li> <p>Filtrage des paquets traditionnel : Comme les pare-feux classiques, les UTM assurent le filtrage des paquets en fonction des adresses IP sources et de destination, ainsi que des ports utilis\u00e9s.</p> </li> <li> <p>Protection antivirus et antimalware : Les pare-feux UTM int\u00e8grent des moteurs antivirus et antimalware pour d\u00e9tecter et bloquer les logiciels malveillants et les virus dans le trafic r\u00e9seau.</p> </li> <li> <p>Filtrage d'URL et de contenu : Ils peuvent filtrer le trafic Web en fonction de cat\u00e9gories d'URL pour emp\u00eacher l'acc\u00e8s \u00e0 des sites malveillants, inappropri\u00e9s ou non conformes. (Pornographie, jeux en ligne, racisme etc...)</p> </li> <li> <p>Pr\u00e9vention des intrusions (IPS) : Les UTM surveillent le trafic r\u00e9seau pour d\u00e9tecter les tentatives d'intrusion et les activit\u00e9s suspectes, puis prennent des mesures pour les bloquer.</p> </li> <li> <p>Filtrage d'email et de spam : Ils incluent des fonctionnalit\u00e9s de filtrage d'email pour bloquer les courriers ind\u00e9sirables, les spams et les attaques par email.</p> </li> <li> <p>VPN (Virtual Private Network) : Ils offrent des capacit\u00e9s VPN pour \u00e9tablir des connexions s\u00e9curis\u00e9es entre diff\u00e9rents sites ou utilisateurs distants.</p> </li> <li> <p>Journalisation et rapports : Les UTM offrent des fonctionnalit\u00e9s de journalisation d\u00e9taill\u00e9e et de cr\u00e9ation de rapports pour aider \u00e0 surveiller l'activit\u00e9 du r\u00e9seau et \u00e0 identifier les menaces potentielles.</p> </li> <li> <p>Gestion centralis\u00e9e : Souvent, les pare-feux UTM peuvent \u00eatre g\u00e9r\u00e9s de mani\u00e8re centralis\u00e9e, ce qui facilite la configuration, la surveillance et la gestion de plusieurs appareils.</p> </li> </ul>"},{"location":"infrastructure/02-serveurs/#un-serveur-de-centralisation-des-evennements-ou-un-siem","title":"Un serveur de centralisation des \u00e9vennements ou un SIEM","text":"<p>Serveur de log</p> <p>Serveur de log (syslog) : Un serveur de logs est un syst\u00e8me qui collecte, stocke et g\u00e8re les logs (journaux) g\u00e9n\u00e9r\u00e9s par divers dispositifs, applications et syst\u00e8mes au sein d'un r\u00e9seau informatique. Les logs peuvent inclure des informations sur les activit\u00e9s, les erreurs, les \u00e9v\u00e9nements et les incidents qui se produisent dans l'environnement informatique. Le principal objectif d'un serveur de logs est de centraliser ces donn\u00e9es pour une surveillance ult\u00e9rieure, la recherche de probl\u00e8mes et la conformit\u00e9 r\u00e9glementaire.  Cependant, les serveurs de logs ne sont pas toujours \u00e9quip\u00e9s d'outils avanc\u00e9s d'analyse ou de corr\u00e9lation des donn\u00e9es.</p> <p>SIEM</p> <p>SIEM (Security Information and Event Management) : Un SIEM est une solution plus avanc\u00e9e qui va au-del\u00e0 de la simple collecte de logs. Il int\u00e8gre la collecte, la corr\u00e9lation, l'analyse et la visualisation des donn\u00e9es de s\u00e9curit\u00e9 \u00e0 partir de diverses sources, telles que les serveurs, les r\u00e9seaux, les applications et les syst\u00e8mes. Les SIEM identifient les sch\u00e9mas et les anomalies dans les \u00e9v\u00e9nements pour d\u00e9tecter les menaces potentielles ou les incidents de s\u00e9curit\u00e9.</p>"},{"location":"infrastructure/02-serveurs/#un-serveur-de-supervision-implementation-au-choix-apres-etudes-des-possibilites","title":"Un serveur de supervision (impl\u00e9mentation au choix apr\u00e8s \u00e9tudes des possibilit\u00e9s)","text":"<p>- A choisir parmis les solutions suivantes:</p> <ul> <li>PRTG (windows)</li> <li>Zabbix</li> <li>Centreon</li> <li>Autre solution pertinente possible non test\u00e9 (Promteus / Grafana)</li> </ul>"},{"location":"infrastructure/02-serveurs/#services-web","title":"Services Web","text":"<p>Serveurs h\u00e9berg\u00e9s dans la DMZ de chaque site \u00e0 isoler et \u00e0 prot\u00e9ger via une parefeux. On montera chaque service de la DMZ dans l\u2019une ou l\u2019autre des technologies \u00e0 savoir Windows et Linux. Les deux technologies doivent \u00eatre maitris\u00e9es (administration syst\u00e8me windows ET linux)</p> <ul> <li>Possibit\u00e9 de mettre en place un ReverseProxy afin de partager l'IP Publique unique disponible entre plusieurs serveurs priv\u00e9.</li> <li>Mise en place de services web obligatoirement chiffr\u00e9 via technologie TLS</li> <li>Serveur de partage de fichiers pour le t\u00e9l\u00e9chargement de documents mis en ligne supportant de multiples protocoles et necessitant une authentification des utilisateurs (type Intranet). A vous de proposer une solution technique coh\u00e9rente.</li> <li>Haute disponibilit\u00e9 des services (High Availability)</li> <li>R\u00e9partition de charge (Load Balancing)</li> </ul> D\u00e9finition <p>High Availability : La haute disponibilit\u00e9 des services, souvent d\u00e9sign\u00e9e par l'anglais \"High Availability\" (HA), est un concept et une approche de conception qui vise \u00e0 garantir un niveau \u00e9lev\u00e9 de continuit\u00e9 et de disponibilit\u00e9 des services informatiques. L'objectif principal de la haute disponibilit\u00e9 est d'assurer que les syst\u00e8mes, applications et services critiques sont accessibles et fonctionnels en permanence, m\u00eame en cas de d\u00e9faillance mat\u00e9rielle, logicielle ou de tout autre probl\u00e8me.</p> D\u00e9finition <p>Load Balancing : La r\u00e9partition de charge, \u00e9galement appel\u00e9e \"load balancing\" en anglais, est une technique utilis\u00e9e pour distribuer \u00e9quitablement la charge de travail et le trafic r\u00e9seau entre plusieurs ressources, telles que des serveurs, des machines virtuelles ou des n\u0153uds de r\u00e9seau. L'objectif principal de la r\u00e9partition de charge est d'optimiser les performances, d'assurer une utilisation \u00e9quilibr\u00e9e des ressources et de garantir une disponibilit\u00e9 \u00e9lev\u00e9e des services.</p>"},{"location":"infrastructure/02-serveurs/#services-de-base-de-donnees","title":"Services de base de donn\u00e9es","text":"<p>Pour assurer le bon fonctionnement des diff\u00e9rentes applications (web ou autres), il sera n\u00e9cessaire de mettre en place un ou plusieurs serveurs de base de donn\u00e9es. Ces serveurs joueront un r\u00f4le central dans le syst\u00e8me d'information (SI) de l'organisation. Ils devront \u00eatre soigneusement s\u00e9curis\u00e9s et maintenus \u00e0 l'int\u00e9rieur du r\u00e9seau, sans exposition directe \u00e0 l'ext\u00e9rieur. Pour cela, nous aurons le choix entre plusieurs options : utiliser MariaDB ou PostgreSQL sous Linux pour une approche open source, ou opter pour SQL Server chez Microsoft Windows.</p>"},{"location":"infrastructure/02-serveurs/#service-de-messagerie","title":"Service de messagerie","text":"<p>La communication au sein de l'entreprise est essentielle, et pour cela, un serveur de messagerie sera mis en place. Ce serveur devra prendre en charge les bo\u00eetes aux lettres des utilisateurs de chaque domaine, par exemple antoine.dupond@chartres.sportludique.fr. Pour cette t\u00e2che, nous utiliserons hMailServer sous Windows. Cependant, si un \u00e9tudiant souhaite s'investir davantage, des options plus avanc\u00e9es sont envisageables, telles que Microsoft Exchange ou une solution open source comme Zimbra (combinant Postfix et Dovecot). Quelle que soit la solution retenue, elle devra \u00eatre op\u00e9rationnelle afin de g\u00e9rer les notifications provenant des solutions de supervision et autres outils SIEM.</p>"},{"location":"infrastructure/02-serveurs/#bastion-dauthentification","title":"Bastion d'authentification","text":"<p>Pour s\u00e9curiser l'acc\u00e8s aux comptes privil\u00e9gi\u00e9s, la mise en place d'un bastion d'authentification est essentielle. Cet \u00e9l\u00e9ment central du syst\u00e8me garantira que les acc\u00e8s aux comptes \u00e0 haut niveau d'autorisation sont contr\u00f4l\u00e9s et surveill\u00e9s. Cette solution permet de garantir la tra\u00e7abilit\u00e9 des acc\u00e8s aux serveurs. \u00c0 cette fin, nous adopterons la solution leader du march\u00e9, \u00e0 savoir Wallix. </p>"},{"location":"infrastructure/03-infrastructure/","title":"Infrastructure","text":""},{"location":"infrastructure/03-infrastructure/#linfrastructure-reseau-du-lycee-fulbert-simulant-le-reseau-sportludique","title":"L\u2019Infrastructure r\u00e9seau du lyc\u00e9e Fulbert simulant le r\u00e9seau SportLudique","text":"<p>L\u2019infrastructure comporte plusieurs p\u00e9rim\u00e8tres de s\u00e9curit\u00e9. Les services de SportLudique sont organis\u00e9s en VLAN de niveau 1 (vlan par ports).</p> <p>Les machines h\u00f4tes utilisables par les \u00e9tudiants sont c\u00e2bl\u00e9es via des prises Ethernet murale de labo dont le num\u00e9ro est pair (2-4-6-8). Ces prises sont ensuite brass\u00e9es sur les \u00e9quipements dont vous avez la charge.</p> <p>Les prises impaires respectivement (1,3,5,7) ne doivent pas \u00eatre deconnect\u00e9s du Switch HP (ou Huawei) sur leur port respectif (1, 3, 5, 7) dans le vlan 117. On vous demande de ne pas modifier ces ports afin de revenir facilement dans une configuration classique pour l\u2019apprentissage et la connectivit\u00e9 au domaine lan.sio.lyceefulbert.fr</p> <p></p>"},{"location":"infrastructure/03-infrastructure/#schema-general","title":"Sch\u00e9ma general","text":""},{"location":"infrastructure/03-infrastructure/#etape-prealable-pour-travailler-sur-le-contexte-sportludique","title":"Etape pr\u00e9alable pour travailler sur le contexte SportLudique","text":"<p>Le VLAN 200 est le VLAN Labo pour toute la promotion des deuxi\u00e8mes ann\u00e9es SISR. Le VLAN 210 est le VLAN Labo de l\u2019\u00eelot 1. Le 220 celui de l\u2019 \u00eelot 2 etc\u2026</p> <p>Chaque site Chartres, Tours, Orl\u00e9ans et Bourges correspond \u00e0 un \u00eelot et poss\u00e8de donc son propre VLAN isol\u00e9 du reste du r\u00e9seau du Labo du lyc\u00e9e Fulbert.</p> <p>L'ensemble des machnies clientes (OS utilisateurs) se ferra via des machines virtuelles locales g\u00e9r\u00e9es via VirtualBox connect\u00e9 en mode bridge. La machine physique devra donc \u00eatre brass\u00e9 correctement sur vos \u00e9quipements, mais devra r\u00e9ster sur le domaine auquel elle a \u00e9t\u00e9 attribu\u00e9 en d\u00e9but d'ann\u00e9e.</p> <p>Ainsi \u00e0 chaque d\u00e9but de s\u00e9ance vous vous brasserez, apr\u00e8s avoir ouvert votre session windows, correctement sur votre infrastructure via une prise murale paire.</p> <p>Puis, \u00e0 chaque fin de s\u00e9ance vous v\u00e9rifierez que le poste est brass\u00e9 sur une prise impaire.</p>"},{"location":"infrastructure/03-infrastructure/#gestion-des-serveurs","title":"Gestion des serveurs","text":"<p>L'ensemble des serveurs n\u00e9cessaires \u00e0 vos infrastructure devront \u00eatre g\u00e9r\u00e9s via la solution d'hyperconvergence Nutanix mis \u00e0 disposition par vos enseignants, ainsi que sur un hyperviseur que vous devrez vous m\u00eame choisir et mettre en place sur un serveur d\u00e9di\u00e9 \u00e0 votre site. Chaque machine virtuelle devra poss\u00e9der un nom logique permettant de l'identifier sans ambiguit\u00e9. La solution Nutanix h\u00e9bergeant les VM de l'ensemble des sites (ainsi que celles de l'infrastructure du BTS), merci de r\u00e9specter la convention de nom suivante sous peine de suppression pure est simple de celle ci:</p>"},{"location":"infrastructure/03-infrastructure/#prefixe-a-utiliser-dans-les-noms-des-vm-sur-la-solution-nutanix","title":"Pr\u00e9fixe \u00e0 utiliser dans les noms des VM sur la solution Nutanix","text":"Ville Prefixe Chartres CHA Tours TRS Orl\u00e9ans ORL Bourges BRG"},{"location":"infrastructure/03-infrastructure/#gestion-de-la-configuration-materielle-dans-les-hyperviseurs","title":"Gestion de la configuration materielle dans les hyperviseurs","text":"<p>Les capacit\u00e9s physiques des serveurs qui h\u00e9bergent vos machines virtuelles ne sont pas infinies. Par cons\u00e9quent, il est crucial de proc\u00e9der \u00e0 un dimensionnement optimal lors de la cr\u00e9ation de vos machines virtuelles. Par exemple, il est recommand\u00e9 d'\u00e9viter d'allouer 16 Go de RAM \u00e0 une machine virtuelle Windows. En ce qui concerne l'espace disque, une capacit\u00e9 de 500 Go est g\u00e9n\u00e9ralement suffisante pour la plupart des cas d'utilisation, \u00e0 moins que les machines ne n\u00e9cessitent de fortes activit\u00e9s d'\u00e9criture sur le disque, telles que les syst\u00e8mes SIEM, les serveurs de journaux centralis\u00e9s, les bastions, et ainsi de suite.</p>"},{"location":"infrastructure/03-infrastructure/#gestion-de-votre-hyperviseur","title":"Gestion de votre hyperviseur","text":"<p>Chaque site disposera de son propre hyperviseur pour h\u00e9berger les serveurs secondaires ou non critiques. Chaque groupe devra choisir entre les solutions VMWare ESXi et Proxmox.</p> <p>Le mat\u00e9riel mis \u00e0 la disposition de chaque site se compose d'un switch et d'un serveur physique qui h\u00e9bergera l'hyperviseur. Le switch de votre site servira \u00e0 interconnecter votre hyperviseur \u00e0 vos r\u00e9seaux \u00e0 travers le switch de collecte g\u00e9r\u00e9 par vos enseignant. Il appartient \u00e0 chaque groupe de configurer int\u00e9gralement son serveur et son switch.</p> <p>Pour chaque site, le mat\u00e9riel mis \u00e0 disposition est organis\u00e9 comme suit : </p> <p>Le mat\u00e9riel de tous les sites \u00e9tant h\u00e9berg\u00e9 dans la m\u00eame baie informatique, l'acc\u00e8s au mat\u00e9riel sera r\u00e9gul\u00e9 pour des questions pratiques. Comme dans un datacenter, chaque groupe devra faire une demande au moins une heure avant \u00e0 un enseignant pour obtenir un cr\u00e9neau de 2h afin d'acc\u00e9der physiquement \u00e0 son mat\u00e9riel. L'acc\u00e8s ne sera accord\u00e9 qu'\u00e0 un groupe \u00e0 la fois, et chaque groupe ne pourra faire qu'une demande par journ\u00e9e. Un registre sera tenu \u00e0 jour \u00e0 des fins de tra\u00e7abilit\u00e9.</p>"},{"location":"infrastructure/03-infrastructure/#login-et-password-non-securise-a-posseder","title":"Login et password non s\u00e9curis\u00e9 \u00e0 poss\u00e9der","text":"Microsoft Windows administrateur / P@ssw0rd123456! Serveur nomuser / nomuser (g\u00e9r\u00e9 dans l\u2019annuaire AD) Stations Distribution linux prefix-admin /   P@ssw0rd123456! Switch / Routeurs admin / P@ssw0rd123456! Mode privil\u00e9gi\u00e9 (enable) P@ssw0rd123456! <p>prefix correspond \u00e0 TRS, BRG, CHA, ORL respectivement pour Tours, Bourges, Chartres et Orl\u00e9ans </p> <p>Il vous sera demand\u00e9 de cr\u00e9er d'autres comptes plus personnalis\u00e9s, qui seront par ailleurs g\u00e9r\u00e9s par un bastion d'acc\u00e8s. Ces comptes vous offriront un moyen d'acc\u00e9der \u00e0 votre infrastructure en cas de panne g\u00e9n\u00e9rale, ce qui les rend similaires \u00e0 des portes d\u00e9rob\u00e9es indispensables pour vos activit\u00e9s d'apprentissage. </p> <p>Attention</p> <p>D'autres comptes devront \u00eatre cr\u00e9\u00e9s et seront g\u00e9r\u00e9s par un bastion d'acc\u00e8s. Ces comptes vous permettront d'avoir un acc\u00e8s en cas de dysfonctionnement g\u00e9n\u00e9ral dans votre infrastructure. Ils peuvent \u00eatre consid\u00e9r\u00e9s comme une porte d\u00e9rob\u00e9e n\u00e9cessaire pour votre apprentissage. Cependant, ils ne doivent pas \u00eatre utilis\u00e9s en production normale.</p>"},{"location":"infrastructure/03-infrastructure/#linfrastructure-reseau","title":"L\u2019Infrastructure r\u00e9seau","text":"<p>La structure g\u00e9n\u00e9rale du r\u00e9seau comprend\u00a0:</p> <p>- Les sous r\u00e9seaux des sites distants</p> <p>- Les sous r\u00e9seaux des d\u00e9partements</p> <p>- Le r\u00e9seau Backbone</p> <p>- Le r\u00e9seau WIFI</p> <p>- La DMZ de chaque site g\u00e9ographique</p> <p>- Le r\u00e9seau d\u2019acc\u00e8s \u00e0 Internet</p> <p>Le r\u00e9seau sportLudique h\u00e9berge tous les serveurs dans une baie de serveurs install\u00e9e dans le service Informatique du d\u00e9partement R\u00e9seau. Les serveurs h\u00e9bergent les applications de gestion et de supervision du parc informatique.</p> <p>Le r\u00e9seau mobile WIFI permet de servir les postes nomades du personnel des diff\u00e9rents sites. Ce r\u00e9seau doit \u00eatre assez souple et adaptable pour fournir un acc\u00e8s \u00e0 Internet au public externe sans toutefois compromettre la s\u00e9curit\u00e9 du SI. </p>"},{"location":"infrastructure/03-infrastructure/#plan-dadressage-ip","title":"Plan d\u2019adressage IP","text":"<p>Le r\u00e9seau g\u00e9n\u00e9ral est construit autour de l\u2019adresse 172.28.0.0 avec un masque de 16 bits. Ceci permet de couvrir l\u2019ensemble du plan d\u2019adressage de l\u2019entreprise mais aussi pour les \u00e9volutions. L\u2019administrateur vous demande de r\u00e9fl\u00e9chir aux d\u00e9coupages en sous r\u00e9seau pour s\u00e9curiser les diff\u00e9rents services de chaque site. Le plan d\u2019adressage IP 192.168.x.0 /24 est attribu\u00e9 \u00e0 la DMZ de chaque site.</p> <p>Les tableaux en annexe \u00e0 compl\u00e9ter contiennent le plan d\u2019adressage IP de l\u2019ensemble du r\u00e9seau.  Ce plan d\u2019adressage tient compte d\u2019une exploitation des adresses IP en mode dynamique par 2 serveurs DHCP.</p> <p>La maintenance de ce plan d'adressage devra obligatoirement s'effectuer via la solution phpipam mis en place par votre enseignant (https://ipam.sio.lyceefulbert.fr)</p> <p>Un bloc d\u2019adresse est r\u00e9serv\u00e9 pour les \u00e9quipements en adressage fixe et ceci pour chaque sous r\u00e9seaux. Des r\u00e8gles d\u2019ing\u00e9nierie ont \u00e9t\u00e9 d\u00e9finies et imposent de placer les plages d\u2019adresses fixes sur les adresses les plus hautes de chaque sous r\u00e9seau.</p>"},{"location":"infrastructure/03-infrastructure/#les-elements-du-reseau","title":"Les \u00e9l\u00e9ments du r\u00e9seau","text":"<p>Ce r\u00e9seau regroupe les fonctions suivantes :</p> <p>- Une structure de VLAN de niveau 3 est utilis\u00e9e pour la structuration des r\u00e9seaux WIFI. Cette structure permet de limiter les domaines de diffusion. Les VLANs de sportludique sont organis\u00e9s selon une structure hi\u00e9rarchique par d\u00e9partement.</p> <p>- Un VLAN de gestion permet d\u2019acc\u00e9der aux \u00e9quipements de r\u00e9seau via les postes Administrateur du service Informatique du d\u00e9partement r\u00e9seau. La gestion des \u00e9quipements permet d\u2019assurer la maintenance, les mises \u00e0 jour des configurations ou des IOS et les op\u00e9rations ponctuelles de surveillance et de test du r\u00e9seau.</p> <p>- Le routage des VLAN utilise la technique des sous interfaces VLAN et l\u2019encapsulation 802.1Q impl\u00e9ment\u00e9s dans les switch et routeurs.</p> <p>- Un connexion Haut d\u00e9bit assure une liaison \u00e0 l\u2019Internet. Chaque site est connect\u00e9 via \u00e0 routeur au r\u00e9seau publique via un prestataire (g\u00e9r\u00e9 par votre professeur qui vous donnera en temps utile les adresses IP publiques utilisables).</p> <p>- Chaque site dispose d\u2019une connexion de secours de type xDSL fournie par un second FAI afin d\u2019assurer une haute disponibilit\u00e9 de l\u2019acc\u00e8s Internet. On r\u00e9fl\u00e9chira \u00e0 une solution pour rendre les services web offerts par chaque site hautement disponible eux aussi.</p> <p>- les serveurs DHCP et serveurs de nom DNS assurent la gestion des machines. Ces services doivent \u00eatre install\u00e9s sur 2 serveurs physiquement s\u00e9par\u00e9s pour assurer la tol\u00e9rance aux pannes (HA).</p> <p>- Un routeur filtrant assure les fonctions de pare feu entre le LAN, la DMZ et l\u2019internet (WAN), l'appliance SN210 de Stormshield ou la distribution pfsense bas\u00e9e sur l'OS BSD (r\u00e9put\u00e9 pour son \u00e9fficacit\u00e9 en s\u00e9curit\u00e9) devront \u00eatre privil\u00e9gi\u00e9e pour cette t\u00e2che. Ce point n\u00e9vralgique devra \u00eatre hautement disponible (impossible pour les SN210) lui aussi au moins sur le site physique de chartres.</p>"},{"location":"infrastructure/03-infrastructure/#infrastructure-sportludique-au-siege-a-chartres","title":"Infrastructure SportLudique (au si\u00e8ge \u00e0 chartres)","text":"<p>L\u2019entreprise comporte 6 services (6 VLANs minimum) dont le d\u00e9partement r\u00e9seau qui renferme le service Informatique. Ce service assure la gestion et administration du r\u00e9seau et du parc informatique.</p> <p>Les ressources informatiques (serveurs, bases de donn\u00e9es, syst\u00e8mes de supervision\u2026) sont situ\u00e9es dans une baie de serveurs.</p> <p>Parmi ces serveurs on trouve les 2 serveurs DHCP en redondance \u00e0 chaud et le serveur Proxy qui se charge des requ\u00eates http des personnels de l\u2019entreprise</p> <p>Les salles ressources au rez de chauss\u00e9e du b\u00e2timent offrent des acc\u00e8s aux \u00e9quipements multim\u00e9dia, vid\u00e9o, t\u00e9l\u00e9phones IP, imprimantes et ordinateurs pour les utilisateurs externes tel que des clients ou des fournisseurs.</p> <p>Ces salles sont regroup\u00e9es dans le n<sup>i\u00e8me</sup> VLAN int\u00e9gr\u00e9 dans le r\u00e9seau.</p>"},{"location":"infrastructure/03-infrastructure/#abonnements-internet-pour-chaque-site","title":"Abonnements Internet pour chaque site","text":"<p>Un abonnement FAI haut d\u00e9bit Fibre est g\u00e9r\u00e9 par un routeur CISCO qui supporte le trafic principal. Un abonnement FAI ADSL de secours devra \u00eatre mis en place charg\u00e9 de prendre le relais en cas de panne de l\u2019abonnement du routeur primaire. Lorsque le lien primaire retrouve un \u00e9tat op\u00e9rationnel il reprend la gestion du trafic (Protocole propri\u00e9taire Cisco HSRP).</p> <p>Les 2 abonnements Internet sont souscris avec les op\u00e9rateurs Orange et SFR qui d\u00e9livrent un contrat de service Pro Fibre 100Mb/s avec une SLA GTR 4heures pour l\u2019abonnement principal Fibre et un contrat bas d\u00e9bit ASDL GTR 48Heures pour l\u2019abonnement de secours.</p> <p>Attention</p> <p>Les Adresses IP suivantes correspondent aux passerelles (Gateway) fournies par les op\u00e9rateurs. C'est \u00e0 vous de trouver l'IP publique correspondante \u00e0 d\u00e9finir sur votre \u00e9quipement (Voir schema r\u00e9seau sur la page Annexes) </p> idVLAN Chartres Tours Orl\u00e9ans Bourges Abonnement FIBRE : 200 183.44.28.2 /30 183.44.37.2 /30 183.44.45.2 /30 183.44.18.2 /30 Abonnement ADSL : 100 221.87.128.1 /30 221.87.137.1 /30 221.87.145.1 /30 221.87.118.1 /30"},{"location":"infrastructure/03-infrastructure/#acces-internet-et-dmz","title":"Acc\u00e8s Internet et DMZ","text":"<p>Cette partie repr\u00e9sente le p\u00e9rim\u00e8tre de s\u00e9curit\u00e9 pour l\u2019acc\u00e8s \u00e0 Internet. Une zone DMZ est int\u00e9gr\u00e9e dans le routeur pare-feu qui r\u00e8glemente les \u00e9changes l\u2019acc\u00e8s \u00e0 Internet. Ce routeur assure la gestion du sous r\u00e9seau DMZ qui renferme les services WEB et FTP, la fonction de pare feu et l\u2019interconnexion au r\u00e9seau priv\u00e9 et Internet. Son impl\u00e9mentation sera cr\u00e9\u00e9e avec une VM connect\u00e9 aux diff\u00e9rents VLANS du lyc\u00e9e Fulbert pour isoler les flux et simuler un v\u00e9ritable routeur d\u00e9di\u00e9.</p> <p>Les 2 services SFTP et WEB de la DMZ sont int\u00e9gr\u00e9s dans une VM dans une machine Windows ou linux pour h\u00e9berger le site WEB de chaque site. Ces services sont accessibles depuis l\u2019Internet (simul\u00e9 dans le labo) et le r\u00e9seau interne sous certaines conditions.</p> <p>Le p\u00e9rim\u00e8tre de s\u00e9curit\u00e9 est repr\u00e9sent\u00e9 par les fonctions suivantes\u00a0:</p> <p>- Pare Feu entre le r\u00e9seau interne, la DMZ et Internet avec s\u00e9curisation par des r\u00e8gles de contr\u00f4le d\u2019acc\u00e8s. Ces r\u00e8gles sont d\u00e9finies ci-dessous.</p> <p>- Haute disponibilit\u00e9 sur l\u2019acc\u00e8s \u00e0 Internet assur\u00e9 par 2 routeurs en HSRP avec fonction NAT/PAT. Une fonction port forwarding permet de rediriger les requ\u00eates provenant de l\u2019Internet (du routeur principal fibre) vers les ressources accessibles de l\u2019association (http, FTP\u2026).</p> <p>- Pour compl\u00e9ter le p\u00e9rim\u00e8tre de s\u00e9curit\u00e9, un serveur Proxy WEB (Proxy squid) r\u00e9glemente l\u2019acc\u00e8s \u00e0 Internet pour l\u2019ensemble des utilisateurs internes de chaque site en les tra\u00e7ant except\u00e9 pour les postes d\u2019administration du service Informatique.</p> <p>R\u00e8gles de contr\u00f4le d\u2019acc\u00e8s\u00a0:</p> <p>1/ Seuls les requ\u00eates du serveur Proxy peut acc\u00e9der \u00e0 Internet.</p> <p>2/ Les Internautes peuvent acc\u00e9der \u00e0 la DMZ mais pas au r\u00e9seau priv\u00e9.</p> <p>3/ Les sous r\u00e9seaux de SportLudique peuvent acc\u00e9der aux ressources de la DMZ.</p> <p>4/ Les postes nomades du r\u00e9seau Wifi \u00a8Visiteurs\u00a8 n\u2019ont acc\u00e8s qu\u2019\u00e0 Internet. Les postes du r\u00e9seau Wifi \u00a8Employ\u00e9s\u00a8 peuvent acc\u00e9der au r\u00e9seau Interne et \u00e0 Internet.</p> <p>5/ Le trafic ICMP est autoris\u00e9 pour les postes du service Informatique.</p> <p>6/ Le trafic ICMP provenant de l\u2019Internet est interdit.</p>"},{"location":"infrastructure/03-infrastructure/#messagerie-electronique","title":"Messagerie Electronique","text":"<p>Un serveur de messagerie sera aussi disponible sur chaque site. Le nom de domaine sportludique.fr \u00e9tant r\u00e9serv\u00e9, les adresses auront la forme utilisateur@&lt;ville&gt;.sportludique.fr</p> <p>Les utilisateurs devront pouvoir consulter leur messagerie du r\u00e9seau internet et du r\u00e9seau publique. Des \u00e9changes seront \u00e9videmment possibles entre chaque site g\u00e9ographique.</p>"},{"location":"infrastructure/03-infrastructure/#reseau-wifi","title":"R\u00e9seau WIFI","text":"<p>Pour cette maquette le r\u00e9seau WIFI interne couvre la surface occup\u00e9e dans le b\u00e2timent Hall d\u2019accueil et l\u2019espace ext\u00e9rieur qui couvrira les zones utilis\u00e9es pour les journ\u00e9es \u00e9v\u00e8nementielles porte ouverte. Ce point d\u2019acc\u00e8s contr\u00f4le 2 r\u00e9seaux radios identifi\u00e9s par un SSID.</p> <p>Un SSID \u00a8Visiteurs\u00a8 permet de fournit une connectivit\u00e9 Internet au public externe \u00e0 l\u2019association dans le cadre de leur visite dans les locaux ou lors d\u2019activit\u00e9s \u00e9v\u00e9nementielles type journ\u00e9es portes ouvertes qui accueille du public ou des invit\u00e9s. Ce r\u00e9seau offre une connectivit\u00e9 ouverte non s\u00e9curis\u00e9e \u00e0 Internet. L\u2019identification du r\u00e9seau est diffus\u00e9e.</p> <p>Un SSID \u00a8Employ\u00e9s\u00a8 fournit au personnel interne munis de postes portables l\u2019accessibilit\u00e9 Internet et vers le r\u00e9seau priv\u00e9. Pour ce SSID on utilise la s\u00e9curisation WPA et une authentification WPA2-Entreprise. Pour ce r\u00e9seau, le cryptage AES est utilis\u00e9 et le SSID de r\u00e9seau n\u2019est pas diffus\u00e9e. L\u2019authentification sera assur\u00e9e via le contr\u00f4leur de domaine ActiveDirectory et une strat\u00e9gie d\u2019acc\u00e8s au r\u00e9seau sera diff\u00e9rente en fonction des groupes utilisateurs. Un test sera fait avec une authentification par certificats \u00e9lectroniques.</p> <p>Ces 2 r\u00e9seaux sont s\u00e9par\u00e9s par des VLAN de niveau 3 et une r\u00e8gle sur le routeur PRF permet d\u2019\u00e9viter que les visiteurs puissent acc\u00e9der au r\u00e9seau interne priv\u00e9.</p>"},{"location":"infrastructure/03-infrastructure/#supervision-de-reseau-maintenance-et-deploiement","title":"Supervision de r\u00e9seau, Maintenance et d\u00e9ploiement","text":"<p>En cas de panne l\u2019analyse de probl\u00e8me r\u00e9seau s\u2019effectue via l\u2019outil d\u2019analyse de trame Wireshark qui permettra de v\u00e9rifier les anomalies de fonctionnement du r\u00e9seau pour la validation, les tests ou la mise en service mais aussi le d\u00e9pannage de situation en cas de blocage.</p> <p>Une fonction de port mirroring sur les commutateurs Cisco permet d\u2019analyser les trafics sur les liens strat\u00e9giques</p> <p>Un service d\u2019administration \u00e0 distance utilisant le protocole SSH version 2 permet une prise de contr\u00f4le \u00e0 distance des \u00e9quipements routeurs et commutateurs du r\u00e9seau en mode s\u00e9curis\u00e9. L\u2019application SSH sera install\u00e9e sur les \u00e9quipements de r\u00e9seau. Ce protocole utilise le mode de chiffrement \u00e0 cl\u00e9s asym\u00e9triques RSA (longueur de cl\u00e9 1024).</p> <p>Les \u00e9quipements de r\u00e9seau sont accessibles en SNMP pour permettre l\u2019exploitation du r\u00e9seau par le logiciel de superivision (Centreon ou autre solution compatible avec le protocole SNMP). On utilise la communaut\u00e9 \u00a8spludique\u00a8 pour les relations agent/serveur avec droits en lecture. On utilisera les traps ou notifications snmp d\u00e9finies par Cisco pour surveiller le fonctionnement du protocole HSRP sur les liaisons internet, les ruptures de liens et les pannes et red\u00e9marrages des \u00e9quipements.</p> <p>Le superviseur est d\u00e9di\u00e9 \u00e0 la supervision des \u00e9quipements de r\u00e9seau (commutateurs, routeurs, passerelles, Points d\u2019acc\u00e8s).</p> <p>L\u2019outil de gestion de parc et gestion d\u2019incidents GLPI permet d\u2019assurer le suivi et la gestion des postes et serveurs informatiques. Un service de t\u00e9l\u00e9 d\u00e9ploiement de logiciel devra \u00eatre mis en place dans chaque site par les \u00e9quipes techniques.</p>"},{"location":"infrastructure/04-annexes/","title":"Annexes","text":""},{"location":"infrastructure/04-annexes/#annexe-1-schema-logique-minimal-linfrastructure-de-chaque-site-geographique","title":"Annexe 1 - Sch\u00e9ma logique minimal l\u2019infrastructure de chaque site g\u00e9ographique","text":""},{"location":"infrastructure/04-annexes/#annexe-2-schema-logique-du-reseau-de-management","title":"Annexe 2 - Sch\u00e9ma logique du r\u00e9seau de management","text":"Nouveaut\u00e9 2026 <p>Un vlan de management d\u00e9di\u00e9 est utilisable sur la ferme de serveurs Nutanix:  110 --&gt;Bourges,  120 --&gt; Chartres,   etc...</p>"},{"location":"infrastructure/04-annexes/#annexe-3-schema-physique-linfrastructure","title":"Annexe 3 - Sch\u00e9ma physique l\u2019infrastructure","text":"<p>Les ports sont evidement \u00e0 choisir par les \u00e9tudiants</p>"},{"location":"infrastructure/04-annexes/#annexe-4-plan-dadressage-ip","title":"Annexe 4 - Plan d'adressage IP","text":"Site de LAN global Nombre d'h\u00f4tes Nombre de serveurs Adresse r\u00e9seau Masque Plan adressage sous r\u00e9seau (VLAN) VLAN service + ID ferme de serveur ** ** ** ** ** ** ** ** Nombre d'h\u00f4tes Masque CIDR Masque d\u00e9cimal Adresse du r\u00e9seau Adresse de diffusion Plage fixe Plage DHCP principal Plage DHCP secondaire Passerelle relai DHCP (oui / non) Site de Routeur Pare Feu Vlan Transport VLAN ID Interface eth0 Interface eth1 Interface eth2 Interface eth3 vers service Adresse Masque Routeurs FAI Interface eth0 (publique) Interface eth1 (priv\u00e9e) Interface virtuelle R1 VLAN 100 Adresse Masque Passerelle R2 VLAN 200 Adresse Masque Passerelle"},{"location":"infrastructure/04-annexes/#annexe-5-plan-dadressage-ip-des-serveurs-suite","title":"Annexe 5 - Plan d'adressage IP des serveurs (suite)","text":"Site de Nom VM sur la ferme VLAN (\u00e9tiquette r\u00e9seau) Adresse IP et masque CIDR Masque (notation d\u00e9cimale Passerelle login password OS"},{"location":"infrastructure/04-annexes/#serveurs-publiques-internet-simule-et-serveurs-heberges-dans-dmz","title":"Serveurs publiques (Internet simul\u00e9) et serveurs h\u00e9berg\u00e9s dans DMZ","text":"Nom VM sur la ferme VLAN (\u00e9tiquette r\u00e9seau) Adresse IP et masque CIDR Masque (notation d\u00e9cimale Passerelle login password OS Registar DNS 200 121.283.90.205 / 29 255.255.255.248 121.283.90.206"},{"location":"infrastructure/04-annexes/#annexe-6-plan-de-brassage","title":"Annexe 6 - Plan de brassage.","text":"SW1 2960-24 Ports VLAN SW1 2960-24 Ports VLAN Fa0/1 Fa0/1 Fa0/2 Fa0/2 Fa0/3 Fa0/3 Fa0/4 Fa0/4 Fa0/5 Fa0/5 Fa0/6 Fa0/6 Fa0/7 Fa0/7 Fa0/8 Fa0/8 Fa0/9 Fa0/9 Fa0/10 Fa0/10 Fa0/11 Fa0/11 Fa0/12 Fa0/12 Fa0/13 Fa0/13 Fa0/14 Fa0/14 Fa0/15 Fa0/15 Fa0/16 Fa0/16 Fa0/17 Fa0/17 Fa0/18 Fa0/18 Fa0/19 Fa0/19 Fa0/20 Fa0/20 Fa0/21 Fa0/21 Fa0/22 Fa0/22 Fa0/23 Fa0/23 Gi0/1 Gi0/1 Gi0/2 Gi0/2"},{"location":"infrastructure/04-annexes/#annexe-7-identifiants-mots-de-passe","title":"Annexe 7 - Identifiants &amp; mots de passe","text":"<p>Tables des noms DNS</p> nom ip"},{"location":"infrastructure/04-annexes/#annexe-8-infrastructure-publique-simulee-dans-le-labo-du-lycee-fulbert","title":"Annexe 8 - Infrastructure Publique simul\u00e9e dans le labo du lyc\u00e9e Fulbert","text":""},{"location":"infrastructure/04-annexes/#annexe-9","title":"Annexe 9","text":""},{"location":"infrastructure/04-annexes/#adressage-ip-publique-des-sites","title":"Adressage IP publique des sites","text":"VLAN ID Routeur FAI interface publique Chartres Orl\u00e9ans Tours Bourges 100 R1 adresse IP 221.87.128.2 /30 221.87.145.2 /30 221.87.137.2 /30 221.87.118.2 /30 masque 255.255.255.252 255.255.255.252 255.255.255.252 255.255.255.252 passerelle 221.87.128.1 221.87.145.1 221.87.137.1 221.87.118.1 200 R2 adresse IP 183.44.28.1 /30 183.44.45.1 /30 183.44.37.1 /30 183.44.18.1 /30 masque 255.255.255.252 255.255.255.252 255.255.255.252 255.255.255.252 passerelle 183.44.28.2 183.44.45.2 183.44.37.2 183.44.18.2"},{"location":"infrastructure/04-annexes/#routeurs-simulant-internet-dans-linfrastructure-du-lycee-fulbert","title":"Routeurs simulant internet dans l\u2019infrastructure du lyc\u00e9e Fulbert","text":"VLAN ID Routeur internet interface IP Masque R\u00e9seau Broadcast 100 R1 chartres 221.87.128.1 /30 255.255.255.252 221.87.128.0 221.87.128.3 orl\u00e9ans 221.87.145.1 /30 255.255.255.252 221.87.145.0 221.87.145.3 tours 221.87.137.1 /30 255.255.255.252 221.87.137.0 221.87.137.3 Bourges 221.87.136.1 /30 255.255.255.252 221.87.118.0 221.87.118.3 reste du monde 121.183.90.201 /29 255.255.255.248 121.183.90.200 121.183.90.207 PASSERELLE 121.183.90.206 200 R2 chartres 183.44.28.1 /30 255.255.255.252 183.44.28.0 183.44.28.3 orl\u00e9ans 183.44.45.1 /30 255.255.255.252 183.44.45.0 183.44.45.3 tours 183.44.37.1 /30 255.255.255.252 183.44.37.0 183.44.37.3 Bourges 183.44.36.1 /30 255.255.255.252 183.44.18.0 183.44.18.3 reste du monde 121.183.90.202 /29 255.255.255.248 121.183.90.200 121.183.90.207 PASSERELLE 121.183.90.206 RSportFulbert Vers Internet simul\u00e9 121.183.90.206/29 255.255.255.248 121.183.90.200 Vers Fulbert 10.200.255.1/16 255.255.0.0 10.200.0.0 PASSERELLE 10.200.255.254 Commentaire NAT r\u00e9seau 128.183.90.200 --&gt; 10.200.255.1"},{"location":"infrastructure/04-annexes/#annexe-10","title":"Annexe 10","text":"<p>Les \u00e9quipements de r\u00e9seau</p>"},{"location":"infrastructure/04-annexes/#dlink-3200-ap","title":"DLINK 3200 AP","text":"DLINK 3200 AP D\u00e9signation Point d\u2019Acc\u00e8s WIFI Caract\u00e9ristiques mat\u00e9riels - Bo\u00eetier solide en m\u00e9tal certifi\u00e9 Plenum  - Technologie Power over Ethernet (PoE) 802.3af int\u00e9gr\u00e9e- Deux antennes \u00e0 gain \u00e9lev\u00e9 amovibles- Base PoE (Power over Ethernet) fournie- Supports de verrouillage inclus Mode de fonctionnement - AP- WDS- AP + WDS Connectivit\u00e9 haute performance - D\u00e9bits sans fil conformes \u00e0 la norme 802.11g- D\u00e9bits de transfert de donn\u00e9es sans fil pouvant atteindre 54 Mbps- D\u00e9bit sans fil de 108 Mbps avec la technologie 108G D-Link *Le d\u00e9bit maximal du signal sans fil est bas\u00e9 sur les sp\u00e9cifications de la norme IEEE 802.11g. Dans la r\u00e9alit\u00e9, sa valeur pourra varier. En effet, les conditions r\u00e9seau et les facteurs environnementaux peuvent restreindre le d\u00e9bit r\u00e9el des donn\u00e9es. S\u00e9curit\u00e9 - Chiffrement des donn\u00e9es WEP 64/128/152 bits- WPA Personal/WPA Enterprise- WPA2 Personal/WPA2 Enterprise- Authentification utilisateur 802.1x- AES- SSID multiples 802.1Q/segmentation r\u00e9seau- Filtrage des adresses MAC Administration - Logiciel AP Manager- Navigateur Web (HTTP)- Telnet- SNMP v.3"},{"location":"infrastructure/04-annexes/#routeurs-cisco","title":"Routeurs Cisco","text":"Routeur Cisco Model Brand CISCO Series 1900 Model CISCO1921/K9 SPEC Speed 10/100/1000Mbps LAN Ports 2 x 10/100/1000Mbps VPN IPSec, PPTP, L2TP Features Interfaces/Ports: 2 x RJ-45 10/100/1000Base-T Network LAN 1 x RJ-45 Auxiliary Management 1 x RJ-45 Console Management 1 x Type A USB 2.0 USB 1 x Type B USB Management I/O Expansions: Number of Expansion Slots: 2 Expansion Slots: (2 Total) HWIC Management: SNMP RMON Syslog NetFlow TR-069 IEEE 802.1p QoS IEEE 802.1q VLAN Web Based Management Cisco Configuration Professional CiscoWorks LMS CiscoWorks NCM Cisco Security Manager Cisco Unified Provisioning Manager Cisco License Manager Cisco Configuration Engine Memory: Standard Memory: 512 MB Maximum Memory: 512 MB Memory Technology: DRAM Flash Memory: 256 MB The Cisco 1921 builds on the best-in-class offering of the Cisco 1841 Integrated Services Routers. All Cisco 1900 Series Integrated Services Routers offer embedded hardware encryption acceleration, optional firewall, intrusion prevention, and advanced security services. In addition, the platforms support the industry's widest range of wired and wireless connectivity options such as Serial, T1/E1, xDSL, Gigabit Ethernet, and third-generation (3G) wireless."},{"location":"infrastructure/04-annexes/#switch-cisco-2960","title":"Switch CISCO 2960","text":"Switch CISCO 2960 - 48 ports Description du produit Cisco Catalyst 2960-24TC-S - commutateur - 24 ports - G\u00e9r\u00e9 - Montable sur rack Type de p\u00e9riph\u00e9rique Commutateur - 24 ports - G\u00e9r\u00e9 Type de ch\u00e2ssis Montable sur rack 1U Interfaces Fast Ethernet Ports 24 x 10/100 + 2 x SFP Gigabit combin\u00e9 Performances Capacit\u00e9 de commutation : 16 Gbps Performances de transfert (taille de paquet 64 octets) : 6,5 Gbps Taille de la table d'adresses MAC 8 000 entr\u00e9es Protocole de gestion \u00e0 distance SNMP 1, SNMP 2, RMON 1, RMON 2, Telnet, SNMP 3, SNMP 2c, HTTP, HTTPS, TFTP, SSH-2 Caract\u00e9ristiques Layer 2 switching, auto-d\u00e9tection par dispositif, compatible DHCP, auto-n\u00e9gociation, prise en charge du r\u00e9seau local (LAN) virtuel, auto-uplink (MDI/MDI-X auto), IGMP snooping, prise en charge de Syslog, prise en charge DiffServ, contr\u00f4le de la temp\u00eate de Broadcast, Multicast Storm Control, Unicast Storm Control, prise en charge du protocole RSTP (Rapid Spanning Tree Protocol), prise en charge du protocole Multiple Spanning Tree Protocol (MSTP), assistance Dynamic Trunking Protocol (DTP), assistance Port Aggregation Protocol (PAgP), qualit\u00e9 de service (QDS), Link Aggregation Control Protocol (LACP), Port Security, notification de l'adresse MAC Conformit\u00e9 aux normes IEEE 802.3, IEEE 802.3u, IEEE 802.3z, IEEE 802.1D, IEEE 802.1Q, IEEE 802.3ab, IEEE 802.1p, IEEE 802.3x, IEEE 802.3ad (LACP), IEEE 802.1w, IEEE 802.1x, IEEE 802.1s, IEEE 802.3ah, IEEE 802.1ab (LLDP) Alimentation CA 120/230 V ( 50/60 Hz ) Dimensions (LxPxH) 44.5 cm x 23.6 cm x 4.4 cm Poids 3.65 kg Garantie du fabricant Garantie limit\u00e9e \u00e0 vie"},{"location":"infrastructure/05-fiche-recette/","title":"Fiche de Recette","text":""},{"location":"infrastructure/05-fiche-recette/#objectif","title":"Objectif","text":"<p>Cette fiche de recette vise \u00e0 tester l'acc\u00e8s \u00e0 Internet depuis plusieurs niveaux du r\u00e9seau en prenant en compte les 4 couches du mod\u00e8le TCP/IP : ICMP, DNS, et les services. Les tests seront effectu\u00e9s \u00e0 cinq emplacements diff\u00e9rents : routeur de jonction, VLAN de transport, DMZ, c\u0153ur du r\u00e9seau, et VLAN serveurs et usagers.</p>"},{"location":"infrastructure/05-fiche-recette/#materiel-requis","title":"Mat\u00e9riel Requis","text":"<ul> <li>Ordinateur portable / PC fixe brass\u00e9 \u00e0 un niveau diff\u00e9rent du r\u00e9seau</li> <li>Outils de test r\u00e9seau (ping, nslookup, navigateur web, etc.)</li> </ul>"},{"location":"infrastructure/05-fiche-recette/#tests","title":"Tests","text":"Source Destination Test Ping (IP) Test R\u00e9solution de Nom DNS Test Service Souhait\u00e9 \u00e0 pr\u00e9ciser (num\u00e9ro de port) Exemple: TCP/22 [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]"},{"location":"stormshield/fiches/commandesUtilesConsole_SNS/","title":"CheatSheet","text":""},{"location":"stormshield/fiches/commandesUtilesConsole_SNS/#commandes-utiles-de-console-ou-en-ssh-des-vm-pare-feu-sns","title":"Commandes utiles de console (ou en ssh) des VM Pare-feu SNS","text":""},{"location":"stormshield/fiches/commandesUtilesConsole_SNS/#reinitialiser-le-pare-feu-avec-la-commande-defaultconfig","title":"R\u00e9initialiser le pare-feu avec la commande defaultconfig","text":"<pre><code>defaultconfig\u00a0\n\nUsage: \\[options\\]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -f:\u00a0\u00a0\u00a0\u00a0 Force\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -r:\u00a0\u00a0\u00a0\u00a0 Reboot after defaultconfig\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -D:\u00a0\u00a0\u00a0\u00a0 Only Restore the data partition\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -p:\u00a0\u00a0\u00a0\u00a0 Reset password\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -u:\u00a0\u00a0\u00a0\u00a0 Check usb token boot restoration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -d:\u00a0\u00a0\u00a0\u00a0 Dump root partition after defaultconfig\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -k:\u00a0\u00a0\u00a0\u00a0 Keep autoupdate data (Pattern, Pvm, Clamav, Kaspersky, URLFiltering), default SSL proxy authority, default sslvpn full authority and ssh host keys\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -l:\u00a0\u00a0\u00a0\u00a0 Keep network configuration file\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -n:\u00a0\u00a0\u00a0\u00a0 Do not mark firewall as having a defaultconfig configuration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -c:\u00a0\u00a0\u00a0\u00a0 No backup files (.old)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -L:\u00a0\u00a0\u00a0\u00a0 Remove logs\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -s:\u00a0\u00a0\u00a0\u00a0 Safe mode. Restore network configuration with only first interface enabled.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -t:\u00a0\u00a0\u00a0\u00a0 Reset TPM (TPM password required)\n</code></pre> <ul> <li>taper ceci  pour red\u00e9marrer en configuration usine. <pre><code>defaultconfig --f --r --p --c -L\n</code></pre></li> </ul>"},{"location":"stormshield/fiches/commandesUtilesConsole_SNS/#principe-de-la-modification-de-la-configuration","title":"Principe de la modification de la configuration","text":"<p>La configuration du pare-feu se trouve dans le dossier ConfigFiles. Il est possible d'intervenir directement dans les fichiers (des exemples sont tr\u00e8s souvent pr\u00e9sents).</p> <p>Une fois la modification r\u00e9alis\u00e9e, il est n\u00e9cessaire de recharger la configuration. L\u00e0 aussi, cela suit un m\u00eame principe\u00a0: la commande commence par \u00ab\u00a0en\u00a0\u00bb, en saisissant ces 2 lettres et en \u00ab\u00a0tabulant\u00a0\u00bb, on dispose de l'ensemble des commandes qui sont dans /usr/Firewall/sbin. Il faut bien s\u00fbr lancer la commande correspondante \u00e0 la modification op\u00e9r\u00e9e.</p> <p>Par exemple, pour modifier l'adresse IP d'une interface\u00a0:</p> <p><pre><code>vi ConfigFiles/network \n</code></pre> \u21d2 Modification des param\u00e8tres souhait\u00e9s \u00e0 l'aide de vi. D\u00e9finition des principaux param\u00e8tres sous le nom de section de l'interface ( [ethernet0] )\u00a0:</p> <ul> <li>State = 1 ou 0 Connectivit\u00e9 de l\\'interface activ\u00e9e ou non</li> <li>Media = 0 \u00e0 6 D\u00e9finit la vitesse de m\u00e9dia (0 = auto-n\u00e9gociation)</li> <li>Protected = 1 ou 0 Interface prot\u00e9g\u00e9e ou non (anti-spoofing sur des     interfaces internes)</li> <li>Address</li> <li>Mask</li> <li>Gateway</li> <li>Sauvegarder les modifications.</li> <li>Il suffit ensuite de recharger les configurations\u00a0:</li> </ul> <pre><code>ennetwork\n</code></pre> <p>Un ifconfig permet de valider la prise en compte des nouveaux param\u00e8tres.</p> <p>Si on modifie la politique de filtrage\u00a0:  <pre><code>enfilter -u\n</code></pre></p>"},{"location":"stormshield/fiches/fiche01_initialiser_SNS/","title":"Fiche 01 -- Initialiser un Pare-feu SNS","text":""},{"location":"stormshield/fiches/fiche01_initialiser_SNS/#procedure-de-remise-a-zero-des-pare-feu-sns","title":"Proc\u00e9dure de remise \u00e0 z\u00e9ro des pare-feu SNS","text":"<p>Cette proc\u00e9dure ne doit \u00e9videmment \u00eatre d\u00e9roul\u00e9e que sur un SNS qui aurait d\u00e9j\u00e0 \u00e9t\u00e9 configur\u00e9.</p> <p>Un RAZ du pare-feu peut \u00eatre fait via la console (sur les VM ou les boitiers physiques), ceci n\u00e9cessite un red\u00e9marrage (reboot). Sur les bo\u00eetiers physiques\u00a0: un appui sur le bouton reset pour les bo\u00eetiers physiques permet de restaurer la configuration d'usine et red\u00e9marrer en bridge sur toutes les interfaces.</p> <p>Vous pouvez faire le choix de r\u00e9initialiser un boitier physique via l'acc\u00e8s console. Pour cela, installer le driver du c\u00e2ble console sur Windows\u00a0: https://ftdichip.com/drivers/vcp-drivers/.</p> <p>Lancer un logiciel permettant l'acc\u00e8s console (Putty, Teraterm, minicom) et utilisant en d\u00e9bit 115200.</p> <p></p> <p>Sur une VM\u00a0:</p> <ul> <li>d\u00e9marrer (ou red\u00e9marrer) la machine virtuelle et s'authentifier pour     acc\u00e9der \u00e0 la console en administrateur\u00a0;</li> <li>saisir la commande </li> </ul> <pre><code>defaultconfig --f --r --p --c -L\n</code></pre>"},{"location":"stormshield/fiches/fiche01_initialiser_SNS/#configuration-initiale","title":"Configuration initiale","text":"<p>La configuration d'usine par d\u00e9faut du *pare-feu SNS * est la suivante.</p> <p>Dans une configuration usine, notamment pour les machines virtuelles et les mod\u00e8les SN310, la premi\u00e8re interface (1) du pare-feu SNS physique est nomm\u00e9e \u00ab\u00a0OUT\u00a0\u00bb, la seconde \u00ab\u00a0IN\u00a0\u00bb et le reste des interfaces \u00ab\u00a0DMZx\u00a0\u00bb. L'interface \u00ab\u00a0OUT\u00a0\u00bb est une interface externe, utilis\u00e9e pour connecter le pare-feu SNS \u00e0 internet et le reste des interfaces sont internes et servent principalement \u00e0 connecter le pare-feu SNS \u00e0 des r\u00e9seaux locaux.</p> Attention <p>Attention au brassage ! La distinction interne/externe pour les interfaces permet de se prot\u00e9ger contre les attaques d'usurpation d'adresse IP IPSpoofing.</p> <p></p> <p>Le sch\u00e9ma pr\u00e9sent\u00e9 ci-dessous correspond, quant \u00e0 lui, \u00e0 un bo\u00eetier SN210. Comme vous pouvez le constater, l'organisation des interfaces est diff\u00e9rente de celle des machines virtuelles ou des mod\u00e8les SN310 et sup\u00e9rieur.</p> <p></p> <p>Pour initialiser le pare-feu, il faut se brancher sur l'interface IN.</p> <p>En configuration usine, sur un bo\u00eetier physique de type SN210 ou SN310, toutes les interfaces sont incluses dans un bridge dont l'adresse est 10.0.0.254/8. Sur les bo\u00eetiers physiques, un serveur DHCP est actif sur toutes les interfaces du bridge et il distribue des adresses IP comprises entre 10.0.0.10 et 10.0.0.100. L'acc\u00e8s \u00e0 l'interface web de configuration du pare-feu SNS se fait avec l'url\u00a0: https://10.0.0.254/admin.</p> <ul> <li>Sur le bo\u00eetier</li> </ul> <p>Par d\u00e9faut, seul le compte syst\u00e8me admin (mot de passe par d\u00e9faut admin), disposant de tous les privil\u00e8ges sur le bo\u00eetier, existe et peut se connecter.</p> <ul> <li>Sur une VM</li> </ul> <p>La configuration usine lance un dialogue de pr\u00e9-configuration qui demande de changer le mot de passe par d\u00e9faut, de configurer vos interfaces, le clavier de la console, etc\u00a0:</p> <p>Un premier \u00e9cran propose un choix qu'il n'est pas n\u00e9cessaire de valider, le syst\u00e8me continue automatiquement\u00a0:</p> <p></p> <p>Un premier red\u00e9marrage automatique est fait et la configuration continue\u00a0:</p> <p></p> <ul> <li>S\u00e9lectionner 4 pour fr (sur le clavier le chiffre 4 sans utiliser la     touche Maj).</li> </ul> <p></p> <ul> <li>Saisir un mot de passe de 8 caract\u00e8res minimum avec Maj/min/chiffre/caract\u00e8res sp\u00e9ciaux.</li> </ul> <p></p> <p>Passons \u00e0 la configuration des interfaces r\u00e9seau\u00a0:</p> <p></p> <p>M\u00eame si plusieurs interfaces ont \u00e9t\u00e9 ajout\u00e9es sur l'hyperviseur (Proxmox, VirtualBox ou VmWare), seulement 2 sont modifiables via l'assistant du d\u00e9marrage.</p> <p>Les interfaces peuvent \u00eatre laiss\u00e9es en DHCP ou \u00eatre configur\u00e9es via une adresse IP fixe.</p> <p>V\u00e9rifications</p> <p>Sachant qu'il est d\u00e9conseill\u00e9 d'administrer le pare-feu via l'interface OUT, l'id\u00e9e est de configurer l'interface IN de mani\u00e8re \u00e0 ce qu'elle se trouve connect\u00e9e \u00e0 un r\u00e9seau logique sur lequel est \u00e9galement connect\u00e9 (ou peut \u00eatre connect\u00e9) un poste de travail permettant de proc\u00e9der \u00e0 l'administration du Stormshield.</p> <p>Lors de cette configuration, le param\u00e9trage pourra \u00eatre, bien s\u00fbr, modifi\u00e9e et, par exemple, une autre interface pourra \u00eatre d\u00e9di\u00e9e \u00e0 l'administration, nottament via l'usage d'un vlan de management</p> <p>Pour ce premier d\u00e9marrage</p> <ul> <li>Laisser l'interface OUT en DHCP m\u00eame si aucun serveur DHCP n'est     reli\u00e9 au r\u00e9seau \u21d2 r\u00e9pondre \u00ab\u00a0n\u00a0\u00bb ou E</li> <li>Laisser l'interface IN en DHCP uniquement s'il y a un serveur     DHCP sur le r\u00e9seau sinon r\u00e9pondre \u00ab\u00a0y\u00a0\u00bb pour mettre une adresse IP     accessible via le r\u00e9seau. Par exemple\u00a0:</li> </ul> <p></p> <p>R\u00e9pondre \u00ab\u00a0n\u00a0\u00bb sur la derni\u00e8re question, en effet il n'est pas recommand\u00e9 d'autoriser l'administration sur votre interface OUT.</p> <p></p> <p>Votre syst\u00e8me est install\u00e9 avec les valeurs rappel\u00e9es ci-dessus, vous pouvez tester que la configuration du clavier a bien \u00e9t\u00e9 prise en compte en saisissant votre login/mdp.</p> <p></p> <p>L'interface d'administration est accessible \u00e0 l'adresse https://@IP-IN/admin/ \u00e0 partir d'un poste sur le m\u00eame r\u00e9seau.</p> <p>Basculer sur la fiche n\u00b02 pour une premi\u00e8re configuration du bo\u00eetier ou de la VM.</p> <p>Plus d'informations</p> <p>https://documentation.stormshield.eu/SNS/v4/fr/Content/Software_Recovery_via_USB_key/SN150-SN160-SN160W-SN210-SN210W-SN310.htm</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/","title":"Fiche 02 -- Prise en main d'un Pare-feu SNS","text":"<p>Documentation officielle</p> <p>https://documentation.stormshield.eu/SNS/v4/fr/Content/User_Configuration_Manual_SNS_v4/Welcome/WELCOME.htm</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#connexion-au-pare-feu-sns","title":"Connexion au pare-feu SNS","text":"<p>Pour acc\u00e9der \u00e0 l'interface d'administration du pare-feu SNS, il est indispensable de connecter votre machine cliente (physique ou virtuelle) sur une interface interne (IN ou DMZ1 ou 2 sur les bo\u00eetiers SN310 et les machines virtuelles, IN sur les boitiers SN210) sous peine de devoir red\u00e9marrer le pare-feu qui aura d\u00e9tect\u00e9 une tentative d'usurpation d'adresse IP sur le bridge et bloquera tout le trafic g\u00e9n\u00e9r\u00e9 par la machine connect\u00e9e sur l'interface OUT.</p> <p>L'interface IN doit \u00eatre dans le m\u00eame r\u00e9seau que la machine \u00e0 partir de laquelle il va \u00eatre proc\u00e9d\u00e9 \u00e0 une premi\u00e8re configuration.</p> <p>L'acc\u00e8s \u00e0 l'interface graphique d'administration du pare-feu SNS se fait par https://@IP/admin (https://10.0.0.254/admin sur un bo\u00eetier) \u00e0 partir d'un navigateur web\u00a0:</p> L'\u00e9cran ci-contre appara\u00eet pour vous connecter une fois le pare-feu SNS d\u00e9marr\u00e9. - Pour modifier les options de langue de l'interface web d'administration, d\u00e9pliez Options puis choisissez la langue. La fen\u00eatre est actualis\u00e9e, vous pouvez vous connecter \u00e0 nouveau. - Saisir l'identifiant admin, le mot de passe admin ou celui que vous avez configur\u00e9 si vous avez effectu\u00e9 la r\u00e9initialisation de la machine virtuelle (par ex. Sio2022* ou autre). Remarque : pour s'authentifier, l'utilisateur peut \u00e9galement s\u00e9lectionner un certificat SSL dans le magasin de son navigateur (\u00e0 configurer au pr\u00e9alable dans les pr\u00e9f\u00e9rences du pare-feu SNS). Nous \u00e9tudierons cette possibilit\u00e9 dans la partie avanc\u00e9e sur la mise en place d'une PKI avec Stormshield. <p>S\u00e9curit\u00e9</p> <p>Pour des raisons \u00e9videntes de s\u00e9curit\u00e9, il conviendra de modifier ce mot de passe lorsque le pare-feu SNS sera utilis\u00e9 en contexte r\u00e9el d'entreprise.</p> <p>La page d'accueil de votre pare-feu SNS s'ouvre sur un\u00a0Tableau de bord qui permet de visualiser un certain nombre d'informations sur votre \u00e9quipement et est personnalisable.</p> <p></p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#premiere-configuration","title":"Premi\u00e8re configuration","text":"<p>Nous verrons ci-apr\u00e8s un certain nombre d'\u00e9l\u00e9ments de configuration g\u00e9n\u00e9rale utiles pour la bonne mise en \u0153uvre de votre pare-feu SNS (pour des configurations plus avanc\u00e9es et autres d\u00e9tails, cf fichier v4CSNA_v4_Livre_formation_Stomshield.pdf).</p> <p>Vigilence</p> <p>Afin de ne jamais \u00eatre d\u00e9connect\u00e9 en cas d'inactivit\u00e9 sur l'interface d'administration pendant ces exercices pratiques, il conviendra de modifier vos pr\u00e9f\u00e9rences, en usage r\u00e9el vous utiliserez un d\u00e9lai de 5 minutes pour \u00e9viter de laisser votre session ouverte sur le pare-feu SNS.</p> <ul> <li>Cliquer sur la fl\u00e8che \u00e0 droite de l'ic\u00f4ne repr\u00e9sentant l'utilisateur     connect\u00e9      en haut \u00e0 droite.</li> <li>Cliquer sur l'ic\u00f4ne     Pr\u00e9f\u00e9rences </li> <li>Dans la zone Param\u00e8tres de connexion, s\u00e9lectionner dans la liste     \u00ab\u00a0D\u00e9connexion en cas d'inactivit\u00e9\u00a0:\u00a0\u00bb la valeur Toujours rester connect\u00e9.</li> </ul> <p></p> <p>Nous \u00e9tudierons notamment les \u00e9l\u00e9ments du menu Configuration / Syst\u00e8me qui correspond \u00e0 la configuration g\u00e9n\u00e9rale\u00a0: licence, mise \u00e0 jour, mot de passe, etc.</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#configuration-generale","title":"Configuration g\u00e9n\u00e9rale","text":"<ul> <li>S\u00e9lectionner dans le menu \u00e0 gauche\u00a0Configuration / Syst\u00e8me puis     Configuration. Le volet Configuration g\u00e9n\u00e9rale est affich\u00e9.</li> <li>Commencer par donner un nom \u00e0 votre bo\u00eetier\u00a0et changer la langue de la console.</li> </ul> <p>Il est pr\u00e9f\u00e9rable de mettre les logs en anglais\u00a0: Langue du pare-feu (traces) afin de pouvoir rechercher plus facilement des r\u00e9f\u00e9rences \u00e0 d'\u00e9ventuels probl\u00e8mes dans les ressources documentaires Stormshield et sur les forums avec les bons mots-cl\u00e9s.</p> <p>La zone Politique de mots de passe permet de d\u00e9finir la longueur du mot de passe (8 par d\u00e9faut) et la zone Types de caract\u00e8res obligatoires permet de g\u00e9rer la complexit\u00e9 du mot de passe\u00a0(Aucun, Alphanum\u00e9riques, Alphab\u00e9tiques et sp\u00e9ciaux), la zone Entropie minimale correspond \u00e0 la robustesse du mot de passe. En utilisation en entreprise, il est recommand\u00e9 de changer le mot de passe de l'administrateur et d'augmenter \u00e0 12 le nombre de caract\u00e8res.</p> <p></p> <p>La zone \u00ab\u00a0Param\u00e8tres de date et d'heure\u00a0\u00bb permet de modifier le fuseau horaire dans la zone Fuseau horaire, s\u00e9lectionnez Europe/Paris.</p> <p></p> <p>NB</p> <p>La modification du fuseau horaire implique un red\u00e9marrage imm\u00e9diat, pour ne pas avoir de d\u00e9calage dans les journaux ou avec une PKI*.</p> <ul> <li>Cliquer le bouton Appliquer pour sauvegarder la configuration et Sauvegarder</li> </ul> <p>Un avertissement puis une ic\u00f4ne  apparaissent vous invitant \u00e0 red\u00e9marrer le pare-feu. Il est bien s\u00fbr possible de le faire une fois les autres configurations r\u00e9alis\u00e9es.</p> <ul> <li> <p>Cliquer sur l'ic\u00f4ne et s\u00e9lectionner Red\u00e9marrer maintenant.</p> </li> <li> <p>Apr\u00e8s le red\u00e9marrage (au bout d'environ 3 minutes), revenir au menu     Configuration / Syst\u00e8me puis Configuration et dans la zone     Param\u00e8tres de date et d'heure cliquer sur Maintenir le     pare-feu \u00e0 l'heure (NTP) pour que les mises \u00e0 jour d'heure     d'\u00e9t\u00e9/heure d'hiver soient \u00e9galement effectives.</p> </li> </ul>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#administration-du-pare-feu","title":"Administration du pare-feu","text":"<ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrir l'onglet     Administration du pare-feu pour visualiser les options de     configuration de l'administration du pare-feu.</li> </ul> <p>Plusieurs options sont configurables mais ne sont pas d\u00e9taill\u00e9es ici (cf. fichier CSNA_v4_Livre_formation_Stomshield.pdf).</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#parametres-reseaux","title":"Param\u00e8tres r\u00e9seaux","text":"<ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrir l'onglet     Param\u00e8tres r\u00e9seaux pour visualiser les options de configuration     r\u00e9seau du pare-feu.</li> </ul> <p>Les pare-feu Stormshield Network supportent le protocole IPv6 et plusieurs fonctionnalit\u00e9s (interface, routage, filtrage, VPN et administration) sont compatibles IPv6. Cependant, ce support est optionnel et son activation s'effectue via le bouton Activer le support du protocole IPv6 sur ce pare-feu (ce qui est inutile ici).</p> <p>NOTE</p> <p>Cette action \u00e9tant irr\u00e9versible, la sauvegarde de la configuration du pare-feu vous sera propos\u00e9e automatiquement lorsque vous cliquerez sur ce bouton. Le retour \u00e0 un support IPv4 exclusif (sans IPv6) n'est possible qu'apr\u00e8s une remise \u00e0 la configuration usine (reset) du pare-feu.</p> <p>Dans le cas o\u00f9 le pare-feu transite par un proxy pour acc\u00e9der \u00e0 Internet, les param\u00e8tres se renseignent depuis ce menu.</p> <p>Un ou plusieurs serveurs DNS peuvent \u00eatre ajout\u00e9s. Le pare-feu contacte ces serveurs pour toute r\u00e9solution qu'il \u00e9met ou doit relayer. Ces r\u00e9solutions de noms sont n\u00e9cessaires pour des fonctionnalit\u00e9s telles que Active Update qui interroge les serveurs de mise \u00e0 jour pour t\u00e9l\u00e9charger les bases de donn\u00e9es (signatures contextuelles, antivirus, Vulnerability Manager, etc.).</p> <p>Pour ajouter un DNS\u00a0:</p> <ul> <li>Cliquer sur Ajouter puis saisir (ou choisir ou cr\u00e9er) un     \u00ab\u00a0objet\u00a0\u00bb (cf fiche 4) et cliquer sur le bouton Appliquer pour     sauvegarder la configuration et Sauvegarder.</li> </ul> <p>NOTE</p> <p>Ci-dessous, les trois DNS par d\u00e9faut (la machine elle-m\u00eame, et deux DNS de Google\u00a0!). Si on passe la souris sur l'objet, on voit les valeurs des propri\u00e9t\u00e9s de l'objet.</p> <p></p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#autres-configurations","title":"Autres configurations","text":""},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#modification-du-mot-de-passe-de-ladministrateur","title":"Modification du mot de passe de l'administrateur","text":"<p>La modification du mot de passe admin (recommand\u00e9e) se fait dans le menu Configuration/Syst\u00e8me/Administrateurs puis onglet Compte ADMIN. Le mot de passe doit par d\u00e9faut, comporter au moins 8 caract\u00e8res et doit respecter la politique de mot de passe d\u00e9finie dans le menu Configuration. La robustesse du mot de passe choisit s'affiche alors. Elle indique son niveau de s\u00e9curit\u00e9 : Tr\u00e8s faible, faible, moyen, bon, excellent. Il est fortement conseill\u00e9 d'utiliser les majuscules et les caract\u00e8res sp\u00e9ciaux pour augmenter le niveau de s\u00e9curit\u00e9.</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#activation-de-la-licence","title":"Activation de la licence","text":"<p>Le menu Configuration / Syst\u00e8me / Licence affiche les d\u00e9tails de la licence et permet le cas \u00e9ch\u00e9ant de l'installer\u00a0:</p> <ul> <li>pour un bo\u00eetier\u00a0: \u00e0 r\u00e9cup\u00e9rer par l'administrateur sur le site     mystormshield.eu avec les informations figurant sous le bo\u00eetier.</li> <li>Pour une VM\u00a0: il est n\u00e9cessaire au pr\u00e9alable de proc\u00e9der \u00e0     l'activation du kit \u00e0 t\u00e9l\u00e9charger sur le site de Stormshield (voir     \u00e9galement page suivante)\u00a0:     https://documentation.stormshield.eu/SNS/v4/fr/Content/PDF/InstallationGuides/sns-fr_EVA_Guide_Installation.pdf</li> </ul> <p>Attention</p> <p>\u00c0 noter que si vous n'activez pas la licence au bout d'un certain temps les fonctionnalit\u00e9s se r\u00e9duisent et surtout vous ne pourrez pas stocker les logs sur les bo\u00eetiers physiques.</p> <p>Sur une VM, les fonctionnalit\u00e9s sans activation sont limit\u00e9es\u00a0:</p> <p></p> <ul> <li> <p>Pour activer la licence sur une VM\u00a0:</p> </li> <li> <p>Se connecter sur     https://mystormshield.eu.</p> </li> <li>Cliquer sur \u00ab\u00a0Product management\u00a0\u00bb (menu gauche) et t\u00e9l\u00e9charger le     kit d'activation.</li> <li>Revenir \u00e9ventuellement sur la page pour t\u00e9l\u00e9charger le fichier     licence, mais cette derni\u00e8re pourra \u00eatre activ\u00e9e automatiquement une     fois le kit d'activation int\u00e9gr\u00e9 via l'interface du pare-feu.</li> </ul> <p>Attention</p> <p></p> <p>Il est n\u00e9cessaire d'importer d'abord le fichier de mise \u00e0 jour t\u00e9l\u00e9charg\u00e9 via le kit d'activation.</p> <ul> <li>Activer le menu Configuration / Syst\u00e8me / Maintenance.</li> <li>L'onglet sur \u00ab\u00a0Mise \u00e0 jour du syst\u00e8me\u00a0\u00bb est activ\u00e9. Cliquer le     bouton \u00ab\u00a0...\u00a0\u00bb et s\u00e9lectionner la mise \u00e0 jour r\u00e9cup\u00e9r\u00e9e dans le kit     d'activation \u00e0 partir d'un poste client ou d'une cl\u00e9 USB.</li> </ul> <p></p> <p>Depuis la zone Configuration avanc\u00e9e, vous pouvez choisir de T\u00e9l\u00e9charger le firmware et l'activer ce qui appliquera la mise \u00e0 jour ou bien de la t\u00e9l\u00e9charger uniquement, son activation pourra se faire ult\u00e9rieurement avec l'option Activer le firmware pr\u00e9c\u00e9demment t\u00e9l\u00e9charg\u00e9.</p> <ul> <li>Dans la zone\u00a0Configuration avanc\u00e9e choisir T\u00e9l\u00e9charger le     firmware et l'activer.</li> <li> <p>Cliquer sur le     bouton\u00a0 L'op\u00e9ration prendra plusieurs minutes surtout ne d\u00e9branchez pas le pare-feu pendant la mise \u00e0 jour. Le pare-feu sera ensuite red\u00e9marr\u00e9.</p> </li> <li> <p>Une fois cette op\u00e9ration r\u00e9alis\u00e9e, activer le menu Configuration /     Syst\u00e8me / Licence puis cliquer sur \u00ab\u00a0Installer la nouvelle     licence\u00a0\u00bb. Cette derni\u00e8re s'active alors automatiquement.</p> </li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#mise-a-jour-du-systeme","title":"Mise \u00e0 jour du syst\u00e8me","text":"<p>Le menu Configuration / Syst\u00e8me / Maintenance / onglet Mise \u00e0 jour du syst\u00e8me permet de mettre \u00e0 jour le syst\u00e8me le cas \u00e9ch\u00e9ant. Afin d'appliquer un fichier de mise \u00e0 jour du firmware, vous devrez le t\u00e9l\u00e9charger sur le pare-feu (soit directement via le lien  une fois que la configuration du r\u00e9seau et de la passerelle par d\u00e9faut est r\u00e9alis\u00e9e et que le pare-feu a acc\u00e8s \u00e0 Internet, soit en allant le t\u00e9l\u00e9charger sur le site https://mystormshield.eu).</p> <p>Attention</p> <p>Pour que la mise \u00e0 jour puisse se faire, la date et l'heure doivent \u00eatre synchronis\u00e9 via le protocole NTP.roduct management\u00a0\u00bb (menu gauche)\u00a0:</p> <p>Attention</p> <p>Il est parfois n\u00e9cessaire de r\u00e9aliser les mises \u00e0 jour interm\u00e9diaires \u00e0 r\u00e9cup\u00e9rer sur le site de Stormshield (cela a \u00e9t\u00e9 le cas sur le SNS510 mais non sur les VM) m\u00eame en dehors de celles qui sont propos\u00e9es.</p> <ul> <li>Cliquer Configuration / Syst\u00e8me /     Maintenance / onglet Mise \u00e0 jour du syst\u00e8me.</li> <li>Cliquer le bouton \u00ab\u00a0...\u00a0\u00bb et s\u00e9lectionner le fichier de mise \u00e0 jour     pr\u00e9sent sur le poste client ou une cl\u00e9 USB.</li> <li>D\u00e9plier la zone Configuration avanc\u00e9e.</li> <li>Dans la \u00ab\u00a0configuration avanc\u00e9e\u00a0\u00bb, vous pouvez choisir de     T\u00e9l\u00e9charger le firmware et l'activer ce qui appliquera la     mise \u00e0 jour ou bien de la t\u00e9l\u00e9charger uniquement, son activation     pourra se faire ult\u00e9rieurement avec l'option Activer le firmware pr\u00e9c\u00e9demment t\u00e9l\u00e9charg\u00e9.</li> <li>Dans la zone\u00a0Configuration avanc\u00e9e choisir T\u00e9l\u00e9charger le     firmware et l'activer.</li> <li>Cliquer sur le     bouton\u00a0</li> </ul> <p>L'op\u00e9ration prendra plusieurs minutes surtout ne d\u00e9branchez pas le pare-feu pendant la mise \u00e0 jour. Le pare-feu sera ensuite red\u00e9marr\u00e9.</p> <p>Attention</p> <p></p> <p>Recharger la page si cette fen\u00eatre boucle ind\u00e9finiment.</p> <p>Le menu Configuration / Syst\u00e8me / Maintenance / onglet Configuration permet uniquement sur les bo\u00eetiers physiques de d\u00e9terminer la partition active et ainsi de garder deux versions du syst\u00e8me disponibles avec une partition de sauvegarde qui permet de revenir en arri\u00e8re sur le boitier (firmware n-1, config n-1).</p> <p>NB\u00a0: Pour revenir \u00e0 une configuration ou version n-2 ou sup\u00e9rieure il faut utiliser USB Recovery accessible seulement sur mystormshield.eu avec un compte client.</p> <p>Le menu Configuration / Syst\u00e8me / Active update permet de contr\u00f4ler la mise \u00e0 jour automatique des modules de Bases d'URLs embarqu\u00e9es, IPS : signatures de protection contextuelles, G\u00e9olocalisation / R\u00e9putation IP publiques, signatures antispam, antivirus et autres listes noires pr\u00e9configur\u00e9es par Stormshield. Il est conseill\u00e9 d'activer uniquement celles qui vous sont utiles.</p>"},{"location":"stormshield/fiches/fiche02_priseEnMain_SNS/#sauvegarde-et-restauration-de-la-configuration","title":"Sauvegarde et restauration de la configuration","text":"<p>La sauvegarde de la configuration se fait dans le menu Configuration / Syst\u00e8me / Maintenance / onglet Sauvegarder.</p> <ul> <li>Au besoin, modifier le nom du fichier et cliquez sur le bouton pour     le t\u00e9l\u00e9charger. La sauvegarde automatique du fichier de     configuration peut \u00eatre mise en place et effectu\u00e9e sur le Cloud     Stormshield.</li> </ul> <p>Info</p> <p>le fichier de configuration est un fichier texte chiffr\u00e9 (extension \u00ab\u00a0na\u00a0\u00bb).</p> <p>La restauration d'une configuration s'effectue dans le menu Configuration / Syst\u00e8me / Maintenance / onglet Restaurer.</p> <ul> <li>S\u00e9lectionner le fichier \u00e0 restaurer en cliquant sur le bouton ...</li> </ul>"},{"location":"stormshield/fiches/fiche03_gestionJournaux_SNS/","title":"Fiche 03 -- Traces, Journaux et supervision","text":"<p>Le stockage des journaux (logs) des pare-feu Stormshield peut \u00eatre configur\u00e9 soit en local, soit vers un serveur Syslog, soit avec le protocole IPFIX.\u00a0Les journaux, rapports d'activit\u00e9s et graphiques d'historiques sont disponibles sur les pare-feus ne disposant pas de stockage local des journaux. Cependant, ils sont limit\u00e9s \u00e0 5 rapports et graphiques au total avec un historique maximal de 7 jours.</p>"},{"location":"stormshield/fiches/fiche03_gestionJournaux_SNS/#configuration-du-stockage-des-journaux-logs","title":"Configuration du stockage des journaux (logs)","text":"<p>Le stockage en local n'est activ\u00e9 par d\u00e9faut que sur les machines virtuelles, il faut donc le cas \u00e9ch\u00e9ant le configurer.</p> <ul> <li>S\u00e9lectionner dans le menu \u00e0 gauche Configuration / Notifications /     Traces -- Syslog - IPFIX puis dans l'onglet / Traces -- Syslog     -- IPFIX choisir Stockage local. </li> </ul> <p>Sur une machine virtuelle, celui-ci est activ\u00e9 par d\u00e9faut et occupe un espace disque de 6Go\u00a0:</p> <p></p> <p>Sur un bo\u00eetier physique, le stockage local des logs n'est pas activ\u00e9 par d\u00e9faut.</p> <ul> <li>Ins\u00e9rer une carte SD dans l'emplacement en fa\u00e7ade du pare-feu SNS,     lorsque le pare-feu est \u00e9teint, elle sera automatiquement d\u00e9tect\u00e9e     lors du d\u00e9marrage (sauf si vous n'avez pas install\u00e9 la licence) et     le syst\u00e8me vous proposera de la formater avant utilisation.</li> </ul> <p></p> <p>La zone Support de stockage permet de s\u00e9lectionner le support de stockage local \u00ab\u00a0disque dur interne\u00a0\u00bb ou \u00ab\u00a0carte m\u00e9moire SD\u00a0\u00bb. Au besoin\u00a0:</p> <ul> <li>cocher le bouton     ON\u00a0;</li> <li>dans la zone Support de stockage s\u00e9lectionner dans la liste     P\u00e9riph\u00e9rique la carte SD comme support de stockage.</li> </ul> <p>Le syst\u00e8me vous propose de la formater avant utilisation.</p> <p></p> <ul> <li>Cliquer Formater Carte SD. Cette op\u00e9ration prend quelques secondes.</li> </ul> <p>Attention</p> <p>Afin de stocker les journaux du pare-feu SNS sur un support externe (carte SD) vous devez d'abord enregistrer la licence, le message d'erreur qui appara\u00eet alors n'est pas explicite, le syst\u00e8me fait comme s'il ne pouvait d\u00e9tecter la carte SD.</p> <p>Une fois le support format\u00e9, la liste des journaux pr\u00e9-configur\u00e9s est activ\u00e9e avec pour chaque journal un espace d\u00e9di\u00e9. Vous pouvez d\u00e9sactiver certains journaux si vous le souhaitez.</p> <p></p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer Appliquer puis Sauvegarder pour     activer le stockage local des journaux.</li> </ul> <p></p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer Conserver les rapports d'activit\u00e9     d\u00e9sactiv\u00e9s.</li> </ul> <p></p> <p>La zone Configuration de l'espace r\u00e9serv\u00e9 pour les traces permet d'activer ou non l'\u00e9criture des traces pour une famille donn\u00e9e en double-cliquant dans la colonne \u00c9tat correspondante. Elle permet \u00e9galement de configurer le pourcentage de l'espace disque r\u00e9serv\u00e9 pour la famille de trace dans la partie Pourcentage. Il est important de noter que le total des pourcentages ne doit pas d\u00e9passer 100\u00a0%. La taille r\u00e9elle de l'espace disque r\u00e9serv\u00e9 \u00e0 une famille de traces est indiqu\u00e9e dans la partie Quota d'espace disque.</p> <p>Les entr\u00e9es de journal anciennes sont \u00e9cras\u00e9es par les nouvelles entr\u00e9es (rotation)\u00a0: il s'agit du comportement par d\u00e9faut. Pour une journalisation sans rotation, il faut un stockage externe (serveur SYSLOG par exemple).</p> <p>L'activation des rapports s'effectue depuis le menu Configuration / Notifications / Configuration des rapports.</p> <ul> <li>Cliquer Configuration / Notifications / Configuration des     rapports et activez l'option Rapports statiques, ensuite     s\u00e9lectionnez les rapports souhait\u00e9s dans le panneau Liste des     rapports.</li> </ul> <p></p> <p>Par d\u00e9faut le rapport sur le Top des protocoles par volume est activ\u00e9 si vous activez les rapports.</p> <p>L'onglet Liste des graphiques historiques permet de visualiser et modifier les graphiques activ\u00e9s par d\u00e9faut.</p> <p></p>"},{"location":"stormshield/fiches/fiche03_gestionJournaux_SNS/#les-journaux","title":"Les Journaux","text":"<p>Les fichiers journaux sont organis\u00e9s en plusieurs cat\u00e9gories dont les plus importantes sont list\u00e9es ci-dessous.</p> <ul> <li>Administration\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s \u00e0 l'administration     du pare-feu SNS. Ainsi, toutes les modifications de configuration     effectu\u00e9es sur le pare-feu sont journalis\u00e9es.</li> <li>Authentification\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s \u00e0     l'authentification des utilisateurs sur le pare-feu SNS.</li> <li>Connexions r\u00e9seaux\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux connexions     TCP/UDP traversant ou \u00e0 destination du pare-feu SNS non trait\u00e9es par     un plugin applicatif.</li> <li>\u00c9v\u00e8nements syst\u00e8mes\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s directement     au syst\u00e8me: arr\u00eat/d\u00e9marrage du pare-feu SNS, erreurs syst\u00e8me,     allumage/extinction d'une interface, haute disponibilit\u00e9, mises \u00e0     jour Active Update, etc.</li> <li>Alarmes\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux fonctions de     pr\u00e9vention d'intrusions (IPS) et les \u00e9v\u00e8nements trac\u00e9s avec le     niveau alarme mineure ou majeure de la politique de filtrage.</li> <li>Proxy HTTP\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux connexions     traversant le proxy HTTP.</li> <li>Connexions applicatives (plugin)\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s     aux connexions trait\u00e9es par un plugin applicatif (HTTP, FTP, SIP,     etc).</li> <li>Politique de filtrage\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux r\u00e8gles     de filtrages et/ou de NAT, lorsque la journalisation des r\u00e8gles est     en mode verbeux.</li> </ul> <p>Dans le contexte Monitoring, le menu LOGS - JOURNAUX D'AUDIT permet de visualiser les journaux et traces sauvegard\u00e9s en local sur le pare-feu SNS, regroup\u00e9s par famille de journaux\u00a0: trafic r\u00e9seau, alarmes, web, etc.</p> <p>Exemple\u00a0: la famille Trafic r\u00e9seau concat\u00e8ne les journaux Connexions r\u00e9seaux, filtrage, Proxy FTP, connexions applicatives, Proxy POP3, Proxy SMTP, Proxy SSL, Proxy HTTP, VPN SSL.</p> <p>Les traces sont affich\u00e9es par ordre anti chronologique (la trace la plus r\u00e9cente est en t\u00eate de liste).</p> <p>Important</p> <p>Pour appliquer le r\u00e8glement g\u00e9n\u00e9ral sur la protection des donn\u00e9es (RGPD), l'acc\u00e8s aux logs des pare-feus SNS est restreint par d\u00e9faut pour tous les administrateurs.</p> <p></p> <p>Le super administrateur \u00ab\u00a0admin\u00a0\u00bb, ainsi que les administrateurs disposant du droit \u00ab\u00a0Acc\u00e8s aux donn\u00e9es personnelles\u00a0\u00bb peuvent acc\u00e9der aux logs complets en cliquant simplement sur Obtenir le droit d'acc\u00e8s aux donn\u00e9es personnelles (logs). Cette manipulation ajoute une entr\u00e9e dans les journaux qui permet de la tracer.</p> <p></p>"},{"location":"stormshield/fiches/fiche03_gestionJournaux_SNS/#consultation-des-journaux","title":"Consultation des Journaux","text":"<ul> <li>Cliquer Monitoring puis LOGS - JOURNAUX D'AUDIT puis, par     exemple, Trafic r\u00e9seau.</li> </ul> <p>Pour voir l'ensemble des donn\u00e9es relatives \u00e0 une trace, mettez la ligne d\u00e9sir\u00e9e en surbrillance et cliquez sur la fl\u00e8che en haut \u00e0 droite D\u00e9tails de la ligne de log.</p> <p></p> <p>L'affichage des journaux peut \u00eatre restreint \u00e0 une plage temporelle pr\u00e9d\u00e9finie (derni\u00e8re heure, aujourd'hui, hier, semaine derni\u00e8re ou mois dernier) ou personnalis\u00e9e.</p> <p>En cliquant sur un type de trace, une fen\u00eatre s'affiche pour offrir des raccourcis vers plusieurs fonctionnalit\u00e9s qui diff\u00e8rent suivant le type de trace affich\u00e9e : afficher de l'aide, ajouter la machine \u00e0 la base objet, filtrer les traces en se basant sur la valeur, voir la ligne compl\u00e8te de la trace, etc.</p> <p>Pour filtrer les traces, une barre de recherche simple permet de rechercher une cha\u00eene de caract\u00e8res dans toutes les colonnes de toutes les traces, voir l'exemple ci-dessous pour icmp.</p> <p></p>"},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/","title":"Fiche 04 -- Configuration du r\u00e9seau","text":""},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/#configuration-des-interfaces-reseau","title":"Configuration des interfaces r\u00e9seau","text":"<p>Dans une configuration usine, la premi\u00e8re interface du pare-feu SNS 210 est nomm\u00e9e \u00ab\u00a0OUT\u00a0\u00bb (qui correspond \u00e0 l'interface WAN sur un boitier physique) et la seconde* \u00ab\u00a0IN\u00a0\u00bb. Les suivantes (3 \u00e0 7) sont des ports de commutateurs. La derni\u00e8re interface \u00ab\u00a0DMZ1\u00a0\u00bb (qui correspond \u00e0 l'interface \u00a0DMZ\u00a0 sur un boitier physique 210) sert \u00e0 connecter le pare-feu sur une zone d\u00e9militaris\u00e9e. *</p> <p>L'interface \u00ab\u00a0OUT\u00a0\u00bb est une interface externe, utilis\u00e9e pour connecter le pare-feu SNS \u00e0 internet (WAN) et le reste des interfaces sont internes et servent principalement \u00e0 connecter le pare-feu SNS \u00e0 des r\u00e9seaux locaux. La distinction interface interne/externe permet de se prot\u00e9ger contre les attaques d'usurpation d'adresse IP.</p> <p>Attention</p> <p>Pour acc\u00e9der \u00e0 l'interface d'administration du pare-feu SNS, il faut connecter votre machine sur une interface interne (in, dmz1, dmz2, etc) **sous peine d'\u00eatre d\u00e9tect\u00e9 comme tentative d'intrusion qui n\u00e9cessite le red\u00e9marrage du firewall.</p> <p>Attention</p> <p>Dans ce cas, on aura un message \u00ab\u00a0forbidden\u00a0\u00bb sur le navigateur, on peut d\u00e9connecter le c\u00e2ble (faisable aussi en virtuel en d\u00e9sactivant la carte), changer son IP et se reconnecter \u00e0 une autre interface interne sans red\u00e9marrage.*</p> <p>La configuration des interfaces s'effectue dans le menu Configuration / R\u00e9seau / Interfaces, en faisant \u00ab\u00a0sortir\u00a0\u00bb les interfaces Ethernet de l'interface bridge cr\u00e9\u00e9e par d\u00e9faut sur le bo\u00eetier.</p> <ul> <li>S\u00e9lectionner Configuration / R\u00e9seau / Interfaces.</li> </ul> <p>Configuration par d\u00e9faut avec bridge</p> <p></p> <p>Configuration en mode routeur</p> <p></p> <ul> <li>Choisir une interface (par exemple IN), pour la sortir du bridge     ou la configurer avec une IP fixe, les manipulations sont     identiques.</li> </ul> <p></p> <p>Attention</p> <p>Il s'agit ici d'une interface interne (prot\u00e9g\u00e9e), le bouton radio correspondant doit \u00eatre coch\u00e9.</p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer dans la zone Plan d'adressage sur     Dynamique/Statique.</li> <li>Cliquer Ip fixe (statique), un tableau appara\u00eet\u00a0:</li> </ul> <p></p> <ul> <li>Cliquer +Ajouter\u00a0et dans la zone Adresse / Masque et saisir     l'adresse IP de l'interface IN puis le masque en CIDR (/24 par     exemple) ou en notation d\u00e9cimale point\u00e9e\u00a0: 255.255.255.0.</li> </ul> <p></p> <ul> <li>Cliquer le bouton Appliquer puis Sauvegarder et \u00e0 nouveau     Sauvegarder.</li> </ul>"},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/#route-par-defaut","title":"Route par d\u00e9faut","text":"<ul> <li>Cliquer Configuration / R\u00e9seau / Routage / onglet Routes     statiques IPv4.</li> </ul> <ul> <li>Cliquer sur     l'ic\u00f4ne\u00a0 pour ajouter un objet r\u00e9seau (cf. fiche 4 pour     plus de d\u00e9tails), choisir Machine et renseigner les champs     Nom (Ex\u00a0: FW-Siege) et Adresse IPv4 du     pare-feu SNS Si\u00e8ge puis cliquer sur le bouton Cr\u00e9er.</li> </ul> <p>Par exemple\u00a0:</p> <p></p> <p>Il est bien s\u00fbr possible de proc\u00e9der autrement en cr\u00e9ant au pr\u00e9alable l'objet r\u00e9seau. Il suffit ensuite de le s\u00e9lectionner.</p>"},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/#configuration-du-proxy-cache-dns","title":"Configuration du proxy cache DNS","text":"<p>Le proxy cache DNS doit \u00eatre activ\u00e9 pour permettre la r\u00e9solution de noms DNS de fa\u00e7on correcte pour la mise en \u0153uvre des activit\u00e9s (labs).</p> <ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrez l'onglet     Param\u00e8tres r\u00e9seaux pour visualiser les options de configuration     r\u00e9seau du pare-feu.</li> </ul> <p></p> <p>La liste des serveurs DNS utilis\u00e9s par le pare-feu doit permettre la r\u00e9solution DNS vers des serveurs de l'Internet, vous pouvez conserver les serveurs de google (par d\u00e9faut) ou les remplacer par d'autres.</p> <p>Le pare-feu intercepte les requ\u00eates DNS \u00e0 destination d'Internet, et effectue lui-m\u00eame la requ\u00eate vers le serveur DNS configur\u00e9. Si le nom demand\u00e9 est dans son cache, le pare-feu r\u00e9pond directement \u00e0 la demande selon les informations qu'il poss\u00e8de. Il est possible de configurer le proxy cache afin que le serveur DNS pr\u00e9sent sur la DMZ puisse l'interroger.</p> <ul> <li>Dans le volet Configuration / R\u00e9seau, ouvrir Proxy cache     DNS.</li> <li>Cliquer sur OFF pour activer le cache DNS, il passe \u00e0 ON.</li> <li>Dans la \u00ab\u00a0liste des clients autoris\u00e9s \u00e0 utiliser le cache DNS\u00a0\u00bb,     cliquer + Ajouter puis cliquer sur l'ic\u00f4ne      pour ajouter un objet Machine, dans Nom de     l'objet, saisir un nom (par exemple srv_dns_priv), dans     Adresse IPv4 saisir l'adresse du DNS puis Cr\u00e9er pour     l'ajouter puis Appliquer.</li> </ul>"},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/#politique-de-securite-et-nat-en-bref","title":"Politique de s\u00e9curit\u00e9 et NAT en bref","text":"<p>Le d\u00e9tail des diff\u00e9rentes possibilit\u00e9s de param\u00e9trage figure dans les fiches 5 et 6.</p> <p> Dans les pare-feu SNS, les r\u00e8gles de filtrage et NAT (traduction d'adresses) sont regroup\u00e9es sous une m\u00eame politique. Il est possible de d\u00e9finir 10 politiques diff\u00e9rentes mais une seule politique est active \u00e0 la fois, identifi\u00e9e par l'ic\u00f4ne\u00a0:</p> <p>La politique de s\u00e9curit\u00e9 active en configuration usine est (1) Block all, elle n'autorise que le ping des interfaces du pare-feu et l'acc\u00e8s en https \u00e0 l'administration du bo\u00eetier.</p> <p>Une politique implicite Block all est \u00e9galement configur\u00e9e sur le pare-feu SNS.</p> <p>Pour modifier\u00a0:</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT.</li> </ul> <p>{width=\"15.947cm\" height=\"6.075cm\"}</p> <ul> <li>Proc\u00e9der aux modifications voulues (cf. fiche 6)</li> <li>Cliquer Sauvegarder les modifications.</li> </ul> <p>Voici ci-dessus le r\u00e9sultat si on applique la derni\u00e8re politique \u00ab\u00a0Pass all\u00a0\u00bb.</p> <p></p> <p>Pour ajouter une r\u00e8gle de NAT dynamique NAPT afin que les machines du r\u00e9seau interne (Network_internals) puissent acc\u00e9der au r\u00e9seau externe (Network_Out) et \u00e0 Internet</p> <p>La r\u00e8gle de NAT dynamique est cr\u00e9\u00e9e avec le bouton Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source (masquerading) qui ajoute automatiquement la plage de ports pr\u00e9d\u00e9finie\u00a0ephemeral_fw\u00a0[20000-59999] au niveau du port source dans le trafic apr\u00e8s traduction. Par d\u00e9faut, les ports sont choisis s\u00e9quentiellement dans cette plage, cependant une option est disponible pour permettre un choix al\u00e9atoire du num\u00e9ro de port pour chaque nouvelle connexion et le rendre ainsi moins pr\u00e9dictible.</p> <ul> <li>Dans votre politique (10), s\u00e9lectionner l'onglet NAT puis     Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source     (masquerading) </li> </ul> <p></p> <p>Une nouvelle r\u00e8gle non activ\u00e9e appara\u00eet avec des valeurs par d\u00e9faut any, any. Dans la section Trafic apr\u00e8s translation, le port source sera traduit par un num\u00e9ro de port choisi dans la plage ephemeral_fw.</p> <p>La configuration du Trafic original (avant translation) permet de renseigner les valeurs des param\u00e8tres avant traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du r\u00e9seau     source\u00a0;</li> <li>Destination permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du     r\u00e9seau destination.</li> </ul> <p>La configuration du Trafic apr\u00e8s translation permet de renseigner les nouvelles valeurs des param\u00e8tres apr\u00e8s traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source d\u00e9finit l'adresse IP ou le r\u00e9seau source et le port     source vus de l'ext\u00e9rieur.</li> <li>Destination d\u00e9finit l'adresse IP ou le r\u00e9seau destination et     Port destination translat\u00e9e le port de destination.</li> </ul> <p>Pour configurer un NAT/PAT pour permettre la sortie sur Internet</p> <ul> <li>Double-cliquer sur une zone vide de la r\u00e8gle pour ouvrir la fen\u00eatre     de configuration d\u00e9taill\u00e9e \u00ab\u00a0Edition de la r\u00e8gle N\u00b01\u00a0\u00bb.</li> <li>Cliquer l'onglet du menu de gauche G\u00e9n\u00e9ral, dans la     zone Commentaire, saisir un commentaire, par exemple     \u00ab\u00a0Configuration de la r\u00e8gle de NAT/PAT pour la sortie internet\u00a0\u00bb.</li> <li>Cliquer sur l'onglet du menu de gauche Source Originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir     Network_internals (qui renvoie \u00e0 tous les r\u00e9seaux internes     prot\u00e9g\u00e9s), dans l'onglet Configuration avanc\u00e9e, laissez Any pour     le port de destination.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Destination originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir Internet,     laissez Any pour le port de destination.</li> </ul> <p></p> <p>Vigilence</p> <p>Attention : si dans la zone destination originale, vous laissez Any, plut\u00f4t qu'Internet qui d\u00e9signe tous les r\u00e9seaux sauf ceux internes au pare-feu SNS, le pare-feu SNS bloquera les flux d'administration (en ssh et en https). En effet, les flux d'administration subiront \u00e9galement une traduction NAT vers l'interface OUT qui l'interpr\u00e9tera comme une tentative d'intrusion et les bloquera.</p> <p>Vigilence</p> <p>Vous pouvez rendre cette r\u00e8gle plus restrictive en choisissant explicitement l'interface de sortie.</p> <ul> <li>Cliquer sur l'onglet Configuration avanc\u00e9e et s\u00e9lectionnez     out dans Interface de sortie.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet Source translat\u00e9e et     s\u00e9lectionner Firewall_Out dans Machine source translat\u00e9e.</li> <li>Dans Port source translat\u00e9, laisser ephemeral_fw et cocher     choisir al\u00e9atoirement le port source translat\u00e9.</li> </ul> <p>Vigilence</p> <p>Cette option choisit al\u00e9atoirement le port source translat\u00e9, ce qui permet d'\u00e9viter les attaques utilisant la pr\u00e9dictibilit\u00e9 des ports utilis\u00e9s. Ainsi si le premier port est 10000, le suivant ne sera pas 10001. Cette pr\u00e9caution n'emp\u00eache pas les attaques, elle permet de les rendre plus complexes.</p> <p></p> <ul> <li>Cliquer l'onglet du menu de gauche Protocole, cela permet de     d\u00e9finir le type de protocole\u00a0: applicatif, IP ou Ethernet, laisser     D\u00e9tection automatique du protocole (par d\u00e9faut)</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Options,\u00a0cela permet de     tracer le trafic qui correspond \u00e0 la r\u00e8gle de traduction dans le     journal de connexions, choisir tracer.</li> </ul> <p></p> <p>Information</p> <p>NB\u00a0: Le NAT ne laisse jamais de traces dans le journal de connexions. Pour tracer une r\u00e8gle de NAT, il faut choisir l'option \u00ab\u00a0tracer\u00a0\u00bb, sinon, aucune journalisation de NAT ne sera effectu\u00e9e.</p> <p></p> <ul> <li>Cliquer sur OK pour sauvegarder les     modifications de la r\u00e8gle de NAT dynamique que vous venez de cr\u00e9er.</li> <li> <p>Dans la colonne \u00c9tat, s\u00e9lectionner avec la fl\u00e8che D\u00e9finir     l'\u00e9tat on  La r\u00e8gle passe.</p> </li> <li> <p>Cliquer sur Appliquer puis Oui, Activer la politique     puis confirmer.</p> </li> </ul> <p></p> <p>Pour g\u00e9rer les statistiques d'utilisation</p> <p>Dans la liste des r\u00e8gles la barre devient verte quand les r\u00e8gles s'appliquent et une info-bulle indique le nombre de fois o\u00f9 la r\u00e8gle a \u00e9t\u00e9 appliqu\u00e9e\u00a0:</p> <p></p> <p>Dans le bandeau d'affichage des r\u00e8gles, d\u00e9pliez le menu cliquez sur R\u00e9initialiser les statistiques des r\u00e8gles pour remettre les compteurs \u00e0 z\u00e9ro.</p> <p></p>"},{"location":"stormshield/fiches/fiche04_configurationReseau_SNS/#creation-de-sous-interfaces-pour-la-gestion-des-trames-etiquetees-8021q-et-des-vlan","title":"Cr\u00e9ation de sous-interfaces pour la gestion des trames \u00e9tiquet\u00e9es (802.1q) et des VLAN","text":"<p>Vigilence</p> <p>Lorsque le pare-feu doit \u00e9galement g\u00e9rer le routage inter-vlan, il est n\u00e9cessaire de cr\u00e9er \u00e0 partir d'une interface physique des sous-interfaces \u00e0 m\u00eame d'interpr\u00e9ter des trames Ethernet \u00e9tiquet\u00e9es 802.1q en fonction des VLAN cr\u00e9\u00e9s.</p> <p>Si l'interface IN est celle utilis\u00e9e pour se connecter \u00e0 la page web d'administration du pare-feu mais \u00e9galement pour la cr\u00e9ation de sous-interfaces, il est indispensable d'avoir un acc\u00e8s \u00e0 cette m\u00eame application par une autre interface telle que DMZ. Sans cela, il ne sera plus possible de se connecter au pare-feu pour l'administrer.</p> <p>Vigilence</p> <p>La d\u00e9sactivation de l'interface parent peut se faire dans un second temps une fois que les interfaces virtuelles sont configur\u00e9es.</p> <p>Pour cr\u00e9er une sous-interface, il est n\u00e9cessaire de se rendre dans le menu Configuration / R\u00e9seau / Interfaces.</p> <p></p> <p>Contrairement \u00e0 la cr\u00e9ation de sous-interfaces sur des routeurs Cisco qui consiste \u00e0 activer l'interface r\u00e9seau physique sans lui attribuer de configuration IP, Stormshield recommande de d\u00e9sactiver  l'interface parente qui servira \u00e0 la cr\u00e9ation des sous-interfaces associ\u00e9es \u00e0 chaque VLAN\u00a0:</p> <ul> <li>double-cliquer sur l'interface physique concern\u00e9e par le routage     inter-vlan (in la plupart du temps) puis dans l'onglet     Configuration G\u00e9n\u00e9rale\u00a0pour la d\u00e9sactiver, passer     l'Etat\u00a0\u00e0\u00a0Off.</li> </ul> <p></p> <ul> <li>S\u00e9lectionner ensuite l'interface physique que vous venez de     d\u00e9sactiver puis cliquer sur Ajouter / VLAN / Pour in (ou toute     autre interface concern\u00e9e).</li> </ul> <p></p> <ul> <li>D\u00e9finir un nom pour la sous-interface en respectant une convention     de nommage coh\u00e9rente puis un commentaire permettant d'expliciter     l'utilit\u00e9 de celle-ci.</li> <li>Le cas \u00e9ch\u00e9ant, choisir l'interface parente correspondante et     d\u00e9finir un identifiant correspondant au VID du VLAN concern\u00e9 (10,     100, 200...).</li> <li>Cette sous-interface est interne puisque les VLAN sont tr\u00e8s souvent     impl\u00e9ment\u00e9s sur le r\u00e9seau local de l'entreprise.</li> </ul>"},{"location":"stormshield/fiches/fiche05_configurationObjetsReseaux_SNS/","title":"Fiche 05 -- Configuration des Objets R\u00e9seau","text":"<p>Les objets r\u00e9seau sont notamment n\u00e9cessaires \u00e0 la mise en place de r\u00e8gles de filtrage et de NAT.</p>"},{"location":"stormshield/fiches/fiche05_configurationObjetsReseaux_SNS/#presentation-des-objets","title":"Pr\u00e9sentation des Objets","text":"<p>Les menus de configuration des pare-feu Stormshield Network utilisent des objets qui repr\u00e9sentent des valeurs (adresse IP, adresse r\u00e9seau, URL, \u00e9v\u00e9nement temporel, etc.). L'utilisation d'objets au lieu de valeurs pr\u00e9sente deux avantages majeurs\u00a0:</p> <ol> <li> <p>Cela permet \u00e0 l'administrateur de manipuler des noms, plus parlants     que des valeurs.</p> </li> <li> <p>Dans le cas o\u00f9 une valeur change, il suffira de modifier la valeur     au niveau de l'objet et non dans tous les menus o\u00f9 l'objet est     utilis\u00e9.</p> </li> </ol> <p>La cr\u00e9ation et la configuration des objets s'effectuent :</p> <ul> <li>Dans le menu\u00a0: CONFIGURATION / OBJETS</li> <li>Dans le menu raccourci\u00a0:     </li> <li>Depuis n'importe quel autre menu via le bouton     </li> </ul> <p>Les objets sont class\u00e9s en 3 cat\u00e9gories\u00a0:</p> <ol> <li>Objets R\u00e9seau\u00a0: regroupe tous les objets en relation avec les     valeurs r\u00e9seaux (adresse IP, num\u00e9ro de port, num\u00e9ro de protocole,     etc.) et les objets temps (par exemple, l'objet Machine     FWOUT_Siege qui repr\u00e9sente la passerelle des agences).</li> <li>Objets Web\u00a0: groupes d'URL (ou groupes de cat\u00e9gories) et groupes     de noms de certificats.</li> <li>Certificats et PKI\u00a0: permet la cr\u00e9ation et la gestion des     autorit\u00e9s de certification et de tous les certificats (de type     serveur, utilisateur, ou smartcard) qui en d\u00e9coulent.</li> </ol> <p>On peut distinguer deux types d'objets particuliers en plus des objets qui peuvent \u00eatre cr\u00e9\u00e9s par l'administrateur\u00a0:</p> <ul> <li>Objets implicites\u00a0: ils sont cr\u00e9\u00e9s automatiquement par le     pare-feu et d\u00e9pendent de la configuration r\u00e9seau. Ces objets sont en     lecture seule et ne peuvent \u00eatre ni modifi\u00e9s ni supprim\u00e9s par     l'administrateur. Par exemple, l'objet \u00ab\u00a0Firewall_out\u00a0\u00bb, cr\u00e9\u00e9     automatiquement lorsqu'une adresse IP est associ\u00e9e \u00e0 l'interface     \u00ab\u00a0OUT\u00a0\u00bb ou l'objet \u00ab\u00a0Network_internals \u00bb qui regroupe     tous les r\u00e9seaux accessibles via les interfaces internes.</li> <li>Objets pr\u00e9-configur\u00e9s\u00a0: ils sont pr\u00e9sents par d\u00e9faut dans la     liste des objets. Ils repr\u00e9sentent des valeurs de param\u00e8tres r\u00e9seaux     standardis\u00e9es (ports, protocoles, r\u00e9seaux) et des valeurs     n\u00e9cessaires pour le fonctionnement du pare-feu (adresse IP des     serveurs Stormshield pour les mises \u00e0 jour). On trouvera par exemple     le protocole ICMP et l'objet \u00ab\u00a0Internet\u00a0\u00bb\u00a0qui regroupe     l'ensemble des machines ne faisant pas partie des r\u00e9seaux internes.</li> </ul> <p>Attention</p> <p>Il est conseill\u00e9 d'utiliser les objets implicites et pr\u00e9-configur\u00e9s et d'\u00e9viter de cr\u00e9er d'autres objets portant les m\u00eames valeurs.</p> <p>Les recommandations sont les suivantes\u00a0:</p> <ul> <li>utiliser les objets implicites ou pr\u00e9-configur\u00e9s\u00a0;</li> <li>suivre une convention de nommage des objets bien d\u00e9finie et     l'appliquer strictement \u00e9vite la cr\u00e9ation de doublons et facilite la     lecture des objets\u00a0;</li> <li>utiliser un groupe d'objet d'administration contenant l'ensemble     des IP et des r\u00e9seaux d'administration permet de r\u00e9utiliser ce     groupe dans toutes les r\u00e8gles de filtrage li\u00e9es \u00e0 l'administration     et donc de maintenir leur coh\u00e9rence tout en facilitant leur     modification\u00a0;</li> <li>limiter l'usage des objets dynamiques (type FQDN et Dynamic Host)\u00a0:     ils g\u00e9n\u00e8rent des requ\u00eates DNS r\u00e9guli\u00e8res. Cela sollicite le r\u00e9seau     et le pare-feu, utilisez cette fonctionnalit\u00e9 lorsqu'elle est     n\u00e9cessaire\u00a0;</li> <li>limiter le nombre d'objets inutilis\u00e9s\u00a0: ils chargent l'affichage et     sont bien souvent oubli\u00e9s et recr\u00e9\u00e9s\u00a0;</li> <li>\u00e9viter les doublons, ils doivent \u00eatre traqu\u00e9s et supprim\u00e9s car     c'est une source d'erreur courante lors de la modification de r\u00e8gles     de filtrage. On se retrouve dans un cas o\u00f9 la modification d'un     objet n'impacte pas toutes les r\u00e8gles qui auraient d\u00fb l'\u00eatre, cr\u00e9ant     ainsi des trous dans la s\u00e9curit\u00e9.</li> </ul> <p>La syntaxe des noms des objets (insensible \u00e0 la casse) doit respecter quelques restrictions d\u00e9finies dans le tableau ci-dessous\u00a0:</p> <p></p>"},{"location":"stormshield/fiches/fiche05_configurationObjetsReseaux_SNS/#creation-des-objets-reseaux","title":"Cr\u00e9ation des objets \u00ab\u00a0R\u00e9seaux\u00a0\u00bb","text":"<p>Le menu Configuration / Objets / Objets r\u00e9seau ou le menu Objets r\u00e9seau permettent de visualiser les objets, de les modifier ou d'en ajouter.</p> <p> </p> <ul> <li>Ouvrir Configuration / Objets\u00a0/ Objets r\u00e9seau et cliquer     sur le bouton Ajouter pour ajouter les objets souhait\u00e9s.</li> </ul> <p></p> <p>Les types d'objets suivants peuvent \u00eatre cr\u00e9\u00e9s :</p> <ul> <li>Machine\u00a0: une adresse IP,</li> <li>Nom DNS (FQDN)\u00a0: toutes les adresses IP associ\u00e9es \u00e0 un nom FQDN par     r\u00e9solution DNS,</li> <li>R\u00e9seau\u00a0: une adresse r\u00e9seau,</li> <li>Plage d'adresses IP\u00a0: une plage d'adresses,</li> <li>Routeur\u00a0: permet de renseigner une ou plusieurs passerelles pour un     routage par r\u00e9partition de charge avec ou sans passerelle de     secours.</li> <li>Groupe\u00a0: un groupe d'objets portant une ou plusieurs adresses IP :     machines, plages d'adresses IP, r\u00e9seaux ou d'autres groupes,</li> <li>Protocole IP\u00a0: l'ID du protocole au niveau IP,</li> <li>Port - Plage de ports\u00a0: un port ou une plage de ports. Il/Elle peut     \u00eatre limit\u00e9(e) \u00e0 un protocole de transport particulier (TCP ou UDP),</li> <li>Groupe de ports\u00a0: un groupe d'objets portant des ports ou des plages     de ports, ainsi que d'autres groupes de ports,</li> <li>Groupe de r\u00e9gions\u00a0: un groupe de pays ou de continents. Ce type     d'objet peut \u00eatre utilis\u00e9 dans la g\u00e9olocalisation des adresses IP,</li> <li>Objet temps\u00a0: un \u00e9v\u00e9nement temporel (ponctuel, jour de l'ann\u00e9e,     jour(s) de la semaine ou plage(s) horaire(s)).</li> </ul> <p>Attention</p> <p>ATTENTION, il faut utiliser un typage d'objets ad\u00e9quat (objet r\u00e9seau pour les r\u00e9seaux, objet machine pour les pare-feu, etc.).</p> <ul> <li>Cliquer sur + CR\u00c9ER pour ajouter l'objet.</li> </ul>"},{"location":"stormshield/fiches/fiche05_configurationObjetsReseaux_SNS/#importexport-des-objets","title":"Import/Export des Objets","text":"<p>Il est possible d'exporter la base d'objets du pare-feu SNS dans un fichier CSV en cliquant sur le bouton \u00ab\u00a0Exporter\u00a0\u00bb. Le fichier CSV g\u00e9n\u00e9r\u00e9 contient les objets machines, plages d'adresses IP, r\u00e9seaux, FQDN, ports -- plages de ports, protocoles, groupes et groupes de ports.</p> <p>Les objets sont organis\u00e9s par cat\u00e9gorie et s\u00e9par\u00e9s par des lignes contenant les noms des param\u00e8tres\u00a0: #type, #name, #IP, etc. (les param\u00e8tres diff\u00e8rent en fonction des cat\u00e9gories d'objets). Les attributs d'un objet, quant \u00e0 eux, sont s\u00e9par\u00e9s par des virgules.</p> <p>Il est possible d'importer des objets depuis un fichier CSV poss\u00e9dant le m\u00eame format que le fichier export\u00e9.</p> <p>Un rapport statistique affiche le nombre d'objets import\u00e9s par type. En cas d'erreur d'import, la base d'objets n'est pas modifi\u00e9e.</p> <p>Attention</p> <p>Les objets du fichier import\u00e9 \u00e9crasent ceux du firewall s'ils portent le m\u00eame nom. Les autres objets ne sont pas affect\u00e9s.</p> <ul> <li>Cliquer sur Exporter, pour exporter la base d'objets     pr\u00e9c\u00e9demment cr\u00e9\u00e9s dans un fichier CSV.</li> </ul> <p></p> <ul> <li> <p>Et cliquer sur Importer,</p> </li> <li> <p>Cliquer sur Importer, pour importer le fichier CSV apr\u00e8s une     \u00e9ventuelle modification, puis choisissez le fichier \u00ab\u00a0csv\u00a0\u00bb et     cliquer sur Transf\u00e9rer pour commencer l'import puis Fermer.     Une barre d'avancement permet de visualiser le d\u00e9roulement de     l'import. Et une fois fini, un rapport statistique affiche le nombre     d'objets import\u00e9s par type.</p> </li> </ul> <p></p> <p>Information</p> <p>En cas de probl\u00e8me \u00e0 l'importation, encodez le fichier en UTF-8 avec des retours \u00e0 la ligne type Unix (LF).</p>"},{"location":"stormshield/fiches/fiche06_configurationNat_SNS/","title":"Fiche 06-- Configuration du NAT/PAT","text":"<p>Dans les pare-feu SNS, les r\u00e8gles de filtrage et NAT (traduction d'adresses) sont regroup\u00e9es sous une m\u00eame politique. Il est possible de d\u00e9finir 10 politiques diff\u00e9rentes mais une seule politique est active \u00e0 la fois, identifi\u00e9e par l'ic\u00f4ne \u00a0:</p>"},{"location":"stormshield/fiches/fiche06_configurationNat_SNS/#mise-en-uvre-du-nat-dynamique","title":"Mise en \u0153uvre du NAT dynamique","text":"<p>NAT dynamique</p> <p>La r\u00e8gle de NAT dynamique NAPT permet aux machines du r\u00e9seau interne (Network_internals) d'acc\u00e9der au r\u00e9seau externe (Network_Out) et \u00e0 Internet</p> <p>La r\u00e8gle de NAT dynamique est cr\u00e9\u00e9e avec le bouton Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source (masquerading) qui ajoute automatiquement la plage de ports pr\u00e9d\u00e9finie\u00a0ephemeral_fw\u00a0[20000-59999] au niveau du port source dans le trafic apr\u00e8s traduction. Par d\u00e9faut, les ports sont choisis s\u00e9quentiellement dans cette plage, cependant une option est disponible pour permettre un choix al\u00e9atoire du num\u00e9ro de port pour chaque nouvelle connexion et le rendre ainsi moins pr\u00e9dictible.</p> <ul> <li>Dans votre politique (10), s\u00e9lectionner l'onglet NAT puis     Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source     (masquerading) </li> </ul> <p></p> <p>Une nouvelle r\u00e8gle non activ\u00e9e appara\u00eet avec des valeurs par d\u00e9faut any, any. Dans la section Trafic apr\u00e8s translation, le port source sera traduit par un num\u00e9ro de port choisi dans la plage ephemeral_fw.</p> <p>La configuration du Trafic original (avant translation) permet de renseigner les valeurs des param\u00e8tres avant traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du r\u00e9seau     source\u00a0;</li> <li>Destination permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du     r\u00e9seau destination.</li> </ul> <p>La configuration du Trafic apr\u00e8s translation permet de renseigner les nouvelles valeurs des param\u00e8tres apr\u00e8s traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source d\u00e9finit l'adresse IP ou le r\u00e9seau source et le port     source vus de l'ext\u00e9rieur.</li> <li>Destination d\u00e9finit l'adresse IP ou le r\u00e9seau destination et     Port destination translat\u00e9e le port de destination.</li> </ul> <p>Pour configurer un NAT/PAT pour permettre la sortie sur Internet</p> <ul> <li>Double-cliquer sur une zone vide de la r\u00e8gle pour ouvrir la fen\u00eatre     de configuration d\u00e9taill\u00e9e \u00ab\u00a0Edition de la r\u00e8gle N\u00b01\u00a0\u00bb.</li> <li>Cliquer l'onglet du menu de gauche G\u00e9n\u00e9ral, dans la     zone Commentaire, saisir un commentaire, par exemple     \u00ab\u00a0Configuration de la r\u00e8gle de NAT/PAT pour la sortie internet\u00a0\u00bb.</li> <li>Cliquer sur l'onglet du menu de gauche Source Originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir     Network_internals (qui renvoie \u00e0 tous les r\u00e9seaux internes     prot\u00e9g\u00e9s), dans l'onglet Configuration avanc\u00e9e, laissez Any pour     le port de destination.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Destination originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir Internet,     laissez Any pour le port de destination.</li> </ul> <p></p> <p>Attention</p> <p>Attention : si dans la zone destination originale, vous laissez Any, plut\u00f4t qu'Internet qui d\u00e9signe tous les r\u00e9seaux sauf ceux internes au pare-feu SNS, le pare-feu SNS bloquera les flux d'administration (en ssh et en https). En effet, les flux d'administration subiront \u00e9galement une traduction NAT vers l'interface OUT qui l'interpr\u00e9tera comme une tentative d'intrusion et les bloquera.</p> <p>Solution</p> <p>Vous pouvez rendre cette r\u00e8gle plus restrictive en choisissant explicitement l'interface de sortie.</p> <ul> <li>Cliquer sur l'onglet Configuration avanc\u00e9e et s\u00e9lectionnez     out dans Interface de sortie.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet Source translat\u00e9e et     s\u00e9lectionner Firewall_Out dans Machine source translat\u00e9e.</li> <li>Dans Port source translat\u00e9, laisser ephemeral_fw et cocher     choisir al\u00e9atoirement le port source translat\u00e9.</li> </ul> <p>Information importante</p> <p>Cette option choisit al\u00e9atoirement le port source translat\u00e9, ce qui permet d'\u00e9viter les attaques utilisant la pr\u00e9dictibilit\u00e9 des ports utilis\u00e9s. Ainsi si le premier port est 10000, le suivant ne sera pas 10001. Cette pr\u00e9caution n'emp\u00eache pas les attaques, elle permet de les rendre plus complexes.</p> <p></p> <ul> <li>Cliquer l'onglet du menu de gauche Protocole, cela permet de     d\u00e9finir le type de protocole\u00a0: applicatif, IP ou Ethernet, laisser     D\u00e9tection automatique du protocole (par d\u00e9faut)</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Options,\u00a0cela permet de     tracer le trafic qui correspond \u00e0 la r\u00e8gle de traduction dans le     journal de connexions, choisir tracer.</li> </ul> <p></p> <p>Nota Bene</p> <p>NB\u00a0: Le NAT ne laisse jamais de traces dans le journal de connexions. Pour tracer une r\u00e8gle de NAT, il faut choisir l'option \u00ab\u00a0tracer\u00a0\u00bb, sinon, aucune journalisation de NAT ne sera effectu\u00e9e.</p> <ul> <li></li> <li>Cliquer sur OK pour sauvegarder les     modifications de la r\u00e8gle de NAT dynamique que vous venez de cr\u00e9er.</li> <li> <p>Dans la colonne \u00c9tat, s\u00e9lectionner avec la fl\u00e8che D\u00e9finir     l'\u00e9tat on </p> </li> <li> <p>Cliquer sur Appliquer puis Oui, Activer la politique     puis confirmer.</p> </li> </ul> <p>Dans la liste des r\u00e8gles la barre devient verte quand les r\u00e8gles s'appliquent et une info-bulle indique le nombre de fois o\u00f9 la r\u00e8gle a \u00e9t\u00e9 appliqu\u00e9e\u00a0:</p> <p></p> <ul> <li>Dans le bandeau d'affichage des r\u00e8gles, d\u00e9plier le menu      et cliquer sur R\u00e9initialiser les statistiques     des r\u00e8gles pour remettre les compteurs \u00e0 z\u00e9ro.</li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche06_configurationNat_SNS/#mise-en-uvre-du-nat-statique-par-port-redirection-de-port","title":"Mise en \u0153uvre du NAT statique par port (redirection de port)","text":"<p>Pour faire une redirection NAT \u00ab\u00a0classique\u00a0\u00bb, il faut s\u00e9lectionner l'onglet NAT puis Nouvelle r\u00e8gle / r\u00e8gle simple.</p> <p>Exemple avec une r\u00e8gle de NAT afin qu'unserveur WEB (objet srv_web_priv, protocole http) soit joignable gr\u00e2ce \u00e0 une redirection de port via l'adresse IP publique OUT d'un pare-feu: \u00ab\u00a0192.36.253.70\u00a0\u00bb.</p> <ul> <li> <p>Source originale = Internet, Interface d'entr\u00e9e = out</p> </li> <li> <p>Destination originale = Firewall_Out, Port dest= http</p> </li> <li> <p>Source translat\u00e9e = Any (ou pas de source)</p> </li> <li> <p>Destination translat\u00e9e = srv_web_priv, Port destination translat\u00e9 = none</p> </li> </ul> <p></p> <ul> <li>Cliquer Appliquer puis Oui, Activer la politique puis     confirmer.</li> </ul> <p>Le d\u00e9tail ci-dessous\u00a0:</p> <p></p> <ul> <li>Dans l'onglet Destination de la r\u00e8gle de filtrage, choisissez     l'onglet Configuration avanc\u00e9e, puis dans NAT sur la     destination, s\u00e9lectionner l'objet correspondant \u00e0 votre serveur     web priv\u00e9\u00a0:</li> </ul> <p></p> <ul> <li>Puis dans l'onglet Port/Protocole, choisir http dans la zone Port destination translat\u00e9.</li> </ul> <p></p> <p>Tra\u00e7age des r\u00e8gles de NAT</p> <p>Activer le tra\u00e7age des r\u00e8gles de NAT permet d'avoir les informations visibles dans les Journaux d'audit (logs).</p> <ul> <li>Double-cliquer sur la r\u00e8gle que vous voulez tracer et choisissez     l'onglet Options, et dans niveau de trace tracer puis **OK.     **</li> </ul> <p> Vous pouvez tester l'acc\u00e8s \u00e0 l'ensemble de vos ressources et v\u00e9rifier le tra\u00e7age des r\u00e8gles demand\u00e9es dans les logs du pare-feu (journal standard et journal Filtrage).</p> <ul> <li>Cliquer sur l'onglet Monitoring puis LOGS - Journaux d'audit /     Vues / Trafic r\u00e9seau\u00a0: vous devriez voir appara\u00eetre les traces\u00a0:</li> </ul> <p></p> <p>Information importante</p> <p>Il est \u00e9galement possible de r\u00e9aliser une redirection de ports directement lors de la cr\u00e9ation d'une r\u00e8gle de filtrage (voir fiche 6). L'int\u00e9r\u00eat d'int\u00e9grer le filtrage et la redirection dans une r\u00e8gle unique est d'optimiser les performances puisque le pare-feu r\u00e9alise un seul traitement au lieu de deux. Voici un exemple ci-dessous \u00e9quivalent \u00e0 la r\u00e8gle pr\u00e9c\u00e9dente\u00a0:</p> <p></p>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/","title":"Fiche 07-- Filtrage protocolaire","text":"<p>La mise en place d'une politique de filtrage, permet \u00e0 l'administrateur de d\u00e9finir les r\u00e8gles qui permettront d'autoriser ou de bloquer les flux au travers du pare-feu SNS. Selon les flux, certaines inspections de s\u00e9curit\u00e9 (analyse antivirale, analyse antispam, filtrage URL, etc.) peuvent \u00eatre activ\u00e9es (nous d\u00e9taillerons ces analyses dans la fiche 7 \u00ab\u00a0Filtrage applicatif\u00a0\u00bb). Les r\u00e8gles de filtrage d\u00e9finies doivent respecter la politique de s\u00e9curit\u00e9 de l'entreprise.</p>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#presentation-des-fonctionnalites","title":"Pr\u00e9sentation des fonctionnalit\u00e9s","text":"<p>Pour d\u00e9finir un flux, une r\u00e8gle de filtrage se base sur de nombreux crit\u00e8res ; ce qui offre un haut niveau de granularit\u00e9. Parmi ces crit\u00e8res, il est notamment possible de pr\u00e9ciser\u00a0:</p> <ul> <li>l'adresse IP source et/ou destination\u00a0;</li> <li>la r\u00e9putation et la g\u00e9olocalisation de l'adresse IP source et/ou     destination\u00a0;</li> <li>l'interface d'entr\u00e9e et/ou sortie\u00a0;</li> <li>l'adresse r\u00e9seau source et/ou destination\u00a0;</li> <li>le FQDN source et/ou destination\u00a0;</li> <li>la valeur du champ DSCP\u00a0;</li> <li>le service TCP/UDP (n\u00b0 de port de destination)\u00a0;</li> <li>le protocole IP (dans le cas d'ICMP, le type de message ICMP peut     \u00eatre pr\u00e9cis\u00e9)\u00a0;</li> <li>l'utilisateur ou le groupe d'utilisateurs devant \u00eatre authentifi\u00e9.</li> </ul> <p>Le nombre de r\u00e8gles de filtrage actives dans une politique est limit\u00e9. Cette limite d\u00e9pend exclusivement du mod\u00e8le de pare-feu SNS.</p> <p>Le premier paquet appartenant \u00e0 chaque nouveau flux re\u00e7u par le pare-feu est confront\u00e9 aux r\u00e8gles de filtrage de la premi\u00e8re \u00e0 la derni\u00e8re ligne. Il est donc recommand\u00e9 d'ordonner au mieux les r\u00e8gles de la plus restrictive \u00e0 la plus g\u00e9n\u00e9raliste.</p> <p>Par d\u00e9faut, tout trafic qui n'est pas autoris\u00e9 explicitement par une r\u00e8gle de filtrage est bloqu\u00e9 (r\u00e8gle n\u00b0 3 de la politique de s\u00e9curit\u00e9 \u00ab\u00a0Block all\u00a0\u00bb).</p> <p>Dans les recommandations pour la d\u00e9finition d'une politique de filtrage r\u00e9seau d'un pare-feu publi\u00e9es par l'ANSSI le 30 mars 2013, il est pr\u00e9cis\u00e9 que la r\u00e8gle finale qui consiste \u00e0 bloquer et journaliser tout ce qui n'est pas autoris\u00e9 par les r\u00e8gles pr\u00e9c\u00e9dentes doit appara\u00eetre explicitement \u00e0 la fin de la politique de filtrage appliqu\u00e9e. L'ajout de cette r\u00e8gle explicite garantit l'application du mod\u00e8le de s\u00e9curit\u00e9 positif (tout ce qui n'a pas \u00e9t\u00e9 autoris\u00e9 pr\u00e9c\u00e9demment est interdit) et permet de s'assurer que la trace des flux non l\u00e9gitimes est conserv\u00e9e.</p> <p></p> <p>Les pare-feu SNS utilisent la technologie SPI (Stateful\u00a0Packet Inspection) qui leur permet de garder en m\u00e9moire l'\u00e9tat des connexions TCP (et SCTP) et des pseudo-connexions UDP et ICMP afin d'en assurer le suivi et de d\u00e9tecter d'\u00e9ventuelles anomalies ou attaques. La cons\u00e9quence directe de ce suivi \u00ab\u00a0Stateful\u00a0\u00bb est l'autorisation d'un flux par une r\u00e8gle de filtrage uniquement dans le sens de l'initiation de la connexion\u00a0: les r\u00e9ponses faisant partie de la m\u00eame connexion sont automatiquement autoris\u00e9es. Ainsi, nous n'avons nul besoin d'une r\u00e8gle de filtrage suppl\u00e9mentaire pour autoriser les paquets r\u00e9ponse d'une connexion \u00e9tablie au travers du pare-feu.</p> <p>La figure page suivante pr\u00e9sente l'ordre d'application des r\u00e8gles de filtrage et de NAT.</p> <p>Information importante</p> <p>il est important de noter que les paquets sont filtr\u00e9s avant que la phase de traduction (NAPT).</p> <p></p> <p>Le premier paquet re\u00e7u est confront\u00e9 aux r\u00e8gles de filtrage des diff\u00e9rents niveaux suivant l'ordre pr\u00e9sent\u00e9 dans la figure ci-apr\u00e8s. D\u00e8s que les \u00e9l\u00e9ments du paquet correspondent \u00e0 une r\u00e8gle dans un niveau, l'action de la r\u00e8gle (bloquer ou autoriser) est appliqu\u00e9e et le paquet n'est plus confront\u00e9 aux r\u00e8gles suivantes. Si aucune r\u00e8gle de filtrage ne correspond, le paquet est bloqu\u00e9 par d\u00e9faut.</p> <p>Dans le cas o\u00f9 le paquet est autoris\u00e9, il est confront\u00e9 aux r\u00e8gles de NAT des diff\u00e9rents niveaux toujours suivant l'ordre pr\u00e9sent\u00e9 ci-apr\u00e8s.</p> <ul> <li>Le filtrage implicite regroupe les r\u00e8gles de filtrage     pr\u00e9-configur\u00e9es ou ajout\u00e9es dynamiquement par le pare-feu pour     autoriser ou bloquer certains flux apr\u00e8s l'activation d'un service.     Par exemple, une r\u00e8gle implicite autorise les connexions \u00e0     destination des interfaces internes du pare-feu SNS sur le port     HTTPS (443/TCP) afin d'assurer un acc\u00e8s continu \u00e0 l'interface     d'administration Web. Autre exemple, d\u00e8s l'activation du service     SSH, un ensemble de r\u00e8gles implicites sera ajout\u00e9 pour autoriser ces     connexions depuis toutes les machines des r\u00e9seaux internes.</li> <li>Le filtrage global regroupe les r\u00e8gles de filtrage inject\u00e9es au     pare-feu depuis l'outil d'administration \u00ab\u00a0Stormshield Management     Server\u00a0\u00bb (SMC) ou apr\u00e8s affichage des politiques globales.</li> <li>Le filtrage local repr\u00e9sente les r\u00e8gles de filtrage ajout\u00e9es par     l'administrateur depuis l'interface d'administration du pare-feu     SNS.</li> </ul> <p>Les r\u00e8gles implicites sont accessibles depuis le menu CONFIGURATION / POLITIQUE DE S\u00c9CURIT\u00c9 / R\u00e8gles implicites. Chaque r\u00e8gle peut \u00eatre activ\u00e9e/d\u00e9sactiv\u00e9e.</p> <p>Information importante</p> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 / R\u00e8gles     implicites.</p> <p>Information importante</p> <p>La modification de l'\u00e9tat de ces r\u00e8gles a un impact direct sur le fonctionnement des services du pare-feu. Pour que le service concern\u00e9 fonctionne toujours, il faut s'assurer au pr\u00e9alable que le flux est autoris\u00e9 par les r\u00e8gles de priorit\u00e9 moindre telles que globales ou locales.</p>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#analyse-des-politiques-predefinies-de-filtrage","title":"Analyse des politiques pr\u00e9d\u00e9finies de filtrage","text":"<p>Vous allez dans un premier temps d\u00e9couvrir \u00e0 travers les r\u00e8gles d\u00e9j\u00e0 d\u00e9finies dans les deux premi\u00e8res politiques pr\u00e9d\u00e9finies de filtrage, le fonctionnement des r\u00e8gles de filtrage sur un pare-feu Stormshield.</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT / Filtrage</li> <li>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir(1)     Block all.</li> </ul> <p></p> <p>Cette politique bloque presque tous les flux (r\u00e8gle N\u00b03) sauf ceux d\u00e9finis par les r\u00e8gles 1 et 2.</p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 autorise l'acc\u00e8s en https et sur le port pr\u00e9d\u00e9fini 1300 pare-feu_srv \u00e0 toutes les interfaces du pare-feu, elle permet donc l'administration \u00e0 distance depuis n'importe quel r\u00e9seau.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 autorise les requ\u00eates ICMP Echo vers toutes les interfaces du pare-feu, afin de pouvoir v\u00e9rifier la pr\u00e9sence du pare-feu \u00e0 l'aide des commandes ICMP. Attention\u00a0: un ping vers la passerelle par d\u00e9faut \u00e9choue, car il n'est pas explicitement autoris\u00e9.</p> </li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir (2)     High.</p> </li> </ul> <p></p> <p>Cette politique est un peu moins restrictive que la pr\u00e9c\u00e9dente, elle autorise plus de chose \u00e0 partir des r\u00e9seaux internes.</p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 autorise l'acc\u00e8s \u00e0 des services web en http, https, dns \u21d2 elle permet l'acc\u00e8s \u00e0 des sites web.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 autorise l'acc\u00e8s \u00e0 des services ftp.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 3 autorise l'acc\u00e8s \u00e0 des services de messagerie en</p> </li> <li> <p>imap, smtp, pop3 elle permet l'envoi et la r\u00e9ception de messages.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 4 autorise les requ\u00eates ICMP Echo vers n'importe quelle destination des r\u00e9seaux internes, afin de pouvoir v\u00e9rifier la pr\u00e9sence du pare-feu et des services en DMZ \u00e0 l'aide des commandes ICMP. Attention\u00a0: un ping vers la passerelle par d\u00e9faut \u00e9choue car il n'est pas explicitement autoris\u00e9.</p> </li> </ul> <p>Information importante</p> <p>Vous remarquerez que pour toutes ces r\u00e8gles la colonne \u00ab\u00a0Inspection de s\u00e9curit\u00e9\u00a0\u00bb stipule IPS(Intrusion Prevention System) qui est le niveau le plus \u00e9lev\u00e9 de filtrage avec inspection du contenu et le cas \u00e9ch\u00e9ant blocage si l'on suspecte un comportement anormal ou une tentative d'intrusion.</p>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#creation-dune-regle-de-filtrage","title":"Cr\u00e9ation d'une r\u00e8gle de filtrage","text":""},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#principes-generaux","title":"Principes g\u00e9n\u00e9raux","text":"<p>Les r\u00e8gles de filtrage s'int\u00e8grent dans une politique de filtrage. Il est possible de modifier une politique existante puis de l'appliquer. Vous pouvez utiliser une politique qui contient d\u00e9j\u00e0 des r\u00e8gles ou non comme la politique n\u00b05.</p> <p>Information</p> <p>\u00c0 noter qu'il est possible de copier/coller des politiques de s\u00e9curit\u00e9 et des r\u00e8gles que l'on modifie \u00e9ventuellement ensuite.</p> <p>Pour renommer la politique\u00a0:</p> <p></p> <ul> <li>Cliquer sur Editer puis Renommer</li> <li> <p>Modifier le nom et cliquer sur METTRE \u00c0 JOUR</p> </li> <li> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT / Filtrage</p> </li> </ul> <p></p> <p>L'onglet FILTRAGE est compos\u00e9 d'un en-t\u00eate pour la gestion des r\u00e8gles de filtrage\u00a0:</p> <ul> <li>R\u00e8gle simple\u00a0: ajoute une r\u00e8gle de filtrage standard. Par     d\u00e9faut, une nouvelle r\u00e8gle est d\u00e9sactiv\u00e9e et tous ses crit\u00e8res sont     param\u00e9tr\u00e9s \u00e0\u00a0Any.</li> <li>S\u00e9parateur -- regroupement de r\u00e8gles\u00a0: ajoute un s\u00e9parateur qui     regroupe toutes les r\u00e8gles se trouvant au-dessous (ou jusqu'au     prochain s\u00e9parateur). Cela permet de faciliter l'affichage d'une     politique contenant un nombre de r\u00e8gles important. Le s\u00e9parateur     peut \u00eatre personnalis\u00e9 par une couleur et un commentaire.</li> <li>R\u00e8gle d'authentification\u00a0: d\u00e9marre un assistant qui facilite     l'ajout d'une r\u00e8gle dont le r\u00f4le est de rediriger les connexions des     utilisateurs non-authentifi\u00e9s vers le portail captif.</li> <li>R\u00e8gle d'inspection SSL\u00a0: d\u00e9marre un assistant qui facilite     l'ajout de r\u00e8gles pour l'activation du proxy SSL.</li> <li>R\u00e8gle de proxy HTTP explicite\u00a0: d\u00e9marre un assistant qui     facilite l'ajout de r\u00e8gles pour l'activation du proxy HTTP     explicite.</li> </ul> <p>Sur la barre de menu, vous disposez notamment des boutons\u00a0:</p> <ul> <li>Supprimer\u00a0: supprime une r\u00e8gle.</li> <li>Monter\u00a0/ Descendre\u00a0: monter ou descendre la/les r\u00e8gle(s)     s\u00e9lectionn\u00e9e(s) d'une position dans la liste.</li> <li>Chercher dans les logs\u00a0: chercher les traces g\u00e9n\u00e9r\u00e9es par     l'application de cette r\u00e8gle dans les journaux d'audit (la recherche     s'effectue sur le nom de la r\u00e8gle \u21d2 Il vaut mieux lui donner un     nom explicite).</li> <li>Chercher dans la supervision\u00a0: chercher le nom de cette r\u00e8gle     dans la supervision des connexions.</li> <li>R\u00e9initialiser les statistiques des r\u00e8gles\u00a0: r\u00e9initialiser les     compteurs d'utilisation de toutes les r\u00e8gles de filtrage et NAT de     la politique active.</li> </ul>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#exemple-de-creation-dune-regle-simple-classique","title":"Exemple de cr\u00e9ation d'une r\u00e8gle simple classique","text":"<p>Le r\u00e9seau interne doit pouvoir \u00e9mettre un ping vers n'importe quelle destination.</p> <ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple</li> <li>Action : Passer</li> <li>Source : L'adresse IP ou le r\u00e9seau source, ici     Network_internals</li> <li>Protocole dest : Port destination, ici ICMP.</li> </ul> <p></p> <ul> <li>Type de protocole\u00a0: Protocole IP</li> <li>Protocole IP\u00a0: icmp</li> <li>Message ICMP\u00a0: choisir au milieu de la liste     requ\u00eate Echo (Ping, type 8, code 0)</li> </ul> <p>La nouvelle r\u00e8gle se pr\u00e9sente ainsi\u00a0:</p> <p></p> <ul> <li>Double-cliquer sur le bouton off pour passer la r\u00e8gle \u00e0 l'\u00e9tat     on, puis cliquez Appliquer puis Oui, activer la     politique.</li> </ul>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#exemple-dune-regle-integrant-egalement-le-natp","title":"Exemple d'une r\u00e8gle int\u00e9grant \u00e9galement le NATP","text":"<p>Dans une r\u00e8gle de filtrage, une directive de NAT sur la destination (DNAT) peut \u00eatre appliqu\u00e9e, sauf si elle contient un objet FQDN, ou des \u00e9l\u00e9ments de g\u00e9olocalisation et /ou de r\u00e9putation.</p> <p>La figure ci-dessous illustre une translation sur la destination d'un trafic SMTP entrant. La r\u00e8gle de filtrage autorise ce trafic en provenance d'un r\u00e9seau externe et \u00e0 destination de l'adresse IP publique du serveur STMP sur le port SMTP/25.</p> <p>L'adresse et le port destination sont translat\u00e9s respectivement par l'adresse IP priv\u00e9e du serveur SMTP et le port SMTP/25 directement dans la r\u00e8gle de filtrage o\u00f9 la publication ARP est \u00e9galement activ\u00e9e. Gr\u00e2ce \u00e0 cette configuration, il n'est pas n\u00e9cessaire d'ajouter une r\u00e8gle de translation pour rediriger ce trafic. </p> <p>Il existe plusieurs avantages \u00e0 cr\u00e9er une directive de NAT sur destination au sein d'une r\u00e8gle de filtrage\u00a0:</p> <ul> <li>indication rapide du flux autoris\u00e9 avec redirection vers la machine     interne\u00a0;</li> <li>gestion et supervision des r\u00e8gles entrantes dans un seul menu\u00a0;</li> <li>optimisation du temps de traitement des r\u00e8gles puisque les r\u00e8gles     pr\u00e9sentes dans l'onglet NAT ne sont pas parcourues\u00a0;</li> <li>activation de protections applicatives (filtrage SMTP, antispam,     etc.) \u00e0 des connexions entrantes translat\u00e9es.</li> </ul>"},{"location":"stormshield/fiches/fiche07_filtrage_protocolaire_SNS/#quelques-fonctionnalites-supplementaires","title":"Quelques fonctionnalit\u00e9s suppl\u00e9mentaires","text":"<p>Ce qui suit est loin d'\u00eatre exhaustif:</p> <p>L'onglet G\u00c9OLOCALISATION / R\u00c9PUTATION du menu Source ou Destination permet d'ajouter un certain nombre de r\u00e8gles\u00a0:</p> <ul> <li>G\u00e9olocalisation : permet de renseigner un continent ou un pays \u00e0     l'origine du trafic. La liste ne contient pas d'adresses IP, le     Firewall d\u00e9termine le pays auquel appartient une IP, plut\u00f4t que de     charger toutes les IP (les blocs d'adressage sont tr\u00e8s fragment\u00e9s     sur Internet).</li> <li>R\u00e9putation des adresses IP publiques : une IP publique peut     avoir une r\u00e9putation \u00e0 la limite de deux cat\u00e9gories. Le groupe \u00ab Bad     \u00bb regroupe les cat\u00e9gories : anonymizer, botnet, malware, phishing,     scanner, spam et tor.    </li> <li>R\u00e9putation des machines : Il est possible     d'activer le filtrage selon le score de r\u00e9putation des machines du     r\u00e9seau interne. Il faut au pr\u00e9alable activer la gestion de     r\u00e9putation des machines et d\u00e9finir les machines concern\u00e9es par le     calcul d\\'un score de r\u00e9putation.</li> </ul> <p>Dans le menu Source, les param\u00e8tres G\u00e9olocalisation et R\u00e9putation des adresses IP publiques sont utilis\u00e9s g\u00e9n\u00e9ralement pour qualifier le flux entrant (provenant d'Internet), alors que le param\u00e8tre R\u00e9putation des machines est utilis\u00e9 pour qualifier le flux sortant.</p> <p>Information importante</p> <p>NOTE : Le score de r\u00e9putation des machines internes, configurable dans ce menu, permet de pr\u00e9ciser le score au-dessus duquel ou en-dessous duquel la r\u00e8gle de filtrage s\\'appliquera aux machines supervis\u00e9es</p> <p>Information importante</p> <p>Le group \u00ab\u00a0bad\u00a0\u00bb int\u00e8gre toutes les cat\u00e9gories pr\u00e9c\u00e9dentes (de \u00ab\u00a0anonymizer\u00a0\u00bb \u00e0 \u00ab\u00a0tor exit node\u00a0\u00bb).</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/","title":"Fiche 08 -- Filtrage applicatif - Proxy web HTTP(s)","text":"<p>La mise en place d'une politique de filtrage, permet \u00e0 l'administrateur de d\u00e9finir les r\u00e8gles qui permettront d'autoriser ou de bloquer des flux au travers du pare-feu SNS. Selon les flux, certaines inspections de s\u00e9curit\u00e9 (analyse antivirale, analyse antispam, filtrage URL, etc.) peuvent \u00eatre activ\u00e9es sur les pare-feu SNS afin de\u00a0:</p> <ul> <li>contr\u00f4ler les acc\u00e8s \u00e0 certains sites web d'Internet (filtrage d'URL     et filtrage SSL)\u00a0;</li> <li>cr\u00e9er une politique anti-relais et antispam (filtrage SMTP)\u00a0;</li> <li>effectuer une analyse antivirale sur les flux DATA (HTTP, SMTP, FTP,     POP3, etc.)\u00a0;</li> <li>bloquer les maliciels \u00e0 l'aide d'une analyse comportementale sur des     machines de d\u00e9tonation (sandboxing Breachfighter).</li> </ul>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#configuration-du-service-proxy-web-http","title":"Configuration du service proxy Web HTTP","text":"<p>La fonction de filtrage des URL permet de contr\u00f4ler l'acc\u00e8s aux sites web d'Internet pour l'ensemble des utilisateurs. Pour contr\u00f4ler ces acc\u00e8s, la politique de filtrage URL va se baser sur une liste d'URL class\u00e9es en cat\u00e9gories ou de mots cl\u00e9s personnalis\u00e9s.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#les-bases-durl-disponibles","title":"Les bases d'URL disponibles","text":"<p>Deux fournisseurs de base URL sont disponibles sur les pare-feu SNS\u00a0:</p> <ol> <li>Base URL embarqu\u00e9e compos\u00e9e de 16 cat\u00e9gories t\u00e9l\u00e9charg\u00e9es sur les     serveurs de mise \u00e0 jour,</li> <li>Base Extended Web Control (EWC) constitu\u00e9e de 65 cat\u00e9gories, toutes     h\u00e9berg\u00e9es dans le Cloud. Cette base est disponible en option     payante, elle est n\u00e9anmoins incluse dans les VM du partenariat     Stormshield Academy.</li> </ol> <ul> <li>Ouvrir Configuration / Objets / Objets Web onglet Base     d'URL. La base par d\u00e9faut est la Base URL embarqu\u00e9e.</li> </ul> <p></p> <p>Les cat\u00e9gories pr\u00e9d\u00e9finies pour la Base URL embarqu\u00e9e sont disponibles. Le contenu des cat\u00e9gories ne peut pas \u00eatre consult\u00e9. Cependant, l'appartenance d'une URL \u00e0 un groupe peut \u00eatre v\u00e9rifi\u00e9e par le biais des champs de classification. Ces champs sont disponibles depuis le menu Objets Web ou au sein d'une politique de filtrage URL.</p> <p>Par exemple, pour v\u00e9rifier l'appartenance de Stormshield \u00e0 une des cat\u00e9gories de la base\u00a0:</p> <ul> <li>Ouvrir Configuration / Objets / Objets Web onglet     URL.</li> <li>Dans la zone V\u00e9rifier l'utilisation saisir stormshield.eu et     cliquer Classifier.</li> </ul> <p></p> <p>Le r\u00e9sultat s'affiche dans la zone de commentaires, l'URL stormshield.eu fait partie de la cat\u00e9gorie IT\u00a0:</p> <p></p> <ul> <li>Au besoin cliquer le symbole au bas de l'\u00e9cran      pour d\u00e9plier la zone de commentaires.</li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#politique-de-filtrage-durl-pre-definie","title":"Politique de filtrage d'URL pr\u00e9-d\u00e9finie","text":"<p>Une seule politique de filtrage est pr\u00e9d\u00e9finie par d\u00e9faut (quelle que soit la politique choisie, ce sont les deux m\u00eame r\u00e8gles qui apparaissent).</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage URL</li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisissez     (0)     URLFilter_00.     </p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 (non activ\u00e9e) autorise les URL qui font partie du groupe authentication_bypass qui peut \u00eatre consult\u00e9 dans le menu Objets Web, il s'agit des sites qui permettent les mises \u00e0 jour Microsoft.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 laisse explicitement passer tous les flux.</p> </li> </ul> </li> </ul> <p>Les r\u00e8gles de filtrage d'URL sont compos\u00e9es d'une colonne Action et d'une colonne Cat\u00e9gorie d'URL.</p> <ul> <li>La colonne Action permet de Bloquer ou de Passer ou de rediriger vers l'une des 4 pages de blocage personnalisables.</li> </ul> <p> </p> <ul> <li>Cat\u00e9gorie d'URL : La colonne contient la liste des cat\u00e9gories pr\u00e9d\u00e9finies de la base URL embarqu\u00e9e et les cat\u00e9gories personnalis\u00e9es que vous avez cr\u00e9\u00e9es. </li> </ul> <p> </p> <p>Il convient ensuite de choisir les cat\u00e9gories de sites \u00e0 autoriser, bloquer ou \u00e0 rediriger vers l'une des 4 pages de blocage personnalisables. Le contr\u00f4le de coh\u00e9rence en temps r\u00e9el affiche les erreurs d\u00e9tect\u00e9es dans votre politique.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#creation-dune-base-url-personnalisee","title":"Cr\u00e9ation d'une base URL personnalis\u00e9e","text":"<p>Si les cat\u00e9gories de sites web pr\u00e9d\u00e9finies par votre base d'URL ne sont pas exactement adapt\u00e9es \u00e0 vos besoins, il est n\u00e9cessaire de cr\u00e9er ses propres cat\u00e9gories pour y mettre les URL que l'on souhaite bloquer ou autoriser.</p> <p>Information importante</p> <p>Il est recommand\u00e9 de pr\u00e9voir au moins une cat\u00e9gorie de type \u00ab\u00a0white list\u00a0\u00bb et une cat\u00e9gorie de type \u00ab\u00a0black list\u00a0\u00bb.</p> <ul> <li>Dans l'onglet URL, cliquer sur Ajouter une cat\u00e9gorie     personnalis\u00e9e puis donnez-lui un nom (par exemple black_list).</li> <li>Dans la zone Cat\u00e9gorie d'URL, cliquer sur Ajouter une URL et     saisir par exemple *.badssl.com/*.</li> </ul> <p>Information iminteressante</p> <p>Le site badssl.com permet d'effectuer de nombreux tests de configuration des navigateurs Internet. En particulier l'URL http.badssl.com permet de tester l'affichage d'une page web en HTTP.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#creation-dune-regle-de-blocage","title":"Cr\u00e9ation d'une r\u00e8gle de blocage","text":"<p>Information</p> <p>Ce qui suit est valable pour n'importe quelle cat\u00e9gorie mais le mode op\u00e9ratoire porte sur la cat\u00e9gorie personnalis\u00e9e \u00ab\u00a0black_list\u00a0\u00bb.</p> <ul> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir une des     r\u00e8gles de politique de filtrage d'URL (par exemple, (0)     URLFilter_00) et cliquer sur \u00c9diter.</p> </li> <li> <p>Renommer cette politique (par exemple \u00a0\u00ab\u00a0Proxy_Cub \u00bb) et mettre \u00e0     jour.</p> </li> <li> <p>Se positionner sur la premi\u00e8re r\u00e8gle (d\u00e9sactiv\u00e9e) et cliquer +     Ajouter pour ajouter une nouvelle r\u00e8gle de filtrage d'URL.</p> </li> </ul> <p></p> <ul> <li>Au niveau de la deuxi\u00e8me r\u00e8gle, dans Action, laisser     BlockPage_00 et dans la colonne Cat\u00e9gorie d'URL, choisir     black_list, puis cliquer sur Appliquer puis sur     Sauvegarder.</li> </ul> <p>Information</p> <p>Les pages de blocage par d\u00e9faut, ici BlockPage_00 peuvent \u00eatre \u00e9dit\u00e9es depuis le menu Configuration \u21d2 Notifications \u21d2 Messages de blocage \u21d2 Onglet Page de blocage HTTP. Les modifications peuvent s'effectuer gr\u00e2ce \u00e0 l'\u00e9diteur HTML, cela permet de personnaliser la page.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#affectation-dune-politique-de-filtrage-url","title":"Affectation d'une politique de filtrage URL","text":"<ul> <li>Ouvrir Configuration / Politique de s\u00e9curit\u00e9 / Filtrage et NAT,     et choisir la politique de s\u00e9curit\u00e9 actuellement appliqu\u00e9e.</li> <li>Dans l'onglet Filtrage, ouvrir la ou les r\u00e8gles qui autorisent     l'acc\u00e8s \u00e0 Internet avec le protocole http. Dans l'onglet     Inspection de s\u00e9curit\u00e9, dans la zone Inspection choisir,     dans la liste Filtrage URL, la politique de filtrage URL \u00e0     appliquer.</li> </ul> <p>Vous devez obtenir la r\u00e8gle suivante\u00a0:</p> <p>A v\u00e9rifier</p> <p></p> <p>Na pas faire attention \u00e0 l'avertissement. En cas d'acc\u00e8s \u00e0 un site en HTTPS, il faudra effectivement d'abord d\u00e9chiffrer le flux pour pouvoir d\u00e9cider du blocage ou non, ce qui n\u00e9cessite l'utilisation d'un proxy SSL (voir partie suivante).</p> <p></p> <p>Pour tester</p> <ul> <li>Ouvrir la page web http.badssl.com depuis votre navigateur, elle     ne doit pas s'afficher correctement. Vous devez voir le message de     blocage ci-contre\u00a0:</li> </ul>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#configuration-du-service-proxy-web-https","title":"Configuration du service proxy Web HTTPS","text":"<p>De nombreux services r\u00e9seau tels que le web, la messagerie, la messagerie instantan\u00e9e, utilisent le protocole SSL/TLS pour authentifier les correspondants et chiffrer leurs communications.</p> <p>Les pare-feu SNS sont capables de filtrer et d\u00e9chiffrer les connexions HTTPS, ce qui permet\u00a0:</p> <ul> <li>de bloquer des sites web HTTPS ou des cat\u00e9gories de sites web HTTPS     inappropri\u00e9s\u00a0;</li> <li>d'analyser les flux HTTPS pour les fonctions de protection     applicative (e.g., anti-virus,\u00a0sandboxing, filtrage URL, Google     SafeSearch, etc.).</li> </ul> <p>Deux m\u00e9thodes sont envisageables pour filtrer les connexions HTTPS\u00a0: avec ou sans d\u00e9chiffrement des flux SSL. Ces deux m\u00e9thodes peuvent \u00eatre combin\u00e9es en fonction de diff\u00e9rents crit\u00e8res, tels que l'authentification, le r\u00e9seau IP source ou certaines URL de destination.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#principe-du-filtrage-sans-dechiffrement-des-flux-ssl","title":"Principe du filtrage SANS d\u00e9chiffrement des flux SSL","text":"<p>Cette m\u00e9thode permet de bloquer les sites web HTTPS ind\u00e9sirables en v\u00e9rifiant seulement leur certificat sans d\u00e9chiffrer le flux. Ainsi, lorsqu'un client initie une connexion vers un site en HTTPS, il envoie en clair au serveur le nom de domaine du site demand\u00e9.</p> <p>Ce m\u00e9canisme appel\u00e9 Server Name Indication (SNI) permet au serveur de s\u00e9lectionner le bon certificat \u00e0 pr\u00e9senter au client. Stormshield Network Security s'appuie sur ce syst\u00e8me pour contr\u00f4ler l'acc\u00e8s \u00e0 ces sites web sans d\u00e9chiffrer le flux.</p> <p>Avec ce type de filtrage, les pare-feu SNS sont compatibles avec les extensions SNI (Server Name Indication), permettant de d\u00e9crire explicitement le nom de l'h\u00f4te avec lequel une session TLS est en n\u00e9gociation. Un message de certificat invalide appara\u00eetra en cas de blocage puis une page de blocage non personnalisable.</p> <p></p> <p>Si vous choisissez Advanced et Proceed, vous aurez acc\u00e8s \u00e0 la page de blocage du pare-feu SNS\u00a0:</p> <p></p> <p>En revanche, cette m\u00e9thode ne permet pas d'analyser les connexions HTTPS avec les protections applicatives tels que l'anti-virus, le sandboxing, Google SafeSearch.</p> <p>Information</p> <p>Une combinaison des deux m\u00e9thodes (voir ci-apr\u00e8s) est plus judicieux.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#principe-du-filtrage-avec-dechiffrement-des-flux-ssl","title":"Principe du filtrage AVEC d\u00e9chiffrement des flux SSL","text":"<p>Le proxy SSL est positionn\u00e9 en \u00ab\u00a0homme du milieu\u00a0\u00bb (Man in the middle) sur le trafic SSL entre le client et le serveur web. Il se charge des n\u00e9gociations SSL et s\u00e9curise ainsi les connexions proxy SSL/serveur, et proxy SSL/client. Entre les deux, il autorise ou bloque les connexions selon la politique de filtrage, et si besoin, il d\u00e9chiffre les flux SSL.</p> <p>Attention</p> <p>Le d\u00e9chiffrement des donn\u00e9es personnelles \u00e9tant encadr\u00e9 par la loi dans la majorit\u00e9 des pays, le filtrage SSL doit prendre en compte cette l\u00e9gislation. Vous devez exclure les sites qui ne doivent pas \u00eatre d\u00e9chiffr\u00e9s en leur appliquant l'action Passer sans d\u00e9chiffrer (e.g., en France les sites bancaires). Pour la France, les aspects juridiques li\u00e9s au d\u00e9chiffrement SSL sont d\u00e9taill\u00e9s en annexe du document Recommandations de s\u00e9curit\u00e9 concernant l'analyse des flux HTTPS de l'ANSSI.</p> <p>Attention</p> <p>Il est n\u00e9cessaire de  comprendre les \u00e9tapes du filtrage SSL.avec d\u00e9chiffrement et les \u00e9l\u00e9ments de configuration pr\u00e9-d\u00e9finis.</p> <ul> <li> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage SSL</p> </li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir par     exemple (0) SSLFilter_00.</p> </li> </ul> <p></p> <ul> <li>\u00c9diter un des 10 profils et le renommer (par exemple, renommer (0)     SSLFilter_00 en proxy_SSL)</li> </ul> <p>Pour chacune des 10 politiques de filtrage par d\u00e9faut, deux r\u00e8gles sont pr\u00e9sentes. La r\u00e8gle num\u00e9ro 1 sp\u00e9cifie de Passer sans d\u00e9chiffrer les URL-CN qui font partie de la cat\u00e9gorie proxyssl_bypass. En effet, ces serveurs d\u00e9tectent que le proxy SSL g\u00e9n\u00e8re un certificat usurp\u00e9 et sont susceptibles de refuser les connexions (c'est le cas par exemple de mozilla.org).</p> <p>La r\u00e8gle num\u00e9ro 2 sp\u00e9cifie de d\u00e9chiffrer tous les autres.</p> <p></p> <p>La cat\u00e9gorie par d\u00e9faut proxyssl_bypass contient donc une liste de noms de certificats que Stormshield recommande de laisser passer sans d\u00e9chiffrer.</p> <p>Il est possible d'ajouter ou de supprimer un nom de certificat (CN) de cette cat\u00e9gorie.</p> <ul> <li>Pour cr\u00e9er, si besoin, une nouvelle cat\u00e9gorie\u00a0: menu CONFIGURATION     \u21d2 OBJETS \u21d2 Objets Web, dans l'onglet NOM DE CERTIFICAT (CN).</li> <li>Pour cr\u00e9er, si besoin, un groupe de cat\u00e9gorie\u00a0:menu CONFIGURATION     \u21d2 OBJETS \u21d2 Objets Web, dans l'onglet GROUPE DE CAT\u00c9GORIES, choisir     un objet de type groupe de cat\u00e9gories Certificats. Un groupe de     cat\u00e9gories peut \u00eatre compos\u00e9 de cat\u00e9gories pr\u00e9sentes dans la base     (EWC ou embarqu\u00e9e), mais aussi de cat\u00e9gories personnalis\u00e9es.</li> </ul> <p>Une r\u00e8gle d\u00e9finit l'action donc \u00e0 appliquer pour une cat\u00e9gorie d'URL-CN. Apr\u00e8s la r\u00e9ception du certificat serveur et la confirmation que le SNI demand\u00e9 correspond au CN (common name) du certificat ou \u00e0 un des noms alternatifs, le SNI est confront\u00e9 aux r\u00e8gles de filtrage SSL. Dans le cas o\u00f9 une r\u00e8gle correspond, l'action de la r\u00e8gle est appliqu\u00e9e\u00a0:</p> <ul> <li> <p>D\u00e9chiffrer : le proxy SSL \u00e9tablit une session TLS avec le     &gt; serveur et une autre avec le client en lui pr\u00e9sentant le     &gt; certificat usurp\u00e9.</p> </li> <li> <p>Bloquer sans d\u00e9chiffrer : le proxy SSL ferme les connexions     &gt; TCP avec le serveur et le client apr\u00e8s l'\u00e9tablissement des     &gt; sessions TLS. Le client recevra quand m\u00eame le certificat usurp\u00e9.</p> </li> <li> <p>Passer sans d\u00e9chiffrer : le proxy SSL ferme la connexion TCP     &gt; apr\u00e8s l'\u00e9tablissement de la session TLS et ouvre une deuxi\u00e8me     &gt; connexion TCP pour renvoyer les commandes TLS du client.</p> </li> </ul> <p>Attention</p> <p>Pour les actions Bloquer sans d\u00e9chiffrer et Passer sans d\u00e9chiffrer, le trio [IP, port, SNI] est ajout\u00e9 au cache du proxy SSL pour appliquer l'action d\u00e8s la r\u00e9ception du SNI lors d'une prochaine connexion au m\u00eame serveur.</p> <p>Attention</p> <p>Pour limiter l'impact du proxy SSL sur les performances du pare-feu, le filtrage SSL peut \u00eatre utilis\u00e9 pour passer sans d\u00e9chiffrer plusieurs sites qui ne repr\u00e9sentent pas une menace sur la s\u00e9curit\u00e9 de l'entreprise, par exemple les sites de mises jours des syst\u00e8mes et des logiciels.</p> <p>Apr\u00e8s avoir (si besoin) modifi\u00e9 un profil, il convient d'activer le proxy SSL.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#activation-du-proxy-ssl","title":"Activation du proxy SSL","text":""},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#methode-1-utilisation-de-lassistant","title":"M\u00e9thode 1\u00a0: utilisation de l'assistant","text":"<ul> <li>Se rendre dans le menu CONFIGURATION \u21d2 POLITIQUE DE S\u00c9CURIT\u00c9 \u21d2     FILTRAGE ET NAT =&gt; onglet FILTRAGE pour y ajouter la r\u00e8gle     d'inspection SSL.</li> </ul> <p>L' assistant \u00ab\u00a0R\u00e8gle d'inspection SSL\u00a0\u00bb a pour but de cr\u00e9er des r\u00e8gles inspectant le trafic chiffr\u00e9 SSL. Il est conseill\u00e9 de passer par cet assistant pour la g\u00e9n\u00e9ration des deux r\u00e8gles indispensables au bon fonctionnement du proxy SSL.</p> <p>Attention</p> <p>Les deux r\u00e8gles sont cr\u00e9\u00e9es m\u00eame s'il y avait auparavant une r\u00e8gle pour le trafic HTTPS. Il ne faut alors garder que la premi\u00e8re et modifier l'une des deux r\u00e8gles concernant le trafic HTTPS et supprimer l'autre.</p> <ul> <li> <p>D\u00e9finir, dans la premi\u00e8re zone, la politique du trafic \u00e0 d\u00e9chiffrer     en indiquant\u00a0:</p> <ul> <li>les machines sources (\u00ab\u00a0Network_internals\u00a0\u00bb par d\u00e9faut)\u00a0;</li> <li>l'interface d'entr\u00e9e (\u00ab\u00a0any\u00a0\u00bb par d\u00e9faut)\u00a0;</li> <li>la destination (\u00ab\u00a0Internet \u00bb par d\u00e9faut) et le port de destination     (\u00ab ssl_srv \u00bb par d\u00e9faut) parmi la liste d\u00e9roulante d'objets\u00a0: il     contient les ports standards des services utilisant une session TLS     : HTTPS, IMAPS, LDAPS, SMTPS, etc.</li> </ul> </li> <li> <p>D\u00e9finir, dans la deuxi\u00e8me zone\u00a0:</p> <ul> <li> <p>le profil d'inspection\u00a0: il est possible de choisir un profil      d\u00e9fini au pr\u00e9alable</p> </li> <li> <p>Politique de filtrage SSL : il est possible de chosir une      politique de filtrage pr\u00e9alablement d\u00e9finie (ou une de celle par      d\u00e9faut). Dans le cas o\u00f9 aucune politique de filtrage n'est      configur\u00e9e, l'action D\u00e9chiffrer sera appliqu\u00e9e par d\u00e9faut pour      tous les serveurs.</p> </li> </ul> </li> <li> <p>Vous pouvez \u00e9galement activer l'Antivirus ou l'Antispam et     s\u00e9lectionner des politiques de filtrage URL, SMTP, FTP ou SSL     (v\u00e9rification du champ CN du certificat pr\u00e9sent\u00e9).</p> </li> </ul> <p>Afin d'Inspecter le trafic d\u00e9chiffr\u00e9 via la seconde zone de la fen\u00eatre de l'assistant, vous pourrez d\u00e9finir la configuration du Profil d'Inspection, en choisissant l'une de celles que vous avez d\u00e9finies au pr\u00e9alable ou laisser en mode \u00ab Auto \u00bb. Ce mode automatique appliquera l'inspection relative \u00e0 l'origine du trafic.</p> <p>L'assistant cr\u00e9e deux r\u00e8gles de filtrage :</p> <p></p> <p>1. La premi\u00e8re r\u00e8gle est utilis\u00e9e pour intercepter les flux provenant du r\u00e9seau interne \u00e0 destination d'internet sur le groupe de port ssl_srv. Ces flux sont translat\u00e9s \u00e0 destination du proxy SSL qui \u00e9coute sur 127.0.0.1:8084. Cette r\u00e8gle applique l'action d\u00e9chiffrer et le filtrage SSL.</p> <p>2. La deuxi\u00e8me r\u00e8gle autorise les flux provenant du r\u00e9seau interne et sortant du proxy SSL (Via SSL proxy) \u00e0 destination d'Internet. Les protections applicatives (Filtrage URL, Antivirus, antispam, etc.) doivent \u00eatre activ\u00e9es sur cette r\u00e8gle.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#methode-2-creation-des-deux-regles","title":"M\u00e9thode 2\u00a0: cr\u00e9ation des deux r\u00e8gles","text":"<ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple</li> </ul> <p>La suite est classique jusqu'\u00e0 inspection\u00a0:</p> <p></p> <p>On obtient la r\u00e8gle\u00a0:</p> <p></p> <ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple (ou modifier une r\u00e8gle     existante)</li> </ul> <p></p> <p></p> <p>Installation du certificat racine dans les navigateurs</p> <p>Une fois le proxy SSL activ\u00e9, le client qui tente de se connecter \u00e0 un site HTTPS d\u00e9chiffr\u00e9, voit une alerte s'afficher dans le navigateur pour l'informer que le certificat re\u00e7u n'est pas sign\u00e9 par une autorit\u00e9 connue. Cette alerte s'explique par le fait que le proxy SSL envoie un certificat usurp\u00e9 sign\u00e9 par une autorit\u00e9 (CA) non publique.</p> <p></p> <p></p> <p>A lire attentivement</p> <p>Pour \u00e9viter l'affichage de cette alerte, il faut installer le certificat de l'autorit\u00e9 de certification racine (CA) utilis\u00e9e par le proxy SSL dans le navigateur (pour Firefox) ou dans le magasin de certificats du syst\u00e8me d'exploitation (pour Internet Explorer, Edge et Chrome) et la d\u00e9clarer comme une autorit\u00e9 racine de confiance.</p> <p>Plusieurs m\u00e9thodes pour r\u00e9cup\u00e9rer le certificat de le CA utilis\u00e9e par le proxy SSL, dont\u00a0:</p> <ul> <li>R\u00e9cup\u00e9rer le certificat de la CA directement depuis le     navigateur quand le message d'alerte s'affiche (ou en cliquant sur     Erreur de certificat, puis Voir le certificat, mettez la CA racine     en surbrillance, et cliquez sur Exporter vers un fichier.</li> <li>Ou r\u00e9cup\u00e9rer le certificat de la CA via l'interface web du firewall,     dans le menu CONFIGURATION \u21d2 OBJETS \u21d2 CERTIFICATS ET PKI</li> </ul> <p></p> <p>Puis</p> <ul> <li>Sur Firefox, suivre la proc\u00e9dure ci-dessous :</li> </ul> <p>1. Taper about:preferences#privacy dans la barre de recherche, puis cliquez sur le bouton Afficher les certificats en bas de page,</p> <p>2. Aller dans l'onglet Autorit\u00e9s et cliquez sur le bouton Importer,</p> <p>3. Choisir le fichier de la CA racine,</p> <p>4. Dans la fen\u00eatre T\u00e9l\u00e9chargement de certificats, cocher la case Confirmer cette AC pour identifier des sites web, puis cliquez sur le bouton OK.</p> <p>5. V\u00e9rifier que l'import est effectif (le classement dans Firefox est effectu\u00e9 par le nom d'organisation d\u00e9crit dans le certificat).</p> <p>Sur Windows, le certificat est ajout\u00e9 au magasin de certificats du syst\u00e8me d'exploitation, utilis\u00e9 par les navigateurs Edge et Chrome (et Internet Explorer).</p> <ul> <li>Suivre la proc\u00e9dure ci-dessous :</li> </ul> <p>1. Cliquer droit sur le certificat \u00e0 installer et choisissez l'option Installer le certificat,</p> <p>2. Dans l'assista\udbc0\udd76t, choisir le magasin pour l'Utilisateur actuel,</p> <p>3. S\u00e9lectionner le magasin de certificats Autorit\u00e9s de certification racines de confiance.</p> <p>Information utile</p> <p>Dans un domaine Active Directory, il est plus simple d'automatiser le d\u00e9ploiement du certificat de la CA par l'utilisation des strat\u00e9gies de groupe (GPO).</p> <ul> <li>Le magasin de certificats de Windows est accessible par le menu D\u00e9marrer, Ex\u00e9cuter, tapez certmgr.msc.</li> </ul>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#documents","title":"Documents","text":""},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#document-1-les-elements-de-configuration-par-defaut","title":"Document 1\u00a0: Les \u00e9l\u00e9ments de configuration par d\u00e9faut","text":""},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#configuration-du-proxy-ssl","title":"Configuration du proxy SSL","text":"<p>La configuration du proxy SSL s'effectue dans le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Profil ssl_01 \u21d2 onglet PROXY</p> <p></p> <p>L'encadr\u00e9 Inspection de contenu permet de d\u00e9finir l'action (d\u00e9l\u00e9guer \u00e0 l'utilisateur, bloquer ou continuer l'analyse) qui doit \u00eatre appliqu\u00e9e par le proxy dans le cas o\u00f9 le certificat pr\u00e9sent\u00e9 par le serveur distant est\u00a0:</p> <p></p> <ul> <li>un certificat auto-sign\u00e9\u00a0;</li> <li>un certificat non valide\u00a0;</li> <li>un certificat sign\u00e9 par une autorit\u00e9 inconnue\u00a0;</li> <li>un certificat avec un type inconnu ou non conforme\u00a0;</li> <li>un certificat avec un nom CN incorrect\u00a0;</li> <li>un certificat dont le CN et les noms alternatifs ne correspondent     pas au FQDN du serveur (SNI).</li> </ul> <p>L'option Autoriser les adresses IP dans les noms de domaine SSL permet d'acc\u00e9der \u00e0 un site en utilisant son adresse IP \u00e0 la place de son nom FQDN.</p> <p>L'encadr\u00e9 Support contient deux options pour d\u00e9finir l'action \u00e0 appliquer (Bloquer ou Passer sans d\u00e9chiffrer) dans le cas o\u00f9 le d\u00e9chiffrement \u00e9choue et dans le cas o\u00f9 le certificat ne peut \u00eatre classifi\u00e9 dans les cat\u00e9gories de la base URL (base embarqu\u00e9e ou Extended Web Control).</p> <p>Information utile</p> <p>Dans le cas o\u00f9 l'acc\u00e8s \u00e0 un site est bloqu\u00e9 par le proxy SSL \u00e0 cause d'un des contr\u00f4les ci-dessus, l'utilisateur voit sur son navigateur un message indiquant la raison du blocage.</p> <p>Cette configuration par d\u00e9faut peut convenir dans la majorit\u00e9 des cas.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#gestion-des-certificats-des-autorites-publiques","title":"Gestion des certificats des autorit\u00e9s publiques","text":"<p>Lorsque le proxy SSL re\u00e7oit le certificat du serveur distant, il v\u00e9rifie s'il est sign\u00e9 par une autorit\u00e9 de confiance publique ou priv\u00e9e. Les autorit\u00e9s de confiance publiques sont pr\u00e9configur\u00e9es et elles sont mises \u00e0 jour automatiquement par le module Active Update.</p> <p>Elles sont accessibles depuis le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 AUTORIT\u00c9S DE CERTIFICATION PUBLIQUES. L'interface permet d'activer/d\u00e9sactiver une autorit\u00e9 en cas de besoin.</p> <p></p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#configuration-de-lautorite-signataire-des-certificats-usurpes","title":"Configuration de l'autorit\u00e9 signataire des certificats usurp\u00e9s","text":"<p>Par d\u00e9faut, le proxy SSL signe les certificats usurp\u00e9s avec l'autorit\u00e9 SSL proxy default authority d\u00e9j\u00e0 pr\u00e9sente sur le firewall. La modification de cette autorit\u00e9 s'effectuedans le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 onglet PROXY.</p> <p>Il suffit de s\u00e9lectionner la nouvelle autorit\u00e9 dans C.A (signe les certificats) et son mot de passe dans Mot de passe de l\\'autorit\u00e9.</p> <p>Information importante</p> <p> Si vous modifiez le CA par d\u00e9faut, veillez \u00e0 sauvegarder son mot de passe dans le cas d'une r\u00e9utilisation future. Le mot de passe peut \u00eatre affich\u00e9 en clair en cliquant sur l'ic\u00f4ne repr\u00e9sentant une cl\u00e9.</p> <p>Il est \u00e9galement possible d'ajouter une autorit\u00e9 priv\u00e9e (non publique) de confiance via le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 AUTORIT\u00c9S DE CERTIFICATION PERSONNALIS\u00c9ES. Dans ce cas, vous faites confiance \u00e0 tous les certificats sign\u00e9s par cette autorit\u00e9.</p> <p>Ajouter un certificat serveur se r\u00e9alise via le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 CERTIFICATS DE CONFIANCE.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#document-2-les-etapes-du-filtrage-ssl-avec-dechiffrement","title":"Document 2\u00a0: Les \u00e9tapes du filtrage SSL AVEC d\u00e9chiffrement","text":"<p>Pour pouvoir analyser les donn\u00e9es chiffr\u00e9es par un tunnel TLS, les firewalls SNS utilisent le proxy SSL qui est positionn\u00e9 comme \u00ab homme du milieu (man in the middle) \u00bb entre le client et le serveur durant l'ouverture de la session TLS. La figure ci-dessus illustre les diff\u00e9rentes \u00e9tapes de l'ouverture d'une session TLS pour une connexion HTTPS au travers du proxy SSL.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#interception-de-la-connexion-par-le-proxy-ssl","title":"Interception de la connexion par le proxy SSL :","text":"<p>La connexion du client sur le port TCP/443 est translat\u00e9e vers le proxy SSL qui \u00e9coute sur 127.0.0.2:8084. Le proxy SSL commence par parcourir un cache contenant une liste de serveurs identifi\u00e9s par le trio [IP, port, SNI] d\u00e9j\u00e0 visit\u00e9s. Ces serveurs peuvent avoir deux \u00e9tats\u00a0:</p> <ul> <li> <p>Bloquer\u00a0: cet \u00e9tat est d\u00fb au fait que le serveur est bloqu\u00e9     par la politique de filtrage SSL avec l'action bloquer sans     d\u00e9chiffrer ou bien le serveur a pr\u00e9sent\u00e9 un certificat qui n'a pas     pu \u00eatre valid\u00e9 par le pare-feu. Dans ce cas, le proxy SSL continue     l'ouverture de la session TLS avec le client pour lui envoyer un     message de blocage. Aucune connexion ne sera initi\u00e9e avec le     serveur.</p> </li> <li> <p>Passer sans d\u00e9chiffrer\u00a0: cet \u00e9tat est engendr\u00e9 par l'action     passer sans d\u00e9chiffrer appliqu\u00e9e \u00e0 ce serveur par le filtrage SSL.     Dans ce cas, le proxy SSL initie une connexion TCP avec le serveur     pour renvoyer les commandes TLS du client.</p> </li> <li> <p>Ouverture d'une nouvelle session TLS par le proxy SSL \u00e0     destination du serveur\u00a0:</p> </li> </ul> <p>Dans le cas o\u00f9 aucune entr\u00e9e n'est trouv\u00e9e dans le cache pour ce site, \u00e0 la r\u00e9ception du message client Hello qui contient le nom du serveur SNI, le proxy SSL entame une nouvelle connexion TCP et une nouvelle session TLS \u00e0 destination du serveur.</p> <ol> <li>V\u00e9rification du certificat serveur\u00a0:</li> </ol> <p>\u00c0 cette \u00e9tape, le proxy analyse le certificat envoy\u00e9 par le serveur. Il mettra fin \u00e0 la connexion dans les cas suivants\u00a0:</p> <ul> <li> <p>Le serveur ne fournit pas d'informations SSL,</p> </li> <li> <p>Le certificat est auto-sign\u00e9 (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur n'est pas sign\u00e9 par une autorit\u00e9 de     certification de confiance et il n'est pas explicitement d\u00e9clar\u00e9     en exception (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur a expir\u00e9 (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur est r\u00e9voqu\u00e9 (seulement pour une CA \u00ab     custom \u00bb pour laquelle la CRL est accessible),</p> </li> <li> <p>Le serveur demande une authentification,</p> </li> <li> <p>Le SNI ne correspondant pas au CN du certificat ni \u00e0 aucun des     noms alternatifs</p> </li> </ul> <p>Lorsque le certificat serveur n'est pas conforme, l'acc\u00e8s au site est bloqu\u00e9.</p>"},{"location":"stormshield/fiches/fiche08_filtrage_applicatifSNS/#application-du-filtrage-ssl","title":"Application du filtrage SSL :","text":"<p>Apr\u00e8s la validation du certificat, le SNI est confront\u00e9 aux r\u00e8gles de filtrage SSL pour d\u00e9terminer l'action \u00e0 appliquer au serveur\u00a0:</p> <p>D\u00e9chiffrer, Bloquer sans d\u00e9chiffrer ou Passer sans d\u00e9chiffrer. Si c'est cette derni\u00e8re qui est appliqu\u00e9e, le proxy SSL ferme la connexion TCP avec le serveur une fois la session TLS \u00e9tablie. Puis il ouvre une nouvelle connexion TCP dans laquelle, il renverra les commandes TLS du client.</p> <ul> <li>\u00c9tablissement de la session TLS [Firewall -- Serveur]\u00a0:</li> </ul> <p>Dans le cas o\u00f9 l'action D\u00e9chiffrer est appliqu\u00e9e, le proxy SSL finalise l'ouverture de la session TLS avec le serveur. \u00c0 ce stade toutes les communications entre le pare-feu et le serveur sont chiffr\u00e9es par la cl\u00e9 K1.</p> <ul> <li>G\u00e9n\u00e9ration d'un certificat usurp\u00e9 (Fake Certificate) :</li> </ul> <p>Si l'action \u00e0 appliquer est D\u00e9chiffrer ou Bloquer sans d\u00e9chiffrer, le proxy g\u00e9n\u00e8re dynamiquement un certificat qui pr\u00e9sente le CN du certificat du serveur distant ainsi que ses noms alternatifs. Les principales diff\u00e9rences dans ce certificat sont les informations de l'\u00e9metteur et la signature effectu\u00e9e par l'autorit\u00e9 d\u00e9di\u00e9e au proxy SSL.</p> <ul> <li>\u00c9tablissement de la session TLS [Firewall -- Client] :</li> </ul> <p>Le proxy SSL finalise l'\u00e9tablissement de la session TLS initi\u00e9e par le client en lui pr\u00e9sentant le certificat usurp\u00e9. Le client effectue une v\u00e9rification du certificat. Dans le cas o\u00f9 le certificat de l'autorit\u00e9 signataire n'a pas \u00e9t\u00e9 pr\u00e9alablement install\u00e9, dans le navigateur (pour Firefox) ou dans le syst\u00e8me (pour Internet Explorer, Edge et Chrome), et d\u00e9clar\u00e9 comme une autorit\u00e9 de confiance, un message d'erreur s'affiche pour signaler au client que l'autorit\u00e9 signataire n'est pas connue. Toutes les communications entre le client et le firewall sont chiffr\u00e9es avec la cl\u00e9 K2.</p> <p>Apr\u00e8s l'\u00e9tape 7, le trafic est s\u00e9curis\u00e9 par la session TLS 1 entre le client et le firewall et par la session TLS 2 entre le firewall et le serveur. Ceci permet au firewall d'appliquer les protections applicatives sur le trafic qui transite en clair entre les deux sessions TLS.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/","title":"Fiche 09 - Pr\u00e9vention d'intrusion IDS/IPS","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#definition-rapide-des-systemes-ids-et-ips","title":"D\u00e9finition rapide des syst\u00e8mes IDS et IPS","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#ids-intrusion-detection-system","title":"IDS (Intrusion Detection System)","text":"<p>Un IDS est un syst\u00e8me de d\u00e9tection d'intrusion qui surveille le r\u00e9seau ou les syst\u00e8mes pour d\u00e9tecter des activit\u00e9s malveillantes ou non autoris\u00e9es. Il analyse le trafic r\u00e9seau ou les logs des syst\u00e8mes et alerte les administrateurs lorsqu'une menace potentielle est identifi\u00e9e. L'IDS est passif et ne bloque pas les attaques, mais fournit des informations pr\u00e9cieuses pour la r\u00e9ponse aux incidents.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#ips-intrusion-prevention-system","title":"IPS (Intrusion Prevention System)","text":"<p>Un IPS est un syst\u00e8me de pr\u00e9vention des intrusions qui surveille \u00e9galement le r\u00e9seau pour d\u00e9tecter des activit\u00e9s malveillantes, mais en plus, il prend des mesures proactives pour emp\u00eacher ces menaces. Lorsqu'une activit\u00e9 suspecte est d\u00e9tect\u00e9e, l'IPS peut bloquer le trafic ou interrompre la connexion afin de pr\u00e9venir des dommages potentiels. L'IPS est consid\u00e9r\u00e9 comme actif, car il prot\u00e8ge activement le r\u00e9seau contre les intrusions.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#presentation-generale","title":"Pr\u00e9sentation g\u00e9n\u00e9rale","text":"<p>Les \u00e9quipements Stormshield Network\u00a0Security sont \u00e9quip\u00e9s nativement d'un module de pr\u00e9vention d'intrusion nomm\u00e9 ASQ (Active Security Qualification). Chaque paquet re\u00e7u par le pare-feu SNS sera soumis \u00e0 un ensemble d'analyses \u00e0 commencer par la v\u00e9rification du protocole IP. Le r\u00f4le principal de l'ASQ est de s'assurer de la conformit\u00e9 du paquet par rapport aux protocoles utilis\u00e9s de la couche IP jusqu'\u00e0 la couche applicative (gr\u00e2ce aux plugins) et aux signatures contextuelles (ou Patterns). C'est \u00e9galement l'ASQ qui est en charge de filtrer les flux et d'appliquer une op\u00e9ration de NAT si n\u00e9cessaire.</p> <p>Int\u00e9gr\u00e9 \u00e0 la pile r\u00e9seau du syst\u00e8me d'exploitation FreeBSD, le moteur de pr\u00e9vention d'intrusion ASQ dispose d'un acc\u00e8s privil\u00e9gi\u00e9 aux ressources mat\u00e9rielles (CPU, m\u00e9moire et carte r\u00e9seau).</p> <p>Ce syst\u00e8me de pr\u00e9vention d'intrusion assure le filtrage des flux ainsi que leur analyse : d\u00e8s les couches de transport et jusqu'aux couches applicatives, il applique des contr\u00f4les g\u00e9n\u00e9riques de conformit\u00e9, ainsi que des contr\u00f4les cibl\u00e9s et comportementaux. Les op\u00e9rations de NAT ainsi que certaines op\u00e9rations de routage sp\u00e9cifique sont \u00e9galement prises en charge par ce moteur.</p> <p>Ces analyses sont appliqu\u00e9es directement sur les connexions cherchant \u00e0 traverser la pile r\u00e9seau du syst\u00e8me.</p> <p></p> <p>Le syst\u00e8me de pr\u00e9vention d'intrusion ou IPS (Intrusion Prevention System) d\u00e9tecte et bloque les tentatives d'attaques des applicatifs gr\u00e2ce \u00e0 des analyses contextuelles et comportementales compl\u00e9t\u00e9es par une identification par signatures. Cette association pr\u00e9sente deux b\u00e9n\u00e9fices majeurs\u00a0:</p> <ul> <li>il permet de r\u00e9aliser un traitement pr\u00e9ventif sur toutes les couches     de communication (du r\u00e9seau \u00e0 l'application) fournissant ainsi une     r\u00e9elle protection 0-day\u00a0;</li> <li>l'usage des contextes applicatifs limite le nombre de signatures \u00e0     examiner et r\u00e9duit ainsi les risques de faux positifs tout en     optimisant les temps de traitements pour procurer des performances     optimales.</li> </ul> <p>Les signatures utilis\u00e9es par le moteur de pr\u00e9vention d'intrusion SNS sont construites pour d\u00e9tecter des attaques identifiables mais \u00e9galement leurs variantes potentielles. \u00c0 titre d'exemple, la signature contextuelle sur une injection SQL par une commande SELECT (http:url:decoded:95) permet de contrer plus de 1 540 variantes d'attaques. En plus de maintenir un espace de stockage contenu, cette technique permet d'optimiser les temps de traitement et propose une protection contre de futures attaques bas\u00e9es sur les m\u00eames principes.</p> <p>La mise \u00e0 jour des bases de signatures du moteur de pr\u00e9vention Stormshield Network Security est assur\u00e9e ind\u00e9pendamment de la mise \u00e0 jour du firmware pour garantir une actualisation p\u00e9riodique et automatique afin de rester constamment prot\u00e9g\u00e9 contre les nouvelles attaques.</p> <p>Cette fonctionnalit\u00e9 de mise \u00e0 jour automatique se nomme \u00ab\u00a0Active Update\u00a0\u00bb ; elle permet \u00e9galement d'ajouter de nouveaux contextes pour int\u00e9grer de nouvelles cat\u00e9gories de signatures contextuelles.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#les-differents-types-danalyses","title":"Les diff\u00e9rents types d'analyses","text":"<p>Au-del\u00e0 du simple classement [niveau r\u00e9seau][niveau applicatif], un pare-feu SNS prot\u00e8ge le r\u00e9seau selon trois familles d'analyses\u00a0:</p> <ul> <li>l'analyse protocolaire\u00a0: elle assure la conformit\u00e9 des flux     r\u00e9seau vis-\u00e0-vis des standards de communication (IP, TCP, UDP, etc.)     ainsi que la conformit\u00e9 aux protocoles applicatifs (HTTP, FTP, etc.)     gr\u00e2ce aux contr\u00f4les appliqu\u00e9s par les contextes applicatifs,</li> <li>l'analyse statistique\u00a0: bas\u00e9e sur des \u00e9tudes statistiques du     trafic transitant par le pare-feu, cette analyse d\u00e9tecte des     comportements assimilables \u00e0 du scan de ports, \u00e0 du SYN flooding, ou     encore \u00e0 des tentatives de DoS (Denial of Service) par maintien de     multiples connexions annon\u00e7ant des petites fen\u00eatres (SockStress),</li> <li>l'analyse par signatures contextuelles\u00a0: elle vient compl\u00e9ter     les contr\u00f4les de conformit\u00e9 sur le trafic. Cette analyse permet de     se prot\u00e9ger de tentatives d'attaques visant sp\u00e9cifiquement un     protocole et une impl\u00e9mentation cliente ou serveur, mais sans     toutefois recourir \u00e0 une inconformit\u00e9 au standard de communication.     Elle s'appuie sur des bases de signatures construites par     Stormshield, maintenues\u00a0quotidiennement et mises \u00e0 disposition sur     les serveurs Active Update.</li> </ul>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#les-niveaux-dinspection-de-securite","title":"Les niveaux d'inspection de s\u00e9curit\u00e9","text":"<p>Chaque paquet re\u00e7u par le pare-feu SNS est soumis \u00e0 la politique de filtrage.</p> <p>Info</p> <p>Par d\u00e9faut, l'analyse IPS (Intrusion Prevention System\u00a0: syst\u00e8me de pr\u00e9vention d'intrusion) est appliqu\u00e9e, ce qui signifie que le pare-feu SNS est capable de d\u00e9tecter une anomalie et de bloquer le paquet correspondant.</p> <p>D'autres niveaux d'inspections peuvent \u00eatre utilis\u00e9s, \u00e0 des fins de tests ou par n\u00e9cessit\u00e9\u00a0: par exemple si on contacte un serveur ne respectant pas la RFC des protocoles qu'il g\u00e8re.</p> <p>Ces niveaux sont \u00e0 s\u00e9lectionner dans la colonne Inspection de s\u00e9curit\u00e9 de la r\u00e8gle de filtrage concern\u00e9e.</p> <p></p> <ul> <li> <p>IPS : D\u00e9tecter et bloquer (choix par d\u00e9faut).</p> </li> <li> <p>L'ASQ va soumettre le paquet \u00e0 l'ensemble des couches qu'il est capable d'analyser et le bloquer en cas d'anomalie.</p> </li> <li> <p>IDS : D\u00e9tecter. L'ASQ effectue une analyse similaire \u00e0 l'IPS sauf que le paquet est toujours autoris\u00e9. C'est un profil permettant de faire un      audit rapide pour une r\u00e8gle de filtrage donn\u00e9e.</p> </li> <li> <p>Pare-feu : ne pas inspecter. L'ASQ ne va effectuer que tr\u00e8s peu d'analyses sur le paquet re\u00e7u. Il se comporte comme un simple routeur filtrant.</p> </li> </ul> <p>L'ASQ est compos\u00e9 de 10 configurations (\u00e9galement nomm\u00e9es profils IPS). Chacune de ces configuration peut \u00eatre \u00e9dit\u00e9e en fonction des besoins de l'administrateur.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#configuration-des-profils-dinspection","title":"Configuration des profils d'inspection","text":"<p>La configuration par d\u00e9faut, comme indiqu\u00e9 dans le menu Configuration \u21d2 Protection applicative \u21d2 Profils d'inspection, applique les profils IPS_00 et IPS_01 respectivement aux connexions entrantes (paquet dont l'adresse IP source ne fait pas partie d'un r\u00e9seau prot\u00e9g\u00e9) et aux connexions sortantes (paquet dont l'adresse IP source fait partie d'un r\u00e9seau prot\u00e9g\u00e9).</p> <p>Si des flux sains d\u00e9clenchent des alarmes, il sera s\u00fbrement n\u00e9cessaire de modifier les param\u00e8tres de l'ASQ pour ne pas bloquer la production. Dans ce cas, les modifications doivent \u00eatre faites au plus sp\u00e9cifique. De pr\u00e9f\u00e9rence dans un profil d\u00e9di\u00e9 qui sera appliqu\u00e9 sur les r\u00e8gles identifiant pr\u00e9cis\u00e9ment le trafic concern\u00e9.</p> <p>Il est alors possible, dans la table de filtrage, de forcer l'utilisation d'un profil ASQ sp\u00e9cifique depuis la colonne Inspection de s\u00e9curit\u00e9.</p> <p>Par d\u00e9faut, l'IPS est actif sur toutes les r\u00e8gles de filtrage en mode de d\u00e9tection automatique du protocole. Afin de mieux inspecter les flux, il est recommand\u00e9 de qualifier manuellement le type de protocole si le port utilis\u00e9 n'est pas standard. L'IPS risquerait de ne pas d\u00e9tecter correctement l'application.</p> <ul> <li>Les profils sont configurables et administrables depuis les menus     Protocoles et Applications et protections sous Configuration     \u21d2 Protection applicative.</li> </ul> <p></p> <p>Par d\u00e9faut, la liste des \u00e9v\u00e8nements est affich\u00e9e en vue par profil d'inspection. Pour tous les \u00e9v\u00e8nements, une action et un niveau d'alerte sont pr\u00e9-param\u00e9tr\u00e9s\u00a0:</p> <ul> <li> <p>Action</p> <ul> <li>Autoriser : le moteur de pr\u00e9vention d'intrusion laisse     passer le paquet correspondant \u00e0 l'alarme\u00a0;</li> <li>Interdire : le moteur de pr\u00e9vention d'intrusion bloque le     paquet correspondant \u00e0 l'alarme.</li> </ul> </li> <li> <p>Niveau</p> <ul> <li>Majeur : le moteur de pr\u00e9vention d'intrusion \u00e9mettra une     alarme majeure sur d\u00e9tection de l'\u00e9venement\u00a0;</li> <li>Mineur : le moteur de pr\u00e9vention d'intrusion \u00e9mettra une     alarme mineure sur d\u00e9tection de l'\u00e9venement\u00a0;</li> <li>Ignore : le moteur de pr\u00e9vention d'intrusion n'\u00e9mettra     aucune alarme sur d\u00e9tection de l'\u00e9venement. L'action d\u00e9finie     sera donc appliqu\u00e9e silencieusement.</li> </ul> </li> </ul> <p>Tri sur les trois cat\u00e9gories d'alarme</p> <p>Des boutons vous permettent d'effectuer un tri sur les alarmes du profil d'inspection. Les 3 cat\u00e9gories dans lesquelles ces alarmes sont r\u00e9parties sont Applications, Protections et Malwares. La s\u00e9lection s'effectue par les 3 boutons du m\u00eame nom\u00a0:</p> <ul> <li>Applications\u00a0: ce type d'alarme est lev\u00e9 par l'utilisation     d'applications courantes. Cette s\u00e9lection permet l'\u00e9laboration d'une     politique de s\u00e9curit\u00e9 applicative.</li> <li>Protections\u00a0: ces alarmes sont lev\u00e9es suite \u00e0 l'analyse effectu\u00e9e     par le moteur IPS : elles r\u00e9sultent du blocage d'attaques connues ou     d'utilisations anormales des protocoles conform\u00e9ment aux RFC.</li> <li>Malwares\u00a0: ces alarmes sont bas\u00e9es sur les signatures connues de     logiciels malveillants, reconnus par des types d'activit\u00e9 suspects.     Il est conseill\u00e9 d'examiner les machines \u00e0 l'origine de cette     cat\u00e9gorie d'alarmes.</li> </ul> <p>Filtrage sur mot cl\u00e9 dans la zone \u00ab\u00a0rechercher\u00a0\u00bb</p> <p>Il peut \u00eatre int\u00e9ressant de filtrer sur un mot cl\u00e9 (\u00e0 noter qu'au passage de la souris un texte explicatif concernant l\u00a0'\u00e9v\u00e8nement appara\u00eet)\u00a0:</p> <p></p> <p>Un bouton d'aide permet aussi d'avoir une explication (en fran\u00e7ais)\u00a0:</p> <p></p> <p></p> <p>Pr\u00e9s\u00e9lection</p> <p>Cette liste contient les alarmes g\u00e9n\u00e9r\u00e9es par un trafic relatif \u00e0 des familles d'applications. Vous pouvez effectuer un tri et n'afficher que les alarmes faisant partie d'un certain nombre de cat\u00e9gories (BYOD, Stockage en ligne, E-mail, Jeu, Communication, Multim\u00e9dia, Peer to peer, Acc\u00e8s \u00e0 distance, R\u00e9seaux sociaux, Web).</p> <p>Info</p> <p>Pour afficher les colonnes Signatures, Mod\u00e8le et Profil applicatif, cliquez sur la fl\u00e8che apparaissant au survol de l'intitul\u00e9 d'une colonne et cochez les cases correspondantes propos\u00e9es dans le menu Colonnes.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#mise-a-jour-des-signatures-contextuelles","title":"Mise \u00e0 jour des signatures contextuelles","text":"<p>Les signatures contextuelles sont nombreuses et peuvent \u00eatre mises \u00e0 jour quotidiennement. Les nouvelles signatures t\u00e9l\u00e9charg\u00e9es (signal\u00e9es par un drapeau bleu \u00ab\u00a0Nouveau\u00a0\u00bb) sont appliqu\u00e9es automatiquement (sans l'approbation de l'administrateur) aux flux analys\u00e9s avec l'action et le niveau d'alerte d\u00e9finis par d\u00e9faut.</p> <ul> <li>Se rendre dans le menu Protection applicative, Profils d'inspection,     zone nouvelles alarme. L'option Appliquer le mod\u00e8le par d\u00e9faut aux     nouvelles alarmes est coch\u00e9e \u21d2 celles-ci se mettront \u00e0 jour     automatiquement et seront livr\u00e9es avec la signature Stormshield     Network.</li> </ul> <p></p> <ul> <li>Si vous souhaitez les appliquer vous-m\u00eames, d\u00e9cocher la case et     d\u00e9finir les param\u00e8tres des champs suivants.</li> </ul> <p>Par ailleurs, suite \u00e0 l'examen des actions et niveaux d'alerte propos\u00e9s, l'administrateur peut approuver ces \u00e9v\u00e8nements pour en faire dispara\u00eetre le marqueur \u00ab\u00a0Nouveau\u00a0\u00bb. C'est alors l'action d\u00e9finie sur la ligne de l'alarme qui s'applique.</p> <p>Info</p> <p>Il est possible d'approuver une s\u00e9lection de signatures en une seule fois en utilisant le bouton \u00ab\u00a0approuver les nouvelles alarmes\u00a0\u00bb.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#appliquer-un-modele","title":"Appliquer un mod\u00e8le","text":"<p>Plusieurs mod\u00e8les permettent de configurer le profil des alarmes en param\u00e9trant leur action (Autoriser ou Interdire) et leur niveau (Ignorer, Mineur ou Majeur).</p> <p>Les mod\u00e8les BASSE, MOYENNE et HAUTE se diff\u00e9rencient essentiellement par l'action des alarmes de type Protections, comme les alarmes relatives aux r\u00e9seaux \\\"peer-to-peer\\\" ou aux messageries instantan\u00e9es.</p> <p>Le mod\u00e8le INTERNET d\u00e9sactive les alarmes pouvant g\u00eaner l'utilisation classique d'Internet, souvent due \u00e0 de mauvaises pratiques trop r\u00e9pandues pour \u00eatre interdites. Un exemple est l'alarme lev\u00e9e en cas d\\'URL contenant des caract\u00e8res non ASCII.</p> <p>Par d\u00e9faut, le profil (1) IPS_01 est bas\u00e9 sur le mod\u00e8le INTERNET (la plupart des alarmes sont configur\u00e9es avec l'action Autoriser, quand elles ne pr\u00e9sentent pas de danger pour le r\u00e9seau interne), \u00e9tant destin\u00e9 au trafic dont l\\'adresse IP source fait partie d\\'un r\u00e9seau prot\u00e9g\u00e9. Les autres profils (dont le trafic entrant) sont configur\u00e9s sur le mod\u00e8le MOYENNE qui assure un niveau de s\u00e9curit\u00e9 standard compromis entre s\u00e9curit\u00e9 et blocage excessif ; il est appliqu\u00e9 par d\u00e9faut au trafic entrant..</p> <p>Les deux autres mod\u00e8les sont\u00a0:</p> <ul> <li>Basse\u00a0: les alarmes les moins critiques sont configur\u00e9es avec     l'action Autoriser.</li> <li>Haute\u00a0: la majorit\u00e9 des alarmes sont configur\u00e9es avec l'action     Bloquer</li> </ul> <p>Chaque \u00e9v\u00e8nement d\u00e9tectable par la pr\u00e9vention d'intrusion est associ\u00e9 \u00e0 une alarme configurable.</p> <p> </p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#les-alarmes-globales","title":"Les alarmes globales","text":"<p>Il existe quelques \u00e9v\u00e8nements pour lesquels le param\u00e9trage est global \u00e0 tous les profils. Ce sont principalement des \u00e9v\u00e8nements d\u00e9tect\u00e9s avant l'\u00e9valuation des r\u00e8gles de filtrage. Or la s\u00e9lection d'un profil protocolaire ou applicatif s'effectue pendant le processus d'\u00e9valuation des r\u00e8gles de filtrage auxquelles sont associ\u00e9es les profils d'inspections. C'est, par exemple, le cas pour l'\u00e9v\u00e8nement \u00ab\u00a0Usurpation d'adresse IP\u00a0\u00bb dont la v\u00e9rification intervient bien avant l'examen du stateful et du filtrage.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#les-alarmes-non-configurables","title":"Les alarmes non configurables","text":"<p>La configuration des actions de certaines alarmes n'est pas possible. Il s'agit pour la plupart d'\u00e9v\u00e8nements particuliers qui sont li\u00e9s \u00e0 une information \u00e0 post\u00e9riori de d\u00e9tection d 'un \u00e9v\u00e8nement (scan de port), d'une information sur les m\u00e9canismes enclench\u00e9s pour la poursuite des analyses (d\u00e9synchronisation du trafic TCP) ou encore d'un \u00e9v\u00e8nement trop en marge des standards de communication pour permettre la poursuite des analyses (Attaque Xmas tree). Les alarmes non configurables sont des alarmes globales.</p> <p>**Ci-dessous, l'\u00e9v\u00e8nement pour un scan de port\u00a0: **</p> <p></p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#documents","title":"Documents","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#document-1-les-analyses-de-securite","title":"Document 1\u00a0: Les analyses de s\u00e9curit\u00e9","text":"<p>Ce qui suit n'est qu'un r\u00e9sum\u00e9. Pour plus de d\u00e9tails, il est n\u00e9cessaire de se r\u00e9f\u00e9rer \u00e0 la documentation officielle du produit</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#11-analyse-protocolaire-ip","title":"1.1 Analyse protocolaire IP","text":"<p>Le moteur de pr\u00e9vention d'intrusion Stormshield Network d\u00e9marre ses contr\u00f4les \u00e0 la couche r\u00e9seau IP :</p> <ul> <li> <p>Les analyses de conformit\u00e9 du protocole IP\u00a0: v\u00e9rifications du     num\u00e9ro de version du protocole IP et la conformit\u00e9 des options     positionn\u00e9es, v\u00e9rification de la taille annonc\u00e9es dans l'en-t\u00eate     IPv4 et de la taille effective de la charge, comparaison de la somme     de contr\u00f4le (checksum) annonc\u00e9e et la valeur de cette somme qui est     recalcul\u00e9e</p> </li> <li> <p>Contr\u00f4le de l\u00e9gitimit\u00e9 des sources (anti usurpation)\u00a0: Le     m\u00e9canisme de protection contre l'usurpation d'adresse     (anti-spoofing) permet de d\u00e9tecter une incoh\u00e9rence entre l'adresse     IP source du paquet re\u00e7u et l'interface r\u00e9seau sur laquelle il se     pr\u00e9sente.</p> </li> <li> <p>Mise en quarantaine de machines ou de connexions\u00a0: les entr\u00e9es     de la quarantaine (liste noire) permettent de bannir toute     communication, de mani\u00e8re bidirectionnelle, entre deux entit\u00e9s IP     (h\u00f4te avec h\u00f4te, h\u00f4te avec r\u00e9seau, r\u00e9seau avec r\u00e9seau et m\u00eame h\u00f4te     ou r\u00e9seau avec \u00ab\u00a0Any\u00a0\u00bb). On distingue les listes suivantes\u00a0:</p> <ul> <li>liste noire statique\u00a0: il est possible, en CLI, de cr\u00e9er des     entr\u00e9es statiques dans la liste de quarantaine pour bannir toute     communication traversante entre des entit\u00e9s IP \u00e0 d\u00e9finir par les     objets leur correspondant.</li> <li>Lliste blanche\u00a0: une liste blanche (WhiteList ou ByPass     ASQ), \u00e0 d\u00e9finir en CLI, permet de contourner les contr\u00f4les ASQ     pour toute communication entre les couples d'objets d\u00e9clar\u00e9s.</li> <li>liste noire dynamique\u00a0: le moteur de pr\u00e9vention d'intrusion     Stormshield Network Security permet de placer des machines en     quarantaine afin que leurs trafics soient bloqu\u00e9s.</li> </ul> <p>Depuis le menu de configuration des alarmes dans le module \u00ab Protection applicative \u00bb, il est possible d'ajouter une r\u00e9action suppl\u00e9mentaire sur r\u00e9alisation d'un \u00e9v\u00e8nement. Ainsi, toute machine d\u00e9clenchant cet \u00e9v\u00e8nement est imm\u00e9diatement plac\u00e9e en quarantaine pour la dur\u00e9e choisie.</p> </li> <li> <p>La fragmentation IP</p> </li> <li> <p>Les attaques par fragmentation IP</p> </li> </ul>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#12-analyse-protocolaire-sur-la-couche-transport","title":"1.2 Analyse protocolaire sur la couche transport","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#firewall-stateful","title":"Firewall stateful","text":"<p>La conservation de l'\u00e9tat des sessions permet de contr\u00f4ler leur conformit\u00e9 aux standards de communication au fil de leurs \u00e9volutions et pendant toute leur dur\u00e9e de vie. On parle de suivi \u00ab stateful \u00bb ou \u00ab plein \u00e9tat \u00bb. Les m\u00e9canismes et contr\u00f4les de suivi stateful permettent, non seulement, de g\u00e9rer automatiquement les paquets r\u00e9ponses \u00e0 destination de l'initiateur de la connexion, mais ils pr\u00e9viennent \u00e9galement les tentatives d'attaques par injection de paquets, en v\u00e9rifiant que le contenu de chaque paquet est coh\u00e9rent avec l'\u00e9tat de la session en cours.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#etat-des-connexions","title":"\u00c9tat des connexions","text":"<p>Le moteur de pr\u00e9vention d'intrusion Stormshield Network applique des contr\u00f4les particuliers aux diff\u00e9rentes \u00e9tapes d'\u00e9tablissement, de transport de donn\u00e9es et de cl\u00f4ture des connexions TCP.</p> <p>Les contr\u00f4les sur ICMP consistent, quant \u00e0 eux, principalement \u00e0 l'identification de session TCP/UDP en rapport avec les messages ICMP retourn\u00e9s. Les r\u00e9ponses ICMP (echo reply) sont \u00e9galement corr\u00e9l\u00e9es aux requ\u00eates (echo request) en attente conserv\u00e9es dans la table de stateful.</p> <p>Quoique bien plus basique, le protocole UDP est \u00e9galement trait\u00e9 par plusieurs \u00e9tats (open ou data) pour rendre compte d'un trafic unidirectionnel ou bidirectionnel, dans le cas d'un dialogue.</p> <p>Le checksum UDP (facultatif) est v\u00e9rifi\u00e9 lorsqu'il est positionn\u00e9.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#regles-de-filtrage","title":"R\u00e8gles de filtrage","text":"<p>Toute nouvelle connexion est \u00e9valu\u00e9e par le moteur de filtrage Stormshield Network.</p> <p>D\u00e8s qu'une r\u00e8gle passante de filtrage correspond \u00e0 la tentative de connexion, cette derni\u00e8re est autoris\u00e9e et le moteur de pr\u00e9vention d'intrusion cr\u00e9e un \u00e9tat permettant de d\u00e9marrer le suivi de la connexion. Toute connexion qui n'est pas explicitement autoris\u00e9e par une r\u00e8gle de filtrage sera bloqu\u00e9e implicitement sans qu''il ne soit besoin de terminer la politique de filtrage par une r\u00e8gle de blocage et, par d\u00e9faut, sans remont\u00e9e de log.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#profils-applicatifs","title":"Profils applicatifs","text":"<p>Chaque r\u00e8gle de filtrage est associ\u00e9e \u00e0 un profil d'inspection. Il est possible de choisir le profil d'inspection \u00e0 utiliser pour chaque r\u00e8gle tel que d\u00e9crit ci-dessous :</p> <ul> <li> <p>Lorsqu'aucun profil n'est s\u00e9lectionn\u00e9, ce sont les profils     d'inspection par d\u00e9faut qui sont utilis\u00e9s.</p> </li> <li> <ul> <li>Le profil ENTRANT par d\u00e9faut (00) s'appliquera aux connexions         provenant d'une adresse IP source non prot\u00e9g\u00e9e (ou non interne),</li> <li>Le profil SORTANT par d\u00e9faut (01) s'appliquera aux connexions     provenant d'une adresse IP source incluse dans les r\u00e9seaux     prot\u00e9g\u00e9s (r\u00e9seaux internes).</li> </ul> </li> <li> <p>S\u00e9lection d'un profil d'inspection particulier qui sera utilis\u00e9 pour     cette r\u00e8gle (il existe 8 profils d'inspection pouvant \u00eatre utilis\u00e9s     \u00e0 la place des profils par d\u00e9fautet dont les param\u00e8tres sont     personnalisables).</p> </li> <li> <p>S\u00e9lection du mode IDS pour lequel le trafic correspondant \u00e0 cette     r\u00e8gle sera inspect\u00e9 sans blocage mais \u00e9mettra des alarmes en cas de     trafic malveillant.</p> </li> <li>S\u00e9lection du mode Firewall pour s'appliquer aucun contr\u00f4le de     conformit\u00e9 et ne mettre en \u0153uvre qu'une gestion basique du suivi     d'\u00e9tat (gestion primaire d'ouverture et de fermeture de connexion.</li> </ul>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#13-analyse-applicative-les-plugins-applicatifs","title":"1.3 Analyse applicative (les plugins applicatifs)","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#la-caracterisation-des-flux-et-levasion-de-donnees","title":"La caract\u00e9risation des flux et l'\u00e9vasion de donn\u00e9es","text":"<p>D\u00e8s lors que l'\u00e9tablissement d'un flux a \u00e9t\u00e9 autoris\u00e9 par une r\u00e8gle de filtrage, son suivi par les m\u00e9canismes de stateful ne suffit pas \u00e0 garantir une s\u00e9curit\u00e9 compl\u00e8te et ne permet pas \u00e0 l'administrateur de se prononcer strictement sur les protocoles applicatifs permis.</p> <p>Il appara\u00eet clairement que le crit\u00e8re HTTP d\u00e9sign\u00e9 par un l'administrateur est traduit par TCP/80.</p> <p>Donc, mis \u00e0 part le protocole de transport et le num\u00e9ro de port, rien ne forcerait ici les flux applicatifs traversant cette r\u00e8gle \u00e0 se conformer au protocole HTTP.</p> <p>Il serait donc possible de faire passer dans ces connexions des flux tout \u00e0 fait diff\u00e9rents de HTTP ; ceci constituerait de l'\u00e9vasion de donn\u00e9es.</p> <p>Pour interdire ce ph\u00e9nom\u00e8ne, l'identification et l'analyse de la couche sup\u00e9rieure s'av\u00e8rent donc n\u00e9cessaires.</p> <p>Ces analyses compl\u00e9mentaires sont confi\u00e9es aux plugins que le moteur de pr\u00e9vention d'intrusion attache aux connexions afin de d\u00e9finir le contexte applicatif associ\u00e9.</p> <p>L'attachement des plugins d'inspection peut \u00eatre assur\u00e9 de diff\u00e9rentes mani\u00e8res :</p> <ul> <li> <p>Explicite:</p> <ul> <li>par implication d'un port par d\u00e9faut (exemple\u00a0: plugin d'analyse     associ\u00e9 au port 80)\u00a0;</li> <li>par s\u00e9lection du protocole applicatif (exemple\u00a0:     l'administrateur pr\u00e9cise le protocole http dans sa r\u00e8gle de     filtrage donc le plugin associ\u00e9 \u00e0 ce protocole sera activ\u00e9 m\u00eame     si le port choisi est autre que le port par d\u00e9faut\u00a0: 80).</li> </ul> </li> <li> <p>Implicite (d\u00e9tection automatique) : La d\u00e9tection du protocole     applicatif est rendue possible par une comparaison du contenu des     premiers paquets de donn\u00e9es \u00e9chang\u00e9s entre les correspondants avec     les syntaxes caract\u00e9ristiques des protocoles applicatifs connus par     les plugins.</p> </li> </ul> <p>D\u00e8s lors qu'un plugin applicatif est associ\u00e9 \u00e0 un flux, il va r\u00e9aliser une \u00e9tude approfondie principalement des donn\u00e9es protocolaires applicatives (aspect s\u00e9quentiel des dialogues, param\u00e8tres positionn\u00e9s dans les en-t\u00eates, phases d'authentification, commandes et codes de retour, formatage des contenus protocolaires, ...).</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#14-analyse-des-signatures-contextuelles","title":"1.4 Analyse des signatures contextuelles","text":""},{"location":"stormshield/fiches/fiche09_IDS_IPS/#detection-par-signature","title":"D\u00e9tection par signature","text":"<p>Le but premier des signatures contextuelles est de caract\u00e9riser des attaques ou des comportements d'attaques ne s'appuyant pas sur des inconformit\u00e9s protocolaires, mais sur des failles sp\u00e9cifiques d'impl\u00e9mentations logicielles. En restant conformes aux standards de communication, ces attaques ne semblent pas suspectes lors des analyses par les plugins. Il s'av\u00e8re donc n\u00e9cessaire de compl\u00e9ter les analyses protocolaires par une identification d'attaques ou de comportements d'attaques connues. En suppl\u00e9ment, puisque les contenus des champs analys\u00e9s peuvent r\u00e9v\u00e9ler les versions de logiciels utilis\u00e9s pour les communications, les signatures contextuelles offrent \u00e9galement la possibilit\u00e9 d'autoriser ou d'interdire l'utilisation de certains logiciels ou services ainsi identifi\u00e9s.</p> <p>Une signature contextuelle est constitu\u00e9e d'une ou plusieurs cha\u00eenes de caract\u00e8res dont des parties peuvent \u00eatre g\u00e9n\u00e9riques et qualifier un type d'attaque dans un contexte applicatif, et d'autres parties plus sp\u00e9cifiques qui visent \u00e0 identifier les \u00e9ventuelles diff\u00e9rentes variantes du type d'attaque qualifi\u00e9.</p> <p>La base des signatures contextuelles est aliment\u00e9e r\u00e9guli\u00e8rement et publi\u00e9e sur les serveurs d'Active Update pr\u00e9-renseign\u00e9s dans la configuration usine.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#document-2-analyse-des-logs","title":"Document 2\u00a0: Analyse des logs","text":"<p>Pour consulter les logs\u00a0:</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#21-inspection-ips-intrusion-prevention-system-journalisation-et-alarmes","title":"2.1 - Inspection IPS (Intrusion Prevention System) : journalisation et alarmes","text":"<p>Le mode IPS est appliqu\u00e9 par d\u00e9faut.</p> <p>Il procure le niveau d'analyse le plus \u00e9lev\u00e9, ainsi que le meilleur niveau de d\u00e9tail des informations de logs pour les connexions, d\u00e8s lors qu'un suivi applicatif leur aura \u00e9t\u00e9 appliqu\u00e9.</p> <p>Outre les informations de base pour une connexion (source, destination et ports), les op\u00e9rations et les arguments pass\u00e9s dans l'applicatif sont \u00e9galement journalis\u00e9s, ainsi que les codes de retour lorsque le protocole en fait usage.</p> <p>Le nom et le num\u00e9ro de la r\u00e8gle de filtrage qui a autoris\u00e9 cette connexion, ainsi que le profil d'inspection appliqu\u00e9 sont \u00e9galement consign\u00e9s.</p> <p>Un \u00e9v\u00e8nement suspect subira un blocage et provoquera la lev\u00e9e d'une alarme qui, elle aussi, permettra d'identifier la r\u00e8gle de filtrage et le profil d'inspection qui \u00e9taient attach\u00e9s \u00e0 la connexion sur laquelle l'\u00e9v\u00e8nement s'est produit.</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#22-inspection-ids-intrusion-detection-system-journalisation","title":"2.2 - Inspection IDS (Intrusion Detection System) : journalisation","text":"<p>Le mode d'inspection IDS est \u00e0 d\u00e9finir explicitement dans la r\u00e8gle de filtrage.</p> <p>Il procure le m\u00eame niveau initial d'analyse que le mode IPS, avec une tol\u00e9rance \u00e9quivalente au param\u00e9trage d'une action \u00ab autoriser \u00bb sur l'ensemble des \u00e9v\u00e8nements de type alarme.</p> <p>Ce mode est donc capable de d\u00e9grader les analyses pour laisser passer des \u00e9v\u00e8nements majeurs qui se produiraient sur la connexion. Il pourra ainsi d\u00e9tacher un plugin de suivi applicatif sur r\u00e9alisation d'un \u00e9v\u00e8nement sensible, mais \u00e9galement abandonner les contr\u00f4les sur les couches inf\u00e9rieures, lorsqu'une anomalie majeure se produit (un mauvais s\u00e9quen\u00e7age TCP par exemple).</p>"},{"location":"stormshield/fiches/fiche09_IDS_IPS/#23-inspection-firewall","title":"2.3 - Inspection Firewall","text":"<p>Le mode d'inspection Firewall est \u00e0 d\u00e9finir explicitement dans la r\u00e8gle de filtrage.</p> <p>Apr\u00e8s acceptation du premier paquet de connexion par la r\u00e8gle de filtrage, il ne procure qu'un suivi basique :</p> <ul> <li>Cr\u00e9ation d'un \u00e9tat sur r\u00e9ception d'un premier paquet valide,</li> <li>Suivi de la volum\u00e9trie des donn\u00e9es \u00e9chang\u00e9es dans la connexion,</li> <li>D\u00e9tection de la cl\u00f4ture de connexion,</li> <li>Aucune lev\u00e9e d'alarme en cas d'\u00e9v\u00e8nement anormal.</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/","title":"Fiche 10 -- Utilisateurs, authentification et portail captif","text":"<p>La fonction d'authentification du pare-feu permet \u00e0 l'utilisateur de s'identifier via un login et un mot de passe ou de mani\u00e8re totalement transparente (SSO / certificat). Pour cela, elle peut utiliser une base de donn\u00e9es LDAP (Lightweight Directory Access Protocol) et, \u00e9ventuellement, un certificat num\u00e9rique x509.</p> <p>Une fois l'authentification r\u00e9ussie, le login de l'utilisateur est associ\u00e9 \u00e0 la machine \u00e0 partir de laquelle celui-ci s'est identifi\u00e9 (cela est stock\u00e9 dans la table utilisateur de l\\'ASQ) et \u00e0 tous les paquets IP qui en proviennent, et ce pour la dur\u00e9e sp\u00e9cifi\u00e9e par l'utilisateur ou l'administrateur selon la m\u00e9thode utilis\u00e9e.</p> <p>L'objectif est d'accorder aux utilisateurs des droits d'acc\u00e8s sp\u00e9cifiques aux r\u00e9seaux et aux services (portail captif, VPN SSL,VPN IPsec, administration du firewall, etc.).</p> <p>Les \u00e9tapes de configuration sont les suivantes\u00a0:</p> <p></p> <p>1. Les annuaires stockent des informations de mani\u00e8re hi\u00e9rarchis\u00e9e dans une arborescence. La norme LDAP permet l'organisation des donn\u00e9es dans l'annuaire et fournit un protocole d'interrogation de l'annuaire (RFC 4510), la configuration sur un pare-feu consiste \u00e0 \u00e9tablir un lien vers un ou plusieurs annuaires.</p> <p>2. Les utilisateurs sont stock\u00e9s dans un annuaire et d\u00e9crits par des attributs (nom, pr\u00e9nom, identifiant, mot de passe, adresse e-mail, certificat, etc.) utilis\u00e9s par le pare-feu pour l'authentification.</p> <p>3. Les m\u00e9thodes d'authentification utilis\u00e9es permettent au pare-feu de configurer la fa\u00e7on de v\u00e9rifier l'identit\u00e9 des utilisateurs.</p> <p>4. La politique d'authentification permet d'accorder aux utilisateurs des droits d'acc\u00e8s aux r\u00e9seaux et services g\u00e9r\u00e9s par le pare-feu.</p> <p>5. Le portail captif peut avoir plusieurs usages\u00a0: authentifier des utilisateurs pour acc\u00e9der au r\u00e9seau, enr\u00f4ler de nouveaux utilisateurs, demander la cr\u00e9ation d'un certificat, t\u00e9l\u00e9charger le client VPN SSL et sa configuration, faire une demande de parrainage pour acc\u00e9der au r\u00e9seau, etc.</p> <p>6. La politique de s\u00e9curit\u00e9 contient les r\u00e8gles de filtrage n\u00e9cessaires pour que les utilisateurs inconnus soient redirig\u00e9s vers la solution d'authentification retenue (par exemple, via le portail captif).</p> <p>Info</p> <p>En fonction de la m\u00e9thode d'authentification retenue, certaines \u00e9tapes de configuration seront facultatives.</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#liaison-a-un-annuaire","title":"Liaison \u00e0 un annuaire","text":"<p>Les pare-feu supportent quatre types d'annuaire qui peuvent \u00eatre class\u00e9s en deux cat\u00e9gories.</p> <p>Ils peuvent supporter cinq annuaires simultan\u00e9ment : un LDAP interne et  quatre LDAP/AD externes, ou cinq LDAP/AD externes. Ce qui signifie qu'ils peuvent supporter en m\u00eame temps cinq domaines diff\u00e9rents.</p> <p>Un client LDAP int\u00e9gr\u00e9 au pare-feu permet de se connecter \u00e0 n'importe quel type d'annuaire (interne ou externe) en utilisant le protocole LDAP (ou LDAPS pour s\u00e9curiser les connexions avec les annuaires externes).</p> <p>Dans le cas d'un LDAP interne, l'annuaire et les utilisateurs sont automatiquement sauvegard\u00e9s/restaur\u00e9s avec la configuration du pare-feu.</p> <p>Ajout et configuration d'un annuaire</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Configuration des     annuaires</li> </ul> <p></p> <ul> <li>Choisir le type d'annuaire ou Ajouter un annuaire (si un annuaire a     d\u00e9j\u00e0 \u00e9t\u00e9 configur\u00e9)</li> </ul> <p>\u21d2 Un assistant de cr\u00e9ation se lance</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#la-configuration-des-annuaires-externes","title":"La configuration des annuaires externes","text":"<p>Type d'annuaire: (Microsoft Active Directory,LDAP et LDAP de type PosixAccount) est sensiblement identique</p> <p></p> <ul> <li> <p>Renseigner les param\u00e8tres du serveur \u00e0 contacter\u00a0:</p> <ul> <li>Nom du domaine\u00a0: le nom DNS du domaine,</li> <li>Serveur\u00a0: l'objet machine qui porte l\\'adresse IP du serveur qui h\u00e9berge l'annuaire,</li> <li>Port\u00a0: le port d'\u00e9coute de votre serveur LDAP</li> <li>Domaine racine (Base DN)</li> </ul> </li> </ul> <p>Identifiant (user DN) et le mot de passe\u00a0:un compte administrateur permettant au pare-feu de se connecter sur votre serveur LDAP et d'effectuer des lectures/\u00e9critures sur certains champs. Il est pr\u00e9f\u00e9rable de cr\u00e9er un compte sp\u00e9cifique pour le pare-feu et de lui attribuer les droits uniquement sur les champs qui lui sont n\u00e9cessaires.</p> <p>Hach\u00e9 du mot de passe\u00a0: permet de s\u00e9lectionner l'algorithme de hachage qui doit \u00eatre utilis\u00e9 pour enregistrer les mots de passes des utilisateurs, ce qui \u00e9vitera de l'enregistrer en clair.</p> <p>Par la suite, l'assistant propose d'activer le profil d'authentification 0 (internal) sur une interface, dans le cas o\u00f9 le profil n'a pas d\u00e9j\u00e0 \u00e9t\u00e9 activ\u00e9. Si c'est le cas, cette \u00e9tape ne s'affiche pas.</p> <p>Attention</p> <p>L'activation du profil n'est pas obligatoire et pourra \u00eatre r\u00e9alis\u00e9e (ou modifi\u00e9e) ult\u00e9rieurement (menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2 onglet PORTAIL CAPTIF ou onglet PROFILS DU PORTAIL CAPTIF pour modifier les param\u00e9trages).</p> <p></p> <ul> <li>Renseigner ensuite Les param\u00e8tres de l'annuaire externe (voir la     documentation en ligne pour le d\u00e9tail\u00a0:     https://documentation.stormshield.eu/SNS/v4/fr/Content/User_Configuration_Manual_SNS_v4/Directory_configuration/DIRECTORY_CONFIGURATION_LDAP.htm.)</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#configuration-dun-annuaire-interne","title":"Configuration d'un annuaire interne","text":"<p>{width=\"11.658cm\" height=\"4.962cm\"}</p> <ul> <li>Organisation\u00a0: le nom de l'organisation.</li> </ul> <p>Domaine\u00a0: le TLD (Top Level Domain) du domaine (fr, eu, org, com, etc.).</p> <ul> <li> <p>Mot de passe\u00a0: un mot de passe permettant de se connecter \u00e0 l'annuaire LDAP depuis un navigateur LDAP.</p> </li> <li> <p>Hach\u00e9 du mot de passe\u00a0: permet de s\u00e9lectionner l'algorithme de hachage qui doit \u00eatre utilis\u00e9 pour enregistrer les mots de passe des utilisateurs, ce qui \u00e9vitera de l'enregistrer en clair.</p> </li> </ul> <p>Par la suite, l'assistant propose d'activer le profil d'authentification 0 (internal) sur une interface, dans le cas o\u00f9 le profil n'a pas d\u00e9j\u00e0 \u00e9t\u00e9 activ\u00e9. Si c'est le cas, cette option sera d\u00e9sactiv\u00e9e (gris\u00e9e) et un message indique que l'association entre profil d'authentification et interface est d\u00e9j\u00e0 r\u00e9alis\u00e9e.</p> <p>Attention</p> <p>L'activation du profil n'est pas obligatoire et pourra \u00eatre r\u00e9alis\u00e9e (ou modifi\u00e9e) ult\u00e9rieurement (menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2 onglet PORTAIL CAPTIF ou onglet PROFILS DU PORTAIL CAPTIF pour modifier les param\u00e9trages).</p> <p>Dans les options choisies ci-dessous (qui peuvent \u00eatre modifi\u00e9es par la suite), le profil est cr\u00e9\u00e9. Les utilisateurs se connectant via l'interface \u00ab\u00a0in_vlan35_cli\u00a0\u00bb auront acc\u00e8s \u00e0 l'interface du portail captif via l'URL\u00a0: https://(@IP_firewall | FQDN_firewall)/auth</p> <ul> <li>Activer l\\'enr\u00f4lement des utilisateurs via le profil 0 (interne) du portail Web\u00a0: active le service d'enr\u00f4lement sur le profil 0     (interne) permettant aux utilisateurs de remplir un formulaire de     cr\u00e9ation de compte qui sera soumis \u00e0 l'approbation de     l'administrateur.</li> <li>Autoriser l'acc\u00e8s \u00e0 la base LDAP\u00a0: donne la possibilit\u00e9     d'acc\u00e9der \u00e0 l'annuaire LDAP depuis une adresse IP publique via un     navigateur LDAP. Si cet acc\u00e8s n'est pas n\u00e9cessaire, il est     vivement conseill\u00e9 de ne pas activer cette option.</li> </ul> <p></p> <p></p> <ul> <li>Saisir un mot de passe\u00a0: permet de se connecter \u00e0 l'annuaire, il     est possible de le modifier.</li> <li>Activer l'utilisation de l'annuaire utilisateur\u00a0: cette option     permet de d\u00e9marrer le service LDAP.</li> <li>Cliquer sur \u00ab\u00a0Appliquer\u00a0\u00bb</li> </ul> <p>Les deux autres options permettent de\u00a0:</p> <ul> <li>Activer l'acc\u00e8s non chiffr\u00e9 (PLAIN)\u00a0: active l'acc\u00e8s non chiffr\u00e9     \u00e0 l'annuaire,</li> <li>Activer l'acc\u00e8s SSL\u00a0: active l'acc\u00e8s s\u00e9curis\u00e9 \u00e0 l'annuaire, il     faut alors renseigner le champ certificat SSL pr\u00e9sent\u00e9 par le     serveur,</li> </ul> <p>Lorsqu'au moins un annuaire a \u00e9t\u00e9 configur\u00e9, via \u00ab\u00a0Action\u00a0\u00bb il est possible de\u00a0:</p> <ul> <li>supprimer un annuaire,</li> <li>d\u00e9signer un annuaire par d\u00e9faut,</li> <li>v\u00e9rifier la connexion \u00e0 l'annuaire,</li> <li>v\u00e9rifier l'utilisation de l'annuaire,</li> </ul> <p>Le reste du menu liste tous les annuaires ajout\u00e9s, parmi lesquels l'annuaire par d\u00e9faut s'affiche en vert. En cliquant sur un annuaire, ses param\u00e8tres s'affichent \u00e0 droite de la page.</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#gestion-des-utilisateurs","title":"Gestion des utilisateurs","text":"<ul> <li>Se rendre au menu CONFIGURATION\u21d2 UTILISATEURS \u21d2 Utilisateurs\u00a0:</li> </ul> <p>Cr\u00e9ation d'un utilisateur</p> <p>Avec un LDAP interne (ou un LDAP externe accessible en lecture/\u00e9criture), il est possible d'ajouter ou de supprimer des utilisateurs et des groupes depuis le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Utilisateurs.</p> <ul> <li>Cliquer sur \u00ab\u00a0Ajouter un utilisateur\u00a0\u00bb.</li> <li>Saisir les informations de l'utilisateur.</li> <li>Saisir le mot de passe lorsqu'il est demand\u00e9.</li> </ul> <p>\u21d2 L'utilisateur est cr\u00e9\u00e9\u00a0: pour distinguer les annuaires, un suffixe est ajout\u00e9 aux utilisateurs et aux groupes pour indiquer le nom de l'annuaire (et non pas le nom du domaine). Par exemple (user@cub.fr).</p> <p>Attention</p> <p>Lors de l'acc\u00e8s \u00e0 ce menu, la liste des utilisateurs et groupes est toujours vide, c'est un comportement normal. En effet, si vous \u00eates connect\u00e9 \u00e0 un annuaire contenant un grand nombre d'utilisateurs et de groupes, l'affichage sans filtre dans le champ Recherche peut avoir un impact sur les performances de l'interface graphique.Pour changer ce comportement par d\u00e9faut (non conseill\u00e9)\u00a0: Ouvrir le menu des pr\u00e9f\u00e9rences du pare-feu accessible en cliquant sur l'ic\u00f4ne repr\u00e9sentant des outils dans l'en-t\u00eate de l'interface Web, et cocher la case \u00ab\u00a0Afficher les utilisateurs d\u00e8s le d\u00e9marrage du module\u00a0\u00bb.</p> <p></p> <p>Sinon, pour voir les utilisateurs ou les groupes\u00a0:</p> <ul> <li>cliquer sur l'un des filtres (utilisateurs ou groupes)</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#le-portail-captif","title":"Le portail captif","text":"<p>Le portail captif, ou portail d'authentification, est une page web embarqu\u00e9e sur le pare-feu et accessible via une connexion s\u00e9curis\u00e9e (HTTPS) depuis ses adresses IP (il peut \u00eatre activ\u00e9 sur toutes les interfaces du pare-feu).</p> <p>Les utilisateurs peuvent se connecter sur le portail en utilisant leur identifiant/mot de passe d'annuaire. Dans le cas o\u00f9 plusieurs annuaires sont configur\u00e9s au niveau du pare-feu, les utilisateurs peuvent ajouter \u00e0 l'identifiant le nom du domaine auquel ils appartiennent, par exemple, user@cub.fr. Si le nom du domaine n'est pas pr\u00e9cis\u00e9, l'authentification s'effectuera avec la m\u00e9thode ou avec l'annuaire d\u00e9fini par d\u00e9faut au niveau du profil d'authentification.</p> <p>L'URL du portail est\u00a0: https://(@IP_firewall | FQDN_firewall)/auth</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#configuration-du-portail-captif","title":"Configuration du portail captif","text":"<p>Pour activer le portail sur une interface, il suffit d'ajouter une ligne dans cet encadr\u00e9, sur laquelle il faut s\u00e9lectionner une interface et un profil d'authentification. Un seul profil peut \u00eatre s\u00e9lectionn\u00e9 par interface.</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2     onglet PORTAIL CAPTIF</li> <li>Cliquer sur +Ajouter</li> <li>S\u00e9lectionner l'interface, choisir le profil, puis \u00ab\u00a0Appliquer\u00a0\u00bb</li> </ul> <p></p> <p>La seconde partie de la page permet d'ajouter une charte d'utilisation de l'acc\u00e8s r\u00e9seau qui doit \u00eatre accept\u00e9e par l'utilisateur une fois authentifi\u00e9 \u21d2 Condition d'utilisation de l'acc\u00e8s \u00e0 Internet. Elle peut \u00eatre t\u00e9l\u00e9charg\u00e9e en format PDF ou en format HTML. Le bouton R\u00e9initialiser la personnalisation des conditions d'utilisation de l'acc\u00e8s \u00e0 Internet permet de supprimer une charte pr\u00e9alablement t\u00e9l\u00e9charg\u00e9e.</p> <p></p> <p>La configuration avanc\u00e9e permet\u00a0:</p> <ul> <li>d'interrompre les connexions lorsque l'authentification expire,</li> <li>d'importer un fichier de configuration du proxy (.pac),</li> <li>de modifier le port du portail captif</li> <li>de modifier son apparence\u00a0: masquer le logo Stormshield sur le     portail, t\u00e9l\u00e9charger un nouveau logo et modifier la feuille de     style.</li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#configuration-dun-profil-dauthentification","title":"Configuration d'un profil d'authentification","text":"<ul> <li>Se rendre dans le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2     Authentification \u21d2 onglet PROFILS DU PORTAIL CAPTIF.</li> </ul> <p>Il existe 10 profils diff\u00e9rents, les cinq premiers sont pr\u00e9configur\u00e9s :</p> <ul> <li>internal, external\u00a0: Ils poss\u00e8dent la m\u00eame configuration. Le premier     est destin\u00e9 \u00e0 \u00eatre attach\u00e9 aux interfaces internes et le deuxi\u00e8me     aux interfaces externes en utilisant n'importe quelle m\u00e9thode     d'authentification utilisant le portail captif\u00a0;</li> <li>Guest\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification invit\u00e9\u00a0;</li> <li>Voucher\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification des     comptes temporaires\u00a0;</li> <li>Sponsor\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification par     parrainage.</li> </ul> <p>Il faut configurer la m\u00e9thode ou l'annuaire par d\u00e9faut utilis\u00e9 par le profil s\u00e9lectionn\u00e9 dans l'\u00e9tape pr\u00e9c\u00e9dente. Par exemple\u00a0:</p> <p></p> <ul> <li>Activer chaque profil pour consulter la pr\u00e9-configuration (qu'il est possible de modifier).</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#deconnexion-des-utilisateurs","title":"D\u00e9connexion des utilisateurs","text":""},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#deconnexion-depuis-le-navigateur","title":"D\u00e9connexion depuis le navigateur","text":"<ul> <li> <p>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet PROFILS DU PORTAIL CAPTIF (configuration avanc\u00e9e).</p> </li> <li> <p>Cocher la case \u00ab\u00a0Activer la page de d\u00e9connexion\u00a0\u00bb</p> </li> </ul> <p>\u21d2 Un onglet de d\u00e9connexion s'ouvre dans le navigateur de l'utilisateur ayant r\u00e9ussi \u00e0 se connecter. Pour se d\u00e9connecter, l'utilisateur doit simplement cliquer sur le bouton D\u00e9connexion de cet onglet.</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#deconnexion-depuis-le-portail-captif","title":"D\u00e9connexion depuis le portail captif","text":"<p>Pour se d\u00e9connecter, l'utilisateur doit se connecter de nouveau au portail captif, cliquer sur Connexion dans le menu de gauche et ensuite sur le bouton D\u00e9connexion.</p> <p>D\u00e9connexion d'un utilisateur depuis l'interface graphique par l'administrateur</p> <ul> <li>Se rendre au menu Supervision puis Utilisateurs.</li> <li>Cliquer sur l'utilisateur avec le bouton droit, et ensuite sur     D\u00e9connecter l'utilisateur.</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#les-methodes-dauthentification","title":"Les m\u00e9thodes d'authentification","text":"<p>Les firewalls SNS impl\u00e9mentent plusieurs m\u00e9thodes d'authentification qui peuvent \u00eatre class\u00e9es en deux cat\u00e9gories\u00a0:</p> <ul> <li>les m\u00e9thodes explicites via le portail captif\u00a0: l'utilisateur est     redirig\u00e9 vers le portail captif pour saisir un identifiant/mot de     passe. Ces derniers sont r\u00e9cup\u00e9r\u00e9s par le pare-feu pour v\u00e9rifier     l'identit\u00e9 de l'utilisateur en fonction de la m\u00e9thode utilis\u00e9e\u00a0;</li> <li>les m\u00e9thodes implicites ou transparentes\u00a0: l'authentification est     transparente vis-\u00e0-vis de l'utilisateur qui n'a pas besoin de     renseigner son identit\u00e9 explicitement pour acc\u00e9der au r\u00e9seau.</li> </ul> <p></p> <p>Pour ajouter une m\u00e9thode d'authentification utilis\u00e9es par le pare-feu</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet M\u00c9THODES DISPONIBLES.</li> </ul> <p>Chaque m\u00e9thode n\u00e9cessite de renseigner des param\u00e8tres sp\u00e9cifiques. Cependant, suite \u00e0 la configuration d'un annuaire LDAP, la m\u00e9thode d'authentification LDAP est renseign\u00e9e automatiquement.</p>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#la-politique-dauthentification","title":"La politique d'authentification","text":"<p>Puisque les pare-feu SNS supportent plusieurs annuaires et plusieurs m\u00e9thodes d'authentification simultan\u00e9ment, il peut \u00eatre n\u00e9cessaire de d\u00e9finir une politique d'authentification pour indiquer la ou les m\u00e9thodes \u00e0 appliquer en fonction de deux crit\u00e8res\u00a0: l'utilisateur ou le groupe d'utilisateurs, et l'adresse IP source ou l'interface d'entr\u00e9e.</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet POLITIQUE D'AUTHENTIFICATION.</li> </ul> <p>La politique peut \u00eatre constitu\u00e9e de plusieurs r\u00e8gles appliqu\u00e9es en fonction de leur ordre. Plusieurs m\u00e9thodes d'authentification peuvent \u00eatre utilis\u00e9es par une seule r\u00e8gle. Dans ce cas, les m\u00e9thodes sont appliqu\u00e9es suivant l'ordre d'apparition dans la r\u00e8gle. Si une m\u00e9thode permet d'authentifier l'utilisateur, les m\u00e9thodes suivantes ne seront pas test\u00e9es. Par exemple\u00a0:</p> <p></p> <p>Dans la r\u00e8gle 3, tous les utilisateurs du domaine \u00ab\u00a0institute.com\u00a0\u00bb qui se connectent depuis le r\u00e9seau interne doivent, en premier lieu, s'authentifier via la m\u00e9thode Agent SSO. Si l'authentification \u00e9choue, alors on propose \u00e0 l'utilisateur de s\u00e9lectionner son certificat. Enfin, si cette seconde m\u00e9thode n'aboutit pas (pas de certificat pour cet utilisateur par exemple), il est convi\u00e9 \u00e0 renseigner un couple d'identifiant/mot de passe pour une authentification via la m\u00e9thode LDAP.</p> <p>Dans le cas o\u00f9 aucune r\u00e8gle ne correspond aux crit\u00e8res du trafic, la m\u00e9thode d'authentification par d\u00e9faut est appliqu\u00e9e.</p> <p>Lorsqu'elle est utilis\u00e9e dans une r\u00e8gle, la m\u00e9thode Agent SSO est automatiquement la plus prioritaire des m\u00e9thodes parce que cette derni\u00e8re authentifie l'utilisateur sur le pare-feu d\u00e8s son authentification sur le domaine Active Directory.</p> <p>Dans la politique d'authentification, vous pouvez donc cr\u00e9er une politique pour d\u00e9terminer les r\u00e9seaux et les utilisateurs qui utiliseront la m\u00e9thode LDAP, ou la d\u00e9finir comme la m\u00e9thode par d\u00e9faut.</p> <p>Pour cr\u00e9er une politique</p> <ul> <li>Cliquer sur Nouvelle r\u00e8gle \u21d2 R\u00e8gle Standard.</li> </ul> <p></p> <ul> <li>Renseigner les utilisateurs ou les groupes,</li> <li>Renseigner les r\u00e9seaux ou les interfaces sources. Dans le cas de la     cr\u00e9ation d'un premier annuaire, le rattachement du profil     d'authentification 0 (internal) \u00e0 une interface est propos\u00e9 lors de     la cr\u00e9ation de l'annuaire. Sinon le rattachement peut s'effectuer     dans le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2     PORTAIL CAPTIF, en ajoutant une entr\u00e9e dans la liste CORRESPONDANCE     ENTRE PROFIL D'AUTHENTIFICATION ET INTERFACE. Dans l'entr\u00e9e, il faut     s\u00e9lectionner l'interface et le profil. La m\u00e9thode ou l'annuaire par     d\u00e9faut sont renseign\u00e9s automatiquement en fonction de ce qui est     configur\u00e9 sur le profil s\u00e9lectionn\u00e9.</li> <li>Choisir les m\u00e9thodes d'authentification \u00e0 utiliser (kerberos,     Radius, SSL, SPNEGO, Agent SSO, m\u00e9thode par d\u00e9faut et interdire).</li> </ul>"},{"location":"stormshield/fiches/fiche10_utilisateurs_authentification_SNS/#regles-de-filtrage-pour-lauthentification","title":"R\u00e8gles de filtrage pour l'authentification","text":"Rappel du principe du portail captif <p>1. L'utilisateur ouvre un navigateur pour acc\u00e9der \u00e0 un site en HTTP ou HTTPS. 2. La requ\u00eate HTTP est intercept\u00e9e par le firewall qui renvoie l'utilisateur vers le portail d'authentification (https://@IP_firewall/auth). 3. L'utilisateur introduit son identifiant/mot de passe d'annuaire qui sont envoy\u00e9s au firewall via une connexion s\u00e9curis\u00e9e (HTTPS). 4. Le firewall authentifie l'utilisateur au niveau de l'annuaire (LDAP interne/externe ou AD). Dans le cas o\u00f9 l'utilisateur est authentifi\u00e9, le navigateur est renvoy\u00e9 vers le site web demand\u00e9 au d\u00e9part.</p> <p>Le premier point n\u00e9cessite une r\u00e8gle pour permettre \u00e0 un utilisateur non authentifi\u00e9 \u00e0 \u00eatre redirig\u00e9 vers le portail \u21d2 Le pare-feu doit rediriger les requ\u00eates HTTP et HTTPS des utilisateurs non authentifi\u00e9s vers le portail captif.</p> <p></p> <ul> <li>Cliquer sur Nouvelle r\u00e8gle puis r\u00e8gle d'authentification</li> </ul> <p>Un assistant permet de cr\u00e9er une r\u00e8gle par d\u00e9faut qu'il sera possible de modifier\u00a0:</p> <p></p> <p>Ci-dessous la r\u00e8gle modifi\u00e9e pour rediriger tous les flux HTTP et HTTPS provenant des r\u00e9seaux prot\u00e9g\u00e9s vers le portail captif\u00a0:</p> <p></p> <p></p> <p>Le champ Utilisateur permet de sp\u00e9cifier l'utilisateur (ou le groupe) devant \u00eatre authentifi\u00e9 pour que la r\u00e8gle s'applique dont\u00a0:</p> <ul> <li> <p>Any user@any : d\u00e9signe tout utilisateur authentifi\u00e9, quel que soit l\\'annuaire ou la m\u00e9thode d\\'authentification utilis\u00e9s,</p> </li> <li> <p>Any user@guest_users.local.domain : d\u00e9signe tout utilisateur authentifi\u00e9 par la m\u00e9thode invit\u00e9,</p> </li> <li> <p>Any user@voucher_users.local.domain : d\u00e9signe tout utilisateur authentifi\u00e9 par la m\u00e9thode comptes temporaires,</p> </li> <li> <p>Any user@sponsored_users.local.domain : d\u00e9signe tout utilisateur se pr\u00e9sentant via la m\u00e9thode parrainage,</p> </li> <li> <p>Any user@\\&lt;domaine&gt; : d\u00e9signe tout utilisateur authentifi\u00e9 par l'annuaire du domaine,</p> </li> <li> <p>Any user@none : d\u00e9signe tout utilisateur authentifi\u00e9 par une m\u00e9thode n'utilisant pas un annuaire, par exemple : parrainage, compte temporaire, etc.</p> </li> <li> <p>Utilisateurs inconnus : d\u00e9signe tout utilisateur non authentifi\u00e9. Cette valeur est principalement utilis\u00e9e dans une r\u00e8gle d'authentification car dans une telle r\u00e8gle, on ne conna\u00eet pas encore l'utilisateur.</p> </li> </ul> <p>La liste de tous les utilisateurs et groupes pr\u00e9sents dans les annuaires.</p> <p>Avant d'ajouter la r\u00e8gle pr\u00e9c\u00e9dente de redirection vers le portail captif, il faut s'assurer que:</p> <p>les connexions DNS sont autoris\u00e9es pour tous les utilisateurs (authentifi\u00e9s ou non), car sans r\u00e9solution DNS, il n'y aura pas de requ\u00eates HTTP ou HTTPS et par cons\u00e9quent, pas de redirection vers le portail captif. La r\u00e8gle d'activation du proxy SSL doit \u00e9galement \u00eatre plac\u00e9e avant pour pouvoir acc\u00e9der aux sites en HTTPS.</p> <p>Vous pouvez ensuite ajouter des r\u00e8gles sp\u00e9cifiques pour les utilisateurs ou les groupes authentifi\u00e9s (Source &gt; Utilisateur:).</p> <p></p> <p>La connexion via le portail captif avec Firefox\u00a0:</p> <p></p> <p></p> <p>Une fois connect\u00e9e, l'acc\u00e8s \u00e0 Internet est possible.</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/","title":"Fiche 11 -- Infrastructures \u00e0 cl\u00e9s pubiques (PKI)","text":""},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#gestion-des-certificats","title":"Gestion des certificats","text":"<p>Les pare-feu Stormshield int\u00e8grent les fonctions permettant la gestion des certificats.</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#ecran-de-gestion","title":"\u00c9cran de gestion","text":"<ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI</li> </ul> <p>+Ajouter lance des assistants de configuration permettant d'ajouter des \u00e9l\u00e9ments dans les objets\u00a0:</p> <ul> <li>Autorit\u00e9 racine\u00a0: permet de cr\u00e9er une autorit\u00e9 de certification     racine g\u00e9r\u00e9e par le firewall. Cette autorit\u00e9 peut \u00eatre une     sous-autorit\u00e9 d'une PKI externe.</li> <li>Sous-autorit\u00e9\u00a0:permet de cr\u00e9er une autorit\u00e9 de certification     d\u00e9pendant d'une autre CA. L'autorit\u00e9 parente doit \u00eatre g\u00e9r\u00e9e par le     boitier.</li> <li>Identit\u00e9 utilisateur : permet de cr\u00e9er une identit\u00e9     utilisateur d\u00e9pendant d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le     boitier.</li> <li>Identit\u00e9 serveur : permet de cr\u00e9er une identit\u00e9 serveur     d\u00e9pendant d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le boitier.</li> <li>Smartcard\u00a0: permet de cr\u00e9er une identit\u00e9 Smartcard d\u00e9pendant     d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le boitier.</li> <li>Importer un fichier\u00a0: le fichier import\u00e9 peut \u00eatre une identit\u00e9,     un certificat, une CRL.</li> </ul>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#ca-interne-et-externe","title":"CA interne et externe","text":""},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#ca-interne","title":"CA interne","text":"<p>Cette fonctionnalit\u00e9 de gestion d'une infrastructure \u00e0 cl\u00e9s publiques permet de r\u00e9pondre \u00e0 un grand nombre de cas d'usage :</p> <ul> <li> <p>Le pare-feu agit en tant qu'autorit\u00e9 de certification racine (root     CA)\u00a0: le bo\u00eetier SNS permet de d\u00e9finir les cha\u00eenes de confiance     n\u00e9cessaires \u00e0 une authentification par certificat. Des autorit\u00e9s par     d\u00e9faut sont disponibles pour signer les certificats utilis\u00e9s par le     proxy SSL ou livrer les certificats n\u00e9cessaires au fonctionnement du     VPN SSL. Son certificat d'autorit\u00e9 est auto-sign\u00e9.</p> <p>Les fonctions propos\u00e9es par le bo\u00eetier SNS permettent de r\u00e9pondre pleinement au r\u00f4le d'autorit\u00e9 de certification (cr\u00e9ation de certificat de diff\u00e9rentes natures, signature de CSR, r\u00e9vocation de certificat et gestion de CRL).</p> </li> <li> <p>Le pare-feu agit en tant que sous-autorit\u00e9 de certification\u00a0: il     est possible de d\u00e9finir un bo\u00eetier SNS comme \u00e9tant une sous-autorit\u00e9     de certification d'une CA parente (g\u00e9r\u00e9e obligatoirement sur le m\u00eame     bo\u00eetier). Le certificat de la sous-autorit\u00e9 est sign\u00e9 par l'autorit\u00e9     parente (pas n\u00e9cessairement une autorit\u00e9 racine), laquelle est une     autorit\u00e9 interne ou externe. Cela permet d'organiser plus finement     la r\u00e9partition et la distribution des identit\u00e9s, par usages ou par     entit\u00e9s d'une m\u00eame entreprise.</p> </li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#ca-externe","title":"CA externe","text":"<p>Dans le cadre d'usage d'une CA externe, les fonctionnalit\u00e9s propos\u00e9es permettent essentiellement d'importer des certificats et de d\u00e9finir les relations de confiance pour divers usages\u00a0:</p> <ul> <li>Import de certificats d'autorit\u00e9 de certification.</li> <li>Import de certificats d'\u00e9quipements.</li> <li>Import de certificats et de cl\u00e9s priv\u00e9s d'\u00e9quipements (fichiers     \u00ab\u00a0.p12\u00a0\u00bb prot\u00e9g\u00e9s ou pas par mot de passe).</li> </ul> <p>Le firewall agit en tant que PKI en permettant l'import de certificats, voire d'identit\u00e9s (prot\u00e9g\u00e9es par des fichiers de type PKCS#12), \u00e9mis par une CA externe</p> <p>Les certificats import\u00e9s sont accessibles aux modules requ\u00e9rant une authentification par certificats (interface d'administration, VPN SSL, VPN Ipsec, etc.)</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#creation-dune-autorite-de-certification","title":"Cr\u00e9ation d'une autorit\u00e9 de certification","text":"<ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI </li> <li>Cliquer sur Ajouter puis s\u00e9lectionner     Autorit\u00e9 racine.</li> <li>Renseigner un CN (obligatoire)\u00a0: il s\\'agit d\\'un nom permettant     d'identifier votre autorit\u00e9 racine, dans la limite de 64 caract\u00e8res.     Ce nom peut faire r\u00e9f\u00e9rence \u00e0 une organisation, un utilisateur, un     serveur, une machine, etc.</li> <li>Renseigner un Identifiant (facultatif)\u00a0: vous pouvez ici     indiquer un raccourci de votre CN, utile pour vos lignes de     commande.</li> <li> <p>renseigner les attributs de l\\'autorit\u00e9. Ces informations seront     pr\u00e9sentes dans le certificat de l\\'autorit\u00e9 ainsi que dans les     certificats qu\\'elle \u00e9mettra\u00a0:</p> <ul> <li>Organisation (O)\u00a0: nom de votre soci\u00e9t\u00e9.</li> <li>Unit\u00e9 d'organisation (OU)\u00a0: \\\"branche\\\" de votre soci\u00e9t\u00e9.</li> <li>Lieu (L) : ville dans laquelle est situ\u00e9e votre soci\u00e9t\u00e9</li> <li>\u00c9tat ou province (ST) : d\u00e9partement g\u00e9ographique de votre     soci\u00e9t\u00e9.</li> <li>Pays (C)\u00a0: pays dans laquelle est situ\u00e9e votre soci\u00e9t\u00e9</li> </ul> </li> <li> <p>Cliquer sur Suivant.</p> </li> <li>Saisir le mot de passe destin\u00e9 \u00e0 prot\u00e9ger l\\'autorit\u00e9 racine et     confirmez-le. Une jauge indique le degr\u00e9 de robustesse de votre mot     de passe. Il est recommand\u00e9 de combiner les lettres minuscules,     majuscules, les chiffres et les caract\u00e8res sp\u00e9ciaux.</li> <li>Renseigner votre E-mail (facultatif) afin de recevoir un message     vous confirmant la cr\u00e9ation de votre autorit\u00e9.</li> <li> <p>Modifier \u00e9ventuellement des \u00e9l\u00e9ments du certificat\u00a0:</p> </li> <li> <p>la valeur de la dur\u00e9e de validit\u00e9 (jours) conseill\u00e9e des certificats     est de 365 jours (propos\u00e9e par d\u00e9faut). Ce champ correspond au     nombre de jours durant lesquels votre certificat d\\'autorit\u00e9 et par     cons\u00e9quent votre PKI seront valides. Cette date influe sur tous les     aspects de votre PKI. En effet, une fois ce certificat expir\u00e9, tous     les certificats utilisateurs le seront \u00e9galement. Cette valeur qui     ne doit pas exc\u00e9der 3650 jours ne sera pas modifiable par la     suite.</p> </li> <li>Vous pouvez aussi modifier la Taille de cl\u00e9 (en bits) du certificat.     Bien que les cl\u00e9s de grande taille soient plus efficaces, il est     d\u00e9conseill\u00e9 d'utiliser celles-ci avec les \u00e9quipements d'entr\u00e9e de     gamme, pour des raisons de temps de g\u00e9n\u00e9ration.</li> </ul> <p></p> <ul> <li>Cliquez sur Suivant puis encore sur Suivant.</li> </ul> <p>Un r\u00e9sum\u00e9 des informations saisies vous est pr\u00e9sent\u00e9\u00a0:</p> <p></p> <ul> <li>Cliquer sur Terminer.</li> </ul> <p>R\u00e9sultat</p> <p></p> <p>L'autorit\u00e9 est automatiquement ajout\u00e9e \u00e0 l'arborescence des autorit\u00e9s, identit\u00e9s et certificats d\u00e9finis sur le firewall.</p> <p>Un clic sur l'autorit\u00e9 affiche ses informations d\u00e9taill\u00e9es dans la partie droite de l'\u00e9cran.</p> <ul> <li> <p>D\u00e9finir \u00e9ventuellement par d\u00e9faut l'autorit\u00e9 de certification</p> <p></p> </li> </ul>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#creation-dune-identite-serveur","title":"Cr\u00e9ation d'une identit\u00e9 serveur","text":"<p>Voir \u00ab\u00a0fiche 12 -- Le VPN\u00a0\u00bb</p> <p></p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#difference-entre-les-certificats-pem-et-der","title":"Diff\u00e9rence entre les certificats PEM et DER","text":""},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#certificat-pem-privacy-enhanced-mail","title":"Certificat PEM (Privacy Enhanced Mail)","text":"<ul> <li>Encodage : Le format PEM utilise un encodage Base64.</li> <li>Structure : Le contenu est encadr\u00e9 par des balises :</li> </ul> <pre><code> -----BEGIN CERTIFICATE-----\n (contenu encod\u00e9 en Base64)\n -----END CERTIFICATE-----\n</code></pre> <ul> <li>Utilisation : Principalement utilis\u00e9 pour les certificats SSL/TLS sur les serveurs web, ainsi que pour stocker des cl\u00e9s priv\u00e9es et des certificats interm\u00e9diaires.</li> <li>Extension de fichier : Les fichiers PEM ont souvent l'une des extensions suivantes : .pem, .crt, .cer, ou .key.</li> <li>Lisibilit\u00e9 : Il est lisible en texte brut et peut \u00eatre ouvert avec n'importe quel \u00e9diteur de texte.</li> </ul>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#certificat-der-distinguished-encoding-rules","title":"Certificat DER (Distinguished Encoding Rules)","text":"<ul> <li>Encodage : Le format DER est binaire (non encod\u00e9 en Base64).</li> <li>Structure : Pas de balises, le fichier est stock\u00e9 dans un format binaire pur.</li> <li>Utilisation : Couramment utilis\u00e9 dans des environnements o\u00f9 l'encodage Base64 n'est pas n\u00e9cessaire, comme les applications Java.</li> <li>Extension de fichier : Les fichiers DER ont g\u00e9n\u00e9ralement l'extension .der ou .cer.</li> <li>Lisibilit\u00e9 : Non lisible en texte brut. Il ne peut pas \u00eatre ouvert directement avec un \u00e9diteur de texte classique.</li> </ul>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#creation-et-gestion-dune-identite-utilisateur","title":"Cr\u00e9ation et gestion d'une identit\u00e9 utilisateur","text":"<p>Premi\u00e8re m\u00e9thode \u00e0 partir d'un utilisateur cr\u00e9\u00e9 dans l'annuaire LDAP interne du firewall</p> <p>il est possible de g\u00e9n\u00e9rer une identit\u00e9 utilisateur directement depuis l'annuaire LDAP interne du firewall. Dans ce cas, le choix de l'autorit\u00e9 signataire se porte automatiquement sur la CA d\u00e9sign\u00e9e par d\u00e9faut.</p> <ul> <li>Se rendre au menu CONFIGURATION / UTILISATEURS / Utilisateurs</li> <li>S\u00e9lectionner l'utilisateur puis cliquer sur CERTIFICAT puis     Cr\u00e9er l'identit\u00e9</li> </ul> <p></p> <p></p> <ul> <li>Cliquer sur \u00ab\u00a0Cr\u00e9er l'identit\u00e9\u00a0\u00bb \u21d2 Le certificat de l'utilisateur     s'affiche</li> </ul> <p></p> <p>Il est \u00e9galement visible via le menu OBJETS / CERTIFICATS et PKI</p> <p></p> <p>Deuxi\u00e8me m\u00e9thode</p> <ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI</li> <li>Cliquer sur +Ajouter puis Identit\u00e9 Utilisateur.</li> <li>Renseigner\u00a0:<ol> <li>un CN (obligatoire)\u00a0: nom permettant d'identifier l\\'utilisateur     dans la limite de 64 caract\u00e8res.</li> <li>un Identifiant (facultatif)\u00a0: vous pouvez ici indiquer un raccourci     de votre CN, utile pour vos lignes de commande (exemple\u00a0: si le CN     est un couple Pr\u00e9nom+Nom, l\\'identifiant peut correspondre aux     initiales du CN).</li> <li>l'adresse e-mail (obligatoire) de l\\'utilisateur pour lequel vous     cr\u00e9ez une identit\u00e9.</li> </ol> </li> <li>Cliquer sur Suivant.</li> <li>S\u00e9lectionner l\\'Autorit\u00e9 parente destin\u00e9e \u00e0 signer le certificat de     l\\'identit\u00e9.</li> <li>Renseigner le Mot de passe de l\\'autorit\u00e9 parente.</li> </ul> <p>Info</p> <p>Les attributs de l\\'autorit\u00e9 sont automatiquement ajout\u00e9s. Ils seront pr\u00e9sents dans le certificat utilisateur.</p> <ul> <li>Cliquer sur Suivant.</li> </ul> <p>Info</p> <p>Lorsque le firewall dispose d'un TPM et que celui-ci a \u00e9t\u00e9 initialis\u00e9, cocher la case Prot\u00e9ger cette identit\u00e9 \u00e0 l'aide du TPM pour enregistrer cette identit\u00e9 sur le TPM.</p> TPM <p>Le TPM (Trusted Platform Module) est un composant mat\u00e9riel de s\u00e9curit\u00e9 qui permet de stocker et prot\u00e9ger les cl\u00e9s cryptographiques ainsi que d'autres donn\u00e9es sensibles de mani\u00e8re s\u00e9curis\u00e9e. Le TPM est con\u00e7u pour renforcer la s\u00e9curit\u00e9 des syst\u00e8mes en fournissant des fonctionnalit\u00e9s comme l'authentification s\u00e9curis\u00e9e et le chiffrement des donn\u00e9es. Il est obligatoire pour Windows 11 d\u00e9sormais en version 2.0 (Puce TPM)</p> <ul> <li>Modifier \u00e9ventuellement des \u00e9l\u00e9ments du certificat\u00a0: la valeur de la     dur\u00e9e de validit\u00e9 (jours) conseill\u00e9e des certificats est de 365     jours (propos\u00e9e par d\u00e9faut). Vous pouvez aussi modifier la Taille de     cl\u00e9 (en bits) du certificat. Bien que les cl\u00e9s de grande taille     soient plus efficaces, il est d\u00e9conseill\u00e9 d'utiliser celles-ci avec     les \u00e9quipements d'entr\u00e9e de gamme, pour des raisons de temps de     g\u00e9n\u00e9ration.</li> </ul> <p>Attention</p> <p>Si l\\'autorit\u00e9 utilis\u00e9e pour g\u00e9n\u00e9rer le certificat est l'autorit\u00e9 par d\u00e9faut du firewall ET si un utilisateur d\u00e9clar\u00e9 dans l'annuaire LDAP r\u00e9f\u00e9rence la m\u00eame adresse e-mail que celle pr\u00e9cis\u00e9e \u00e0 l'\u00e9tape 3, vous pouvez associer automatiquement cette identit\u00e9 \u00e0 l'utilisateur correspondant\u00a0:</p> <ul> <li>Cocher la case Publier cette identit\u00e9 dans l'annuaire LDAP,</li> <li>Saisissez deux fois un mot de passe destin\u00e9 \u00e0 prot\u00e9ger le conteneur     PKCS#12 de l'identit\u00e9.</li> <li>Cliquer sur Suivant \u21d2 Un r\u00e9sum\u00e9 des informations saisies vous est     pr\u00e9sent\u00e9.</li> <li>Cliquer sur Terminer.</li> </ul> <p>Info</p> <p>L'identit\u00e9 est automatiquement ajout\u00e9e \u00e0 l'arborescence des autorit\u00e9s, identit\u00e9s et certificats d\u00e9finis sur le firewall, sous son autorit\u00e9 parente.</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#gestion-des-identites-et-certificats","title":"Gestion des identit\u00e9s et certificats","text":"<p>Menu T\u00e9l\u00e9charger</p> <p>Certificat : le format d'export contient des donn\u00e9es en base64 (.pem) ou des donn\u00e9es binaires (.der). Le fichier export\u00e9 contient le certificat du porteur mais \u00e9galement les certificats des autorit\u00e9s pr\u00e9sentes dans la cha\u00eene de confiance de ce certificat.</p> <p>Identit\u00e9 : l'identit\u00e9, puisqu'elle contient une cl\u00e9 priv\u00e9e, est sensible et son export doit \u00eatre prot\u00e9g\u00e9 par un mot de passe, lequel permet de chiffrer la cl\u00e9 priv\u00e9e qu'il contient. L'identit\u00e9 est pour rappel constitu\u00e9e de la cl\u00e9 priv\u00e9e du porteur, de son certificat (qui contient sa cl\u00e9 publique), et des certificats de la cha\u00eene de confiance. Le fichier d'export est un container .pem ou un container PKCS#12 (ou .p12).</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#document-1-rappels-et-vocabulaire","title":"Document 1\u00a0: Rappels et vocabulaire","text":"Infrastructure \u00e0 cl\u00e9s publiques ou PKI (Public Key Infrastructure) <p>Infrastructure qui h\u00e9berge les informations publiques (annuaire, CRL) et qui permet d'acc\u00e9der aux certificats de l'organisation, d'effectuer un renouvellement de certificat, ou de le r\u00e9voquer.</p> <p>Un certificat peut contenir du texte (extensions .pem, .crt) ou des donn\u00e9es binaires directement (extensions .cer, .der).</p> <p>La validit\u00e9 du certificat est remise en cause\u00a0:</p> <ul> <li>\u00e0 l'expiration de ce dernier (limitation dans le temps)\u00a0;</li> <li>\u00e0 l'expiration de la CA\u00a0;</li> <li>en cas de perte ou de vol de la cl\u00e9 priv\u00e9e du propri\u00e9taire\u00a0;</li> <li>en cas de d\u00e9part du propri\u00e9taire de la soci\u00e9t\u00e9.</li> </ul> <p>Liste des certificats r\u00e9voqu\u00e9s</p> <p>La CRL est un fichier sign\u00e9 par la CA, qui liste les num\u00e9ros de s\u00e9rie des certificats r\u00e9voqu\u00e9s avant leur expiration. Cette liste doit \u00eatre accessible publiquement pour permettre aux utilisateurs de s'assurer que les identit\u00e9s qui leur sont pr\u00e9sent\u00e9es sont encore valides.</p> <p></p> <p>Stockage des identit\u00e9s num\u00e9riques par la CA</p> <p>Lorsque la CA g\u00e9n\u00e8re les bi-cl\u00e9s, il est simple de contr\u00f4ler la robustesse des cl\u00e9s et de les sauvegarder, mais cela n\u00e9cessite la mise en place d'une proc\u00e9dure s\u00e9curis\u00e9e pour d\u00e9livrer son identit\u00e9 \u00e0 un utilisateur final. Il existe pour cela un container prot\u00e9g\u00e9 standardis\u00e9 nomm\u00e9 PKCS#12 qui contient traditionnellement : [cl\u00e9 priv\u00e9e du porteur + certificat du porteur (contenant sa cl\u00e9 publique) + certificat de la CA signataire].</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#document-2-fonctionnalites-de-la-pki-de-stormshield","title":"Document 2\u00a0: Fonctionnalit\u00e9s de la PKI de Stormshield","text":""},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#authentification-dutilisateurs","title":"Authentification d'utilisateurs","text":"<p>1. L'utilisateur mobile, ou l'administrateur de l'interface web, souhaitant s'authentifier aupr\u00e8s du firewall pr\u00e9sente son certificat utilisateur, soit par son navigateur web, soit par son client VPN IPsec,</p> <p>2. Le firewall v\u00e9rifie la validit\u00e9 du certificat et contr\u00f4le l'identit\u00e9 de l'utilisateur sur le serveur LDAP,</p> <p>3. Les politiques d'acc\u00e8s attach\u00e9es \u00e0 cet utilisateur peuvent alors lui \u00eatre appliqu\u00e9es, pour permettre l'acc\u00e8s aux ressources r\u00e9seau internes.</p>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#authentification-de-serveurs-et-ou-de-clients","title":"Authentification de serveurs (et / ou de clients)","text":"<ol> <li> <p>Le serveur, lors de l'initialisation d'une session, pr\u00e9sente son certificat serveur au client, lequel v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>\u00c9ventuellement, le client pr\u00e9sente son certificat client au serveur, lequel v\u00e9rifie sa validit\u00e9. Lorsque cette \u00e9tape est pr\u00e9sente, il s'agit d'une session avec authentification mutuelle (c'est le cas par exemple d'une session TCP/TLS entre le firewall client et le serveur Syslog Stormshield Visibility Center),</p> </li> <li> <p>Apr\u00e8s l'authentification, le client et le serveur n\u00e9gocient une cl\u00e9 de session.</p> </li> </ol>"},{"location":"stormshield/fiches/fiche11_infrastructure_cles_publiques_SNS/#authentification-de-passerelles-ipsec","title":"Authentification de passerelles IPSec","text":"<ol> <li> <p>Lors de la phase d'\u00e9tablissement du tunnel, le firewall qui initie le tunnel (Initiator) pr\u00e9sente son certificat \u00e0 la passerelle distante, laquelle v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>Le firewall qui r\u00e9pond (Responder) pr\u00e9sente son certificat \u00e0 la passerelle distante, laquelle v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>Outre les v\u00e9rifications effectu\u00e9es sur la validit\u00e9 des certificats pr\u00e9sent\u00e9s (int\u00e9grit\u00e9, signature num\u00e9rique, p\u00e9riode de validit\u00e9, etc.), le certificat de l'autorit\u00e9 de certification ayant sign\u00e9 le certificat de la passerelle distante doit appartenir au groupe de confiance de CA, 'est-\u00e0-dire aux autorit\u00e9s de certification accept\u00e9es dans la politique VPN Ipsec,</p> </li> <li> <p>La v\u00e9rification de l'identit\u00e9 de la passerelle distante permet de garantir que le tunnel est mont\u00e9 avec la passerelle identifi\u00e9e par le certificat, ce point optionnel ne peut \u00eatre d\u00e9fini qu'en CLI.</p> </li> </ol>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/","title":"Fiche 12 -- VPN pour utilisateurs nomades","text":""},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#le-vpn-ssl","title":"Le VPN SSL","text":"<p>Les pare-feux Stormshield int\u00e8grent deux types de VPN SSL qui peuvent \u00eatre utilis\u00e9s simultan\u00e9ment\u00a0:</p> <ul> <li>VPN SSL portail qui permet l'acc\u00e8s aux serveurs Web HTTP et serveurs     applicatifs via le portail captif apr\u00e8s authentification.</li> <li>VPN SSL (complet) qui permet l'acc\u00e8s au r\u00e9seau interne d'une mani\u00e8re     transparente.</li> </ul> <p>La fiche ne concerne que le VPN SSL en mode complet.</p>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#concepts-et-generalites","title":"Concepts et g\u00e9n\u00e9ralit\u00e9s","text":"<p>Le VPN SSL permet \u00e0 des utilisateurs distants d'acc\u00e9der de mani\u00e8re s\u00e9curis\u00e9e aux ressources internes d'une entreprise. Les communications entre l'utilisateur distant et le pare-feu sont encapsul\u00e9es et prot\u00e9g\u00e9es via un tunnel TLS chiffr\u00e9. L'\u00e9tablissement de ce tunnel est bas\u00e9 sur la pr\u00e9sentation de certificats serveur et client sign\u00e9s par une autorit\u00e9 de confiance (CA). Cette solution garantit donc authentification, confidentialit\u00e9, int\u00e9grit\u00e9 et non-r\u00e9pudiation.</p> <p>Au niveau du pare-feu, les tunnels VPN SSL sont g\u00e9r\u00e9s par le serveur OpenVPN (logiciel libre) qui est int\u00e9gr\u00e9 dans le firmware en tant que nouveau service. OpenVPN peut fonctionner sur n'importe quel port TCP (par d\u00e9faut 443) et/ou UDP (par d\u00e9faut 1194), \u00e0 l'exception de quelques-uns, qui sont utilis\u00e9s pour les processus internes du pare-feu.</p> <p>Le fonctionnement sur le port TCP 443 offre un acc\u00e8s ais\u00e9 depuis les r\u00e9seaux avec filtrage d'acc\u00e8s \u00e0 Internet (h\u00f4tels, wifi public, connexion 3G, etc.).</p> <p>En ce qui concerne les utilisateurs nomades, le tunnel est g\u00e9r\u00e9 par le client VPN SSL (Stormshield ou openVPN standard), qui doit \u00eatre install\u00e9 et configur\u00e9 sur les machines. Ce client est installable sur tout type de terminal (Windows, IOS, Android, etc.). Les diff\u00e9rents \u00e9l\u00e9ments de configuration (certificats, fichier de conf, etc.) sont r\u00e9cup\u00e9r\u00e9s sur le portail captif. Une fois le tunnel mis en \u0153uvre, l\\'h\u00f4te distant r\u00e9cup\u00e8re une adresse IP fournie par le serveur VPN SSL. Elle sera consid\u00e9r\u00e9e comme faisant partie des r\u00e9seaux internes (prot\u00e9g\u00e9s) du pare-feu et l'utilisateur sera vu comme authentifi\u00e9.</p> <p>La mise en \u0153uvre du tunnel VPN SSL s'effectue en trois \u00e9tapes principales\u00a0:</p> <p></p> <ol> <li> <p>Le client VPN SSL authentifie l'utilisateur via le portail captif. Durant cette \u00e9tape, le pare-feu v\u00e9rifie si l'utilisateur authentifi\u00e9 poss\u00e8de les droits lui permettant d'ouvrir un tunnel VPN SSL.</p> </li> <li> <p>Si l'authentification r\u00e9ussit, le client envoie une requ\u00eate pour r\u00e9cup\u00e9rer les fichiers de configuration renvoy\u00e9s par le pare-feu dans un dossier compress\u00e9 \u00ab\u00a0openvpn_client.zip\u00a0\u00bb. Le dossier contient les fichiers suivants :</p> <ul> <li>Le certificat de l'autorit\u00e9 de certification (CA.cert.pem),</li> <li>Le certificat du client et sa cl\u00e9 priv\u00e9e (openvpnclient.cert.pem et     openvpnclient.pkey.pem),</li> <li>La configuration du client OpenVPN.</li> </ul> </li> <li> <p>Le client lance le processus de mise en \u0153uvre du tunnel TLS avec authentification par certificat \u00e0 l\\'aide des certificats r\u00e9cup\u00e9r\u00e9s lors de l'\u00e9tape pr\u00e9c\u00e9dente. Avant la mise en \u0153uvre du tunnel, le pare-feu v\u00e9rifie que le nombre maximal d'utilisateurs n'est pas encore atteint et qu'un sous-r\u00e9seau peut \u00eatre r\u00e9serv\u00e9 pour ce nouveau client. Si toutes les conditions sont v\u00e9rifi\u00e9es, le tunnel est mis en \u0153uvre et l'utilisateur est consid\u00e9r\u00e9 comme authentifi\u00e9.</p> </li> </ol> <p>Info</p> <p>Si le serveur VPN SSL est accessible via un port UDP ou TCP, le client VPN SSL tente d'abord de mettre en \u0153uvre le tunnel avec le protocole UDP et en cas d'\u00e9chec, il effectue automatiquement une nouvelle tentative avec le protocole TCP.</p>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#configurer-le-service-vpn-ssl","title":"Configurer le service VPN SSL","text":"<p>Pr\u00e9alables</p> <p>La premi\u00e8re \u00e9tape de mise en \u0153uvre d'un tunnel VPN SSL est l'authentification de l'utilisateur via le portail captif, ce qui signifie :</p> <ul> <li>qu'un annuaire externe ou interne doit \u00eatre configur\u00e9 au niveau du     pare-feu (voir fiche 10)\u00a0;</li> </ul> <p></p> <ul> <li>qu'une m\u00e9thode d'authentification doit \u00eatre configur\u00e9e\u00a0:</li> </ul> <p></p> <ul> <li>qu'un profil du portail captif doit \u00eatre rattach\u00e9 \u00e0 l'interface     depuis laquelle les utilisateurs se connectent\u00a0:</li> </ul> <p></p> <p>Les m\u00e9thodes d'authentification possibles pour le service VPN SSL sont les m\u00e9thodes explicites qui n\u00e9cessitent un couple identifiant/mot de passe, en l'occurrence LDAP (interne, externe ou Microsoft Active Directory), Kerberos et Radius.</p> <p>Des certificats seront utilis\u00e9s pour l'authentification entre le client et le serveur VPN SSL. Pour cela, une autorit\u00e9 de certification racine (CA) existe dans la configuration usine de tous les pare-feux Stormshield Network. Cette CA est nomm\u00e9e sslvpn-full-default-authority, et elle contient un certificat serveur (qui identifie le serveur VPN SSL), et un certificat client (qui identifie tous les clients\u00a0: chacun d'entre eux sera ensuite diff\u00e9renci\u00e9 par un couple login/mot de passe).</p> <p></p> <p>Configuration du serveur SSL</p> <ul> <li>Cliquer sur le module Configuration &gt; VPN &gt; VPN SSL et     activer le Activer le VPN SSL.</li> </ul> <p></p> <p>Param\u00e8tres r\u00e9seaux</p> <ul> <li> <p>Indiquer l'adresse IP ou le FQDN pour lequel le pare-feu Stormshield     Network sera joignable pour \u00e9tablir les tunnels VPN SSL. Ce doit     \u00eatre une adresse IP publique (accessible sur Internet) ou une     adresse IP priv\u00e9e accessible via une redirection.</p> </li> <li> <p>Dans le champ R\u00e9seaux ou machines accessibles, s\u00e9lectionner ou     cr\u00e9er l'objet repr\u00e9sentant les r\u00e9seaux et/ou machines qui seront     joignables au travers du tunnel SSL. Cet objet peut \u00eatre un r\u00e9seau,     une machine ou un groupe incluant des r\u00e9seaux et / ou des machines.</p> </li> </ul> <p>Info</p> <p>Il sera n\u00e9cessaire de d\u00e9finir les routes n\u00e9cessaires pour joindre l'ensemble des ressources et d'affiner les r\u00e8gles de filtrage.</p> <ul> <li> <p>Param\u00e8tres DNS envoy\u00e9s au client</p> </li> <li> <p>Indiquer le suffixe DNS qui sera utilis\u00e9 par les clients pour r\u00e9aliser leurs r\u00e9solutions de noms d'h\u00f4tes.</p> </li> <li> <p>Pr\u00e9ciser les serveurs DNS primaire et secondaire \u00e0 lui attribuer.</p> </li> </ul> <p>Important</p> <p>Les r\u00e9seaux assign\u00e9s aux clients UDP et TCP doivent \u00eatre diff\u00e9rents. Choisir des r\u00e9seaux enti\u00e8rement d\u00e9di\u00e9s aux clients VPN SSL et n'appartenant pas aux r\u00e9seaux internes existants ou d\u00e9clar\u00e9s par une route statique. En effet, l'interface utilis\u00e9e pour le VPN SSL \u00e9tant prot\u00e9g\u00e9e, le pare-feu d\u00e9tecterait alors une tentative d'usurpation d'adresse IP (spoofing) et bloquerait les flux correspondants.</p> <p>Astuce</p> <p>Afin d'\u00e9viter des conflits de routage sur les postes clients lors de la connexion au VPN, choisir plut\u00f4t, pour vos clients VPN, des sous-r\u00e9seaux peu commun\u00e9ment utilis\u00e9s (exemple\u00a0: 10.60.77.0/24, etc.). En effet, de nombreux r\u00e9seaux d'acc\u00e8s internet filtr\u00e9s (wifi public, h\u00f4tels, etc) ou r\u00e9seaux locaux priv\u00e9s utilisent les premi\u00e8res plages d'adresses r\u00e9serv\u00e9es \u00e0 ces usages (exemple\u00a0: 10.0.0.0/24, 192.168.0.0/24).</p> <p>Le nombre maximum de tunnels simultan\u00e9s est automatiquement calcul\u00e9 et affich\u00e9. Par exemple, pour une plage en /24, seules 63 adresses sont disponibles. Cela correspond au minimum des deux valeurs suivantes\u00a0:</p> <ol> <li> <ul> <li>Le quart du nombre d'adresses IP, moins une, incluses dans le         r\u00e9seau client choisi. Un tunnel SSL utilise en effet 4 adresses         IP,</li> <li>Le nombre maximal de tunnels autoris\u00e9s selon le mod\u00e8le de     pare-feu utilis\u00e9.</li> </ul> </li> </ol> <p></p> <ul> <li>S\u00e9lectionner l'objet repr\u00e9sentant l'adresse IP de L'UTM pour     permettre un acc\u00e8s via le port UDP.</li> </ul> <p>Il vous est aussi possible de personnaliser le laps de temps (en secondes) au terme duquel les cl\u00e9s utilis\u00e9es par les algorithmes de chiffrement seront ren\u00e9goci\u00e9es (\u00e9tapes 1 et 2 de l'\u00e9tablissement de tunnel). La valeur par d\u00e9faut est de 4 heures (14400 secondes).</p> <ul> <li>Scripts \u00e0 ex\u00e9cuter sur le client</li> </ul> <p>Vous pouvez s\u00e9lectionner des scripts que Stormshield Network SSL VPN Client ex\u00e9cutera lors de la connexion et/ou d\u00e9connexion au pare-feu (uniquement sur Windows). Il est possible, par exemple, de connecter/d\u00e9connecter automatiquement un lecteur r\u00e9seau Windows par cette m\u00e9thode. Un exemple de script est pr\u00e9sent\u00e9 dans la section Pour aller plus loin.</p> <p></p> <ul> <li>Certificats utilis\u00e9s</li> </ul> <p></p> <p>Les certificats que doivent pr\u00e9senter le service VPN SSL du pare-feu et le client pour \u00e9tablir un tunnel sont cr\u00e9\u00e9s par d\u00e9faut.</p> <p>Si vous choisissez de cr\u00e9er votre propre CA, vous devez utiliser deux certificats, et leur cl\u00e9 priv\u00e9e respective, sign\u00e9s par celle-ci. S'il ne s'agit pas d'une autorit\u00e9 racine, les deux certificats doivent \u00eatre issus de la m\u00eame sous-autorit\u00e9.</p> <p>Configuration des droits d'acc\u00e8s au VPN SSL</p> <ul> <li>Se rendre au menu Configuration &gt; Utilisateurs &gt; Droits     d\\'acc\u00e8s, l'onglet Acc\u00e8s par d\u00e9faut permet d'autoriser ou     d'interdire l'utilisation du VPN SSL \u00e0 l'ensemble des utilisateurs     sans aucune distinction.</li> </ul> <p></p> <p>Pour autoriser des utilisateurs sp\u00e9cifiques (recommand\u00e9 par Stormshield), il faut laisser \u00ab\u00a0Interdire\u00a0\u00bb ici puis\u00a0:</p> <ul> <li>Cliquer sur l'onglet \u00ab\u00a0Acc\u00e8s d\u00e9taill\u00e9\u00a0\u00bb et cliquer sur Ajouter     afin de cr\u00e9er une r\u00e8gle d'acc\u00e8s personnalis\u00e9e.</li> <li>Activer la r\u00e8gle (colonne Etat), s\u00e9lectionner les utilisateurs ou     le groupe d'utilisateurs autoris\u00e9s (colonne Utilisateur -- groupe     d'utilisateurs) et choisir l'action Autoriser dans la colonne     VPN SSL.</li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#methode-dauthentification","title":"M\u00e9thode d'authentification","text":"<p>D\u00e9finition des r\u00e8gles de filtrage pour autoriser / interdire les flux entre les clients VPN SSL et les ressources internes</p> <ul> <li> <p>Ajouter les r\u00e8gles n\u00e9cessaires de filtrage au pare-feu comme\u00a0:</p> </li> <li> <p>celle autorisant n'importe quelle adresse IP sur Internet \u00e0 se     connecter sur le service VPN (1194/UDP ou 443/TCP) du pare-feu sur     son interface externe\u00a0;</p> </li> </ul> <p></p> <ul> <li>l'initiation de connexions \u00e0 partir des clients VPN SSL et \u00e0     destination des serveurs Web internes</li> <li>permettre aux clients vpn d'acc\u00e9der \u00e0 Internet\u00a0;</li> <li> <p>etc.</p> </li> <li> <p>Ajouter ou modifier si besoin la r\u00e8gle NAT permettant aux clients     d'utiliser le VPN SSL pour acc\u00e9der \u00e0 internet.</p> </li> </ul> <p>Info</p> <p>**Les tunnels VPN SSL sont compatibles avec les fonctions avanc\u00e9es de filtrage du pare-feu Stormshield Network. Les r\u00e8gles de filtrage peuvent donc faire appel aux profils d'inspection, proxies applicatifs, contr\u00f4le antiviral, etc.</p> <p>Info</p> <p>Pour permettre aux clients VPN SSL d'acc\u00e9der au portail d'authentification sur les interfaces associ\u00e9es aux profils d'authentification du pare-feu, la r\u00e8gle de filtrage implicite nomm\u00e9e Autoriser l'acc\u00e8s au portail d'authentification et au VPN SSL pour les interfaces associ\u00e9es aux profils d'authentification (Authd) doit \u00eatre activ\u00e9e.</p> <p>Si tel n'est pas le cas, il est imp\u00e9ratif d'ajouter des r\u00e8gles de filtrage explicites dans la politique active autorisant les flux \u00e0 destination de l'interface publique sur le port d'\u00e9coute du service.</p>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#installation-et-configuration-du-client-vpn-ssl","title":"Installation et configuration du client VPN SSL","text":"<p>Il est possible de configurer un client VPN sur n'importe quel syst\u00e8me d'exploitation. Il ne sera d\u00e9velopp\u00e9 ci-apr\u00e8s que les proc\u00e9dures sur Windows et Linux.</p> <p>Pour aller plus loin au niveau des d\u00e9tails et de l'installation du client sur d'autres syst\u00e8mes\u00a0: https://documentation.stormshield.eu/SNS/v4/fr/Content/SSL_VPN_tunnels/Installation_and_configuration_of_the_client.htm.</p> <p>Sur Windows, il est possible d'utiliser le client VPN de Stormshield. Ce client peut \u00eatre t\u00e9l\u00e9charg\u00e9 sur l'espace priv\u00e9 https://mystormshield.eu et sur le portail captif du pare-feu apr\u00e8s authentification\u00a0:</p> <p></p> <p>Configuration du client VPN SSL Stormshield Network</p> <ul> <li>T\u00e9l\u00e9charger \u00ab\u00a0VPN SSL client\u00a0\u00bb sur le portail captif     (https://(@IP_pare-feu | FQDN_pare-feu)/auth).</li> </ul> <p>Information</p> <p>VPN SSL Client ne peut \u00eatre utilis\u00e9 que sous un seul profil utilisateur Windows. Il doit donc \u00eatre imp\u00e9rativement install\u00e9 sous le profil Windows de l'utilisateur final du logiciel.</p> <p>Vigilence</p> <p>D'autre part, cette installation requiert une \u00e9l\u00e9vation de privil\u00e8ges. Si l'utilisateur ne poss\u00e8de pas les droits d'administration sur le poste de travail, il devra fournir, au cours de l'installation, le nom et le mot de passe d'un compte ayant les droits d'administration.</p> <ul> <li> <p>Faire un double clic sur l'ex\u00e9cutable enregistr\u00e9 sur le poste de     travail.</p> </li> <li> <p>Suivre les diff\u00e9rentes fen\u00eatres propos\u00e9es par l'assistant     d'installation. Seuls le chemin d'installation et un groupe de     programme \u00e0 associer sont \u00e9ventuellement \u00e0 personnaliser.</p> </li> </ul> <p>Le t\u00e9l\u00e9chargement et l'int\u00e9gration des fichiers de configuration sont r\u00e9alis\u00e9s automatiquement lors de l'utilisation de \u00ab\u00a0Stormshield Network SSL VPN Client\u00a0\u00bb. Apr\u00e8s authentification et validation du droit \u00e0 l'utilisation du VPN SSL, le client r\u00e9cup\u00e8re l'ensemble des donn\u00e9es n\u00e9cessaires pour se configurer.</p> <ul> <li> <p>D\u00e9marrer et param\u00e9trer le client. Une fois d\u00e9marr\u00e9, le client VPN     SSL n\u00e9cessite trois param\u00e8tres\u00a0:</p> </li> <li> <p>l'adresse IP ou le FQDN du pare-feu \u00e0 contacter\u00a0:</p> <ul> <li>l'adresse IP ou le FQDN doit bien \u00e9videmment \u00eatre accessible     soit directement soit via une redirection\u00a0;</li> <li> <p>si le port n'est pas le port par d\u00e9faut (1194 en UDP et 443 en     TCP), l'adresse IP ou le FQDN doit \u00eatre suivi de     \u00ab\u00a0:numero_port\u00a0\u00bb</p> <p></p> </li> <li> <p>l'identifiant de l'utilisateur disposant des droits     pour le VPN SSL\u00a0;</p> </li> <li> <p>Le mot de passe de l'utilisateur.</p> </li> </ul> </li> </ul> <p>Une fen\u00eatre indique que la connexion \u00e0 ce site n'est pas s\u00e9curis\u00e9e, car le client ne fait pas confiance \u00e0 la CA signataire du certificat serveur pr\u00e9sent\u00e9 par le portail captif du pare-feu. Il est donc possible :</p> <ul> <li> <p>d'afficher le certificat pour savoir quelle CA l'a sign\u00e9\u00a0;</p> </li> <li> <p>de faire confiance \u00e0 ce certificat, ce qui signifie que la CA est     ajout\u00e9e aux autorit\u00e9s de confiance et qu'il est possible de     continuer avec la configuration du tunnel\u00a0;</p> </li> <li>d'annuler la connexion, ce qui arr\u00eatera la configuration du tunnel.</li> </ul> <p>L'ic\u00f4ne du client VPN SSL Stormshield qui appara\u00eet dans la zone de notification de la barre de t\u00e2ches de Windows poss\u00e8de un code couleur qui correspond \u00e0 son \u00e9tat\u00a0:</p> <ul> <li>Rouge\u00a0: le client est d\u00e9connect\u00e9,</li> <li>Jaune\u00a0: le client essaye de mettre en \u0153uvre le tunnel,</li> <li>Bleu\u00a0: le client est connect\u00e9 (lorsque le client est connect\u00e9, des     informations sur la connexion apparaissent lorsque le curseur de la     souris est positionn\u00e9 sur l'ic\u00f4ne.)</li> </ul> <p>La page de supervision du pare-feu permet de visualiser (et \u00e9ventuellement supprimer en d\u00e9connectant l'utiliateur) les tunnels VPN SSL ouverts dans l'onglet Supervision =&gt; tunnels VPN SSL .</p> <p></p> <p>Les utilisateurs connect\u00e9s via un tunnel VPN SSL sont consid\u00e9r\u00e9s comme authentifi\u00e9s et peuvent \u00eatre visualis\u00e9s dans les traces.</p> <p>Info</p> <p>En cas d'\u00e9chec de la configuration du tunnel, faire un clic droit sur l'ic\u00f4ne VPN SSL Stormshield Network pour afficher les traces.</p> <p>Le client VPN SSL Stormshield poss\u00e8de une fonction de carnet d'adresses, qui peut aider \u00e0 sauvegarder diff\u00e9rents profils VPN dans un seul fichier chiffr\u00e9. Le mot de passe utilis\u00e9 pour prot\u00e9ger le fichier est sp\u00e9cifique. Pour ajouter une entr\u00e9e au carnet d'adresses\u00a0:</p> <ul> <li>Cliquer sur le bouton \u00ab\u00a0Ajouter\u00a0\u00bb, renseigner les d\u00e9tails et cliquer     sur \u00ab\u00a0OK\u00a0\u00bb pour sauvegarder.</li> </ul> <p>Info</p> <p>Il est \u00e9galement possible d'importer/exporter des entr\u00e9es. Le carnet d'adresses se trouve \u00e0 l'emplacement suivant\u00a0:  %USERPROFILE%\\AppData\\Local\\Stormshield\\Stormshield SSL VPN Client\\AddrBook.gap</p> <p>Lorsque le tunnel est mont\u00e9, le poste client disposera d'une interface sp\u00e9cifique au tunnel VPN SSL dont l'adresse IP fait partie de l'objet R\u00e9seau assign\u00e9 au client de la configuration serveur. Les routes n\u00e9cessaires sont automatiquement cr\u00e9\u00e9es. Par exemple sur Linux\u00a0:</p> <pre><code>route -n\n\nTable de routage IP du noyau\n\nDestination Passerelle Genmask Indic Metric Ref Use Iface\n0.0.0.0 10.60.50.5 0.0.0.0 UG 50 0 0 tun0\n10.60.50.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n10.60.50.1 10.60.50.5 255.255.255.255 UGH 50 0 0 tun0\n10.60.50.5 0.0.0.0 255.255.255.255 UH 50 0 0 tun0\n10.61.50.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n10.61.50.1 10.60.50.5 255.255.255.255 UGH 50 0 0 tun0\n172.16.5.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n192.168.5.0 10.60.50.5 255.255.255.128 UG 50 0 0 tun0\n192.168.5.128 10.60.50.5 255.255.255.192 UG 50 0 0 tun0\n192.168.5.192 10.60.50.5 255.255.255.192 UG 50 0 0 tun0\n</code></pre> <p>R\u00e9sultat</p> <p>On peut voir qu'une route par d\u00e9faut est cr\u00e9\u00e9e \u21d2 Du moment que le poste est int\u00e9gr\u00e9 au VPN toutes les communications (y compris l'acc\u00e8s \u00e0 Internet) passe par le pare-feu Stormshield. Il est possible de modifier ce comportement mais cela n'est pas conseill\u00e9 pour des raisons \u00e9videntes de s\u00e9curit\u00e9.</p>"},{"location":"stormshield/fiches/fiche12_vpn_openvpn/#configuration-du-client-openvpn-ssl-sur-linux","title":"Configuration du client openVPN SSL sur Linux","text":"<p>Le fichier \u00ab\u00a0openvpn_client.zip\u00a0\u00bb doit \u00eatre r\u00e9cup\u00e9r\u00e9 sur portail captif de Stormshield et d\u00e9compress\u00e9. Il comprend le fichier de conf du profil (voir ci-dessous) et les certificats\u00a0:</p> <p><pre><code>dev tun\nremote 192.36.253.50 1194 udp\nremote 192.36.253.50 443 tcp\ncipher AES-256-CBC\ntls-cipher TLS-ECDHE-RSA-WITH-AES-128-CBC-SHA256\nauth SHA256\nnobind\nresolv-retry infinite\npersist-key\npersist-tun\nca \\\"CA.cert.pem\\\"\ncert \\\"openvpnclient.cert.pem\\\"\nkey \\\"openvpnclient.pkey.pem\\\"\ncompress lz4\nverb 0\nauth-user-pass\nauth-retry interact\nauth-nocache\nreneg-sec 0\n</code></pre> Configuration sur Linux en UDP avec network-manager (seuls les \u00e9l\u00e9ments modifi\u00e9s sont pr\u00e9cis\u00e9s)\u00a0:</p> <p></p> <ul> <li> <p>Se rendre au menu Param\u00e8tres / R\u00e9seau et cliquer sur \u00ab\u00a0+\u00a0\u00bb au     niveau du VPN</p> </li> <li> <p>Cliquer sur l'onglet \u00ab\u00a0Identit\u00e9\u00a0\u00bb</p> </li> </ul> <p>Ici, le FQDN \u00ab\u00a0cub.corsica\u00a0\u00bb est r\u00e9solu par l'adresse IP publique et le port 1195 est redirig\u00e9 vers le port UDP/1194 du pare-feu Stormshield.</p> <ul> <li>Cliquer sur \u00ab\u00a0Advanced\u00a0\u00bb</li> </ul> <p></p> <p>Il s'agit ici du port d'\u00e9coute en UDP du serveur VPN configur\u00e9 sur le pare-feu.</p> <p></p> <ul> <li> <p>Cliquer sur l'onglet \u00ab\u00a0S\u00e9curit\u00e9</p> <p> -   Enregistrer en cliquant sur \u00ab\u00a0Appliquer\u00a0\u00bb et activer le VPN</p> </li> </ul> <p>Configuration sur Linux en TCP avec network-manager (seuls les \u00e9l\u00e9ments modifi\u00e9s sont pr\u00e9cis\u00e9s)\u00a0:</p> <p> -   Se rendre au menu Param\u00e8tres / R\u00e9seau et cliquer sur \u00ab\u00a0+\u00a0\u00bb au     niveau du VPN</p> <ul> <li>Cliquer sur l'onglet \u00ab\u00a0Identit\u00e9\u00a0\u00bb</li> </ul> <p>Ici, le FQDN \u00ab\u00a0cub.corsica\u00a0\u00bb est r\u00e9solu par l'adresse IP publique et le port 4435 est redirig\u00e9 vers le port TCP/443 du pare-feu Stormshield.</p> <ul> <li>Cliquer sur \u00ab\u00a0Advanced\u00a0\u00bb</li> </ul> <p></p> <p>Il s'agit ici du port d'\u00e9coute en TCP du serveur VPN configur\u00e9 sur le pare-feu.</p> <ul> <li>Cocher \u00ab\u00a0Utiliser une connexion TCP\u00a0\u00bb car, par d\u00e9faut, le client VPN     initie une connexion UDP\u00a0\u00bb</li> </ul> <p></p> <ul> <li>Enregistrer en cliquant sur \u00ab\u00a0Appliquer\u00a0\u00bb et activer le VPN</li> </ul> <p></p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/","title":"Fiche 13 -- VPN site \u00e0 site","text":""},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#le-vpn-ipsec","title":"Le VPN IPSec","text":""},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#concepts-et-generalites","title":"Concepts et g\u00e9n\u00e9ralit\u00e9s","text":"<p>Le tunnel VPN IPsec site-\u00e0-site permet de connecter deux r\u00e9seaux priv\u00e9s via un r\u00e9seau public tout en assurant les services de s\u00e9curit\u00e9 suivants :</p> <ul> <li>l'authentification : permet la v\u00e9rification des identit\u00e9s des     deux extr\u00e9mit\u00e9s de tunnel. Deux m\u00e9thodes d'authentification sont     possibles : cl\u00e9 pr\u00e9-partag\u00e9e (PSK : Pre-Shared key) ou certificats     (PKI : Public Key Infrastructure)\u00a0;</li> <li>l'int\u00e9grit\u00e9 : v\u00e9rifie que les donn\u00e9es n'ont pas \u00e9t\u00e9 modifi\u00e9es en     utilisant les algorithmes de hachage\u00a0;</li> <li>la confidentialit\u00e9 : assure que les donn\u00e9es ne peuvent \u00eatre lues     par une personne tierce capturant le trafic\u00a0;</li> <li>l'anti-rejeu : permet d'ignorer des anciens paquets (des     paquets dont le num\u00e9ro de s\u00e9quence est ant\u00e9rieur \u00e0 un certain seuil)     d\u00e9j\u00e0 re\u00e7us, s'ils sont transmis \u00e0 nouveau.</li> </ul> <p>La n\u00e9gociation du tunnel entre les deux extr\u00e9mit\u00e9s s'effectue avec le protocole ISAKMP (Internet Security Association Key Management Protocol) appel\u00e9 aussi IKE dont la derni\u00e8re version se nomme IKEv2.</p> <p>Une fois le tunnel \u00e9tabli entre les deux \u00e9quipements, les extr\u00e9mit\u00e9s de trafic correspondantes aux r\u00e9seaux priv\u00e9s peuvent communiquer via le protocole ESP (Encapsultating Security Payload) qui assure la confidentialit\u00e9 et l'int\u00e9grit\u00e9 des donn\u00e9es \u00e9chang\u00e9es. Le protocole ESP est encapsul\u00e9 directement dans un datagramme IP.</p> <p></p> <p>Important </p> <p>Dans le respect des bonnes pratiques, il est recommand\u00e9 d'utiliser le protocole IKEv2 pour la mise en \u0153uvre du tunnel et une authentification forte par certificats X509.</p> <p>Vous pouvez bien evidement commencer par un premier test avec une Shared Key (cl\u00e9 partag\u00e9) aux deux extermit\u00e9s du tunnel.</p> <p></p> <p>Phase 1\u00a0: Les deux extr\u00e9mit\u00e9s du tunnel n\u00e9gocient un profil de chiffrement phase 1 et s'authentifient avec un cl\u00e9 pr\u00e9-partag\u00e9e ou des certificats X509. Un dialogue d'application chiffr\u00e9 nomm\u00e9 PARENT-SA permet ensuite de d\u00e9marrer la n\u00e9gociation de la phase 2. Si les deux extr\u00e9mit\u00e9s n'arrivent pas \u00e0 se mettre d'accord sur un profil de chiffrement ou \u00e0 s'authentifier, la n\u00e9gociation s'arr\u00eate imm\u00e9diatement.</p> <p>Phase\u00a02\u00a0: Les deux extr\u00e9mit\u00e9s vont n\u00e9gocier le profil de chiffrement de la phase 2 et les extr\u00e9mit\u00e9s de trafic qui permettront la communication \u00e0 travers le tunnel. Deux canaux sont ouverts pour le transmission des donn\u00e9es, un pour chaque direction. Chaque canal utilise sa propre cl\u00e9 de chiffrement appel\u00e9e CHILD-SA1 et CHILD-SA2. Chaque extr\u00e9mit\u00e9 poss\u00e9dera donc deux cl\u00e9s sym\u00e9triques, une pour chiffrer les donn\u00e9es \u00e0 envoyer et l'autre pour d\u00e9chiffrer les donn\u00e9es re\u00e7ues dans l'autre canal.</p> <p>Attention </p> <p>Les tunnels IPSec sont g\u00e9n\u00e9rallement mont\u00e9 sur des routeurs ayant des IP Publiques.  Quand le Tunnel doit \u00eatre mont\u00e9 sur des routeurs \"cach\u00e9s\" derri\u00e8re du NAT, il faut configurer ce qu'on appelle commun\u00e9ment le NAT-T (NAT Traversal)</p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#configurer-le-service-vpn-ipsec","title":"Configurer le service VPN IPSec","text":"<p>L'authentification lors de la cr\u00e9ation d'un tunnel VPN IPSec peut se faire de deux fa\u00e7ons\u00a0:</p> <ul> <li>par la d\u00e9finition d'une cl\u00e9 pr\u00e9-partag\u00e9e commune\u00a0;</li> <li>par l'utilisation de certificats X509 cr\u00e9\u00e9s pour chaque extr\u00e9mit\u00e9 \u00e0     l'aide d'une PKI (Infrastructure \u00e0 cl\u00e9s publiques utilisant une     autorit\u00e9 de certification).</li> </ul> <p>L'utilisation de la cl\u00e9 pr\u00e9-partag\u00e9e est d\u00e9conseill\u00e9e en production et valable uniquement lors de phase de tests ou du maquettage. Nous choisirons ici l'authentification par certificats.</p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#gestion-de-la-pki-du-sns","title":"Gestion de la PKI du SNS","text":"<p>Dans un premier temps, il est donc n\u00e9cessaire de cr\u00e9er une PKI sur l'un des pare-feux puis de cr\u00e9er des certificats serveurs pour chaque extr\u00e9mit\u00e9 du tunnel (ex\u00a0: un certificat pour le pare-feu de edimbourg et un certificat pour le pare-feu de frankfurt).</p> <p>Cliquer sur Configuration &gt; Objets &gt; Certificats et PKI</p> <p></p> <p>Puis sur Ajouter &gt; Autorit\u00e9 racine</p> <p></p> <p></p> <p></p> <p></p> <p>Une fois la nouvelle PKI cr\u00e9\u00e9e, il est n\u00e9cessaire de g\u00e9n\u00e9rer 2 certificats pour les 2 pare-feux concern\u00e9s. Pour cela, s\u00e9lectionner la PKI pki.cub.fr et cliquer sur Ajouter &gt; Identit\u00e9 serveur afin de cr\u00e9er un certificat pour le pare-feu d'Edimbourg.</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>Il faut ensuite r\u00e9aliser la m\u00eame op\u00e9ration afin de cr\u00e9er un certificat pour le pare-feu de Frankfurt en adaptant certains param\u00e8tres dont en particulier le CN (Common Name) du certificat.</p> <p>Nous avons maintenant \u00e0 notre disposition une PKI et 2 certificats g\u00e9n\u00e9r\u00e9s.</p> <p></p> <p>Comme la PKI a \u00e9t\u00e9 cr\u00e9\u00e9e sur le pare-feu d'Edimbourg, il est n\u00e9cessaire d'exporter le certificat du pare-feu de Frankfurt sur le pare-feu de l'agence de Frankfurt.</p> <p>Pour cela, clique droit sur le certificat concern\u00e9 puis T\u00e9l\u00e9charger &gt; Identit\u00e9 &gt; au format P12. Il est demand\u00e9 d'entrer un mot de passe qui permettra de prot\u00e9ger votre cl\u00e9 priv\u00e9e en particulier en cas de vol ou de compromission.</p> Format P12 <p>Certificat P12 (PKCS#12) - Encodage : Le format P12 est encod\u00e9 en binaire. - Structure : C'est un conteneur binaire qui peut stocker \u00e0 la fois des certificats, des cl\u00e9s priv\u00e9es et m\u00eame des cha\u00eenes de certificats (certificats interm\u00e9diaires et racine). - Utilisation : Le format P12 est utilis\u00e9 pour transporter \u00e0 la fois un certificat et sa cl\u00e9 priv\u00e9e dans un seul fichier, souvent pour les besoins d'import/export (ex. : sur les navigateurs, serveurs ou clients). - Extension de fichier : Les fichiers P12 ont souvent l'extension <code>.p12</code> ou <code>.pfx</code>. - S\u00e9curit\u00e9 : Le fichier P12 peut \u00eatre prot\u00e9g\u00e9 par un mot de passe pour s\u00e9curiser les cl\u00e9s priv\u00e9es qu'il contient. - Lisibilit\u00e9 : Non lisible en texte brut, car c'est un fichier binaire. Il doit \u00eatre ouvert avec des outils sp\u00e9cialis\u00e9s (comme <code>OpenSSL</code> ou les gestionnaires de certificats dans les syst\u00e8mes d'exploitation).</p> <p></p> <p></p> <p>Une fois le fichier p12 t\u00e9l\u00e9charg\u00e9 sur le poste, il est n\u00e9cessaire de l'importer dans l'autre pare-feu en l'occurence celui de Franckfurt. Pour cela, se connecter sur l'interface d'administration du pare-feu concern\u00e9 en s'assurant de disposer du fichier p12 sur le poste client d'administration.</p> <p>Puis cliquer sur Configuration &gt; Objets &gt; Certificats et PKI puis sur Ajouter &gt; Importer un fichier.</p> <p></p> <p></p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#configuration-du-vpn-ipsec","title":"Configuration du VPN IPSEC","text":"<p>Maintenant que chaque pare-feu dispose de son certificat sign\u00e9 par la PKI pr\u00e9c\u00e9demment cr\u00e9\u00e9e, il s'agit de configurer le tunnel VPN IPSEC sur les deux extr\u00e9mit\u00e9s.</p> <p>Sur le pare-feu de Edimbourg, cliquer sur Configuration &gt; VPN &gt; VPN IPsec et choisir la politique IPsec 04 (04) qu'il faudra renommer IPsec-EdFk.</p> <p></p> <p>Puis cliquer sur Ajouter &gt; Tunnel site \u00e0 site simple.</p> <p>Un assistant s'ouvre et permet de d\u00e9finir quel sous-r\u00e9seau ou VLAN de votre agence (ici Edimbourg) pourra envoyer et recevoir des flux par le tunnel VPN IPSec jusqu'\u00e0 l'autre agence (ici Frankfurt). Ainsi, en ressources locales, indiquer le sous-r\u00e9seau ou le VLAN pr\u00e9sent dans votre agence (si vous souhaitez permettre la communication de plusieurs sous-r\u00e9seaux, il faut au pr\u00e9alable cr\u00e9er un objet groupe contenant l'ensemble des sous-r\u00e9seaux concern\u00e9s).</p> <p>En r\u00e9seaux distants, vous indiquerez un objet r\u00e9seau correspondant au sous-r\u00e9seau \u00e0 joindre dans l'autre agence. Enfin, il sera indispensable de d\u00e9finir un correspondant et de le s\u00e9lectionner.</p> <p></p> <p></p> <p></p> <p>Attention</p> <p>Attention\u00a0! Cette \u00e9tape peut porter \u00e0 confusion. Bien que le terme \u00ab\u00a0identification du correspondant\u00a0\u00bb soit employ\u00e9 ici, c'est bien le certificat du pare-feu sur lequel vous \u00eates connect\u00e9 (ici pare-feu Edimbourg) qu'il faut indiquer et non celui du pare-feu distant.</p> <p></p> <p></p> <p></p> <p>Lorsque la cr\u00e9ation du tunnel IPSec est effective, il faut bien \u00e9videmment l'activer (on) et d\u00e9finir une valeur en seconde de Keepalive (vous veillerez \u00e0 d\u00e9finir la m\u00eame valeur sur le pare-feu distant, ici, Frankfurt). Cela permettra de faciliter l'activation du tunnel et assurera le maintien de ce dernier m\u00eame en cas d'absence de trafic \u00e0 l'int\u00e9rieur de celui-ci (lire l'explication ci-dessous).</p> <p>KeepAlive</p> <p>L'option suppl\u00e9mentaire Keepalive permet de maintenir les tunnels mont\u00e9s de fa\u00e7on artificielle. Cette m\u00e9canique envoie des paquets initialisant et for\u00e7ant le maintien du tunnel. Cette option est d\u00e9sactiv\u00e9e par d\u00e9faut pour \u00e9viter une charge inutile, dans le cas de configuration contenant de nombreux tunnels, mont\u00e9s en m\u00eame temps sans r\u00e9el besoin.</p> <p>Pour activer cette option, affectez une valeur supp\u00e9rieur \u00e0  0, correspondant \u00e0 l'intervalle en seconde, entre chaque envoi de paquet UDP.</p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#mise-en-uvre-des-regles-de-filtrage-adaptees","title":"Mise en \u0153uvre des r\u00e8gles de filtrage adapt\u00e9es","text":"<p>Pour que la communication par l'interm\u00e9diaire de ce tunnel IPsec soit pleinement fonctionnel, il est n\u00e9cessaire de cr\u00e9er les r\u00e8gles de filtrage permettant d'autoriser la cr\u00e9ation du VPN puis la communication entre les sous-r\u00e9seaux distants.</p> <p>Toujours sur le pare-feu de l'agence d'Edimbourg, il faut autoriser l'\u00e9tablissement du tunnel (protocoles ISAKMP et ESP) entre les deux pare-feux. Normalement, une r\u00e8gle implicite est pr\u00e9vue \u00e0 cet effet, cependant lors de diff\u00e9rentes phases de test, cela s'est av\u00e9r\u00e9 peu concluant, ce qui nous am\u00e8ne \u00e0 proposer des r\u00e8gles explicites \u00e0 ce sujet.</p> <p></p> <p>Enfin, il faut d\u00e9finir les r\u00e8gles n\u00e9cessaires autorisant la communication des sous-r\u00e9seaux d\u00e9finis dans la configuration du tunnel au niveau des r\u00e8gles de filtrage.</p> <p></p> <p>La directive \u00ab\u00a0via Tunnel VPN IPsec\u00a0\u00bb dans la seconde r\u00e8gle est tr\u00e8s importante et obligatoire. Il est possible de la d\u00e9finir lors de la cr\u00e9ation de la r\u00e8gle dans le menu Source &gt; Configuration avanc\u00e9e &gt; Via\u00a0: Tunnel VPN IPSec.</p> <p>\u00c0 partir de l\u00e0, il s'agira de r\u00e9aliser exactement les m\u00eames op\u00e9rations dans le sens inverse sur le pare-feu de l'autre agence (ici Frankfurt) afin de rendre le tunnel pleinement op\u00e9rationnel.</p> <p>Nota Bene</p> <p>NB\u00a0: La plupart des erreurs rencontr\u00e9es proviennent de diff\u00e9rences de configuration entre les deux extr\u00e9mit\u00e9s du tunnel (Profil de chiffrement utilis\u00e9, Keepalive, d\u00e9finition des sous-r\u00e9seaux habilit\u00e9s \u00e0 solliciter le tunnel VPN, etc). Il s'agit donc de faire preuve de rigueur et d'attention sur ces \u00e9l\u00e9ments en particulier.</p>"},{"location":"stormshield/fiches/fiche13_vpn_ipsec/#gestion-du-nat-traversal-nat-t","title":"Gestion du NAT-Traversal (NAT-T)","text":"<p>Lorsque vous montez un tunnel IPSec entre deux \u00e9quipements Stormshield, ces \u00e9quipements vont chiffrer les paquets et les encapsuler dans le protocole ESP (Encapsulating Security Payload), qui est un protocole de la suite IPSec.</p> <p>Probl\u00e8me : Les routeurs Cisco situ\u00e9s entre les deux \u00e9quipements effectuent du NAT (Network Address Translation). Le NAT pose un probl\u00e8me avec ESP, car :</p> <ul> <li>ESP est un protocole IP (\u201cprotocol 50\u201d) et ne poss\u00e8de pas de num\u00e9ro de port. Cela pose un probl\u00e8me avec le NAT (Network Address Translation) (comme avec TCP ou UDP).</li> <li>Le NAT modifie les adresses IP : Cela casse l\u2019int\u00e9grit\u00e9 du paquet IPSec, car les \u00e9quipements IPSec v\u00e9rifient l\u2019int\u00e9grit\u00e9 des paquets (checksum + hash) et d\u00e9tectent toute modification comme une attaque.</li> </ul> <p>Solution : NAT-Traversal (NAT-T) Pour contourner ce probl\u00e8me, on encapsule les paquets ESP dans de l'UDP/4500.</p> <p>Voici les \u00e9tapes du NAT-T :</p> <ul> <li>D\u00e9tection du NAT : Lors de la phase d\u2019\u00e9tablissement du tunnel IPSec (IKE), les \u00e9quipements Stormshield et Cisco \u00e9changent des messages pour d\u00e9tecter s\u2019il y a un NAT entre eux.</li> <li>L\u2019usage du NAT-T provoquera l\u2019ajout d\u2019un en-t\u00eate UDP de 8 octets.</li> <li>Encapsulation ESP dans UDP/4500 : Une fois le NAT d\u00e9tect\u00e9, les paquets ESP sont encapsul\u00e9s dans des paquets UDP, port 4500, ce qui permet au NAT de fonctionner correctement.</li> <li>D\u00e9capsulation : \u00c0 la r\u00e9ception, l\u2019\u00e9quipement IPSec retire l\u2019en-t\u00eate UDP et traite normalement le paquet ESP.</li> </ul> <p></p> <p>Important</p> <p>NB\u00a0: Certains routeurs supportent l'autodetection de NAT-T, dautres non. Il faut evidement s'adapter au materiel utilis\u00e9. Nos vieux routeurs ne le supporte pas.</p> <p>Si l'\u00e9quipement supporte nativement NAT-T il suffit de l'activer.  Exemple sur un \u00e9quipement cisco:</p> <pre><code>crypto isakmp nat-traversal 20  #Le 20 correspond au d\u00e9lai en secondes pour d\u00e9tecter un NAT.\n</code></pre> <p>Dans le cas contraire, il faut forcer l'activation du NAT-T sur le firewall (Stromshield en l'occurence). et bien configurer la redirection du port UDP 4500 (pour ikeV2). Le port UDP 500 \u00e9tait autrefois utilis\u00e9 pour IKEv1.</p> <pre><code>    ! Activer la redirection des ports UDP 4500 (NAT-T)\nip nat inside source static udp 192.168.1.1 4500 interface GigabitEthernet0/0 4500\n</code></pre>"}]}